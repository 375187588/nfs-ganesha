<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>nfs-ganesha: handle_mapping_db.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.3 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">nfs-ganesha&#160;<span id="projectnumber">1.4</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<h1>handle_mapping_db.h File Reference</h1>  </div>
</div>
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="handle__mapping_8h_source.html">handle_mapping.h</a>&quot;</code><br/>
<code>#include &quot;HashTable.h&quot;</code><br/>
</div>
<p><a href="handle__mapping__db_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handle__mapping__db_8h.html#adda334f61ab4cee495ed3a903b3411b5">DB_FILE_PREFIX</a>&#160;&#160;&#160;&quot;handlemap.sqlite&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handle__mapping__db_8h.html#a9c601a442dc29976b60120c915ef84b3">MAP_TABLE</a>&#160;&#160;&#160;&quot;HandleMap&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handle__mapping__db_8h.html#a3e9c5fccb8dbc206ea47bf531f0688b5">OBJID_FIELD</a>&#160;&#160;&#160;&quot;ObjectId&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handle__mapping__db_8h.html#aad17466ae542455fe7e8ea56e7436479">HASH_FIELD</a>&#160;&#160;&#160;&quot;HandleHash&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handle__mapping__db_8h.html#a7974c11e30bdfecc467966933f706956">HANDLE_FIELD</a>&#160;&#160;&#160;&quot;FSALHandle&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handle__mapping__db_8h.html#ad9ea0b4ebe351aa81298c581eeb55e7d">MAX_DB</a>&#160;&#160;&#160;32</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handle__mapping__db_8h.html#a65211e81cdb4243b7ca7013b437f8062">handlemap_db_count</a> (const char *dir)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handle__mapping__db_8h.html#a7d4c84d25d5186bfc841894804c0a0a7">handlemap_db_init</a> (const char *db_dir, const char *tmp_dir, unsigned int db_count, unsigned int nb_dbop_prealloc, int synchronous_insert)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handle__mapping__db_8h.html#ae1ee2f5c3aa50da08f42057d68c3a788">handlemap_db_reaload_all</a> (<a class="el" href="structhash__table.html">hash_table_t</a> *target_hash)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handle__mapping__db_8h.html#a6023d6d71f28fb6cc9d60564385742f5">handlemap_db_insert</a> (<a class="el" href="structnfs23__map__handle____.html">nfs23_map_handle_t</a> *p_in_nfs23_digest, <a class="el" href="structfsal__handle____.html">fsal_handle_t</a> *p_in_handle)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handle__mapping__db_8h.html#ada3129912ad3922ded904906a58c46fe">handlemap_db_delete</a> (<a class="el" href="structnfs23__map__handle____.html">nfs23_map_handle_t</a> *p_in_nfs23_digest)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handle__mapping__db_8h.html#a490b32e5e8ea302d9a24948be1704785">handlemap_db_flush</a> ()</td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="adda334f61ab4cee495ed3a903b3411b5"></a><!-- doxytag: member="handle_mapping_db.h::DB_FILE_PREFIX" ref="adda334f61ab4cee495ed3a903b3411b5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DB_FILE_PREFIX&#160;&#160;&#160;&quot;handlemap.sqlite&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="handle__mapping__db_8h_source.html#l00007">7</a> of file <a class="el" href="handle__mapping__db_8h_source.html">handle_mapping_db.h</a>.</p>

</div>
</div>
<a class="anchor" id="a7974c11e30bdfecc467966933f706956"></a><!-- doxytag: member="handle_mapping_db.h::HANDLE_FIELD" ref="a7974c11e30bdfecc467966933f706956" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define HANDLE_FIELD&#160;&#160;&#160;&quot;FSALHandle&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="handle__mapping__db_8h_source.html#l00013">13</a> of file <a class="el" href="handle__mapping__db_8h_source.html">handle_mapping_db.h</a>.</p>

</div>
</div>
<a class="anchor" id="aad17466ae542455fe7e8ea56e7436479"></a><!-- doxytag: member="handle_mapping_db.h::HASH_FIELD" ref="aad17466ae542455fe7e8ea56e7436479" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define HASH_FIELD&#160;&#160;&#160;&quot;HandleHash&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="handle__mapping__db_8h_source.html#l00012">12</a> of file <a class="el" href="handle__mapping__db_8h_source.html">handle_mapping_db.h</a>.</p>

</div>
</div>
<a class="anchor" id="a9c601a442dc29976b60120c915ef84b3"></a><!-- doxytag: member="handle_mapping_db.h::MAP_TABLE" ref="a9c601a442dc29976b60120c915ef84b3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAP_TABLE&#160;&#160;&#160;&quot;HandleMap&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="handle__mapping__db_8h_source.html#l00010">10</a> of file <a class="el" href="handle__mapping__db_8h_source.html">handle_mapping_db.h</a>.</p>

</div>
</div>
<a class="anchor" id="ad9ea0b4ebe351aa81298c581eeb55e7d"></a><!-- doxytag: member="handle_mapping_db.h::MAX_DB" ref="ad9ea0b4ebe351aa81298c581eeb55e7d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_DB&#160;&#160;&#160;32</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="handle__mapping__db_8h_source.html#l00015">15</a> of file <a class="el" href="handle__mapping__db_8h_source.html">handle_mapping_db.h</a>.</p>

</div>
</div>
<a class="anchor" id="a3e9c5fccb8dbc206ea47bf531f0688b5"></a><!-- doxytag: member="handle_mapping_db.h::OBJID_FIELD" ref="a3e9c5fccb8dbc206ea47bf531f0688b5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OBJID_FIELD&#160;&#160;&#160;&quot;ObjectId&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="handle__mapping__db_8h_source.html#l00011">11</a> of file <a class="el" href="handle__mapping__db_8h_source.html">handle_mapping_db.h</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a65211e81cdb4243b7ca7013b437f8062"></a><!-- doxytag: member="handle_mapping_db.h::handlemap_db_count" ref="a65211e81cdb4243b7ca7013b437f8062" args="(const char *dir)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int handlemap_db_count </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>dir</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>count the number of database instances in a given directory (this is used for checking that the number of db matches the number of threads) </p>

<p>Definition at line <a class="el" href="handle__mapping__db_8c_source.html#l00609">609</a> of file <a class="el" href="handle__mapping__db_8c_source.html">handle_mapping_db.c</a>.</p>

</div>
</div>
<a class="anchor" id="ada3129912ad3922ded904906a58c46fe"></a><!-- doxytag: member="handle_mapping_db.h::handlemap_db_delete" ref="ada3129912ad3922ded904906a58c46fe" args="(nfs23_map_handle_t *p_in_nfs23_digest)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int handlemap_db_delete </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structnfs23__map__handle____.html">nfs23_map_handle_t</a> *&#160;</td>
          <td class="paramname"><em>p_in_nfs23_digest</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Submit a db 'delete' request. The request is inserted in the appropriate db queue. (always asynchronous) </p>

<p>Definition at line <a class="el" href="handle__mapping__db_8c_source.html#l00848">848</a> of file <a class="el" href="handle__mapping__db_8c_source.html">handle_mapping_db.c</a>.</p>

</div>
</div>
<a class="anchor" id="a490b32e5e8ea302d9a24948be1704785"></a><!-- doxytag: member="handle_mapping_db.h::handlemap_db_flush" ref="a490b32e5e8ea302d9a24948be1704785" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int handlemap_db_flush </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Wait for all queues to be empty and all current DB request to be done. </p>

<p>Definition at line <a class="el" href="handle__mapping__db_8c_source.html#l00885">885</a> of file <a class="el" href="handle__mapping__db_8c_source.html">handle_mapping_db.c</a>.</p>

</div>
</div>
<a class="anchor" id="a7d4c84d25d5186bfc841894804c0a0a7"></a><!-- doxytag: member="handle_mapping_db.h::handlemap_db_init" ref="a7d4c84d25d5186bfc841894804c0a0a7" args="(const char *db_dir, const char *tmp_dir, unsigned int db_count, unsigned int nb_dbop_prealloc, int synchronous_insert)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int handlemap_db_init </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>db_dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>tmp_dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>db_count</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>nb_dbop_prealloc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>synchronous_insert</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Initialize databases access (init DB queues, start threads, establish DB connections, and create db schema if it was empty).</p>
<p>Initialize databases access</p>
<ul>
<li>init DB queues</li>
<li>start threads</li>
<li>establish DB connections</li>
<li>create db schema if it was empty </li>
</ul>

<p><dl class="todo"><dt><b><a class="el" href="todo.html#_todo000052">Todo:</a></b></dt><dd>ici coller out_parameter-&gt;fs_specific_info.hdlmap_nb_db_op_prealloc </dd></dl>
</p>

<p>Definition at line <a class="el" href="handle__mapping__db_8c_source.html#l00692">692</a> of file <a class="el" href="handle__mapping__db_8c_source.html">handle_mapping_db.c</a>.</p>

</div>
</div>
<a class="anchor" id="a6023d6d71f28fb6cc9d60564385742f5"></a><!-- doxytag: member="handle_mapping_db.h::handlemap_db_insert" ref="a6023d6d71f28fb6cc9d60564385742f5" args="(nfs23_map_handle_t *p_in_nfs23_digest, fsal_handle_t *p_in_handle)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int handlemap_db_insert </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structnfs23__map__handle____.html">nfs23_map_handle_t</a> *&#160;</td>
          <td class="paramname"><em>p_in_nfs23_digest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfsal__handle____.html">fsal_handle_t</a> *&#160;</td>
          <td class="paramname"><em>p_in_handle</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Submit a db 'insert' request. The request is inserted in the appropriate db queue. </p>

<p>Definition at line <a class="el" href="handle__mapping__db_8c_source.html#l00804">804</a> of file <a class="el" href="handle__mapping__db_8c_source.html">handle_mapping_db.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae1ee2f5c3aa50da08f42057d68c3a788"></a><!-- doxytag: member="handle_mapping_db.h::handlemap_db_reaload_all" ref="ae1ee2f5c3aa50da08f42057d68c3a788" args="(hash_table_t *target_hash)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int handlemap_db_reaload_all </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structhash__table.html">hash_table_t</a> *&#160;</td>
          <td class="paramname"><em>target_hash</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Gives the order to each DB thread to reload the content of its database and insert it to the hash table. The function blocks until all threads have loaded their data. </p>

<p>Definition at line <a class="el" href="handle__mapping__db_8c_source.html#l00760">760</a> of file <a class="el" href="handle__mapping__db_8c_source.html">handle_mapping_db.c</a>.</p>

</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Wed Nov 21 2012 for nfs-ganesha by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </small></address>
</body>
</html>
