<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>nfs-ganesha: nfs_worker_thread.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.3 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">nfs-ganesha&#160;<span id="projectnumber">1.4</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>nfs_worker_thread.c</h1>  </div>
</div>
<div class="contents">
<a href="nfs__worker__thread_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * vim:expandtab:shiftwidth=8:tabstop=8:</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * Copyright CEA/DAM/DIF  (2008)</span>
<a name="l00005"></a>00005 <span class="comment"> * contributeur : Philippe DENIEL   philippe.deniel@cea.fr</span>
<a name="l00006"></a>00006 <span class="comment"> *                Thomas LEIBOVICI  thomas.leibovici@cea.fr</span>
<a name="l00007"></a>00007 <span class="comment"> *</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00010"></a>00010 <span class="comment"> * modify it under the terms of the GNU Lesser General Public</span>
<a name="l00011"></a>00011 <span class="comment"> * License as published by the Free Software Foundation; either</span>
<a name="l00012"></a>00012 <span class="comment"> * version 3 of the License, or (at your option) any later version.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00015"></a>00015 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00016"></a>00016 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<a name="l00017"></a>00017 <span class="comment"> * Lesser General Public License for more details.</span>
<a name="l00018"></a>00018 <span class="comment"> *</span>
<a name="l00019"></a>00019 <span class="comment"> * You should have received a copy of the GNU Lesser General Public</span>
<a name="l00020"></a>00020 <span class="comment"> * License along with this library; if not, write to the Free Software</span>
<a name="l00021"></a>00021 <span class="comment"> * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * ---------------------------------------</span>
<a name="l00024"></a>00024 <span class="comment"> */</span>
<a name="l00025"></a>00025 
<a name="l00038"></a>00038 <span class="preprocessor">#ifdef HAVE_CONFIG_H</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span><span class="preprocessor">#include &quot;config.h&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#endif</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span>
<a name="l00042"></a>00042 <span class="preprocessor">#ifdef _SOLARIS</span>
<a name="l00043"></a>00043 <span class="preprocessor"></span><span class="preprocessor">#include &quot;solaris_port.h&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#endif</span>
<a name="l00045"></a>00045 <span class="preprocessor"></span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &lt;assert.h&gt;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &lt;stdbool.h&gt;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &lt;pthread.h&gt;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &lt;fcntl.h&gt;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &lt;sys/file.h&gt;</span>           <span class="comment">/* for having FNDELAY */</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &lt;sys/signal.h&gt;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &lt;poll.h&gt;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;HashData.h&quot;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;HashTable.h&quot;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;log.h&quot;</span>
<a name="l00058"></a>00058 <span class="preprocessor">#include &quot;ganesha_rpc.h&quot;</span>
<a name="l00059"></a>00059 <span class="preprocessor">#include &quot;nfs23.h&quot;</span>
<a name="l00060"></a>00060 <span class="preprocessor">#include &quot;nfs4.h&quot;</span>
<a name="l00061"></a>00061 <span class="preprocessor">#include &quot;mount.h&quot;</span>
<a name="l00062"></a>00062 <span class="preprocessor">#include &quot;nlm4.h&quot;</span>
<a name="l00063"></a>00063 <span class="preprocessor">#include &quot;rquota.h&quot;</span>
<a name="l00064"></a>00064 <span class="preprocessor">#include &quot;nfs_core.h&quot;</span>
<a name="l00065"></a>00065 <span class="preprocessor">#include &quot;cache_inode.h&quot;</span>
<a name="l00066"></a>00066 <span class="preprocessor">#include &quot;nfs_exports.h&quot;</span>
<a name="l00067"></a>00067 <span class="preprocessor">#include &quot;nfs_creds.h&quot;</span>
<a name="l00068"></a>00068 <span class="preprocessor">#include &quot;nfs_proto_functions.h&quot;</span>
<a name="l00069"></a>00069 <span class="preprocessor">#include &quot;nfs_dupreq.h&quot;</span>
<a name="l00070"></a>00070 <span class="preprocessor">#include &quot;nfs_file_handle.h&quot;</span>
<a name="l00071"></a>00071 <span class="preprocessor">#include &quot;nfs_stat.h&quot;</span>
<a name="l00072"></a>00072 <span class="preprocessor">#include &quot;nfs_tcb.h&quot;</span>
<a name="l00073"></a>00073 <span class="preprocessor">#include &quot;SemN.h&quot;</span>
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 <span class="keyword">extern</span> <a class="code" href="structnfs__worker__data____.html">nfs_worker_data_t</a> *<a class="code" href="nfs__core_8h.html#a4dfa2d28740c327f84868034c781f5d4">workers_data</a>;
<a name="l00076"></a>00076 
<a name="l00077"></a><a class="code" href="nfs__worker__thread_8c.html#a018598c904c79ffce5c8a8b997f9fc7c">00077</a> <a class="code" href="structpool.html" title="Type representing a pool.">pool_t</a> *<a class="code" href="nfs__core_8h.html#a018598c904c79ffce5c8a8b997f9fc7c">request_pool</a>;
<a name="l00078"></a><a class="code" href="nfs__worker__thread_8c.html#abc74f9c5987eaf6c9af98852e40b4653">00078</a> <a class="code" href="structpool.html" title="Type representing a pool.">pool_t</a> *<a class="code" href="nfs__core_8h.html#abc74f9c5987eaf6c9af98852e40b4653">request_data_pool</a>;
<a name="l00079"></a><a class="code" href="nfs__worker__thread_8c.html#a120af9c25da978b5bec06f8ca0453219">00079</a> <a class="code" href="structpool.html" title="Type representing a pool.">pool_t</a> *<a class="code" href="nfs__core_8h.html#a120af9c25da978b5bec06f8ca0453219">dupreq_pool</a>;
<a name="l00080"></a><a class="code" href="nfs__worker__thread_8c.html#ae764f3008acff52e16850c39adfd6eda">00080</a> <a class="code" href="structpool.html" title="Type representing a pool.">pool_t</a> *<a class="code" href="nfs__core_8h.html#ae764f3008acff52e16850c39adfd6eda">ip_stats_pool</a>;
<a name="l00081"></a>00081 
<a name="l00082"></a>00082 <span class="comment">/* These two variables keep state of the thread that gc at this time */</span>
<a name="l00083"></a><a class="code" href="nfs__worker__thread_8c.html#a1aaee2caa31305958d161507860bda96">00083</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="nfs__worker__thread_8c.html#a1aaee2caa31305958d161507860bda96">nb_current_gc_workers</a>;
<a name="l00084"></a><a class="code" href="nfs__worker__thread_8c.html#abe04e34ee93c05b0ef368bc7f20f5656">00084</a> pthread_mutex_t <a class="code" href="nfs__worker__thread_8c.html#abe04e34ee93c05b0ef368bc7f20f5656">lock_nb_current_gc_workers</a>;
<a name="l00085"></a>00085 
<a name="l00086"></a><a class="code" href="nfs__worker__thread_8c.html#a17e820f36f50303164aa1a93909155e3">00086</a> <span class="keyword">const</span> <a class="code" href="structnfs__function__desc____.html">nfs_function_desc_t</a> <a class="code" href="nfs__worker__thread_8c.html#a17e820f36f50303164aa1a93909155e3">invalid_funcdesc</a> =
<a name="l00087"></a>00087   {<a class="code" href="group__NFSprocs.html#gab077e61380d1d6be40777cf6b9ae6171">nfs_Null</a>, <a class="code" href="group__NFSprocs.html#ga77bc02fb872c0855f4166a6b642f09b3">nfs_Null_Free</a>, (xdrproc_t) xdr_void, (xdrproc_t) xdr_void,
<a name="l00088"></a>00088    <span class="stringliteral">&quot;invalid_function&quot;</span>, <a class="code" href="nfs__proto__functions_8h.html#aed6ce17d8db2471a85ee3f6add005aab">NOTHING_SPECIAL</a>};
<a name="l00089"></a>00089 
<a name="l00090"></a><a class="code" href="nfs__worker__thread_8c.html#a5ecbbf13d82cd2cbf2d6d80cb61624c5">00090</a>   <span class="keyword">const</span> <a class="code" href="structnfs__function__desc____.html">nfs_function_desc_t</a> *<a class="code" href="nfs__core_8h.html#a5ecbbf13d82cd2cbf2d6d80cb61624c5">INVALID_FUNCDESC</a> = &amp;<a class="code" href="nfs__worker__thread_8c.html#a17e820f36f50303164aa1a93909155e3">invalid_funcdesc</a>;
<a name="l00091"></a>00091 
<a name="l00092"></a>00092 <span class="comment">/* Static array : all the function pointer per nfs v2 functions */</span>
<a name="l00093"></a><a class="code" href="nfs__dupreq_8c.html#ad1973964670037b91a33fd6b6e4c40bc">00093</a> <span class="keyword">const</span> <a class="code" href="structnfs__function__desc____.html">nfs_function_desc_t</a> <a class="code" href="nfs__worker__thread_8c.html#ae9ae682ddad7174791232905d02ec256">nfs2_func_desc</a>[] = {
<a name="l00094"></a>00094   {<a class="code" href="group__NFSprocs.html#gab077e61380d1d6be40777cf6b9ae6171">nfs_Null</a>, <a class="code" href="group__NFSprocs.html#ga77bc02fb872c0855f4166a6b642f09b3">nfs_Null_Free</a>, (xdrproc_t) xdr_void,
<a name="l00095"></a>00095    (xdrproc_t) xdr_void, <span class="stringliteral">&quot;nfs_Null&quot;</span>,
<a name="l00096"></a>00096    <a class="code" href="nfs__proto__functions_8h.html#aed6ce17d8db2471a85ee3f6add005aab">NOTHING_SPECIAL</a>},
<a name="l00097"></a>00097   {<a class="code" href="group__NFSprocs.html#ga601b2ea22a9a3355ff2f2bd94a99a6ea" title="Get attributes for a file.">nfs_Getattr</a>, <a class="code" href="group__NFSprocs.html#ga3faa8c359341697ec064df525e047beb">nfs_Getattr_Free</a>, (xdrproc_t) <a class="code" href="nfs23_8h.html#a241b1988e75252c8bf678e40877cf146">xdr_fhandle2</a>,
<a name="l00098"></a>00098    (xdrproc_t) <a class="code" href="nfs23_8h.html#a352b24b248bf53d462601d6180ce2464">xdr_ATTR2res</a>, <span class="stringliteral">&quot;nfs_Getattr&quot;</span>,
<a name="l00099"></a>00099    <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a> | <a class="code" href="nfs__proto__functions_8h.html#acf7123a6f73347a399778fd902194a69">SUPPORTS_GSS</a>},
<a name="l00100"></a>00100   {<a class="code" href="group__NFSprocs.html#gaef228fa7f193e6ed8732176a466d1d7c" title="The NFS PROC2 and PROC3 SETATTR.">nfs_Setattr</a>, <a class="code" href="group__NFSprocs.html#gacf6506705dd1f7ec8588283353783078">nfs_Setattr_Free</a>, (xdrproc_t) <a class="code" href="nfs23_8h.html#ab746f9f0355ab5b9ca11c56756a890ff">xdr_SETATTR2args</a>,
<a name="l00101"></a>00101    (xdrproc_t) <a class="code" href="nfs23_8h.html#a352b24b248bf53d462601d6180ce2464">xdr_ATTR2res</a>, <span class="stringliteral">&quot;nfs_Setattr&quot;</span>,
<a name="l00102"></a>00102    <a class="code" href="nfs__proto__functions_8h.html#a89fef22a3485d2b65f75121673d978b0">MAKES_WRITE</a> | <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a> | <a class="code" href="nfs__proto__functions_8h.html#a404163b184b6e34650d2a6ef54052137">CAN_BE_DUP</a> | <a class="code" href="nfs__proto__functions_8h.html#acf7123a6f73347a399778fd902194a69">SUPPORTS_GSS</a>},
<a name="l00103"></a>00103   {<a class="code" href="group__NFSprocs.html#gaa4df4ea9d0ce1a1a8ce33aae637a6a4c" title="Implements NFSPROC2_ROOT.">nfs2_Root</a>, <a class="code" href="group__NFSprocs.html#gae6f00e91074f5d37adeafa6768de69f4">nfs2_Root_Free</a>, (xdrproc_t) xdr_void,
<a name="l00104"></a>00104    (xdrproc_t) xdr_void, <span class="stringliteral">&quot;nfs2_Root&quot;</span>,
<a name="l00105"></a>00105    <a class="code" href="nfs__proto__functions_8h.html#aed6ce17d8db2471a85ee3f6add005aab">NOTHING_SPECIAL</a>},
<a name="l00106"></a>00106   {<a class="code" href="group__NFSprocs.html#ga7e97e81d1bb49bb377b2e58a3c5450e0" title="The NFS PROC2 and PROC3 LOOKUP.">nfs_Lookup</a>, <a class="code" href="group__NFSprocs.html#ga9d570d02276892797b1129e4dd639ad9">nfs2_Lookup_Free</a>, (xdrproc_t) <a class="code" href="nfs23_8h.html#ad846d4fee47e94f37d287469a5aed979">xdr_diropargs2</a>,
<a name="l00107"></a>00107    (xdrproc_t) <a class="code" href="nfs23_8h.html#ad1ccf54b5a41786eda00727b3fbfaffa">xdr_DIROP2res</a>, <span class="stringliteral">&quot;nfs_Lookup&quot;</span>,
<a name="l00108"></a>00108    <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a> | <a class="code" href="nfs__proto__functions_8h.html#acf7123a6f73347a399778fd902194a69">SUPPORTS_GSS</a>},
<a name="l00109"></a>00109   {<a class="code" href="group__NFSprocs.html#ga2f688c0536f7201f49421673d66f94f5" title="The NFS PROC2 and PROC3 READLINK.">nfs_Readlink</a>, <a class="code" href="group__NFSprocs.html#gab2d20f415004728500aa091556d20437">nfs2_Readlink_Free</a>, (xdrproc_t) <a class="code" href="nfs23_8h.html#a241b1988e75252c8bf678e40877cf146">xdr_fhandle2</a>,
<a name="l00110"></a>00110    (xdrproc_t) <a class="code" href="nfs23_8h.html#a8e131750b738496a9b6ba8b1356b1e8a">xdr_READLINK2res</a>, <span class="stringliteral">&quot;nfs_Readlink&quot;</span>,
<a name="l00111"></a>00111    <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a> | <a class="code" href="nfs__proto__functions_8h.html#acf7123a6f73347a399778fd902194a69">SUPPORTS_GSS</a>},
<a name="l00112"></a>00112   {<a class="code" href="group__NFSprocs.html#ga19dae481ffb3a0f724f6111a87bf933b" title="The NFS PROC2 and PROC3 READ.">nfs_Read</a>, <a class="code" href="group__NFSprocs.html#ga04c1230679892638268300b7492c64a5">nfs2_Read_Free</a>, (xdrproc_t) <a class="code" href="nfs23_8h.html#a1b9260a831c05bb208066ca314a74289">xdr_READ2args</a>,
<a name="l00113"></a>00113    (xdrproc_t) <a class="code" href="nfs23_8h.html#a292d88c3bca00b1873d4b0c8b111c2bb">xdr_READ2res</a>, <span class="stringliteral">&quot;nfs_Read&quot;</span>,
<a name="l00114"></a>00114    <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a> | <a class="code" href="nfs__proto__functions_8h.html#acf7123a6f73347a399778fd902194a69">SUPPORTS_GSS</a>},
<a name="l00115"></a>00115   {<a class="code" href="group__NFSprocs.html#gaf7150f190ce37764fc7e1b3c4c959fe5" title="Implements NFSPROC2_WRITECACHE.">nfs2_Writecache</a>, <a class="code" href="group__NFSprocs.html#gae8612a8951c969d29ed4a48b5b5dc13e">nfs2_Writecache_Free</a>, (xdrproc_t) xdr_void,
<a name="l00116"></a>00116    (xdrproc_t) xdr_void, <span class="stringliteral">&quot;nfs_Writecache&quot;</span>,
<a name="l00117"></a>00117    <a class="code" href="nfs__proto__functions_8h.html#aed6ce17d8db2471a85ee3f6add005aab">NOTHING_SPECIAL</a>},
<a name="l00118"></a>00118   {<a class="code" href="group__NFSprocs.html#ga6b2e22da37bc1f2d2d9e991e61547bae" title="The NFS PROC2 and PROC3 WRITE.">nfs_Write</a>, <a class="code" href="group__NFSprocs.html#gacdba416885514f0172886d8f7459cbc1">nfs_Write_Free</a>, (xdrproc_t) <a class="code" href="nfs23_8h.html#a0eda0691b170f98a083f28fe06aef575">xdr_WRITE2args</a>,
<a name="l00119"></a>00119    (xdrproc_t) <a class="code" href="nfs23_8h.html#a352b24b248bf53d462601d6180ce2464">xdr_ATTR2res</a>, <span class="stringliteral">&quot;nfs_Write&quot;</span>,
<a name="l00120"></a>00120    <a class="code" href="nfs__proto__functions_8h.html#a89fef22a3485d2b65f75121673d978b0">MAKES_WRITE</a> | <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a> | <a class="code" href="nfs__proto__functions_8h.html#a404163b184b6e34650d2a6ef54052137">CAN_BE_DUP</a> | <a class="code" href="nfs__proto__functions_8h.html#acf7123a6f73347a399778fd902194a69">SUPPORTS_GSS</a>},
<a name="l00121"></a>00121   {<a class="code" href="group__NFSprocs.html#ga97b3c7d8d1cdb295fca53f4a913adef7" title="The NFS PROC2 and PROC3 CREATE.">nfs_Create</a>, <a class="code" href="group__NFSprocs.html#gabb391a8932304128245b335835b1dd37">nfs_Create_Free</a>, (xdrproc_t) <a class="code" href="nfs23_8h.html#a69d027867d1e5256925b561ffe05d9e7">xdr_CREATE2args</a>,
<a name="l00122"></a>00122    (xdrproc_t) <a class="code" href="nfs23_8h.html#ad1ccf54b5a41786eda00727b3fbfaffa">xdr_DIROP2res</a>, <span class="stringliteral">&quot;nfs_Create&quot;</span>,
<a name="l00123"></a>00123    <a class="code" href="nfs__proto__functions_8h.html#a89fef22a3485d2b65f75121673d978b0">MAKES_WRITE</a> | <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a> | <a class="code" href="nfs__proto__functions_8h.html#a404163b184b6e34650d2a6ef54052137">CAN_BE_DUP</a> | <a class="code" href="nfs__proto__functions_8h.html#acf7123a6f73347a399778fd902194a69">SUPPORTS_GSS</a>},
<a name="l00124"></a>00124   {<a class="code" href="group__NFSprocs.html#ga5335ba5d02dc4f50a1673b9d1236ae2e" title="The NFS PROC2 and PROC3 REMOVE.">nfs_Remove</a>, <a class="code" href="group__NFSprocs.html#gabce2846d95112f9d9191dabe739df960">nfs_Remove_Free</a>, (xdrproc_t) <a class="code" href="nfs23_8h.html#ad846d4fee47e94f37d287469a5aed979">xdr_diropargs2</a>,
<a name="l00125"></a>00125    (xdrproc_t) <a class="code" href="nfs23_8h.html#a701eb86ee09afbe325325d0e964a42dc">xdr_nfsstat2</a>, <span class="stringliteral">&quot;nfs_Remove&quot;</span>,
<a name="l00126"></a>00126    <a class="code" href="nfs__proto__functions_8h.html#a89fef22a3485d2b65f75121673d978b0">MAKES_WRITE</a> | <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a> | <a class="code" href="nfs__proto__functions_8h.html#a404163b184b6e34650d2a6ef54052137">CAN_BE_DUP</a> | <a class="code" href="nfs__proto__functions_8h.html#acf7123a6f73347a399778fd902194a69">SUPPORTS_GSS</a>},
<a name="l00127"></a>00127   {<a class="code" href="group__NFSprocs.html#gaa373e13195cd18b5292a90401c12c278" title="The NFS PROC2 and PROC3 RENAME.">nfs_Rename</a>, <a class="code" href="group__NFSprocs.html#ga3ceb32a575cd6e97f9028d973f880cd5">nfs_Rename_Free</a>, (xdrproc_t) <a class="code" href="nfs23_8h.html#a7b3cb8c65d3e85535a95735b6a1aa7ab">xdr_RENAME2args</a>,
<a name="l00128"></a>00128    (xdrproc_t) <a class="code" href="nfs23_8h.html#a701eb86ee09afbe325325d0e964a42dc">xdr_nfsstat2</a>, <span class="stringliteral">&quot;nfs_Rename&quot;</span>,
<a name="l00129"></a>00129    <a class="code" href="nfs__proto__functions_8h.html#a89fef22a3485d2b65f75121673d978b0">MAKES_WRITE</a> | <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a> | <a class="code" href="nfs__proto__functions_8h.html#a404163b184b6e34650d2a6ef54052137">CAN_BE_DUP</a> | <a class="code" href="nfs__proto__functions_8h.html#acf7123a6f73347a399778fd902194a69">SUPPORTS_GSS</a>},
<a name="l00130"></a>00130   {<a class="code" href="group__NFSprocs.html#ga33c63bb46b9ff8d035c73004e05dbd12" title="The NFS PROC2 and PROC3 LINK.">nfs_Link</a>, <a class="code" href="group__NFSprocs.html#ga6c80f148619689895f7abf0ba965d5d2">nfs_Link_Free</a>, (xdrproc_t) <a class="code" href="nfs23_8h.html#a1d664e311300dcf2d2637b0f011fd6bf">xdr_LINK2args</a>,
<a name="l00131"></a>00131    (xdrproc_t) <a class="code" href="nfs23_8h.html#a701eb86ee09afbe325325d0e964a42dc">xdr_nfsstat2</a>, <span class="stringliteral">&quot;nfs_Link&quot;</span>,
<a name="l00132"></a>00132    <a class="code" href="nfs__proto__functions_8h.html#a89fef22a3485d2b65f75121673d978b0">MAKES_WRITE</a> | <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a> | <a class="code" href="nfs__proto__functions_8h.html#a404163b184b6e34650d2a6ef54052137">CAN_BE_DUP</a> | <a class="code" href="nfs__proto__functions_8h.html#acf7123a6f73347a399778fd902194a69">SUPPORTS_GSS</a>},
<a name="l00133"></a>00133   {<a class="code" href="group__NFSprocs.html#ga4d70c5c84114eae80a4e750bef263af0" title="The NFS PROC2 and PROC3 SYMLINK.">nfs_Symlink</a>, <a class="code" href="group__NFSprocs.html#gac429ad894745e072f1d528e5e043f7d9">nfs_Symlink_Free</a>, (xdrproc_t) <a class="code" href="nfs23_8h.html#aceaf44a437b2f5ae43571e3c932ddf25">xdr_SYMLINK2args</a>,
<a name="l00134"></a>00134    (xdrproc_t) <a class="code" href="nfs23_8h.html#a701eb86ee09afbe325325d0e964a42dc">xdr_nfsstat2</a>, <span class="stringliteral">&quot;nfs_Symlink&quot;</span>,
<a name="l00135"></a>00135    <a class="code" href="nfs__proto__functions_8h.html#a89fef22a3485d2b65f75121673d978b0">MAKES_WRITE</a> | <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a> | <a class="code" href="nfs__proto__functions_8h.html#a404163b184b6e34650d2a6ef54052137">CAN_BE_DUP</a> | <a class="code" href="nfs__proto__functions_8h.html#acf7123a6f73347a399778fd902194a69">SUPPORTS_GSS</a>},
<a name="l00136"></a>00136   {<a class="code" href="group__NFSprocs.html#ga6071c7da5204ae196d2ca5c2ba38c49c" title="The NFS PROC2 and PROC3 MKDIR.">nfs_Mkdir</a>, <a class="code" href="group__NFSprocs.html#ga22feb265c8dc65333618da08a366ac09">nfs_Mkdir_Free</a>, (xdrproc_t) <a class="code" href="nfs23_8h.html#a69d027867d1e5256925b561ffe05d9e7">xdr_CREATE2args</a>,
<a name="l00137"></a>00137    (xdrproc_t) <a class="code" href="nfs23_8h.html#ad1ccf54b5a41786eda00727b3fbfaffa">xdr_DIROP2res</a>, <span class="stringliteral">&quot;nfs_Mkdir&quot;</span>,
<a name="l00138"></a>00138    <a class="code" href="nfs__proto__functions_8h.html#a89fef22a3485d2b65f75121673d978b0">MAKES_WRITE</a> | <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a> | <a class="code" href="nfs__proto__functions_8h.html#a404163b184b6e34650d2a6ef54052137">CAN_BE_DUP</a> | <a class="code" href="nfs__proto__functions_8h.html#acf7123a6f73347a399778fd902194a69">SUPPORTS_GSS</a>},
<a name="l00139"></a>00139   {<a class="code" href="group__NFSprocs.html#ga4a2fa3bc433a7ce147332a5cff8d3cbc" title="The NFS PROC2 and PROC3 RMDIR.">nfs_Rmdir</a>, <a class="code" href="group__NFSprocs.html#gabe0f9f0f8f8cb13fecb9a4cc59748325">nfs_Rmdir_Free</a>, (xdrproc_t) <a class="code" href="nfs23_8h.html#ad846d4fee47e94f37d287469a5aed979">xdr_diropargs2</a>,
<a name="l00140"></a>00140    (xdrproc_t) <a class="code" href="nfs23_8h.html#a701eb86ee09afbe325325d0e964a42dc">xdr_nfsstat2</a>, <span class="stringliteral">&quot;nfs_Rmdir&quot;</span>,
<a name="l00141"></a>00141    <a class="code" href="nfs__proto__functions_8h.html#a89fef22a3485d2b65f75121673d978b0">MAKES_WRITE</a> | <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a> | <a class="code" href="nfs__proto__functions_8h.html#a404163b184b6e34650d2a6ef54052137">CAN_BE_DUP</a> | <a class="code" href="nfs__proto__functions_8h.html#acf7123a6f73347a399778fd902194a69">SUPPORTS_GSS</a>},
<a name="l00142"></a>00142   {<a class="code" href="group__NFSprocs.html#ga0060845e94a234f886c994fe0c5ed188" title="The NFS PROC2 and PROC3 READDIR.">nfs_Readdir</a>, <a class="code" href="group__NFSprocs.html#ga084dabf08482aadf9b743eadf2baafe4">nfs2_Readdir_Free</a>, (xdrproc_t) <a class="code" href="nfs23_8h.html#a3224de3c7dac76339bfd5f9e49af870f">xdr_READDIR2args</a>,
<a name="l00143"></a>00143    (xdrproc_t) <a class="code" href="nfs23_8h.html#ad8f73475d05df4183fa6ebbc2725cb01">xdr_READDIR2res</a>, <span class="stringliteral">&quot;nfs_Readdir&quot;</span>,
<a name="l00144"></a>00144    <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a> | <a class="code" href="nfs__proto__functions_8h.html#acf7123a6f73347a399778fd902194a69">SUPPORTS_GSS</a>},
<a name="l00145"></a>00145   {<a class="code" href="group__NFSprocs.html#ga6e5482dc91daa454feefc693a77ffbf4" title="The NFS PROC2 and PROC3 FSSTAT.">nfs_Fsstat</a>, <a class="code" href="group__NFSprocs.html#ga052fa5a02d1b1e2376713384024d3e5d">nfs_Fsstat_Free</a>, (xdrproc_t) <a class="code" href="nfs23_8h.html#a241b1988e75252c8bf678e40877cf146">xdr_fhandle2</a>,
<a name="l00146"></a>00146    (xdrproc_t) <a class="code" href="nfs23_8h.html#a9d5243492e05e79443fbb64a89b2b359">xdr_STATFS2res</a>, <span class="stringliteral">&quot;nfs_Fsstat&quot;</span>,
<a name="l00147"></a>00147    <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a> | <a class="code" href="nfs__proto__functions_8h.html#acf7123a6f73347a399778fd902194a69">SUPPORTS_GSS</a>}
<a name="l00148"></a>00148 };
<a name="l00149"></a>00149 
<a name="l00150"></a><a class="code" href="nfs__dupreq_8c.html#a177ddde86497df151d3b3ff5c876d90a">00150</a> <span class="keyword">const</span> <a class="code" href="structnfs__function__desc____.html">nfs_function_desc_t</a> <a class="code" href="nfs__worker__thread_8c.html#a580a0054fa9c0c4e06806571159dcd53">nfs3_func_desc</a>[] = {
<a name="l00151"></a>00151   {<a class="code" href="group__NFSprocs.html#gab077e61380d1d6be40777cf6b9ae6171">nfs_Null</a>, <a class="code" href="group__NFSprocs.html#ga77bc02fb872c0855f4166a6b642f09b3">nfs_Null_Free</a>, (xdrproc_t) xdr_void,
<a name="l00152"></a>00152    (xdrproc_t) xdr_void,
<a name="l00153"></a>00153    <span class="stringliteral">&quot;nfs_Null&quot;</span>,
<a name="l00154"></a>00154    <a class="code" href="nfs__proto__functions_8h.html#aed6ce17d8db2471a85ee3f6add005aab">NOTHING_SPECIAL</a>},
<a name="l00155"></a>00155   {<a class="code" href="group__NFSprocs.html#ga601b2ea22a9a3355ff2f2bd94a99a6ea" title="Get attributes for a file.">nfs_Getattr</a>, <a class="code" href="group__NFSprocs.html#ga3faa8c359341697ec064df525e047beb">nfs_Getattr_Free</a>, (xdrproc_t) <a class="code" href="nfs23_8h.html#ada2746bf1ed703b44081b02bf9222161">xdr_GETATTR3args</a>,
<a name="l00156"></a>00156    (xdrproc_t) <a class="code" href="nfs23_8h.html#abeed9c34458ddc81ed45e1efef1f55dd">xdr_GETATTR3res</a>, <span class="stringliteral">&quot;nfs_Getattr&quot;</span>, <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a> | <a class="code" href="nfs__proto__functions_8h.html#acf7123a6f73347a399778fd902194a69">SUPPORTS_GSS</a>},
<a name="l00157"></a>00157   {<a class="code" href="group__NFSprocs.html#gaef228fa7f193e6ed8732176a466d1d7c" title="The NFS PROC2 and PROC3 SETATTR.">nfs_Setattr</a>, <a class="code" href="group__NFSprocs.html#gacf6506705dd1f7ec8588283353783078">nfs_Setattr_Free</a>, (xdrproc_t) <a class="code" href="nfs23_8h.html#aa5d9a5f57ade9de14834bd1d6d264c52">xdr_SETATTR3args</a>,
<a name="l00158"></a>00158    (xdrproc_t) <a class="code" href="nfs23_8h.html#a5d72160509c6b3c267cecf6de56ce180">xdr_SETATTR3res</a>, <span class="stringliteral">&quot;nfs_Setattr&quot;</span>,
<a name="l00159"></a>00159    <a class="code" href="nfs__proto__functions_8h.html#a89fef22a3485d2b65f75121673d978b0">MAKES_WRITE</a> | <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a> | <a class="code" href="nfs__proto__functions_8h.html#a404163b184b6e34650d2a6ef54052137">CAN_BE_DUP</a> | <a class="code" href="nfs__proto__functions_8h.html#acf7123a6f73347a399778fd902194a69">SUPPORTS_GSS</a>},
<a name="l00160"></a>00160   {<a class="code" href="group__NFSprocs.html#ga7e97e81d1bb49bb377b2e58a3c5450e0" title="The NFS PROC2 and PROC3 LOOKUP.">nfs_Lookup</a>, <a class="code" href="group__NFSprocs.html#ga2b42d7f9c6a317c5f84c1d962d524b13">nfs3_Lookup_Free</a>, (xdrproc_t) <a class="code" href="nfs23_8h.html#a552be814e80d97d7af828a40f5f316df">xdr_LOOKUP3args</a>,
<a name="l00161"></a>00161    (xdrproc_t) <a class="code" href="nfs23_8h.html#aaf48bcf0c0c3b22ba5271fc8352fa5b7">xdr_LOOKUP3res</a>, <span class="stringliteral">&quot;nfs_Lookup&quot;</span>,
<a name="l00162"></a>00162    <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a> | <a class="code" href="nfs__proto__functions_8h.html#acf7123a6f73347a399778fd902194a69">SUPPORTS_GSS</a>},
<a name="l00163"></a>00163   {<a class="code" href="group__NFSprocs.html#ga69238516d865101ebec0375a7929fe77">nfs3_Access</a>, <a class="code" href="group__NFSprocs.html#ga552c617592e3b0aac0a13bc15a662296">nfs3_Access_Free</a>, (xdrproc_t) <a class="code" href="nfs23_8h.html#aa5c32b8e5f4a9b9515bddc3edf789f93">xdr_ACCESS3args</a>,
<a name="l00164"></a>00164    (xdrproc_t) <a class="code" href="nfs23_8h.html#aeaf83044406d22e03b3e7a26a143f7bd">xdr_ACCESS3res</a>, <span class="stringliteral">&quot;nfs3_Access&quot;</span>,
<a name="l00165"></a>00165    <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a> | <a class="code" href="nfs__proto__functions_8h.html#acf7123a6f73347a399778fd902194a69">SUPPORTS_GSS</a>},
<a name="l00166"></a>00166   {<a class="code" href="group__NFSprocs.html#ga2f688c0536f7201f49421673d66f94f5" title="The NFS PROC2 and PROC3 READLINK.">nfs_Readlink</a>, <a class="code" href="group__NFSprocs.html#gabfe1759d1dc1b1f5e695f3c3776549a8">nfs3_Readlink_Free</a>, (xdrproc_t) <a class="code" href="nfs23_8h.html#a04ec251228274261b84cb4b6826139ab">xdr_READLINK3args</a>,
<a name="l00167"></a>00167    (xdrproc_t) <a class="code" href="nfs23_8h.html#a7a41c9be857a817933a13124e03a415e">xdr_READLINK3res</a>, <span class="stringliteral">&quot;nfs_Readlink&quot;</span>,
<a name="l00168"></a>00168    <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a> | <a class="code" href="nfs__proto__functions_8h.html#acf7123a6f73347a399778fd902194a69">SUPPORTS_GSS</a>},
<a name="l00169"></a>00169   {<a class="code" href="group__NFSprocs.html#ga19dae481ffb3a0f724f6111a87bf933b" title="The NFS PROC2 and PROC3 READ.">nfs_Read</a>, <a class="code" href="group__NFSprocs.html#ga8efaad8c30a899faeedf5b7e147f611f">nfs3_Read_Free</a>, (xdrproc_t) <a class="code" href="nfs23_8h.html#a13ba7e8fd535d23acc0eafdfd5bcd9f6">xdr_READ3args</a>,
<a name="l00170"></a>00170    (xdrproc_t) <a class="code" href="nfs23_8h.html#aa042a503787ba9e84c91fbd83990763b">xdr_READ3res</a>, <span class="stringliteral">&quot;nfs_Read&quot;</span>,
<a name="l00171"></a>00171    <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a> | <a class="code" href="nfs__proto__functions_8h.html#acf7123a6f73347a399778fd902194a69">SUPPORTS_GSS</a>},
<a name="l00172"></a>00172   {<a class="code" href="group__NFSprocs.html#ga6b2e22da37bc1f2d2d9e991e61547bae" title="The NFS PROC2 and PROC3 WRITE.">nfs_Write</a>, <a class="code" href="group__NFSprocs.html#gacdba416885514f0172886d8f7459cbc1">nfs_Write_Free</a>, (xdrproc_t) <a class="code" href="nfs23_8h.html#a16b7e73e2e250e4e5c2f119865f1030b">xdr_WRITE3args</a>,
<a name="l00173"></a>00173    (xdrproc_t) <a class="code" href="nfs23_8h.html#ac57bdffc68aec419c44bd74f43e11463">xdr_WRITE3res</a>, <span class="stringliteral">&quot;nfs_Write&quot;</span>,
<a name="l00174"></a>00174    <a class="code" href="nfs__proto__functions_8h.html#a89fef22a3485d2b65f75121673d978b0">MAKES_WRITE</a> | <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a> | <a class="code" href="nfs__proto__functions_8h.html#a404163b184b6e34650d2a6ef54052137">CAN_BE_DUP</a> | <a class="code" href="nfs__proto__functions_8h.html#acf7123a6f73347a399778fd902194a69">SUPPORTS_GSS</a>},
<a name="l00175"></a>00175   {<a class="code" href="group__NFSprocs.html#ga97b3c7d8d1cdb295fca53f4a913adef7" title="The NFS PROC2 and PROC3 CREATE.">nfs_Create</a>, <a class="code" href="group__NFSprocs.html#gabb391a8932304128245b335835b1dd37">nfs_Create_Free</a>, (xdrproc_t) <a class="code" href="nfs23_8h.html#a75dd4846ecd53d8a5b8c4e8adb8bb8bf">xdr_CREATE3args</a>,
<a name="l00176"></a>00176    (xdrproc_t) <a class="code" href="nfs23_8h.html#af9c80cbca9cb275eb964e8e20401d3b5">xdr_CREATE3res</a>, <span class="stringliteral">&quot;nfs_Create&quot;</span>,
<a name="l00177"></a>00177    <a class="code" href="nfs__proto__functions_8h.html#a89fef22a3485d2b65f75121673d978b0">MAKES_WRITE</a> | <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a> | <a class="code" href="nfs__proto__functions_8h.html#a404163b184b6e34650d2a6ef54052137">CAN_BE_DUP</a> | <a class="code" href="nfs__proto__functions_8h.html#acf7123a6f73347a399778fd902194a69">SUPPORTS_GSS</a>},
<a name="l00178"></a>00178   {<a class="code" href="group__NFSprocs.html#ga6071c7da5204ae196d2ca5c2ba38c49c" title="The NFS PROC2 and PROC3 MKDIR.">nfs_Mkdir</a>, <a class="code" href="group__NFSprocs.html#ga22feb265c8dc65333618da08a366ac09">nfs_Mkdir_Free</a>, (xdrproc_t) <a class="code" href="nfs23_8h.html#a06754220b204d7d2658ac47ea5a9e411">xdr_MKDIR3args</a>,
<a name="l00179"></a>00179    (xdrproc_t) <a class="code" href="nfs23_8h.html#a08a6fc72269a9210a509d1984b8ddbb1">xdr_MKDIR3res</a>, <span class="stringliteral">&quot;nfs_Mkdir&quot;</span>,
<a name="l00180"></a>00180    <a class="code" href="nfs__proto__functions_8h.html#a89fef22a3485d2b65f75121673d978b0">MAKES_WRITE</a> | <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a> | <a class="code" href="nfs__proto__functions_8h.html#a404163b184b6e34650d2a6ef54052137">CAN_BE_DUP</a> | <a class="code" href="nfs__proto__functions_8h.html#acf7123a6f73347a399778fd902194a69">SUPPORTS_GSS</a>},
<a name="l00181"></a>00181   {<a class="code" href="group__NFSprocs.html#ga4d70c5c84114eae80a4e750bef263af0" title="The NFS PROC2 and PROC3 SYMLINK.">nfs_Symlink</a>, <a class="code" href="group__NFSprocs.html#gac429ad894745e072f1d528e5e043f7d9">nfs_Symlink_Free</a>, (xdrproc_t) <a class="code" href="nfs23_8h.html#adf08184932634ea5b55290b50b0b0e89">xdr_SYMLINK3args</a>,
<a name="l00182"></a>00182    (xdrproc_t) <a class="code" href="nfs23_8h.html#a06240399dae0d68785fee490d72e4591">xdr_SYMLINK3res</a>, <span class="stringliteral">&quot;nfs_Symlink&quot;</span>,
<a name="l00183"></a>00183    <a class="code" href="nfs__proto__functions_8h.html#a89fef22a3485d2b65f75121673d978b0">MAKES_WRITE</a> | <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a> | <a class="code" href="nfs__proto__functions_8h.html#a404163b184b6e34650d2a6ef54052137">CAN_BE_DUP</a> | <a class="code" href="nfs__proto__functions_8h.html#acf7123a6f73347a399778fd902194a69">SUPPORTS_GSS</a>},
<a name="l00184"></a>00184   {<a class="code" href="group__NFSprocs.html#gab1c50c34276752afc513e0736ee2b912" title="Implements NFSPROC3_MKNOD.">nfs3_Mknod</a>, <a class="code" href="group__NFSprocs.html#gace19570d1efef9e24d45cbdaf678e97b">nfs3_Mknod_Free</a>, (xdrproc_t) <a class="code" href="nfs23_8h.html#a8cef365ffe76adc1a231f24e45334cce">xdr_MKNOD3args</a>,
<a name="l00185"></a>00185    (xdrproc_t) <a class="code" href="nfs23_8h.html#a60e1072e09d0bbb0b22ade9debfb208d">xdr_MKNOD3res</a>, <span class="stringliteral">&quot;nfs3_Mknod&quot;</span>,
<a name="l00186"></a>00186    <a class="code" href="nfs__proto__functions_8h.html#a89fef22a3485d2b65f75121673d978b0">MAKES_WRITE</a> | <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a> | <a class="code" href="nfs__proto__functions_8h.html#a404163b184b6e34650d2a6ef54052137">CAN_BE_DUP</a> | <a class="code" href="nfs__proto__functions_8h.html#acf7123a6f73347a399778fd902194a69">SUPPORTS_GSS</a>},
<a name="l00187"></a>00187   {<a class="code" href="group__NFSprocs.html#ga5335ba5d02dc4f50a1673b9d1236ae2e" title="The NFS PROC2 and PROC3 REMOVE.">nfs_Remove</a>, <a class="code" href="group__NFSprocs.html#gabce2846d95112f9d9191dabe739df960">nfs_Remove_Free</a>, (xdrproc_t) <a class="code" href="nfs23_8h.html#a62d61e89124ac2de7aa83663aa80faae">xdr_REMOVE3args</a>,
<a name="l00188"></a>00188    (xdrproc_t) <a class="code" href="nfs23_8h.html#a16aba59c43109beb481f43ab3e3c748a">xdr_REMOVE3res</a>, <span class="stringliteral">&quot;nfs_Remove&quot;</span>,
<a name="l00189"></a>00189    <a class="code" href="nfs__proto__functions_8h.html#a89fef22a3485d2b65f75121673d978b0">MAKES_WRITE</a> | <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a> | <a class="code" href="nfs__proto__functions_8h.html#a404163b184b6e34650d2a6ef54052137">CAN_BE_DUP</a> | <a class="code" href="nfs__proto__functions_8h.html#acf7123a6f73347a399778fd902194a69">SUPPORTS_GSS</a>},
<a name="l00190"></a>00190   {<a class="code" href="group__NFSprocs.html#ga4a2fa3bc433a7ce147332a5cff8d3cbc" title="The NFS PROC2 and PROC3 RMDIR.">nfs_Rmdir</a>, <a class="code" href="group__NFSprocs.html#gabe0f9f0f8f8cb13fecb9a4cc59748325">nfs_Rmdir_Free</a>, (xdrproc_t) <a class="code" href="nfs23_8h.html#adee61a04c1d8aa7aa02763201dfb1c51">xdr_RMDIR3args</a>,
<a name="l00191"></a>00191    (xdrproc_t) <a class="code" href="nfs23_8h.html#ad3a3099f86cc405e1fb133be5b183d8f">xdr_RMDIR3res</a>, <span class="stringliteral">&quot;nfs_Rmdir&quot;</span>,
<a name="l00192"></a>00192    <a class="code" href="nfs__proto__functions_8h.html#a89fef22a3485d2b65f75121673d978b0">MAKES_WRITE</a> | <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a> | <a class="code" href="nfs__proto__functions_8h.html#a404163b184b6e34650d2a6ef54052137">CAN_BE_DUP</a> | <a class="code" href="nfs__proto__functions_8h.html#acf7123a6f73347a399778fd902194a69">SUPPORTS_GSS</a>},
<a name="l00193"></a>00193   {<a class="code" href="group__NFSprocs.html#gaa373e13195cd18b5292a90401c12c278" title="The NFS PROC2 and PROC3 RENAME.">nfs_Rename</a>, <a class="code" href="group__NFSprocs.html#ga3ceb32a575cd6e97f9028d973f880cd5">nfs_Rename_Free</a>, (xdrproc_t) <a class="code" href="nfs23_8h.html#a82337ec360facdab04590ef9bbff5df4">xdr_RENAME3args</a>,
<a name="l00194"></a>00194    (xdrproc_t) <a class="code" href="nfs23_8h.html#a2b2a01a798052b8182ef6a64357a8e3f">xdr_RENAME3res</a>, <span class="stringliteral">&quot;nfs_Rename&quot;</span>,
<a name="l00195"></a>00195    <a class="code" href="nfs__proto__functions_8h.html#a89fef22a3485d2b65f75121673d978b0">MAKES_WRITE</a> | <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a> | <a class="code" href="nfs__proto__functions_8h.html#a404163b184b6e34650d2a6ef54052137">CAN_BE_DUP</a> | <a class="code" href="nfs__proto__functions_8h.html#acf7123a6f73347a399778fd902194a69">SUPPORTS_GSS</a>},
<a name="l00196"></a>00196   {<a class="code" href="group__NFSprocs.html#ga33c63bb46b9ff8d035c73004e05dbd12" title="The NFS PROC2 and PROC3 LINK.">nfs_Link</a>, <a class="code" href="group__NFSprocs.html#ga6c80f148619689895f7abf0ba965d5d2">nfs_Link_Free</a>, (xdrproc_t) <a class="code" href="nfs23_8h.html#aa3b18a62d8fadd059858a44fcf54e374">xdr_LINK3args</a>,
<a name="l00197"></a>00197    (xdrproc_t) <a class="code" href="nfs23_8h.html#a0153714ae205ce08d5a0323ebe8bcd28">xdr_LINK3res</a>, <span class="stringliteral">&quot;nfs_Link&quot;</span>,
<a name="l00198"></a>00198    <a class="code" href="nfs__proto__functions_8h.html#a89fef22a3485d2b65f75121673d978b0">MAKES_WRITE</a> | <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a> | <a class="code" href="nfs__proto__functions_8h.html#a404163b184b6e34650d2a6ef54052137">CAN_BE_DUP</a> | <a class="code" href="nfs__proto__functions_8h.html#acf7123a6f73347a399778fd902194a69">SUPPORTS_GSS</a>},
<a name="l00199"></a>00199   {<a class="code" href="group__NFSprocs.html#ga0060845e94a234f886c994fe0c5ed188" title="The NFS PROC2 and PROC3 READDIR.">nfs_Readdir</a>, <a class="code" href="group__NFSprocs.html#ga902eec2e2d7ec8f317d76985d9af2a56">nfs3_Readdir_Free</a>, (xdrproc_t) <a class="code" href="nfs23_8h.html#accbd97cd6a0dedb27b7188c4bd63ea1f">xdr_READDIR3args</a>,
<a name="l00200"></a>00200    (xdrproc_t) <a class="code" href="nfs23_8h.html#aac203ffebf5da7364c318db0a8cb6a1e">xdr_READDIR3res</a>, <span class="stringliteral">&quot;nfs_Readdir&quot;</span>,
<a name="l00201"></a>00201    <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a> | <a class="code" href="nfs__proto__functions_8h.html#acf7123a6f73347a399778fd902194a69">SUPPORTS_GSS</a>},
<a name="l00202"></a>00202   {<a class="code" href="group__NFSprocs.html#gaa9a39b7471960cc7cf9f2d77e0e714ff" title="The NFS PROC3 READDIRPLUS.">nfs3_Readdirplus</a>, <a class="code" href="group__NFSprocs.html#ga8c95afac60baaec75256292b966199c6" title="Frees the result structure allocated for nfs3_Readdirplus.">nfs3_Readdirplus_Free</a>, (xdrproc_t) <a class="code" href="nfs23_8h.html#a5ec8eef4ff3416dc9eb5d80fd89c0edd">xdr_READDIRPLUS3args</a>,
<a name="l00203"></a>00203    (xdrproc_t) <a class="code" href="nfs23_8h.html#af23ac667332a341fa27a6420b0efdbac">xdr_READDIRPLUS3res</a>, <span class="stringliteral">&quot;nfs3_Readdirplus&quot;</span>,
<a name="l00204"></a>00204    <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a> | <a class="code" href="nfs__proto__functions_8h.html#acf7123a6f73347a399778fd902194a69">SUPPORTS_GSS</a>},
<a name="l00205"></a>00205   {<a class="code" href="group__NFSprocs.html#ga6e5482dc91daa454feefc693a77ffbf4" title="The NFS PROC2 and PROC3 FSSTAT.">nfs_Fsstat</a>, <a class="code" href="group__NFSprocs.html#ga052fa5a02d1b1e2376713384024d3e5d">nfs_Fsstat_Free</a>, (xdrproc_t) <a class="code" href="nfs23_8h.html#a2255178dedcd250debfd53c80f3a8602">xdr_FSSTAT3args</a>,
<a name="l00206"></a>00206    (xdrproc_t) <a class="code" href="nfs23_8h.html#ad0819e54d39fe000dd33c24238a5227d">xdr_FSSTAT3res</a>, <span class="stringliteral">&quot;nfs_Fsstat&quot;</span>,
<a name="l00207"></a>00207    <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a> | <a class="code" href="nfs__proto__functions_8h.html#acf7123a6f73347a399778fd902194a69">SUPPORTS_GSS</a>},
<a name="l00208"></a>00208   {<a class="code" href="group__NFSprocs.html#ga6ded25737c3d630bd8fdf794e5a33922" title="Implements NFSPROC3_FSINFO.">nfs3_Fsinfo</a>, <a class="code" href="group__NFSprocs.html#gac8472acff1de5bf19a605f758ac20158">nfs3_Fsinfo_Free</a>, (xdrproc_t) <a class="code" href="nfs23_8h.html#a498c5d90652fd063576d3d451141cc71">xdr_FSINFO3args</a>,
<a name="l00209"></a>00209    (xdrproc_t) <a class="code" href="nfs23_8h.html#a70049039f05ce24fd7a5e01925717d48">xdr_FSINFO3res</a>, <span class="stringliteral">&quot;nfs3_Fsinfo&quot;</span>,
<a name="l00210"></a>00210    <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a>},
<a name="l00211"></a>00211   {<a class="code" href="group__NFSprocs.html#ga0101311f46309463ec4726e075c3869e" title="Implements NFSPROC3_PATHCONF.">nfs3_Pathconf</a>, <a class="code" href="group__NFSprocs.html#ga3fca168f7adbb213fab8746f033a1f22">nfs3_Pathconf_Free</a>, (xdrproc_t) <a class="code" href="nfs23_8h.html#a7cadb029b5e3ebd4420b36280d1beee9">xdr_PATHCONF3args</a>,
<a name="l00212"></a>00212    (xdrproc_t) <a class="code" href="nfs23_8h.html#a3c53ecf8f7e23fa32d308e0d847c25dd">xdr_PATHCONF3res</a>, <span class="stringliteral">&quot;nfs3_Pathconf&quot;</span>,
<a name="l00213"></a>00213    <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a> | <a class="code" href="nfs__proto__functions_8h.html#acf7123a6f73347a399778fd902194a69">SUPPORTS_GSS</a>},
<a name="l00214"></a>00214   {<a class="code" href="group__NFSprocs.html#ga53bd61a8d7abe64621730dee780f53e6" title="Implements NFSPROC3_COMMIT.">nfs3_Commit</a>, <a class="code" href="group__NFSprocs.html#ga1a70694ec7376c98517ee284b5bf05ff">nfs3_Commit_Free</a>, (xdrproc_t) <a class="code" href="nfs23_8h.html#a166014ad0c2ef067be2b454d67db1266">xdr_COMMIT3args</a>,
<a name="l00215"></a>00215    (xdrproc_t) <a class="code" href="nfs23_8h.html#a1872558b19e750b023210cad3e54daab">xdr_COMMIT3res</a>, <span class="stringliteral">&quot;nfs3_Commit&quot;</span>,
<a name="l00216"></a>00216    <a class="code" href="nfs__proto__functions_8h.html#a89fef22a3485d2b65f75121673d978b0">MAKES_WRITE</a> | <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a> | <a class="code" href="nfs__proto__functions_8h.html#acf7123a6f73347a399778fd902194a69">SUPPORTS_GSS</a>}
<a name="l00217"></a>00217 };
<a name="l00218"></a>00218 
<a name="l00219"></a>00219 <span class="comment">/* Remeber that NFSv4 manages authentication though junction crossing, and</span>
<a name="l00220"></a>00220 <span class="comment"> * so does it for RO FS management (for each operation) */</span>
<a name="l00221"></a><a class="code" href="nfs__dupreq_8c.html#ade3381a451007489495bf0b92585520f">00221</a> <span class="keyword">const</span> <a class="code" href="structnfs__function__desc____.html">nfs_function_desc_t</a> <a class="code" href="nfs__worker__thread_8c.html#af71589ae240e6becde81cba53f437acc">nfs4_func_desc</a>[] = {
<a name="l00222"></a>00222   {<a class="code" href="group__NFSprocs.html#gab077e61380d1d6be40777cf6b9ae6171">nfs_Null</a>, <a class="code" href="group__NFSprocs.html#ga77bc02fb872c0855f4166a6b642f09b3">nfs_Null_Free</a>, (xdrproc_t) xdr_void,
<a name="l00223"></a>00223    (xdrproc_t) xdr_void, <span class="stringliteral">&quot;nfs_Null&quot;</span>,
<a name="l00224"></a>00224    <a class="code" href="nfs__proto__functions_8h.html#aed6ce17d8db2471a85ee3f6add005aab">NOTHING_SPECIAL</a>},
<a name="l00225"></a>00225   {<a class="code" href="group__NFSprocs.html#ga21b07cc2bbe85c1bb55bf2dcab4d1ad8">nfs4_Compound</a>, <a class="code" href="group__NFSprocs.html#ga87d14750f2b16ad88320a7117d0d7609">nfs4_Compound_Free</a>, (xdrproc_t) <a class="code" href="nfsv40_8h.html#a58199dce945c3e21e24678ee818a375e">xdr_COMPOUND4args</a>,
<a name="l00226"></a>00226    (xdrproc_t) <a class="code" href="nfsv40_8h.html#a5f3d4faad505a4c4e53ce74e9be2eb1a">xdr_COMPOUND4res</a>, <span class="stringliteral">&quot;nfs4_Compound&quot;</span>, <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a>}
<a name="l00227"></a>00227 };
<a name="l00228"></a>00228 
<a name="l00229"></a><a class="code" href="nfs__dupreq_8c.html#a331b43564c209696c670c70673d544e1">00229</a> <span class="keyword">const</span> <a class="code" href="structnfs__function__desc____.html">nfs_function_desc_t</a> <a class="code" href="nfs__worker__thread_8c.html#ab439a33fe7152078b400f13678c012f1">mnt1_func_desc</a>[] = {
<a name="l00230"></a>00230   {<a class="code" href="group__MNTprocs.html#ga353cb3eb5294c8415909678c72117b0e" title="The Mount proc null function, for all versions.">mnt_Null</a>, <a class="code" href="group__NFSprocs.html#gaea64e2d78be78da2a71da79f8148f3a8">mnt_Null_Free</a>, (xdrproc_t) xdr_void,
<a name="l00231"></a>00231    (xdrproc_t) xdr_void, <span class="stringliteral">&quot;mnt_Null&quot;</span>,
<a name="l00232"></a>00232    <a class="code" href="nfs__proto__functions_8h.html#aed6ce17d8db2471a85ee3f6add005aab">NOTHING_SPECIAL</a>},
<a name="l00233"></a>00233   {<a class="code" href="group__MNTprocs.html#ga94ec4e19de32e34ec873cc6f873b2975" title="The Mount proc mount function, for all versions.">mnt_Mnt</a>, <a class="code" href="group__NFSprocs.html#gac3bbd7e4e552bcf7af22714c6d06e98f">mnt1_Mnt_Free</a>, (xdrproc_t) <a class="code" href="mount_8h.html#a9df8de57aef14f4eebf0a02b6afe353b">xdr_dirpath</a>,
<a name="l00234"></a>00234    (xdrproc_t) <a class="code" href="nfs23_8h.html#a61d6a7bd517ab9ec90b14e5d6ac302d2">xdr_fhstatus2</a>, <span class="stringliteral">&quot;mnt_Mnt&quot;</span>,
<a name="l00235"></a>00235    <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a>},
<a name="l00236"></a>00236   {<a class="code" href="group__MNTprocs.html#gaf76f4294bf2d919fe2d58f1c405fbd41" title="The Mount proc Dump function, for all versions.">mnt_Dump</a>, <a class="code" href="group__NFSprocs.html#gad835adce5166476b3899d71b4da4dc18">mnt_Dump_Free</a>, (xdrproc_t) xdr_void,
<a name="l00237"></a>00237    (xdrproc_t) <a class="code" href="mount_8h.html#aba947f98a583a7aea4583a3649b88664">xdr_mountlist</a>, <span class="stringliteral">&quot;mnt_Dump&quot;</span>,
<a name="l00238"></a>00238    <a class="code" href="nfs__proto__functions_8h.html#aed6ce17d8db2471a85ee3f6add005aab">NOTHING_SPECIAL</a>},
<a name="l00239"></a>00239   {<a class="code" href="group__MNTprocs.html#gad6382b9cdc43e0e5b88798a5fb825269" title="The Mount proc umount function, for all versions.">mnt_Umnt</a>, <a class="code" href="group__NFSprocs.html#ga0aed32a96096e0a88bccd4698f103a9f">mnt_Umnt_Free</a>, (xdrproc_t) <a class="code" href="mount_8h.html#a9df8de57aef14f4eebf0a02b6afe353b">xdr_dirpath</a>,
<a name="l00240"></a>00240    (xdrproc_t) xdr_void, <span class="stringliteral">&quot;mnt_Umnt&quot;</span>,
<a name="l00241"></a>00241    <a class="code" href="nfs__proto__functions_8h.html#aed6ce17d8db2471a85ee3f6add005aab">NOTHING_SPECIAL</a>},
<a name="l00242"></a>00242   {<a class="code" href="group__MNTprocs.html#gaa1fd72e266d05912ee1882ed051e404c" title="The Mount proc umount_all function, for all versions.">mnt_UmntAll</a>, <a class="code" href="group__NFSprocs.html#gaf84eedaff38cb8d39ab0230033cd66bf">mnt_UmntAll_Free</a>, (xdrproc_t) xdr_void,
<a name="l00243"></a>00243    (xdrproc_t) xdr_void, <span class="stringliteral">&quot;mnt_UmntAll&quot;</span>,
<a name="l00244"></a>00244    <a class="code" href="nfs__proto__functions_8h.html#aed6ce17d8db2471a85ee3f6add005aab">NOTHING_SPECIAL</a>},
<a name="l00245"></a>00245   {<a class="code" href="group__MNTprocs.html#gaf845d8c27a0cbf7755a019dfb666995e" title="The Mount proc export function, for all versions.">mnt_Export</a>, <a class="code" href="group__NFSprocs.html#gab16cb1612cb6fdfffd77c84b6334a7c9">mnt_Export_Free</a>, (xdrproc_t) xdr_void,
<a name="l00246"></a>00246    (xdrproc_t) <a class="code" href="mount_8h.html#a685ae6330a2eda68c46146e11d8baaa7">xdr_exports</a>, <span class="stringliteral">&quot;mnt_Export&quot;</span>,
<a name="l00247"></a>00247    <a class="code" href="nfs__proto__functions_8h.html#aed6ce17d8db2471a85ee3f6add005aab">NOTHING_SPECIAL</a>}
<a name="l00248"></a>00248 };
<a name="l00249"></a>00249 
<a name="l00250"></a><a class="code" href="nfs__dupreq_8c.html#a7bcfef9b974d9b55a0f057d959a13bb8">00250</a> <span class="keyword">const</span> <a class="code" href="structnfs__function__desc____.html">nfs_function_desc_t</a> <a class="code" href="nfs__worker__thread_8c.html#a41035b6c8b713eb089640889054745f0">mnt3_func_desc</a>[] = {
<a name="l00251"></a>00251   {<a class="code" href="group__MNTprocs.html#ga353cb3eb5294c8415909678c72117b0e" title="The Mount proc null function, for all versions.">mnt_Null</a>, <a class="code" href="group__NFSprocs.html#gaea64e2d78be78da2a71da79f8148f3a8">mnt_Null_Free</a>, (xdrproc_t) xdr_void,
<a name="l00252"></a>00252    (xdrproc_t) xdr_void, <span class="stringliteral">&quot;mnt_Null&quot;</span>,
<a name="l00253"></a>00253    <a class="code" href="nfs__proto__functions_8h.html#aed6ce17d8db2471a85ee3f6add005aab">NOTHING_SPECIAL</a>},
<a name="l00254"></a>00254   {<a class="code" href="group__MNTprocs.html#ga94ec4e19de32e34ec873cc6f873b2975" title="The Mount proc mount function, for all versions.">mnt_Mnt</a>, <a class="code" href="group__NFSprocs.html#ga0224a415c06ceea24974dc444fff2449">mnt3_Mnt_Free</a>, (xdrproc_t) <a class="code" href="mount_8h.html#a9df8de57aef14f4eebf0a02b6afe353b">xdr_dirpath</a>,
<a name="l00255"></a>00255    (xdrproc_t) <a class="code" href="mount_8h.html#a0815b4e921753fea83ad98ba1a2026ed">xdr_mountres3</a>, <span class="stringliteral">&quot;mnt_Mnt&quot;</span>,
<a name="l00256"></a>00256    <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a>},
<a name="l00257"></a>00257   {<a class="code" href="group__MNTprocs.html#gaf76f4294bf2d919fe2d58f1c405fbd41" title="The Mount proc Dump function, for all versions.">mnt_Dump</a>, <a class="code" href="group__NFSprocs.html#gad835adce5166476b3899d71b4da4dc18">mnt_Dump_Free</a>, (xdrproc_t) xdr_void,
<a name="l00258"></a>00258    (xdrproc_t) <a class="code" href="mount_8h.html#aba947f98a583a7aea4583a3649b88664">xdr_mountlist</a>, <span class="stringliteral">&quot;mnt_Dump&quot;</span>,
<a name="l00259"></a>00259    <a class="code" href="nfs__proto__functions_8h.html#aed6ce17d8db2471a85ee3f6add005aab">NOTHING_SPECIAL</a>},
<a name="l00260"></a>00260   {<a class="code" href="group__MNTprocs.html#gad6382b9cdc43e0e5b88798a5fb825269" title="The Mount proc umount function, for all versions.">mnt_Umnt</a>, <a class="code" href="group__NFSprocs.html#ga0aed32a96096e0a88bccd4698f103a9f">mnt_Umnt_Free</a>, (xdrproc_t) <a class="code" href="mount_8h.html#a9df8de57aef14f4eebf0a02b6afe353b">xdr_dirpath</a>,
<a name="l00261"></a>00261    (xdrproc_t) xdr_void, <span class="stringliteral">&quot;mnt_Umnt&quot;</span>,
<a name="l00262"></a>00262    <a class="code" href="nfs__proto__functions_8h.html#aed6ce17d8db2471a85ee3f6add005aab">NOTHING_SPECIAL</a>},
<a name="l00263"></a>00263   {<a class="code" href="group__MNTprocs.html#gaa1fd72e266d05912ee1882ed051e404c" title="The Mount proc umount_all function, for all versions.">mnt_UmntAll</a>, <a class="code" href="group__NFSprocs.html#gaf84eedaff38cb8d39ab0230033cd66bf">mnt_UmntAll_Free</a>, (xdrproc_t) xdr_void,
<a name="l00264"></a>00264    (xdrproc_t) xdr_void, <span class="stringliteral">&quot;mnt_UmntAll&quot;</span>,
<a name="l00265"></a>00265    <a class="code" href="nfs__proto__functions_8h.html#aed6ce17d8db2471a85ee3f6add005aab">NOTHING_SPECIAL</a>},
<a name="l00266"></a>00266   {<a class="code" href="group__MNTprocs.html#gaf845d8c27a0cbf7755a019dfb666995e" title="The Mount proc export function, for all versions.">mnt_Export</a>, <a class="code" href="group__NFSprocs.html#gab16cb1612cb6fdfffd77c84b6334a7c9">mnt_Export_Free</a>, (xdrproc_t) xdr_void,
<a name="l00267"></a>00267    (xdrproc_t) <a class="code" href="mount_8h.html#a685ae6330a2eda68c46146e11d8baaa7">xdr_exports</a>, <span class="stringliteral">&quot;mnt_Export&quot;</span>,
<a name="l00268"></a>00268    <a class="code" href="nfs__proto__functions_8h.html#aed6ce17d8db2471a85ee3f6add005aab">NOTHING_SPECIAL</a>}
<a name="l00269"></a>00269 };
<a name="l00270"></a>00270 
<a name="l00271"></a><a class="code" href="nfs__worker__thread_8c.html#ae2359d945ac1b7d9dd7a02828db05b7d">00271</a> <span class="preprocessor">#define nlm4_Unsupported nlm_Null</span>
<a name="l00272"></a><a class="code" href="nfs__worker__thread_8c.html#ac784369cc2870f6293891209af11c79b">00272</a> <span class="preprocessor"></span><span class="preprocessor">#define nlm4_Unsupported_Free nlm_Null_Free</span>
<a name="l00273"></a>00273 <span class="preprocessor"></span>
<a name="l00274"></a>00274 <span class="preprocessor">#ifdef _USE_NLM</span>
<a name="l00275"></a>00275 <span class="preprocessor"></span><span class="keyword">const</span> <a class="code" href="structnfs__function__desc____.html">nfs_function_desc_t</a> nlm4_func_desc[] = {
<a name="l00276"></a>00276   [<a class="code" href="nlm4_8h.html#ace2657a3d6a54eb4d4f3c19cc5d45d77">NLMPROC4_NULL</a>] = {
<a name="l00277"></a>00277       <a class="code" href="group__NLMprocs.html#ga25316e31fe1e634302d52ca802f28f8b" title="The NLM proc null function, for all versions.">nlm_Null</a>, <a class="code" href="group__NFSprocs.html#ga6fb8381d7124927bcc9d5768bc0fdba9">nlm_Null_Free</a>, (xdrproc_t) xdr_void,
<a name="l00278"></a>00278       (xdrproc_t) xdr_void, <span class="stringliteral">&quot;nlm_Null&quot;</span>,
<a name="l00279"></a>00279       <a class="code" href="nfs__proto__functions_8h.html#aed6ce17d8db2471a85ee3f6add005aab">NOTHING_SPECIAL</a>},
<a name="l00280"></a>00280   [<a class="code" href="nlm4_8h.html#a3c888fffe0ae9b29993eab681f0e3292">NLMPROC4_TEST</a>] = {
<a name="l00281"></a>00281       <a class="code" href="group__NLMprocs.html#gada23166916d188de86afd57e476607b2">nlm4_Test</a>, <a class="code" href="group__NFSprocs.html#ga2ab6ba754ed7fb55e04fe3b724637e8e">nlm4_Test_Free</a>, (xdrproc_t) <a class="code" href="nlm4_8h.html#a5b83044f4b950fa8c2ecaccb1c7a5e36">xdr_nlm4_testargs</a>,
<a name="l00282"></a>00282       (xdrproc_t) <a class="code" href="nlm4_8h.html#a24363a0caa9fd586520b01c14ce223d5">xdr_nlm4_testres</a>, <span class="stringliteral">&quot;nlm4_Test&quot;</span>,
<a name="l00283"></a>00283       <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a>},
<a name="l00284"></a>00284   [<a class="code" href="nlm4_8h.html#a6d6926d26f7f035bf7204b2d2bbe2778">NLMPROC4_LOCK</a>] = {
<a name="l00285"></a>00285       <a class="code" href="group__NLMprocs.html#gaad6e9cb7a05ba20cd4f08ca809668203" title="Set a range lock.">nlm4_Lock</a>, <a class="code" href="group__NFSprocs.html#ga221c8bf2e79fd5ce0804b80026b43acd">nlm4_Lock_Free</a>, (xdrproc_t) <a class="code" href="nlm4_8h.html#a0b8a3eccf16e702b21131d8eaf30512c">xdr_nlm4_lockargs</a>,
<a name="l00286"></a>00286       (xdrproc_t) <a class="code" href="nlm4_8h.html#a96db59c8f90c9d871d06dd612e92ef4b">xdr_nlm4_res</a>, <span class="stringliteral">&quot;nlm4_Lock&quot;</span>,
<a name="l00287"></a>00287       <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a>},
<a name="l00288"></a>00288   [<a class="code" href="nlm4_8h.html#a93b7efc2737e2c6c6a3c3eb9a4bfff4c">NLMPROC4_CANCEL</a>] = {
<a name="l00289"></a>00289       <a class="code" href="group__NLMprocs.html#ga39a4f56853889aef35802dcf04368548" title="Cancel a blocked range lock.">nlm4_Cancel</a>, <a class="code" href="group__NFSprocs.html#ga3cd47669c300ffb9727d4fa6090af313">nlm4_Cancel_Free</a>, (xdrproc_t) <a class="code" href="nlm4_8h.html#af58737e79691728ee9ae9a316409f8cb">xdr_nlm4_cancargs</a>,
<a name="l00290"></a>00290       (xdrproc_t) <a class="code" href="nlm4_8h.html#a96db59c8f90c9d871d06dd612e92ef4b">xdr_nlm4_res</a>, <span class="stringliteral">&quot;nlm4_Cancel&quot;</span>,
<a name="l00291"></a>00291       <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a>},
<a name="l00292"></a>00292   [<a class="code" href="nlm4_8h.html#a71b2cf4b9c17fd1c3f01ebf06913cc15">NLMPROC4_UNLOCK</a>] = {
<a name="l00293"></a>00293       <a class="code" href="group__NLMprocs.html#gadbf9b8fcaf4cb898a6ec6446426d06dd" title="Free a range lock.">nlm4_Unlock</a>, <a class="code" href="group__NFSprocs.html#gadce1b1ae276542860bb4a11d2e2eb49a">nlm4_Unlock_Free</a>, (xdrproc_t) <a class="code" href="nlm4_8h.html#ae0b07f7c539bdd904fe630b7e54ee772">xdr_nlm4_unlockargs</a>,
<a name="l00294"></a>00294       (xdrproc_t) <a class="code" href="nlm4_8h.html#a96db59c8f90c9d871d06dd612e92ef4b">xdr_nlm4_res</a>, <span class="stringliteral">&quot;nlm4_Unlock&quot;</span>,
<a name="l00295"></a>00295       <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a>},
<a name="l00296"></a>00296   [<a class="code" href="nlm4_8h.html#a33e0700068fada217480556b7390bd60">NLMPROC4_GRANTED</a>] = {
<a name="l00297"></a>00297       <a class="code" href="nfs__worker__thread_8c.html#ae2359d945ac1b7d9dd7a02828db05b7d">nlm4_Unsupported</a>, <a class="code" href="nfs__worker__thread_8c.html#ac784369cc2870f6293891209af11c79b">nlm4_Unsupported_Free</a>, (xdrproc_t) xdr_void,
<a name="l00298"></a>00298       (xdrproc_t) xdr_void, <span class="stringliteral">&quot;nlm4_Granted&quot;</span>,
<a name="l00299"></a>00299       <a class="code" href="nfs__proto__functions_8h.html#aed6ce17d8db2471a85ee3f6add005aab">NOTHING_SPECIAL</a>},
<a name="l00300"></a>00300   [<a class="code" href="nlm4_8h.html#a3ec07bc97ffe7e20807af5b085cb89c9">NLMPROC4_TEST_MSG</a>] = {
<a name="l00301"></a>00301       <a class="code" href="group__NLMprocs.html#ga2c530ce49502c9c62bc2d4ddb6768a19" title="Test lock Message.">nlm4_Test_Message</a>, <a class="code" href="group__NFSprocs.html#ga2ab6ba754ed7fb55e04fe3b724637e8e">nlm4_Test_Free</a>,
<a name="l00302"></a>00302       (xdrproc_t) <a class="code" href="nlm4_8h.html#a5b83044f4b950fa8c2ecaccb1c7a5e36">xdr_nlm4_testargs</a>,
<a name="l00303"></a>00303       (xdrproc_t) xdr_void, <span class="stringliteral">&quot;nlm4_Test_msg&quot;</span>,
<a name="l00304"></a>00304       <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a>},
<a name="l00305"></a>00305   [<a class="code" href="nlm4_8h.html#ae5eafa766d4c34190a2c06a00cbebefd">NLMPROC4_LOCK_MSG</a>] = {
<a name="l00306"></a>00306       <a class="code" href="group__NLMprocs.html#ga1bb2d7ecaa683eed216beee0a84a6065">nlm4_Lock_Message</a>, <a class="code" href="group__NFSprocs.html#ga221c8bf2e79fd5ce0804b80026b43acd">nlm4_Lock_Free</a>,
<a name="l00307"></a>00307       (xdrproc_t) <a class="code" href="nlm4_8h.html#a0b8a3eccf16e702b21131d8eaf30512c">xdr_nlm4_lockargs</a>,
<a name="l00308"></a>00308       (xdrproc_t) xdr_void, <span class="stringliteral">&quot;nlm4_Lock_msg&quot;</span>,
<a name="l00309"></a>00309       <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a>},
<a name="l00310"></a>00310   [<a class="code" href="nlm4_8h.html#a897a0ebc7152e24282f1a9255c3b02f1">NLMPROC4_CANCEL_MSG</a>] = {
<a name="l00311"></a>00311       <a class="code" href="group__NLMprocs.html#gae8d344ec3a710b8a48556cb8a5c97e62">nlm4_Cancel_Message</a>, <a class="code" href="group__NFSprocs.html#ga3cd47669c300ffb9727d4fa6090af313">nlm4_Cancel_Free</a>,
<a name="l00312"></a>00312       (xdrproc_t) <a class="code" href="nlm4_8h.html#af58737e79691728ee9ae9a316409f8cb">xdr_nlm4_cancargs</a>,
<a name="l00313"></a>00313       (xdrproc_t) xdr_void, <span class="stringliteral">&quot;nlm4_Cancel_msg&quot;</span>,
<a name="l00314"></a>00314       <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a>},
<a name="l00315"></a>00315   [<a class="code" href="nlm4_8h.html#a4bd8e4c7d8c4609855b8fa1ed4195efa">NLMPROC4_UNLOCK_MSG</a>] = {
<a name="l00316"></a>00316       <a class="code" href="group__NLMprocs.html#ga653f3ca2d5d96b8aa948d5ae3aadd31c" title="Unlock Message.">nlm4_Unlock_Message</a>, <a class="code" href="group__NFSprocs.html#gadce1b1ae276542860bb4a11d2e2eb49a">nlm4_Unlock_Free</a>,
<a name="l00317"></a>00317       (xdrproc_t) <a class="code" href="nlm4_8h.html#ae0b07f7c539bdd904fe630b7e54ee772">xdr_nlm4_unlockargs</a>,
<a name="l00318"></a>00318       (xdrproc_t) xdr_void, <span class="stringliteral">&quot;nlm4_Unlock_msg&quot;</span>,
<a name="l00319"></a>00319       <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a>},
<a name="l00320"></a>00320   [<a class="code" href="nlm4_8h.html#a5cefd0b5eef7266d5585343625d2f413">NLMPROC4_GRANTED_MSG</a>] = {
<a name="l00321"></a>00321       <a class="code" href="nfs__worker__thread_8c.html#ae2359d945ac1b7d9dd7a02828db05b7d">nlm4_Unsupported</a>, <a class="code" href="nfs__worker__thread_8c.html#ac784369cc2870f6293891209af11c79b">nlm4_Unsupported_Free</a>, (xdrproc_t) xdr_void,
<a name="l00322"></a>00322       (xdrproc_t) xdr_void, <span class="stringliteral">&quot;nlm4_Granted_msg&quot;</span>,
<a name="l00323"></a>00323       <a class="code" href="nfs__proto__functions_8h.html#aed6ce17d8db2471a85ee3f6add005aab">NOTHING_SPECIAL</a>},
<a name="l00324"></a>00324   [<a class="code" href="nlm4_8h.html#a61eeca147efca59e5d8e7f9a5217c666">NLMPROC4_TEST_RES</a>] = {
<a name="l00325"></a>00325       <a class="code" href="nfs__worker__thread_8c.html#ae2359d945ac1b7d9dd7a02828db05b7d">nlm4_Unsupported</a>, <a class="code" href="nfs__worker__thread_8c.html#ac784369cc2870f6293891209af11c79b">nlm4_Unsupported_Free</a>, (xdrproc_t) xdr_void,
<a name="l00326"></a>00326       (xdrproc_t) xdr_void, <span class="stringliteral">&quot;nlm4_Test_res&quot;</span>,
<a name="l00327"></a>00327       <a class="code" href="nfs__proto__functions_8h.html#aed6ce17d8db2471a85ee3f6add005aab">NOTHING_SPECIAL</a>},
<a name="l00328"></a>00328   [<a class="code" href="nlm4_8h.html#a33e0e2b3ba76da98b8a2e365918628f2">NLMPROC4_LOCK_RES</a>] = {
<a name="l00329"></a>00329       <a class="code" href="nfs__worker__thread_8c.html#ae2359d945ac1b7d9dd7a02828db05b7d">nlm4_Unsupported</a>, <a class="code" href="nfs__worker__thread_8c.html#ac784369cc2870f6293891209af11c79b">nlm4_Unsupported_Free</a>, (xdrproc_t) xdr_void,
<a name="l00330"></a>00330       (xdrproc_t) xdr_void, <span class="stringliteral">&quot;nlm4_Lock_res&quot;</span>,
<a name="l00331"></a>00331       <a class="code" href="nfs__proto__functions_8h.html#aed6ce17d8db2471a85ee3f6add005aab">NOTHING_SPECIAL</a>},
<a name="l00332"></a>00332   [<a class="code" href="nlm4_8h.html#a0f4a33a13706484a12bf91ee18c0f697">NLMPROC4_CANCEL_RES</a>] = {
<a name="l00333"></a>00333       <a class="code" href="nfs__worker__thread_8c.html#ae2359d945ac1b7d9dd7a02828db05b7d">nlm4_Unsupported</a>, <a class="code" href="nfs__worker__thread_8c.html#ac784369cc2870f6293891209af11c79b">nlm4_Unsupported_Free</a>, (xdrproc_t) xdr_void,
<a name="l00334"></a>00334       (xdrproc_t) xdr_void, <span class="stringliteral">&quot;nlm4_Cancel_res&quot;</span>,
<a name="l00335"></a>00335       <a class="code" href="nfs__proto__functions_8h.html#aed6ce17d8db2471a85ee3f6add005aab">NOTHING_SPECIAL</a>},
<a name="l00336"></a>00336   [<a class="code" href="nlm4_8h.html#a98d8362f28bc4be795785290a884beb0">NLMPROC4_UNLOCK_RES</a>] = {
<a name="l00337"></a>00337       <a class="code" href="nfs__worker__thread_8c.html#ae2359d945ac1b7d9dd7a02828db05b7d">nlm4_Unsupported</a>, <a class="code" href="nfs__worker__thread_8c.html#ac784369cc2870f6293891209af11c79b">nlm4_Unsupported_Free</a>, (xdrproc_t) xdr_void,
<a name="l00338"></a>00338       (xdrproc_t) xdr_void, <span class="stringliteral">&quot;nlm4_Unlock_res&quot;</span>,
<a name="l00339"></a>00339       <a class="code" href="nfs__proto__functions_8h.html#aed6ce17d8db2471a85ee3f6add005aab">NOTHING_SPECIAL</a>},
<a name="l00340"></a>00340   [<a class="code" href="nlm4_8h.html#ac878bfcff7ab0119884eef9e7618eeaa">NLMPROC4_GRANTED_RES</a>] = {
<a name="l00341"></a>00341       <a class="code" href="group__NLMprocs.html#ga6445509cec3794ace7975aed72be172d">nlm4_Granted_Res</a>, <a class="code" href="group__NFSprocs.html#ga50ab0ce025c36d46221c5dd932754dce">nlm4_Granted_Res_Free</a>, (xdrproc_t) <a class="code" href="nlm4_8h.html#a96db59c8f90c9d871d06dd612e92ef4b">xdr_nlm4_res</a>,
<a name="l00342"></a>00342       (xdrproc_t) xdr_void, <span class="stringliteral">&quot;nlm4_Granted_res&quot;</span>,
<a name="l00343"></a>00343       <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a>},
<a name="l00344"></a>00344   [<a class="code" href="nlm4_8h.html#aa1349a564f4673d68d85603bb3f34e91">NLMPROC4_SM_NOTIFY</a>] = {
<a name="l00345"></a>00345       <a class="code" href="group__NLMprocs.html#ga30ee795cbdb3d293c45314906227eeb6" title="NSM notification.">nlm4_Sm_Notify</a>, <a class="code" href="group__NFSprocs.html#ga0959f64f0d7ffecc26d60068fbef4299">nlm4_Sm_Notify_Free</a>,
<a name="l00346"></a>00346       (xdrproc_t) <a class="code" href="nlm4_8h.html#abe2ffb563d93f1fc316cc368c5a783be">xdr_nlm4_sm_notifyargs</a>, (xdrproc_t) xdr_void,
<a name="l00347"></a>00347       <span class="stringliteral">&quot;nlm4_sm_notify&quot;</span>,
<a name="l00348"></a>00348       <a class="code" href="nfs__proto__functions_8h.html#aed6ce17d8db2471a85ee3f6add005aab">NOTHING_SPECIAL</a>},
<a name="l00349"></a>00349   [17] = {
<a name="l00350"></a>00350       <a class="code" href="nfs__worker__thread_8c.html#ae2359d945ac1b7d9dd7a02828db05b7d">nlm4_Unsupported</a>, <a class="code" href="nfs__worker__thread_8c.html#ac784369cc2870f6293891209af11c79b">nlm4_Unsupported_Free</a>,
<a name="l00351"></a>00351       (xdrproc_t) xdr_void, (xdrproc_t) xdr_void,
<a name="l00352"></a>00352       <span class="stringliteral">&quot;nlm4_Granted_res&quot;</span>,
<a name="l00353"></a>00353       <a class="code" href="nfs__proto__functions_8h.html#aed6ce17d8db2471a85ee3f6add005aab">NOTHING_SPECIAL</a>},
<a name="l00354"></a>00354   [18] = {
<a name="l00355"></a>00355       <a class="code" href="nfs__worker__thread_8c.html#ae2359d945ac1b7d9dd7a02828db05b7d">nlm4_Unsupported</a>, <a class="code" href="nfs__worker__thread_8c.html#ac784369cc2870f6293891209af11c79b">nlm4_Unsupported_Free</a>,
<a name="l00356"></a>00356       (xdrproc_t) xdr_void, (xdrproc_t) xdr_void,
<a name="l00357"></a>00357       <span class="stringliteral">&quot;nlm4_Granted_res&quot;</span>,
<a name="l00358"></a>00358       <a class="code" href="nfs__proto__functions_8h.html#aed6ce17d8db2471a85ee3f6add005aab">NOTHING_SPECIAL</a>},
<a name="l00359"></a>00359   [19] = {
<a name="l00360"></a>00360       <a class="code" href="nfs__worker__thread_8c.html#ae2359d945ac1b7d9dd7a02828db05b7d">nlm4_Unsupported</a>, <a class="code" href="nfs__worker__thread_8c.html#ac784369cc2870f6293891209af11c79b">nlm4_Unsupported_Free</a>,
<a name="l00361"></a>00361       (xdrproc_t) xdr_void, (xdrproc_t) xdr_void,
<a name="l00362"></a>00362       <span class="stringliteral">&quot;nlm4_Granted_res&quot;</span>,
<a name="l00363"></a>00363       <a class="code" href="nfs__proto__functions_8h.html#aed6ce17d8db2471a85ee3f6add005aab">NOTHING_SPECIAL</a>},
<a name="l00364"></a>00364   [<a class="code" href="nlm4_8h.html#abb47fef1bfd08c707907a86ab410a2be">NLMPROC4_SHARE</a>] {<a class="code" href="group__NLMprocs.html#gaebbda004967c1df19abed8c7d5950f78">nlm4_Share</a>, <a class="code" href="group__NFSprocs.html#ga6ea6cc2e4970e24c752b86a50583832b">nlm4_Share_Free</a>,
<a name="l00365"></a>00365                     (xdrproc_t) <a class="code" href="nlm4_8h.html#ac21ec6c2cfbfaa2a511ad6aadf9a337e">xdr_nlm4_shareargs</a>, (xdrproc_t) <a class="code" href="nlm4_8h.html#a53c05a36669577c62fff6be97712ff4e">xdr_nlm4_shareres</a>,
<a name="l00366"></a>00366                     <span class="stringliteral">&quot;nlm4_Share&quot;</span>,
<a name="l00367"></a>00367                     <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a>},
<a name="l00368"></a>00368   [<a class="code" href="nlm4_8h.html#ad810d25d548d502d8a2f62c6cdaeeb41">NLMPROC4_UNSHARE</a>] = {<a class="code" href="group__NLMprocs.html#ga2428c704d34a93eea66a18834b432e00">nlm4_Unshare</a>, <a class="code" href="group__NFSprocs.html#ga43ef2f5b6d1b380af6c7b29b9e3856af">nlm4_Unshare_Free</a>,
<a name="l00369"></a>00369                         (xdrproc_t) <a class="code" href="nlm4_8h.html#ac21ec6c2cfbfaa2a511ad6aadf9a337e">xdr_nlm4_shareargs</a>, (xdrproc_t) <a class="code" href="nlm4_8h.html#a53c05a36669577c62fff6be97712ff4e">xdr_nlm4_shareres</a>,
<a name="l00370"></a>00370                         <span class="stringliteral">&quot;nlm4_Unshare&quot;</span>,
<a name="l00371"></a>00371                         <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a>},
<a name="l00372"></a>00372   [<a class="code" href="nlm4_8h.html#a1c97ec33276eaac8f61bfe9be3c4eea1">NLMPROC4_NM_LOCK</a>] = {
<a name="l00373"></a>00373                         <span class="comment">/* NLM_NM_LOCK uses the same handling as NLM_LOCK except for</span>
<a name="l00374"></a>00374 <span class="comment">                         * monitoring, nlm4_Lock will make that determination.</span>
<a name="l00375"></a>00375 <span class="comment">                         */</span>
<a name="l00376"></a>00376                         <a class="code" href="group__NLMprocs.html#gaad6e9cb7a05ba20cd4f08ca809668203" title="Set a range lock.">nlm4_Lock</a>, <a class="code" href="group__NFSprocs.html#ga221c8bf2e79fd5ce0804b80026b43acd">nlm4_Lock_Free</a>,
<a name="l00377"></a>00377                         (xdrproc_t) <a class="code" href="nlm4_8h.html#a0b8a3eccf16e702b21131d8eaf30512c">xdr_nlm4_lockargs</a>, (xdrproc_t) <a class="code" href="nlm4_8h.html#a96db59c8f90c9d871d06dd612e92ef4b">xdr_nlm4_res</a>,
<a name="l00378"></a>00378                         <span class="stringliteral">&quot;nlm4_Nm_lock&quot;</span>,
<a name="l00379"></a>00379                         <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a>},
<a name="l00380"></a>00380   [<a class="code" href="nlm4_8h.html#a1d7c91777bc2a3a770046e9ab742ba61">NLMPROC4_FREE_ALL</a>] = {<a class="code" href="group__NLMprocs.html#gada05522b206d9b53e9605fef9d5013ec">nlm4_Free_All</a>, <a class="code" href="group__NFSprocs.html#gaaf4a7e1a28b5afae293a415f9ea1ebc5">nlm4_Free_All_Free</a>,
<a name="l00381"></a>00381                          (xdrproc_t) <a class="code" href="nlm4_8h.html#a0966979de3e650f549bb859c78ba5c25">xdr_nlm4_free_allargs</a>, (xdrproc_t) xdr_void,
<a name="l00382"></a>00382                          <span class="stringliteral">&quot;nlm4_Free_all&quot;</span>,
<a name="l00383"></a>00383                          <a class="code" href="nfs__proto__functions_8h.html#aed6ce17d8db2471a85ee3f6add005aab">NOTHING_SPECIAL</a>},
<a name="l00384"></a>00384 };
<a name="l00385"></a>00385 <span class="preprocessor">#endif                          </span><span class="comment">/* _USE_NLM */</span>
<a name="l00386"></a>00386 
<a name="l00387"></a>00387 <span class="preprocessor">#ifdef _USE_RQUOTA</span>
<a name="l00388"></a>00388 <span class="preprocessor"></span><span class="keyword">const</span> <a class="code" href="structnfs__function__desc____.html">nfs_function_desc_t</a> rquota1_func_desc[] = {
<a name="l00389"></a>00389   [0] = {
<a name="l00390"></a>00390          <a class="code" href="group__RQUOTA.html#gaf3edf25247f0cf1ff18962ac7143cf2b" title="The RQUOTA proc null function, for all versions.">rquota_Null</a>, <a class="code" href="group__NFSprocs.html#ga0180dc43a1968497a494a10d28269d38">rquota_Null_Free</a>, (xdrproc_t) xdr_void,
<a name="l00391"></a>00391          (xdrproc_t) xdr_void, <span class="stringliteral">&quot;rquota_Null&quot;</span>,
<a name="l00392"></a>00392          <a class="code" href="nfs__proto__functions_8h.html#aed6ce17d8db2471a85ee3f6add005aab">NOTHING_SPECIAL</a>},
<a name="l00393"></a>00393   [<a class="code" href="rquota_8h.html#ab063b616fd70842f2be93a7c0d84c27d">RQUOTAPROC_GETQUOTA</a>] = {
<a name="l00394"></a>00394       <a class="code" href="group__RQUOTA.html#ga81ba6d4af8644e23ebe5e704d82179b7" title="The Rquota getquota function, for all versions.">rquota_getquota</a>, <a class="code" href="group__NFSprocs.html#gac163084ca912fdf121efe081dbbeb109">rquota_getquota_Free</a>,
<a name="l00395"></a>00395       (xdrproc_t) <a class="code" href="rquota_8h.html#a9daf9f2c5ba2176eb137167446a2ac00">xdr_getquota_args</a>,
<a name="l00396"></a>00396       (xdrproc_t) <a class="code" href="rquota_8h.html#a446833ad7231d6421e4b29323f70b543">xdr_getquota_rslt</a>, <span class="stringliteral">&quot;rquota_Getquota&quot;</span>,
<a name="l00397"></a>00397       <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a>},
<a name="l00398"></a>00398   [<a class="code" href="rquota_8h.html#a2bf28de6fbd3844aff15e1fb1f89e831">RQUOTAPROC_GETACTIVEQUOTA</a>] = {
<a name="l00399"></a>00399       <a class="code" href="group__RQUOTA.html#ga5f840fd320a7a77f599c82fcf1eb507b" title="The Rquota getactivequota function, for all versions.">rquota_getactivequota</a>, <a class="code" href="group__NFSprocs.html#gacad909499770fddbe30919366d08dee7">rquota_getactivequota_Free</a>,
<a name="l00400"></a>00400       (xdrproc_t) <a class="code" href="rquota_8h.html#a9daf9f2c5ba2176eb137167446a2ac00">xdr_getquota_args</a>,
<a name="l00401"></a>00401       (xdrproc_t) <a class="code" href="rquota_8h.html#a446833ad7231d6421e4b29323f70b543">xdr_getquota_rslt</a>, <span class="stringliteral">&quot;rquota_Getactivequota&quot;</span>,
<a name="l00402"></a>00402       <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a>},
<a name="l00403"></a>00403   [<a class="code" href="rquota_8h.html#a4952877fc336281b71b9ffee9988412e">RQUOTAPROC_SETQUOTA</a>] = {
<a name="l00404"></a>00404       <a class="code" href="group__RQUOTA.html#gaf764e5dbf031cbd647b8335d8f51454d" title="The Rquota setquota function, for all versions.">rquota_setquota</a>, <a class="code" href="group__NFSprocs.html#gabdb73a6f249b9eacb6d95b9b99be5131">rquota_setquota_Free</a>,
<a name="l00405"></a>00405       (xdrproc_t) <a class="code" href="rquota_8h.html#a7d3cb3a266d2462963df348ef9b9b97b">xdr_setquota_args</a>,
<a name="l00406"></a>00406       (xdrproc_t) <a class="code" href="rquota_8h.html#aeaab63318e9ee2744dcf3a4d03c78dc1">xdr_setquota_rslt</a>, <span class="stringliteral">&quot;rquota_Setactivequota&quot;</span>,
<a name="l00407"></a>00407       <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a>},
<a name="l00408"></a>00408   [<a class="code" href="rquota_8h.html#a0c4fc6301f2d410d5c613f33d0031edf">RQUOTAPROC_SETACTIVEQUOTA</a>] = {
<a name="l00409"></a>00409       <a class="code" href="group__RQUOTA.html#ga1c27e079f703fd49d0f5b2cc3eb78f2f" title="The Rquota setactivequota function, for all versions.">rquota_setactivequota</a>, <a class="code" href="group__NFSprocs.html#gacaabbbd20b2bdb5fac964daf3c377520">rquota_setactivequota_Free</a>,
<a name="l00410"></a>00410       (xdrproc_t) <a class="code" href="rquota_8h.html#a7d3cb3a266d2462963df348ef9b9b97b">xdr_setquota_args</a>,
<a name="l00411"></a>00411       (xdrproc_t) <a class="code" href="rquota_8h.html#aeaab63318e9ee2744dcf3a4d03c78dc1">xdr_setquota_rslt</a>, <span class="stringliteral">&quot;rquota_Getactivequota&quot;</span>,
<a name="l00412"></a>00412       <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a>}
<a name="l00413"></a>00413 };
<a name="l00414"></a>00414 
<a name="l00415"></a>00415 <span class="keyword">const</span> <a class="code" href="structnfs__function__desc____.html">nfs_function_desc_t</a> rquota2_func_desc[] = {
<a name="l00416"></a>00416     [0] = {
<a name="l00417"></a>00417         <a class="code" href="group__RQUOTA.html#gaf3edf25247f0cf1ff18962ac7143cf2b" title="The RQUOTA proc null function, for all versions.">rquota_Null</a>, <a class="code" href="group__NFSprocs.html#ga0180dc43a1968497a494a10d28269d38">rquota_Null_Free</a>, (xdrproc_t) xdr_void,
<a name="l00418"></a>00418         (xdrproc_t) xdr_void, <span class="stringliteral">&quot;rquota_Null&quot;</span>,
<a name="l00419"></a>00419         <a class="code" href="nfs__proto__functions_8h.html#aed6ce17d8db2471a85ee3f6add005aab">NOTHING_SPECIAL</a>},
<a name="l00420"></a>00420     [<a class="code" href="rquota_8h.html#ab063b616fd70842f2be93a7c0d84c27d">RQUOTAPROC_GETQUOTA</a>] = {
<a name="l00421"></a>00421         <a class="code" href="group__RQUOTA.html#ga81ba6d4af8644e23ebe5e704d82179b7" title="The Rquota getquota function, for all versions.">rquota_getquota</a>, <a class="code" href="group__NFSprocs.html#gac163084ca912fdf121efe081dbbeb109">rquota_getquota_Free</a>,
<a name="l00422"></a>00422         (xdrproc_t) <a class="code" href="rquota_8h.html#aa64169b51beaade649571b8abfc4f363">xdr_ext_getquota_args</a>,
<a name="l00423"></a>00423         (xdrproc_t) <a class="code" href="rquota_8h.html#a446833ad7231d6421e4b29323f70b543">xdr_getquota_rslt</a>, <span class="stringliteral">&quot;rquota_Ext_Getquota&quot;</span>,
<a name="l00424"></a>00424         <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a>},
<a name="l00425"></a>00425   [<a class="code" href="rquota_8h.html#a2bf28de6fbd3844aff15e1fb1f89e831">RQUOTAPROC_GETACTIVEQUOTA</a>] = {
<a name="l00426"></a>00426       <a class="code" href="group__RQUOTA.html#ga5f840fd320a7a77f599c82fcf1eb507b" title="The Rquota getactivequota function, for all versions.">rquota_getactivequota</a>, <a class="code" href="group__NFSprocs.html#gacad909499770fddbe30919366d08dee7">rquota_getactivequota_Free</a>,
<a name="l00427"></a>00427       (xdrproc_t) <a class="code" href="rquota_8h.html#aa64169b51beaade649571b8abfc4f363">xdr_ext_getquota_args</a>,
<a name="l00428"></a>00428       (xdrproc_t) <a class="code" href="rquota_8h.html#a446833ad7231d6421e4b29323f70b543">xdr_getquota_rslt</a>,
<a name="l00429"></a>00429       <span class="stringliteral">&quot;rquota_Ext_Getactivequota&quot;</span>,
<a name="l00430"></a>00430       <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a>},
<a name="l00431"></a>00431     [<a class="code" href="rquota_8h.html#a4952877fc336281b71b9ffee9988412e">RQUOTAPROC_SETQUOTA</a>] = {
<a name="l00432"></a>00432         <a class="code" href="group__RQUOTA.html#gaf764e5dbf031cbd647b8335d8f51454d" title="The Rquota setquota function, for all versions.">rquota_setquota</a>, <a class="code" href="group__NFSprocs.html#gabdb73a6f249b9eacb6d95b9b99be5131">rquota_setquota_Free</a>,
<a name="l00433"></a>00433         (xdrproc_t) <a class="code" href="rquota_8h.html#a77d92ec942d7a07205056c3bd530bde8">xdr_ext_setquota_args</a>,
<a name="l00434"></a>00434         (xdrproc_t) <a class="code" href="rquota_8h.html#aeaab63318e9ee2744dcf3a4d03c78dc1">xdr_setquota_rslt</a>, <span class="stringliteral">&quot;rquota_Ext_Setactivequota&quot;</span>,
<a name="l00435"></a>00435         <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a>},
<a name="l00436"></a>00436     [<a class="code" href="rquota_8h.html#a0c4fc6301f2d410d5c613f33d0031edf">RQUOTAPROC_SETACTIVEQUOTA</a>] = {
<a name="l00437"></a>00437         <a class="code" href="group__RQUOTA.html#ga1c27e079f703fd49d0f5b2cc3eb78f2f" title="The Rquota setactivequota function, for all versions.">rquota_setactivequota</a>, <a class="code" href="group__NFSprocs.html#gacaabbbd20b2bdb5fac964daf3c377520">rquota_setactivequota_Free</a>,
<a name="l00438"></a>00438         (xdrproc_t) <a class="code" href="rquota_8h.html#a77d92ec942d7a07205056c3bd530bde8">xdr_ext_setquota_args</a>,
<a name="l00439"></a>00439         (xdrproc_t) <a class="code" href="rquota_8h.html#aeaab63318e9ee2744dcf3a4d03c78dc1">xdr_setquota_rslt</a>,
<a name="l00440"></a>00440         <span class="stringliteral">&quot;rquota_Ext_Getactivequota&quot;</span>,
<a name="l00441"></a>00441         <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a>}
<a name="l00442"></a>00442 };
<a name="l00443"></a>00443 
<a name="l00444"></a>00444 <span class="preprocessor">#endif                          </span><span class="comment">/* _USE_RQUOTA */</span>
<a name="l00445"></a>00445 
<a name="l00446"></a>00446 <span class="keyword">extern</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="nfs__tcb_8c.html#aa83dc66ed4a1817d9a7f6a76db63eb77">pause_state_str</a>[];
<a name="l00447"></a>00447 
<a name="l00461"></a><a class="code" href="nfs__worker__thread_8c.html#a47e8bde054e96db98693ae1d2d74cd43">00461</a> <span class="keywordtype">int</span> <a class="code" href="nfs__core_8h.html#a47e8bde054e96db98693ae1d2d74cd43">nfs_Init_gc_counter</a>(<span class="keywordtype">void</span>)
<a name="l00462"></a>00462 {
<a name="l00463"></a>00463   pthread_mutexattr_t mutexattr;
<a name="l00464"></a>00464 
<a name="l00465"></a>00465   <span class="keywordflow">if</span>(pthread_mutexattr_init(&amp;mutexattr) != 0)
<a name="l00466"></a>00466     <span class="keywordflow">return</span> -1;
<a name="l00467"></a>00467 
<a name="l00468"></a>00468   <span class="keywordflow">if</span>(pthread_mutex_init(&amp;<a class="code" href="nfs__worker__thread_8c.html#abe04e34ee93c05b0ef368bc7f20f5656">lock_nb_current_gc_workers</a>, &amp;mutexattr) != 0)
<a name="l00469"></a>00469     <span class="keywordflow">return</span> -1;
<a name="l00470"></a>00470 
<a name="l00471"></a>00471   <a class="code" href="nfs__worker__thread_8c.html#a1aaee2caa31305958d161507860bda96">nb_current_gc_workers</a> = 0;
<a name="l00472"></a>00472 
<a name="l00473"></a>00473   <span class="keywordflow">return</span> 0;                     <span class="comment">/* Success */</span>
<a name="l00474"></a>00474 }                               <span class="comment">/* nfs_Init_gc_counter */</span>
<a name="l00475"></a>00475 
<a name="l00476"></a><a class="code" href="cmd__tools_8h.html#acf045ccad77a69933c72ecf0f7beeb14">00476</a> <span class="keyword">struct </span>timeval <a class="code" href="nfs__stat_8h.html#acf045ccad77a69933c72ecf0f7beeb14">time_diff</a>(struct timeval time_from, struct timeval time_to)
<a name="l00477"></a>00477 {
<a name="l00478"></a>00478 
<a name="l00479"></a>00479   <span class="keyword">struct </span>timeval result;
<a name="l00480"></a>00480 
<a name="l00481"></a>00481   <span class="keywordflow">if</span>(time_to.tv_usec &lt; time_from.tv_usec)
<a name="l00482"></a>00482     {
<a name="l00483"></a>00483       result.tv_sec = time_to.tv_sec - time_from.tv_sec - 1;
<a name="l00484"></a>00484       result.tv_usec = 1000000 + time_to.tv_usec - time_from.tv_usec;
<a name="l00485"></a>00485     }
<a name="l00486"></a>00486   <span class="keywordflow">else</span>
<a name="l00487"></a>00487     {
<a name="l00488"></a>00488       result.tv_sec = time_to.tv_sec - time_from.tv_sec;
<a name="l00489"></a>00489       result.tv_usec = time_to.tv_usec - time_from.tv_usec;
<a name="l00490"></a>00490     }
<a name="l00491"></a>00491 
<a name="l00492"></a>00492   <span class="keywordflow">return</span> result;
<a name="l00493"></a>00493 }
<a name="l00494"></a>00494 
<a name="l00499"></a><a class="code" href="nfs__worker__thread_8c.html#a4fd1c8c2a69cec20ceec98348a679f34">00499</a> <span class="keywordtype">int</span> <a class="code" href="nfs__worker__thread_8c.html#a4fd1c8c2a69cec20ceec98348a679f34">is_rpc_call_valid</a>(SVCXPRT *xprt, <span class="keyword">struct</span> svc_req *preq)
<a name="l00500"></a>00500 {
<a name="l00501"></a>00501   <span class="keywordtype">int</span> lo_vers, hi_vers;
<a name="l00502"></a>00502 
<a name="l00503"></a>00503   <span class="keywordflow">if</span>(preq-&gt;rq_prog == <a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#aeef2995e9b54747311db1972d158fd41">core_param</a>.<a class="code" href="structnfs__core__param____.html#aa04e466147819b7a92794e45e67ad2c9">program</a>[<a class="code" href="nfs__core_8h.html#a7f6e26c17a511d03a3e095f595a02907a69c56a6ce312422c90b25f97a43d4dc2">P_NFS</a>])
<a name="l00504"></a>00504     {
<a name="l00505"></a>00505       <span class="comment">/* If we go there, preq-&gt;rq_prog ==  nfs_param.core_param.program[P_NFS] */</span>
<a name="l00506"></a>00506       <span class="keywordflow">if</span>(((preq-&gt;rq_vers != <a class="code" href="nfs23_8h.html#ab7bf618affb552e91b562c195b52b6a7">NFS_V2</a>) || ((<a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#aeef2995e9b54747311db1972d158fd41">core_param</a>.<a class="code" href="structnfs__core__param____.html#a1c4c04a8f01424eb79f5df47036fbf36">core_options</a> &amp; <a class="code" href="nfs__core_8h.html#a8541f80ed5bfbad4e2c0480a0a5272fe">CORE_OPTION_NFSV2</a>) == 0)) &amp;&amp;
<a name="l00507"></a>00507          ((preq-&gt;rq_vers != <a class="code" href="nfs23_8h.html#ad0f0a57c0aacb6093af91d085b807cbd">NFS_V3</a>) || ((<a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#aeef2995e9b54747311db1972d158fd41">core_param</a>.<a class="code" href="structnfs__core__param____.html#a1c4c04a8f01424eb79f5df47036fbf36">core_options</a> &amp; <a class="code" href="nfs__core_8h.html#a95b77ea227a89897affa6e4286f39d9f">CORE_OPTION_NFSV3</a>) == 0)) &amp;&amp;
<a name="l00508"></a>00508          ((preq-&gt;rq_vers != <a class="code" href="nfsv40_8h.html#a38cfe5720671dbafe5d1b278f6fe9dec">NFS_V4</a>) || ((<a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#aeef2995e9b54747311db1972d158fd41">core_param</a>.<a class="code" href="structnfs__core__param____.html#a1c4c04a8f01424eb79f5df47036fbf36">core_options</a> &amp; <a class="code" href="nfs__core_8h.html#a909bc686b3f5a599dd38d9f29aaaef68">CORE_OPTION_NFSV4</a>) == 0)))
<a name="l00509"></a>00509         {
<a name="l00510"></a>00510           <span class="keywordflow">if</span>(xprt != <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00511"></a>00511             {
<a name="l00512"></a>00512               <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l00513"></a>00513                            <span class="stringliteral">&quot;Invalid NFS Version #%d&quot;</span>,
<a name="l00514"></a>00514                            (<span class="keywordtype">int</span>)preq-&gt;rq_vers);
<a name="l00515"></a>00515               lo_vers = <a class="code" href="nfsv40_8h.html#a38cfe5720671dbafe5d1b278f6fe9dec">NFS_V4</a>;
<a name="l00516"></a>00516               hi_vers = <a class="code" href="nfs23_8h.html#ab7bf618affb552e91b562c195b52b6a7">NFS_V2</a>;
<a name="l00517"></a>00517               <span class="keywordflow">if</span>((<a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#aeef2995e9b54747311db1972d158fd41">core_param</a>.<a class="code" href="structnfs__core__param____.html#a1c4c04a8f01424eb79f5df47036fbf36">core_options</a> &amp; <a class="code" href="nfs__core_8h.html#a8541f80ed5bfbad4e2c0480a0a5272fe">CORE_OPTION_NFSV2</a>) != 0)
<a name="l00518"></a>00518                 lo_vers = <a class="code" href="nfs23_8h.html#ab7bf618affb552e91b562c195b52b6a7">NFS_V2</a>;
<a name="l00519"></a>00519               <span class="keywordflow">if</span>((<a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#aeef2995e9b54747311db1972d158fd41">core_param</a>.<a class="code" href="structnfs__core__param____.html#a1c4c04a8f01424eb79f5df47036fbf36">core_options</a> &amp; <a class="code" href="nfs__core_8h.html#a95b77ea227a89897affa6e4286f39d9f">CORE_OPTION_NFSV3</a>) != 0)
<a name="l00520"></a>00520                 {
<a name="l00521"></a>00521                   <span class="keywordflow">if</span>(lo_vers == <a class="code" href="nfsv40_8h.html#a38cfe5720671dbafe5d1b278f6fe9dec">NFS_V4</a>)
<a name="l00522"></a>00522                     lo_vers = <a class="code" href="nfs23_8h.html#ad0f0a57c0aacb6093af91d085b807cbd">NFS_V3</a>;
<a name="l00523"></a>00523                   hi_vers = <a class="code" href="nfs23_8h.html#ad0f0a57c0aacb6093af91d085b807cbd">NFS_V3</a>;
<a name="l00524"></a>00524                 }
<a name="l00525"></a>00525               <span class="keywordflow">if</span>((<a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#aeef2995e9b54747311db1972d158fd41">core_param</a>.<a class="code" href="structnfs__core__param____.html#a1c4c04a8f01424eb79f5df47036fbf36">core_options</a> &amp; <a class="code" href="nfs__core_8h.html#a909bc686b3f5a599dd38d9f29aaaef68">CORE_OPTION_NFSV4</a>) != 0)
<a name="l00526"></a>00526                 hi_vers = <a class="code" href="nfsv40_8h.html#a38cfe5720671dbafe5d1b278f6fe9dec">NFS_V4</a>;
<a name="l00527"></a>00527               svcerr_progvers2(xprt, preq, lo_vers, hi_vers);  <span class="comment">/* Bad NFS version */</span>
<a name="l00528"></a>00528             }
<a name="l00529"></a>00529           <span class="keywordflow">return</span> <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00530"></a>00530         }
<a name="l00531"></a>00531       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(((preq-&gt;rq_vers == <a class="code" href="nfs23_8h.html#ab7bf618affb552e91b562c195b52b6a7">NFS_V2</a>) &amp;&amp; (preq-&gt;rq_proc &gt; <a class="code" href="nfs23_8h.html#af1496d7998aa323f84a514d1a11fd349">NFSPROC_STATFS</a>)) ||
<a name="l00532"></a>00532               ((preq-&gt;rq_vers == <a class="code" href="nfs23_8h.html#ad0f0a57c0aacb6093af91d085b807cbd">NFS_V3</a>) &amp;&amp; (preq-&gt;rq_proc &gt; <a class="code" href="nfs23_8h.html#a7a832f8cdd0d37313d100d1f5273595d">NFSPROC3_COMMIT</a>)) ||
<a name="l00533"></a>00533               ((preq-&gt;rq_vers == <a class="code" href="nfsv40_8h.html#a38cfe5720671dbafe5d1b278f6fe9dec">NFS_V4</a>) &amp;&amp; (preq-&gt;rq_proc &gt; <a class="code" href="nfsv40_8h.html#a8ef9e1ab2fa6753b1ad048a62fc418f7">NFSPROC4_COMPOUND</a>)))
<a name="l00534"></a>00534         {
<a name="l00535"></a>00535           <span class="keywordflow">if</span>(xprt != <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00536"></a>00536             svcerr_noproc2(xprt, preq);
<a name="l00537"></a>00537           <span class="keywordflow">return</span> <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00538"></a>00538         }
<a name="l00539"></a>00539       <span class="keywordflow">return</span> <a class="code" href="HashTable_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00540"></a>00540     }
<a name="l00541"></a>00541 
<a name="l00542"></a>00542   <span class="keywordflow">if</span>(preq-&gt;rq_prog == <a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#aeef2995e9b54747311db1972d158fd41">core_param</a>.<a class="code" href="structnfs__core__param____.html#aa04e466147819b7a92794e45e67ad2c9">program</a>[<a class="code" href="nfs__core_8h.html#a7f6e26c17a511d03a3e095f595a02907a9c790ab4adce0dd1d4dde907f1211eb4">P_MNT</a>] &amp;&amp;
<a name="l00543"></a>00543      ((<a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#aeef2995e9b54747311db1972d158fd41">core_param</a>.<a class="code" href="structnfs__core__param____.html#a1c4c04a8f01424eb79f5df47036fbf36">core_options</a> &amp; (<a class="code" href="nfs__core_8h.html#a8541f80ed5bfbad4e2c0480a0a5272fe">CORE_OPTION_NFSV2</a> | <a class="code" href="nfs__core_8h.html#a95b77ea227a89897affa6e4286f39d9f">CORE_OPTION_NFSV3</a>)) != 0))
<a name="l00544"></a>00544     {
<a name="l00545"></a>00545       <span class="comment">/* Call is with MOUNTPROG */</span>
<a name="l00546"></a>00546       <span class="comment">/* Verify mount version and report error if invalid */</span>
<a name="l00547"></a>00547       lo_vers = <a class="code" href="mount_8h.html#a1b68bc78418850d3ec380cd17106c913">MOUNT_V1</a>;
<a name="l00548"></a>00548       hi_vers = <a class="code" href="mount_8h.html#a12f1699613f9b6e2ca86537be080c567">MOUNT_V3</a>;
<a name="l00549"></a>00549 
<a name="l00550"></a>00550       <span class="comment">/* Some clients may use the wrong mount version to umount, so always allow umount,</span>
<a name="l00551"></a>00551 <span class="comment">       * otherwise only allow request if the appropriate mount version is enabled.</span>
<a name="l00552"></a>00552 <span class="comment">       * also need to allow dump and export, so just disallow mount if version not supported</span>
<a name="l00553"></a>00553 <span class="comment">       */</span>
<a name="l00554"></a>00554       <span class="keywordflow">if</span>((preq-&gt;rq_vers == <a class="code" href="mount_8h.html#a1b68bc78418850d3ec380cd17106c913">MOUNT_V1</a>) &amp;&amp;
<a name="l00555"></a>00555          (((<a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#aeef2995e9b54747311db1972d158fd41">core_param</a>.<a class="code" href="structnfs__core__param____.html#a1c4c04a8f01424eb79f5df47036fbf36">core_options</a> &amp; <a class="code" href="nfs__core_8h.html#a8541f80ed5bfbad4e2c0480a0a5272fe">CORE_OPTION_NFSV2</a>) != 0) ||
<a name="l00556"></a>00556           (preq-&gt;rq_proc != <a class="code" href="mount_8h.html#aa8f304aa6ffd6ba2706fc649b67801cf">MOUNTPROC2_MNT</a>)))
<a name="l00557"></a>00557         {
<a name="l00558"></a>00558           <span class="keywordflow">if</span>(preq-&gt;rq_proc &gt; <a class="code" href="mount_8h.html#ae401c64ccd7ca53e3b90d5611b3f16cd">MOUNTPROC2_EXPORT</a>)
<a name="l00559"></a>00559             {
<a name="l00560"></a>00560               <span class="keywordflow">if</span>(xprt != <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00561"></a>00561                 svcerr_noproc2(xprt, preq);
<a name="l00562"></a>00562               <span class="keywordflow">return</span> <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00563"></a>00563             }
<a name="l00564"></a>00564           <span class="keywordflow">return</span> <a class="code" href="HashTable_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00565"></a>00565         }
<a name="l00566"></a>00566       <span class="keywordflow">else</span> <span class="keywordflow">if</span>((preq-&gt;rq_vers == <a class="code" href="mount_8h.html#a12f1699613f9b6e2ca86537be080c567">MOUNT_V3</a>) &amp;&amp;
<a name="l00567"></a>00567               (((<a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#aeef2995e9b54747311db1972d158fd41">core_param</a>.<a class="code" href="structnfs__core__param____.html#a1c4c04a8f01424eb79f5df47036fbf36">core_options</a> &amp; <a class="code" href="nfs__core_8h.html#a95b77ea227a89897affa6e4286f39d9f">CORE_OPTION_NFSV3</a>) != 0) ||
<a name="l00568"></a>00568                (preq-&gt;rq_proc != <a class="code" href="mount_8h.html#aa8f304aa6ffd6ba2706fc649b67801cf">MOUNTPROC2_MNT</a>)))
<a name="l00569"></a>00569         {
<a name="l00570"></a>00570           <span class="keywordflow">if</span>(preq-&gt;rq_proc &gt; <a class="code" href="mount_8h.html#a5574832f21495a6845fdb57a315bf950">MOUNTPROC3_EXPORT</a>)
<a name="l00571"></a>00571             {
<a name="l00572"></a>00572               <span class="keywordflow">if</span>(xprt != <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00573"></a>00573                   svcerr_noproc2(xprt, preq);
<a name="l00574"></a>00574               <span class="keywordflow">return</span> <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00575"></a>00575             }
<a name="l00576"></a>00576           <span class="keywordflow">return</span> <a class="code" href="HashTable_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00577"></a>00577         }
<a name="l00578"></a>00578 
<a name="l00579"></a>00579       <span class="keywordflow">if</span>(xprt != <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00580"></a>00580         {
<a name="l00581"></a>00581           <span class="comment">/* Bad MOUNT version - set the hi and lo versions and report error */</span>
<a name="l00582"></a>00582           <span class="keywordflow">if</span>((<a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#aeef2995e9b54747311db1972d158fd41">core_param</a>.<a class="code" href="structnfs__core__param____.html#a1c4c04a8f01424eb79f5df47036fbf36">core_options</a> &amp; <a class="code" href="nfs__core_8h.html#a8541f80ed5bfbad4e2c0480a0a5272fe">CORE_OPTION_NFSV2</a>) == 0)
<a name="l00583"></a>00583             lo_vers = <a class="code" href="mount_8h.html#a12f1699613f9b6e2ca86537be080c567">MOUNT_V3</a>;
<a name="l00584"></a>00584           <span class="keywordflow">if</span>((<a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#aeef2995e9b54747311db1972d158fd41">core_param</a>.<a class="code" href="structnfs__core__param____.html#a1c4c04a8f01424eb79f5df47036fbf36">core_options</a> &amp; <a class="code" href="nfs__core_8h.html#a95b77ea227a89897affa6e4286f39d9f">CORE_OPTION_NFSV3</a>) == 0)
<a name="l00585"></a>00585             hi_vers = <a class="code" href="mount_8h.html#a1b68bc78418850d3ec380cd17106c913">MOUNT_V1</a>;
<a name="l00586"></a>00586 
<a name="l00587"></a>00587           <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l00588"></a>00588                        <span class="stringliteral">&quot;Invalid Mount Version #%d&quot;</span>,
<a name="l00589"></a>00589                        (<span class="keywordtype">int</span>)preq-&gt;rq_vers);
<a name="l00590"></a>00590           svcerr_progvers2(xprt, preq, lo_vers, hi_vers);
<a name="l00591"></a>00591         }
<a name="l00592"></a>00592       <span class="keywordflow">return</span> <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00593"></a>00593     }
<a name="l00594"></a>00594 
<a name="l00595"></a>00595 <span class="preprocessor">#ifdef _USE_NLM</span>
<a name="l00596"></a>00596 <span class="preprocessor"></span>  <span class="keywordflow">if</span>(preq-&gt;rq_prog == <a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#aeef2995e9b54747311db1972d158fd41">core_param</a>.<a class="code" href="structnfs__core__param____.html#aa04e466147819b7a92794e45e67ad2c9">program</a>[P_NLM] &amp;&amp;
<a name="l00597"></a>00597           ((<a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#aeef2995e9b54747311db1972d158fd41">core_param</a>.<a class="code" href="structnfs__core__param____.html#a1c4c04a8f01424eb79f5df47036fbf36">core_options</a> &amp; <a class="code" href="nfs__core_8h.html#a95b77ea227a89897affa6e4286f39d9f">CORE_OPTION_NFSV3</a>) != 0))
<a name="l00598"></a>00598     {
<a name="l00599"></a>00599       <span class="comment">/* Call is with NLMPROG */</span>
<a name="l00600"></a>00600       <span class="keywordflow">if</span>(preq-&gt;rq_vers != <a class="code" href="nlm4_8h.html#a77d7904b6e8b9680a169ff75b341bb84">NLM4_VERS</a>)
<a name="l00601"></a>00601         {
<a name="l00602"></a>00602           <span class="comment">/* Bad NLM version */</span>
<a name="l00603"></a>00603           <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l00604"></a>00604                        <span class="stringliteral">&quot;Invalid NLM Version #%d&quot;</span>,
<a name="l00605"></a>00605                        (<span class="keywordtype">int</span>)preq-&gt;rq_vers);
<a name="l00606"></a>00606           <span class="keywordflow">if</span>(xprt != <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00607"></a>00607             svcerr_progvers2(xprt, preq, <a class="code" href="nlm4_8h.html#a77d7904b6e8b9680a169ff75b341bb84">NLM4_VERS</a>, <a class="code" href="nlm4_8h.html#a77d7904b6e8b9680a169ff75b341bb84">NLM4_VERS</a>);
<a name="l00608"></a>00608           <span class="keywordflow">return</span> <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00609"></a>00609         }
<a name="l00610"></a>00610       <span class="keywordflow">if</span>(preq-&gt;rq_proc &gt; <a class="code" href="nlm4_8h.html#a1d7c91777bc2a3a770046e9ab742ba61">NLMPROC4_FREE_ALL</a>)
<a name="l00611"></a>00611         {
<a name="l00612"></a>00612           <span class="keywordflow">if</span>(xprt != <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00613"></a>00613              svcerr_noproc2(xprt, preq);
<a name="l00614"></a>00614           <span class="keywordflow">return</span> <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00615"></a>00615         }
<a name="l00616"></a>00616       <span class="keywordflow">return</span> <a class="code" href="HashTable_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00617"></a>00617     }
<a name="l00618"></a>00618 <span class="preprocessor">#endif                          </span><span class="comment">/* _USE_NLM */</span>
<a name="l00619"></a>00619 
<a name="l00620"></a>00620 <span class="preprocessor">#ifdef _USE_RQUOTA</span>
<a name="l00621"></a>00621 <span class="preprocessor"></span>   <span class="keywordflow">if</span>(preq-&gt;rq_prog == <a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#aeef2995e9b54747311db1972d158fd41">core_param</a>.<a class="code" href="structnfs__core__param____.html#aa04e466147819b7a92794e45e67ad2c9">program</a>[P_RQUOTA])
<a name="l00622"></a>00622      {
<a name="l00623"></a>00623        <span class="comment">/* Call is with NLMPROG */</span>
<a name="l00624"></a>00624        <span class="keywordflow">if</span>((preq-&gt;rq_vers != <a class="code" href="rquota_8h.html#ac79dc26de161d86cf32482a5573cc767">RQUOTAVERS</a>) &amp;&amp;
<a name="l00625"></a>00625           (preq-&gt;rq_vers != <a class="code" href="rquota_8h.html#a669e05a2522ab72aa2b0e8aa8323d883">EXT_RQUOTAVERS</a>))
<a name="l00626"></a>00626          {
<a name="l00627"></a>00627            <span class="comment">/* Bad NLM version */</span>
<a name="l00628"></a>00628            <span class="keywordflow">if</span>(xprt != <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00629"></a>00629              {
<a name="l00630"></a>00630                <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l00631"></a>00631                             <span class="stringliteral">&quot;Invalid RQUOTA Version #%d&quot;</span>,
<a name="l00632"></a>00632                             (<span class="keywordtype">int</span>)preq-&gt;rq_vers);
<a name="l00633"></a>00633                svcerr_progvers2(xprt, preq, <a class="code" href="rquota_8h.html#ac79dc26de161d86cf32482a5573cc767">RQUOTAVERS</a>, <a class="code" href="rquota_8h.html#a669e05a2522ab72aa2b0e8aa8323d883">EXT_RQUOTAVERS</a>);
<a name="l00634"></a>00634              }
<a name="l00635"></a>00635            <span class="keywordflow">return</span> <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00636"></a>00636          }
<a name="l00637"></a>00637        <span class="keywordflow">if</span> (((preq-&gt;rq_vers == <a class="code" href="rquota_8h.html#ac79dc26de161d86cf32482a5573cc767">RQUOTAVERS</a>) &amp;&amp;
<a name="l00638"></a>00638             (preq-&gt;rq_proc &gt; <a class="code" href="rquota_8h.html#a0c4fc6301f2d410d5c613f33d0031edf">RQUOTAPROC_SETACTIVEQUOTA</a>)) ||
<a name="l00639"></a>00639            ((preq-&gt;rq_vers == <a class="code" href="rquota_8h.html#a669e05a2522ab72aa2b0e8aa8323d883">EXT_RQUOTAVERS</a>) &amp;&amp;
<a name="l00640"></a>00640             (preq-&gt;rq_proc &gt; <a class="code" href="rquota_8h.html#a0c4fc6301f2d410d5c613f33d0031edf">RQUOTAPROC_SETACTIVEQUOTA</a>)))
<a name="l00641"></a>00641         {
<a name="l00642"></a>00642           <span class="keywordflow">if</span>(xprt != <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00643"></a>00643             svcerr_noproc2(xprt, preq);
<a name="l00644"></a>00644           <span class="keywordflow">return</span> <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00645"></a>00645         }
<a name="l00646"></a>00646       <span class="keywordflow">return</span> <a class="code" href="HashTable_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00647"></a>00647      }
<a name="l00648"></a>00648 <span class="preprocessor">#endif                          </span><span class="comment">/* _USE_QUOTA */</span>
<a name="l00649"></a>00649 
<a name="l00650"></a>00650   <span class="comment">/* No such program */</span>
<a name="l00651"></a>00651   <span class="keywordflow">if</span>(xprt != <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00652"></a>00652     {
<a name="l00653"></a>00653       <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l00654"></a>00654                    <span class="stringliteral">&quot;Invalid Program number #%d&quot;</span>,
<a name="l00655"></a>00655                    (<span class="keywordtype">int</span>)preq-&gt;rq_prog);
<a name="l00656"></a>00656       svcerr_noprog2(xprt, preq);        <span class="comment">/* This is no NFS, MOUNT program, exit... */</span>
<a name="l00657"></a>00657     }
<a name="l00658"></a>00658   <span class="keywordflow">return</span> <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00659"></a>00659 }
<a name="l00660"></a>00660 
<a name="l00661"></a>00661 <span class="comment">/*</span>
<a name="l00662"></a>00662 <span class="comment"> * Extract nfs function descriptor from nfs request.</span>
<a name="l00663"></a>00663 <span class="comment"> */</span>
<a name="l00664"></a><a class="code" href="nfs__worker__thread_8c.html#aeba106915769b419aebf2f3ab19b654a">00664</a> <span class="keyword">const</span> <a class="code" href="structnfs__function__desc____.html">nfs_function_desc_t</a> *<a class="code" href="nfs__core_8h.html#aeba106915769b419aebf2f3ab19b654a">nfs_rpc_get_funcdesc</a>(<a class="code" href="structnfs__request__data____.html">nfs_request_data_t</a> *preqnfs)
<a name="l00665"></a>00665 {
<a name="l00666"></a>00666   <span class="keyword">struct </span>svc_req *req = &amp;preqnfs-&gt;<a class="code" href="structnfs__request__data____.html#afddd6756b9d7c6c4e6ab81c7d79ac4a0">req</a>;
<a name="l00667"></a>00667 
<a name="l00668"></a>00668   <span class="comment">/* Validate rpc call, but don&#39;t report any errors here */</span>
<a name="l00669"></a>00669   <span class="keywordflow">if</span>(<a class="code" href="nfs__worker__thread_8c.html#a4fd1c8c2a69cec20ceec98348a679f34">is_rpc_call_valid</a>(preqnfs-&gt;<a class="code" href="structnfs__request__data____.html#aa61bc5d11af7e64be2f23a5b2a5ef0da">xprt</a>, req) == <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>)
<a name="l00670"></a>00670     {
<a name="l00671"></a>00671       <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l00672"></a>00672                    <span class="stringliteral">&quot;INVALID_FUNCDESC for Program %d, Version %d, &quot;</span>
<a name="l00673"></a>00673                    <span class="stringliteral">&quot;Function %d after is_rpc_call_valid&quot;</span>,
<a name="l00674"></a>00674                    (<span class="keywordtype">int</span>)req-&gt;rq_prog, (<span class="keywordtype">int</span>)req-&gt;rq_vers, (<span class="keywordtype">int</span>)req-&gt;rq_proc);
<a name="l00675"></a>00675       <span class="keywordflow">return</span> <a class="code" href="nfs__core_8h.html#a5ecbbf13d82cd2cbf2d6d80cb61624c5">INVALID_FUNCDESC</a>;
<a name="l00676"></a>00676     }
<a name="l00677"></a>00677 
<a name="l00678"></a>00678   <span class="keywordflow">if</span>(req-&gt;rq_prog == <a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#aeef2995e9b54747311db1972d158fd41">core_param</a>.<a class="code" href="structnfs__core__param____.html#aa04e466147819b7a92794e45e67ad2c9">program</a>[<a class="code" href="nfs__core_8h.html#a7f6e26c17a511d03a3e095f595a02907a69c56a6ce312422c90b25f97a43d4dc2">P_NFS</a>])
<a name="l00679"></a>00679     {
<a name="l00680"></a>00680       <span class="keywordflow">if</span>(req-&gt;rq_vers == <a class="code" href="nfs23_8h.html#ab7bf618affb552e91b562c195b52b6a7">NFS_V2</a>)
<a name="l00681"></a>00681         <span class="keywordflow">return</span> &amp;nfs2_func_desc[req-&gt;rq_proc];
<a name="l00682"></a>00682       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(req-&gt;rq_vers == <a class="code" href="nfs23_8h.html#ad0f0a57c0aacb6093af91d085b807cbd">NFS_V3</a>)
<a name="l00683"></a>00683         <span class="keywordflow">return</span> &amp;nfs3_func_desc[req-&gt;rq_proc];
<a name="l00684"></a>00684       <span class="keywordflow">else</span>
<a name="l00685"></a>00685         <span class="keywordflow">return</span> &amp;nfs4_func_desc[req-&gt;rq_proc];
<a name="l00686"></a>00686     }
<a name="l00687"></a>00687 
<a name="l00688"></a>00688   <span class="keywordflow">if</span>(req-&gt;rq_prog == <a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#aeef2995e9b54747311db1972d158fd41">core_param</a>.<a class="code" href="structnfs__core__param____.html#aa04e466147819b7a92794e45e67ad2c9">program</a>[<a class="code" href="nfs__core_8h.html#a7f6e26c17a511d03a3e095f595a02907a9c790ab4adce0dd1d4dde907f1211eb4">P_MNT</a>])
<a name="l00689"></a>00689     {
<a name="l00690"></a>00690       <span class="keywordflow">if</span>(req-&gt;rq_vers == <a class="code" href="mount_8h.html#a1b68bc78418850d3ec380cd17106c913">MOUNT_V1</a>)
<a name="l00691"></a>00691         <span class="keywordflow">return</span> &amp;mnt1_func_desc[req-&gt;rq_proc];
<a name="l00692"></a>00692       <span class="keywordflow">else</span>
<a name="l00693"></a>00693         <span class="keywordflow">return</span> &amp;mnt3_func_desc[req-&gt;rq_proc];
<a name="l00694"></a>00694     }
<a name="l00695"></a>00695 
<a name="l00696"></a>00696 <span class="preprocessor">#ifdef _USE_NLM</span>
<a name="l00697"></a>00697 <span class="preprocessor"></span>  <span class="keywordflow">if</span>(req-&gt;rq_prog == <a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#aeef2995e9b54747311db1972d158fd41">core_param</a>.<a class="code" href="structnfs__core__param____.html#aa04e466147819b7a92794e45e67ad2c9">program</a>[P_NLM])
<a name="l00698"></a>00698     {
<a name="l00699"></a>00699       <span class="keywordflow">return</span> &amp;nlm4_func_desc[req-&gt;rq_proc];
<a name="l00700"></a>00700     }
<a name="l00701"></a>00701 <span class="preprocessor">#endif                          </span><span class="comment">/* _USE_NLM */</span>
<a name="l00702"></a>00702 
<a name="l00703"></a>00703 <span class="preprocessor">#ifdef _USE_RQUOTA</span>
<a name="l00704"></a>00704 <span class="preprocessor"></span>  <span class="keywordflow">if</span>(req-&gt;rq_prog == <a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#aeef2995e9b54747311db1972d158fd41">core_param</a>.<a class="code" href="structnfs__core__param____.html#aa04e466147819b7a92794e45e67ad2c9">program</a>[P_RQUOTA])
<a name="l00705"></a>00705     {
<a name="l00706"></a>00706       <span class="keywordflow">if</span>(req-&gt;rq_vers == <a class="code" href="rquota_8h.html#ac79dc26de161d86cf32482a5573cc767">RQUOTAVERS</a>)
<a name="l00707"></a>00707         <span class="keywordflow">return</span> &amp;rquota1_func_desc[req-&gt;rq_proc];
<a name="l00708"></a>00708       <span class="keywordflow">else</span>
<a name="l00709"></a>00709         <span class="keywordflow">return</span> &amp;rquota2_func_desc[req-&gt;rq_proc];
<a name="l00710"></a>00710     }
<a name="l00711"></a>00711 <span class="preprocessor">#endif                          </span><span class="comment">/* _USE_RQUOTA */</span>
<a name="l00712"></a>00712 
<a name="l00713"></a>00713   <span class="comment">/* Oops, should never get here! */</span>
<a name="l00714"></a>00714   svcerr_noprog2(preqnfs-&gt;<a class="code" href="structnfs__request__data____.html#aa61bc5d11af7e64be2f23a5b2a5ef0da">xprt</a>, req);
<a name="l00715"></a>00715   <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l00716"></a>00716                <span class="stringliteral">&quot;INVALID_FUNCDESC for Program %d, Version %d, Function %d&quot;</span>,
<a name="l00717"></a>00717                (<span class="keywordtype">int</span>)req-&gt;rq_prog, (<span class="keywordtype">int</span>)req-&gt;rq_vers, (<span class="keywordtype">int</span>)req-&gt;rq_proc);
<a name="l00718"></a>00718   <span class="keywordflow">return</span> <a class="code" href="nfs__core_8h.html#a5ecbbf13d82cd2cbf2d6d80cb61624c5">INVALID_FUNCDESC</a>;
<a name="l00719"></a>00719 }
<a name="l00720"></a>00720 
<a name="l00721"></a>00721 <span class="comment">/*</span>
<a name="l00722"></a>00722 <span class="comment"> * Extract RPC argument.</span>
<a name="l00723"></a>00723 <span class="comment"> */</span>
<a name="l00724"></a><a class="code" href="nfs__worker__thread_8c.html#a77e8f030d1fde829450a2c9fc196362d">00724</a> <span class="keywordtype">int</span> <a class="code" href="nfs__core_8h.html#a77e8f030d1fde829450a2c9fc196362d">nfs_rpc_get_args</a>(<a class="code" href="structnfs__request__data____.html">nfs_request_data_t</a> *preqnfs, <span class="keyword">const</span> <a class="code" href="structnfs__function__desc____.html">nfs_function_desc_t</a> *pfuncdesc)
<a name="l00725"></a>00725 {
<a name="l00726"></a>00726   SVCXPRT *xprt = preqnfs-&gt;<a class="code" href="structnfs__request__data____.html#aa61bc5d11af7e64be2f23a5b2a5ef0da">xprt</a>;
<a name="l00727"></a>00727   <a class="code" href="unionnfs__arg____.html">nfs_arg_t</a> *parg_nfs = &amp;preqnfs-&gt;<a class="code" href="structnfs__request__data____.html#a5d5d5916b19052b01a23d6f4e78ddecb">arg_nfs</a>;
<a name="l00728"></a>00728 
<a name="l00729"></a>00729   memset(parg_nfs, 0, <span class="keyword">sizeof</span>(<a class="code" href="unionnfs__arg____.html">nfs_arg_t</a>));
<a name="l00730"></a>00730 
<a name="l00731"></a>00731   <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l00732"></a>00732                <span class="stringliteral">&quot;Before svc_getargs on socket %d, xprt=%p&quot;</span>,
<a name="l00733"></a>00733                xprt-&gt;xp_fd, xprt);
<a name="l00734"></a>00734 
<a name="l00735"></a>00735   <span class="keywordflow">if</span>(svc_getargs(xprt, pfuncdesc-&gt;<a class="code" href="group__NFSprocs.html#gac1da0ffd4b07434230a44ef3a2ca558f">xdr_decode_func</a>, (caddr_t) parg_nfs) == <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>)
<a name="l00736"></a>00736     {
<a name="l00737"></a>00737       <span class="keyword">struct </span>svc_req *req = &amp;preqnfs-&gt;<a class="code" href="structnfs__request__data____.html#afddd6756b9d7c6c4e6ab81c7d79ac4a0">req</a>;
<a name="l00738"></a>00738       <a class="code" href="log_8h.html#a3cf3c22fac6bb9871e25007551caeb13">LogMajor</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l00739"></a>00739                    <span class="stringliteral">&quot;svc_getargs failed for Program %d, Version %d, Function %d xid=%u&quot;</span>,
<a name="l00740"></a>00740                (<span class="keywordtype">int</span>)req-&gt;rq_prog, (<span class="keywordtype">int</span>)req-&gt;rq_vers, (<span class="keywordtype">int</span>)req-&gt;rq_proc,
<a name="l00741"></a>00741                req-&gt;rq_xid);
<a name="l00742"></a>00742       svcerr_decode2(xprt, req);
<a name="l00743"></a>00743       <span class="keywordflow">return</span> <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00744"></a>00744     }
<a name="l00745"></a>00745 
<a name="l00746"></a>00746   <span class="keywordflow">return</span> <a class="code" href="HashTable_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00747"></a>00747 }
<a name="l00748"></a>00748 
<a name="l00757"></a>00757 <span class="keyword">static</span> <span class="keywordtype">void</span> nfs_rpc_execute(<a class="code" href="structrequest__data____.html">request_data_t</a> *preq,
<a name="l00758"></a>00758                             <a class="code" href="structnfs__worker__data____.html">nfs_worker_data_t</a> *pworker_data)
<a name="l00759"></a>00759 {
<a name="l00760"></a>00760   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> export_check_result;
<a name="l00761"></a>00761   <a class="code" href="structexportlist____.html">exportlist_t</a> *pexport = <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00762"></a>00762   <a class="code" href="structnfs__request__data____.html">nfs_request_data_t</a> *preqnfs = preq-&gt;<a class="code" href="structrequest__data____.html#a418c071aa5cff12637b7668645e371ba">r_u</a>.<a class="code" href="unionrequest__data_____1_1request__content____.html#aa3080af499da22a494e6dd32f5e4c7ce">nfs</a>;
<a name="l00763"></a>00763   <a class="code" href="unionnfs__arg____.html">nfs_arg_t</a> *parg_nfs = &amp;preqnfs-&gt;<a class="code" href="structnfs__request__data____.html#a5d5d5916b19052b01a23d6f4e78ddecb">arg_nfs</a>;
<a name="l00764"></a>00764   <a class="code" href="unionnfs__res____.html">nfs_res_t</a> res_nfs;
<a name="l00765"></a>00765   <span class="keywordtype">short</span> exportid;
<a name="l00766"></a>00766   <a class="code" href="structlru__list____.html">LRU_list_t</a> *lru_dupreq = <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00767"></a>00767   <span class="keyword">struct </span>svc_req *req = &amp;preqnfs-&gt;<a class="code" href="structnfs__request__data____.html#afddd6756b9d7c6c4e6ab81c7d79ac4a0">req</a>;
<a name="l00768"></a>00768   SVCXPRT *xprt = preqnfs-&gt;<a class="code" href="structnfs__request__data____.html#aa61bc5d11af7e64be2f23a5b2a5ef0da">xprt</a>;
<a name="l00769"></a>00769   <a class="code" href="nfs__stat_8h.html#a97f31ee04128b6f3c0063fee72bbec96">nfs_stat_type_t</a> stat_type;
<a name="l00770"></a>00770   <a class="code" href="ganesha__rpc_8h.html#a42f3261a45141da24a6d18194eae1c91">sockaddr_t</a> hostaddr;
<a name="l00771"></a>00771   <span class="keywordtype">int</span> port;
<a name="l00772"></a>00772   <span class="keywordtype">int</span> rc;
<a name="l00773"></a>00773   <span class="keywordtype">int</span> do_dupreq_cache;
<a name="l00774"></a>00774   <a class="code" href="nfs__dupreq_8h.html#ac04e868a8254478b04252e38f6b27440">dupreq_status_t</a> dpq_status;
<a name="l00775"></a>00775   <a class="code" href="structexportlist__client__entry____.html">exportlist_client_entry_t</a> related_client;
<a name="l00776"></a>00776   <span class="keyword">struct </span><a class="code" href="structuser__cred.html">user_cred</a> <a class="code" href="structuser__credentials.html">user_credentials</a>;
<a name="l00777"></a>00777   <span class="keywordtype">int</span>   update_per_share_stats;
<a name="l00778"></a>00778   <a class="code" href="structfsal__op__context____.html">fsal_op_context_t</a> * pfsal_op_ctx = <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> ;
<a name="l00779"></a>00779 
<a name="l00780"></a>00780   <span class="keyword">struct </span>timeval *timer_start = &amp;pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a49c2ed29735a44d5779e8674ee76df63">timer_start</a>;
<a name="l00781"></a>00781   <span class="keyword">struct </span>timeval timer_end;
<a name="l00782"></a>00782   <span class="keyword">struct </span>timeval timer_diff;
<a name="l00783"></a>00783   <span class="keyword">struct </span>timeval queue_timer_diff;
<a name="l00784"></a>00784   <a class="code" href="structnfs__request__latency__stat____.html">nfs_request_latency_stat_t</a> latency_stat;
<a name="l00785"></a>00785 
<a name="l00786"></a>00786   memset(&amp;related_client, 0, <span class="keyword">sizeof</span>(<a class="code" href="structexportlist__client__entry____.html">exportlist_client_entry_t</a>));
<a name="l00787"></a>00787 
<a name="l00788"></a>00788   <span class="comment">/* Get the value from the worker data */</span>
<a name="l00789"></a>00789   lru_dupreq = pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a5dcb7ab5d79badb75a9fe1b37b6a24cb">duplicate_request</a>;
<a name="l00790"></a>00790 
<a name="l00791"></a>00791   <span class="comment">/* initializing RPC structure */</span>
<a name="l00792"></a>00792   memset(&amp;res_nfs, 0, <span class="keyword">sizeof</span>(res_nfs));
<a name="l00793"></a>00793 
<a name="l00794"></a>00794   <span class="comment">/* If we reach this point, there was no dupreq cache hit or no dup req cache</span>
<a name="l00795"></a>00795 <span class="comment">   * was necessary.  Get NFS function descriptor. */</span>
<a name="l00796"></a>00796   pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a9c8362f69383467f564f831889a917e3">pfuncdesc</a> = <a class="code" href="nfs__core_8h.html#aeba106915769b419aebf2f3ab19b654a">nfs_rpc_get_funcdesc</a>(preqnfs);
<a name="l00797"></a>00797   <span class="keywordflow">if</span>(pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a9c8362f69383467f564f831889a917e3">pfuncdesc</a> == INVALID_FUNCDESC)
<a name="l00798"></a>00798     <span class="keywordflow">return</span>;
<a name="l00799"></a>00799 
<a name="l00800"></a>00800   <span class="comment">/* XXX must hold lock when calling any TI-RPC channel function,</span>
<a name="l00801"></a>00801 <span class="comment">   * including svc_sendreply2 and the svcerr_* calls */</span>
<a name="l00802"></a>00802 
<a name="l00803"></a>00803   <span class="keywordflow">if</span>(<a class="code" href="ganesha__rpc_8h.html#ac79de7952a084c98f9dfeba5e1ac0556">copy_xprt_addr</a>(&amp;hostaddr, xprt) == 0)
<a name="l00804"></a>00804     {
<a name="l00805"></a>00805       <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l00806"></a>00806                    <span class="stringliteral">&quot;copy_xprt_addr failed for Program %d, Version %d, &quot;</span>
<a name="l00807"></a>00807                    <span class="stringliteral">&quot;Function %d&quot;</span>,
<a name="l00808"></a>00808                    (<span class="keywordtype">int</span>)req-&gt;rq_prog, (<span class="keywordtype">int</span>)req-&gt;rq_vers,
<a name="l00809"></a>00809                    (<span class="keywordtype">int</span>)req-&gt;rq_proc);
<a name="l00810"></a>00810       <span class="comment">/* XXX move lock wrapper into RPC API */</span>
<a name="l00811"></a>00811       svc_dplx_lock_x(xprt, &amp;pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a45a5ae3cb189d60666f7cd4e5fc4f8c5">sigmask</a>);
<a name="l00812"></a>00812       svcerr_systemerr2(xprt, req);
<a name="l00813"></a>00813       svc_dplx_unlock_x(xprt, &amp;pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a45a5ae3cb189d60666f7cd4e5fc4f8c5">sigmask</a>);
<a name="l00814"></a>00814       <span class="keywordflow">return</span>;
<a name="l00815"></a>00815     }
<a name="l00816"></a>00816 
<a name="l00817"></a>00817   port = <a class="code" href="ganesha__rpc_8h.html#a79f07f6ff6b909e4a108e53412d5d127">get_port</a>(&amp;hostaddr);
<a name="l00818"></a>00818 
<a name="l00819"></a>00819   <span class="keywordflow">if</span>(<a class="code" href="log_8h.html#ac778c7aeca566b747dd5bb1baecb6316">isDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>))
<a name="l00820"></a>00820     {
<a name="l00821"></a>00821       <span class="keywordtype">char</span> addrbuf[<a class="code" href="ganesha__rpc_8h.html#a9174d973fdbe2abdc1987d702b5b7d1a">SOCK_NAME_MAX</a>];
<a name="l00822"></a>00822       <a class="code" href="ganesha__rpc_8h.html#a798e3040dc5734e965e36b405958f984">sprint_sockaddr</a>(&amp;hostaddr, addrbuf, <span class="keyword">sizeof</span>(addrbuf));
<a name="l00823"></a>00823       <a class="code" href="log_8h.html#aa7aee8ec65b5baafb430f8d2a7588d53">LogDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l00824"></a>00824                <span class="stringliteral">&quot;Request from %s for Program %d, Version %d, Function %d &quot;</span>
<a name="l00825"></a>00825                <span class="stringliteral">&quot;has xid=%u&quot;</span>,
<a name="l00826"></a>00826                addrbuf,
<a name="l00827"></a>00827                (<span class="keywordtype">int</span>)req-&gt;rq_prog, (<span class="keywordtype">int</span>)req-&gt;rq_vers, (<span class="keywordtype">int</span>)req-&gt;rq_proc,
<a name="l00828"></a>00828                req-&gt;rq_xid);
<a name="l00829"></a>00829     }
<a name="l00830"></a>00830 
<a name="l00831"></a>00831   do_dupreq_cache = pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a9c8362f69383467f564f831889a917e3">pfuncdesc</a>-&gt;<a class="code" href="group__NFSprocs.html#gaf72ed67e54f4f570bdc423fbf18f628b">dispatch_behaviour</a> &amp; <a class="code" href="nfs__proto__functions_8h.html#a404163b184b6e34650d2a6ef54052137">CAN_BE_DUP</a>;
<a name="l00832"></a>00832   <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>, <span class="stringliteral">&quot;do_dupreq_cache = %d&quot;</span>, do_dupreq_cache);
<a name="l00833"></a>00833   dpq_status = <a class="code" href="nfs__dupreq_8h.html#accd676b25fd8adda77faf10c37f5a71b">nfs_dupreq_add_not_finished</a>(req, &amp;res_nfs);
<a name="l00834"></a>00834   <span class="keywordflow">switch</span>(dpq_status)
<a name="l00835"></a>00835     {
<a name="l00836"></a>00836       <span class="comment">/* a new request, continue processing it */</span>
<a name="l00837"></a>00837     <span class="keywordflow">case</span> <a class="code" href="nfs__dupreq_8h.html#a8f699cea0366b683501fe91a4dbc37faa081a1934d0972db9961d46f25d264ff9">DUPREQ_SUCCESS</a>:
<a name="l00838"></a>00838       <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>, <span class="stringliteral">&quot;Current request is not duplicate.&quot;</span>);
<a name="l00839"></a>00839       <span class="keywordflow">break</span>;
<a name="l00840"></a>00840       <span class="comment">/* Found the reuqest in the dupreq cache. It&#39;s an old request so resend</span>
<a name="l00841"></a>00841 <span class="comment">       * old reply. */</span>
<a name="l00842"></a>00842     <span class="keywordflow">case</span> <a class="code" href="nfs__dupreq_8h.html#a8f699cea0366b683501fe91a4dbc37faa8da646241fbb89f0df17b9458aae381a">DUPREQ_ALREADY_EXISTS</a>:
<a name="l00843"></a>00843       <span class="keywordflow">if</span>(do_dupreq_cache)
<a name="l00844"></a>00844         {
<a name="l00845"></a>00845           <span class="comment">/* Request was known, use the previous reply */</span>
<a name="l00846"></a>00846           <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l00847"></a>00847                        <span class="stringliteral">&quot;NFS DISPATCHER: DupReq Cache Hit: using previous &quot;</span>
<a name="l00848"></a>00848                        <span class="stringliteral">&quot;reply, rpcxid=%u&quot;</span>,
<a name="l00849"></a>00849                        req-&gt;rq_xid);
<a name="l00850"></a>00850 
<a name="l00851"></a>00851           <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l00852"></a>00852                        <span class="stringliteral">&quot;Before svc_sendreply on socket %d (dup req)&quot;</span>,
<a name="l00853"></a>00853                        xprt-&gt;xp_fd);
<a name="l00854"></a>00854 
<a name="l00855"></a>00855           svc_dplx_lock_x(xprt, &amp;pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a45a5ae3cb189d60666f7cd4e5fc4f8c5">sigmask</a>);
<a name="l00856"></a>00856           <span class="keywordflow">if</span>(svc_sendreply2
<a name="l00857"></a>00857              (xprt, req, pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a9c8362f69383467f564f831889a917e3">pfuncdesc</a>-&gt;<a class="code" href="group__NFSprocs.html#ga12912f1556e435ca2f4a698dec035a72">xdr_encode_func</a>,
<a name="l00858"></a>00858               (caddr_t) &amp;res_nfs) == <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>)
<a name="l00859"></a>00859             {
<a name="l00860"></a>00860               <a class="code" href="log_8h.html#aa7aee8ec65b5baafb430f8d2a7588d53">LogDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l00861"></a>00861                        <span class="stringliteral">&quot;NFS DISPATCHER: FAILURE: Error while calling &quot;</span>
<a name="l00862"></a>00862                        <span class="stringliteral">&quot;svc_sendreply&quot;</span>);
<a name="l00863"></a>00863               svcerr_systemerr2(xprt, req);
<a name="l00864"></a>00864             }
<a name="l00865"></a>00865           svc_dplx_unlock_x(xprt, &amp;pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a45a5ae3cb189d60666f7cd4e5fc4f8c5">sigmask</a>);
<a name="l00866"></a>00866 
<a name="l00867"></a>00867           <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l00868"></a>00868                        <span class="stringliteral">&quot;After svc_sendreply on socket %d (dup req)&quot;</span>,
<a name="l00869"></a>00869                        xprt-&gt;xp_fd);
<a name="l00870"></a>00870           <span class="keywordflow">return</span>;
<a name="l00871"></a>00871         }
<a name="l00872"></a>00872       <span class="keywordflow">else</span>
<a name="l00873"></a>00873         {
<a name="l00874"></a>00874           <a class="code" href="test__findlog_8c.html#adfd9432c5478fa14c7d678edb301feed">LogCrit</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l00875"></a>00875                   <span class="stringliteral">&quot;Error: Duplicate request rejected because it was found &quot;</span>
<a name="l00876"></a>00876                   <span class="stringliteral">&quot;in the cache but is not allowed to be cached.&quot;</span>);
<a name="l00877"></a>00877           svc_dplx_lock_x(xprt, &amp;pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a45a5ae3cb189d60666f7cd4e5fc4f8c5">sigmask</a>);
<a name="l00878"></a>00878           svcerr_systemerr2(xprt, req);
<a name="l00879"></a>00879           svc_dplx_unlock_x(xprt, &amp;pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a45a5ae3cb189d60666f7cd4e5fc4f8c5">sigmask</a>);
<a name="l00880"></a>00880           <span class="keywordflow">return</span>;
<a name="l00881"></a>00881         }
<a name="l00882"></a>00882       <span class="keywordflow">break</span>;
<a name="l00883"></a>00883 
<a name="l00884"></a>00884       <span class="comment">/* Another thread owns the request */</span>
<a name="l00885"></a>00885     <span class="keywordflow">case</span> <a class="code" href="nfs__dupreq_8h.html#a8f699cea0366b683501fe91a4dbc37faa98fd422532ebdcd70e7682d3c0aa419c">DUPREQ_BEING_PROCESSED</a>:
<a name="l00886"></a>00886       <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l00887"></a>00887                    <span class="stringliteral">&quot;Dupreq xid=%u was asked for process since another thread &quot;</span>
<a name="l00888"></a>00888                    <span class="stringliteral">&quot;manage it, reject for avoiding threads starvation...&quot;</span>,
<a name="l00889"></a>00889                    req-&gt;rq_xid);
<a name="l00890"></a>00890       <span class="comment">/* Free the arguments */</span>
<a name="l00891"></a>00891       svc_dplx_lock_x(xprt, &amp;pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a45a5ae3cb189d60666f7cd4e5fc4f8c5">sigmask</a>);
<a name="l00892"></a>00892       <span class="keywordflow">if</span>((preqnfs-&gt;<a class="code" href="structnfs__request__data____.html#afddd6756b9d7c6c4e6ab81c7d79ac4a0">req</a>.rq_vers == 2) ||
<a name="l00893"></a>00893          (preqnfs-&gt;<a class="code" href="structnfs__request__data____.html#afddd6756b9d7c6c4e6ab81c7d79ac4a0">req</a>.rq_vers == 3) ||
<a name="l00894"></a>00894          (preqnfs-&gt;<a class="code" href="structnfs__request__data____.html#afddd6756b9d7c6c4e6ab81c7d79ac4a0">req</a>.rq_vers == 4)) 
<a name="l00895"></a>00895         <span class="keywordflow">if</span>(!SVC_FREEARGS(xprt, pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a9c8362f69383467f564f831889a917e3">pfuncdesc</a>-&gt;<a class="code" href="group__NFSprocs.html#gac1da0ffd4b07434230a44ef3a2ca558f">xdr_decode_func</a>,
<a name="l00896"></a>00896                          (caddr_t) parg_nfs))
<a name="l00897"></a>00897           {
<a name="l00898"></a>00898             <a class="code" href="test__findlog_8c.html#adfd9432c5478fa14c7d678edb301feed">LogCrit</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l00899"></a>00899                     <span class="stringliteral">&quot;NFS DISPATCHER: FAILURE: Bad SVC_FREEARGS for %s&quot;</span>,
<a name="l00900"></a>00900                     pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a9c8362f69383467f564f831889a917e3">pfuncdesc</a>-&gt;<a class="code" href="group__NFSprocs.html#gace56bc4b2e8e74de72034c85144cbb7d">funcname</a>);
<a name="l00901"></a>00901           }
<a name="l00902"></a>00902       svc_dplx_unlock_x(xprt, &amp;pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a45a5ae3cb189d60666f7cd4e5fc4f8c5">sigmask</a>);
<a name="l00903"></a>00903       <span class="comment">/* Ignore the request, send no error */</span>
<a name="l00904"></a>00904       <span class="keywordflow">return</span>;
<a name="l00905"></a>00905 
<a name="l00906"></a>00906       <span class="comment">/* something is very wrong with the duplicate request cache */</span>
<a name="l00907"></a>00907     <span class="keywordflow">case</span> <a class="code" href="nfs__dupreq_8h.html#a8f699cea0366b683501fe91a4dbc37faa5e1858a0b91c975314d7316be31c0bcd">DUPREQ_NOT_FOUND</a>:
<a name="l00908"></a>00908       <a class="code" href="test__findlog_8c.html#adfd9432c5478fa14c7d678edb301feed">LogCrit</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l00909"></a>00909               <span class="stringliteral">&quot;Did not find the request in the duplicate request cache and &quot;</span>
<a name="l00910"></a>00910               <span class="stringliteral">&quot;couldn&#39;t add the request.&quot;</span>);
<a name="l00911"></a>00911       svc_dplx_lock_x(xprt, &amp;pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a45a5ae3cb189d60666f7cd4e5fc4f8c5">sigmask</a>);
<a name="l00912"></a>00912       svcerr_systemerr2(xprt, req);
<a name="l00913"></a>00913       svc_dplx_unlock_x(xprt, &amp;pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a45a5ae3cb189d60666f7cd4e5fc4f8c5">sigmask</a>);
<a name="l00914"></a>00914       <span class="keywordflow">return</span>;
<a name="l00915"></a>00915 
<a name="l00916"></a>00916       <span class="comment">/* oom */</span>
<a name="l00917"></a>00917     <span class="keywordflow">case</span> <a class="code" href="nfs__dupreq_8h.html#a8f699cea0366b683501fe91a4dbc37faabf8d181a38bfc1ee1a745a9c8b7f5e6d">DUPREQ_INSERT_MALLOC_ERROR</a>:
<a name="l00918"></a>00918       <a class="code" href="test__findlog_8c.html#adfd9432c5478fa14c7d678edb301feed">LogCrit</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l00919"></a>00919               <span class="stringliteral">&quot;Cannot process request, not enough memory available!&quot;</span>);
<a name="l00920"></a>00920       svc_dplx_lock_x(xprt, &amp;pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a45a5ae3cb189d60666f7cd4e5fc4f8c5">sigmask</a>);
<a name="l00921"></a>00921       svcerr_systemerr2(xprt, req);
<a name="l00922"></a>00922       svc_dplx_unlock_x(xprt, &amp;pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a45a5ae3cb189d60666f7cd4e5fc4f8c5">sigmask</a>);
<a name="l00923"></a>00923       <span class="keywordflow">return</span>;
<a name="l00924"></a>00924 
<a name="l00925"></a>00925     <span class="keywordflow">default</span>:
<a name="l00926"></a>00926       <a class="code" href="test__findlog_8c.html#adfd9432c5478fa14c7d678edb301feed">LogCrit</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l00927"></a>00927               <span class="stringliteral">&quot;Unknown duplicate request cache status. This should never be &quot;</span>
<a name="l00928"></a>00928               <span class="stringliteral">&quot;reached!&quot;</span>);
<a name="l00929"></a>00929       svc_dplx_lock_x(xprt, &amp;pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a45a5ae3cb189d60666f7cd4e5fc4f8c5">sigmask</a>);
<a name="l00930"></a>00930       svcerr_systemerr2(xprt, req);
<a name="l00931"></a>00931       svc_dplx_unlock_x(xprt, &amp;pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a45a5ae3cb189d60666f7cd4e5fc4f8c5">sigmask</a>);
<a name="l00932"></a>00932       <span class="keywordflow">return</span>;
<a name="l00933"></a>00933     }
<a name="l00934"></a>00934 
<a name="l00935"></a>00935   <span class="comment">/* Get the export entry */</span>
<a name="l00936"></a>00936   <span class="keywordflow">if</span>(req-&gt;rq_prog == <a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#aeef2995e9b54747311db1972d158fd41">core_param</a>.<a class="code" href="structnfs__core__param____.html#aa04e466147819b7a92794e45e67ad2c9">program</a>[<a class="code" href="nfs__core_8h.html#a7f6e26c17a511d03a3e095f595a02907a69c56a6ce312422c90b25f97a43d4dc2">P_NFS</a>])
<a name="l00937"></a>00937     {
<a name="l00938"></a>00938       <span class="comment">/* The NFSv2 and NFSv3 functions&#39;arguments always begin with the file</span>
<a name="l00939"></a>00939 <span class="comment">       * handle (but not the NULL function).  This hook is used to get the</span>
<a name="l00940"></a>00940 <span class="comment">       * fhandle with the arguments and so determine the export entry to be</span>
<a name="l00941"></a>00941 <span class="comment">       * used.  In NFSv4, junction traversal is managed by the protocol itself</span>
<a name="l00942"></a>00942 <span class="comment">       * so the whole export list is provided to NFSv4 request. */</span>
<a name="l00943"></a>00943 
<a name="l00944"></a>00944       <span class="keywordflow">switch</span> (req-&gt;rq_vers)
<a name="l00945"></a>00945         {
<a name="l00946"></a>00946         <span class="keywordflow">case</span> <a class="code" href="nfs23_8h.html#ab7bf618affb552e91b562c195b52b6a7">NFS_V2</a>:
<a name="l00947"></a>00947           <span class="keywordflow">if</span>(req-&gt;rq_proc != <a class="code" href="nfs23_8h.html#a89801cea943f5ad4c708b2b7411bacda">NFSPROC_NULL</a>)
<a name="l00948"></a>00948             {
<a name="l00949"></a>00949               exportid = <a class="code" href="nfs__file__handle_8h.html#a4e15ee51a5126d013954cb8ddf34b62b">nfs2_FhandleToExportId</a>((<a class="code" href="nfs23_8h.html#a4122a54677d2f66ef8a8f564b6076db2">fhandle2</a> *) parg_nfs);
<a name="l00950"></a>00950 
<a name="l00951"></a>00951               <span class="keywordflow">if</span>(exportid &lt; 0 ||
<a name="l00952"></a>00952                  (pexport = <a class="code" href="nfs__exports_8h.html#a7ccd248588595588755f71322288a8df">nfs_Get_export_by_id</a>(<a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#ac8fc09bcd317cc133cd1f8b6b3478aa3">pexportlist</a>,
<a name="l00953"></a>00953                                                  exportid)) == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> ||
<a name="l00954"></a>00954                  (pexport-&gt;<a class="code" href="structexportlist____.html#a47d40937207a0fd8e67e191415ffef60">options</a> &amp; <a class="code" href="nfs__exports_8h.html#a0c1f241798a079101e61e8dff2344c3e">EXPORT_OPTION_NFSV2</a>) == 0)
<a name="l00955"></a>00955                 {
<a name="l00956"></a>00956                   <span class="comment">/* Reject the request for authentication reason (incompatible</span>
<a name="l00957"></a>00957 <span class="comment">                   * file handle) */</span>
<a name="l00958"></a>00958                   <span class="keywordflow">if</span>(<a class="code" href="log_8h.html#a3f69d7a1490bad51754c04781bff6f54">isInfo</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>))
<a name="l00959"></a>00959                     {
<a name="l00960"></a>00960                       <span class="keywordtype">char</span> dumpfh[1024];
<a name="l00961"></a>00961                       <span class="keywordtype">char</span> *reason;
<a name="l00962"></a>00962                       <span class="keywordtype">char</span> addrbuf[<a class="code" href="ganesha__rpc_8h.html#a9174d973fdbe2abdc1987d702b5b7d1a">SOCK_NAME_MAX</a>];
<a name="l00963"></a>00963                       <a class="code" href="ganesha__rpc_8h.html#a798e3040dc5734e965e36b405958f984">sprint_sockaddr</a>(&amp;hostaddr, addrbuf, <span class="keyword">sizeof</span>(addrbuf));
<a name="l00964"></a>00964                       <span class="keywordflow">if</span>(exportid &lt; 0)
<a name="l00965"></a>00965                         reason = <span class="stringliteral">&quot;has badly formed handle&quot;</span>;
<a name="l00966"></a>00966                       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(pexport == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00967"></a>00967                         reason = <span class="stringliteral">&quot;has invalid export&quot;</span>;
<a name="l00968"></a>00968                       <span class="keywordflow">else</span>
<a name="l00969"></a>00969                         reason = <span class="stringliteral">&quot;V2 not allowed on this export&quot;</span>;
<a name="l00970"></a>00970                       <a class="code" href="nfs__file__handle_8h.html#a3a9c85d9f52b8bbdc1102925bcb320c1">sprint_fhandle2</a>(dumpfh, (<a class="code" href="nfs23_8h.html#a4122a54677d2f66ef8a8f564b6076db2">fhandle2</a> *) parg_nfs);
<a name="l00971"></a>00971                       <a class="code" href="log_8h.html#a3cf3c22fac6bb9871e25007551caeb13">LogMajor</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l00972"></a>00972                                <span class="stringliteral">&quot;NFS2 Request from host %s %s, proc=%d, FH=%s&quot;</span>,
<a name="l00973"></a>00973                                addrbuf, reason,
<a name="l00974"></a>00974                                (<span class="keywordtype">int</span>)req-&gt;rq_proc, dumpfh);
<a name="l00975"></a>00975                     }
<a name="l00976"></a>00976                   <span class="comment">/* Bad argument */</span>
<a name="l00977"></a>00977                   svc_dplx_lock_x(xprt, &amp;pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a45a5ae3cb189d60666f7cd4e5fc4f8c5">sigmask</a>);
<a name="l00978"></a>00978                   svcerr_auth2(xprt, req, AUTH_FAILED);
<a name="l00979"></a>00979                   svc_dplx_unlock_x(xprt, &amp;pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a45a5ae3cb189d60666f7cd4e5fc4f8c5">sigmask</a>);
<a name="l00980"></a>00980                   <span class="keywordflow">if</span> (<a class="code" href="nfs__dupreq_8h.html#ad30cdf2e72a3a44f95f951cc1572198d">nfs_dupreq_delete</a>(req) != <a class="code" href="nfs__dupreq_8h.html#a8f699cea0366b683501fe91a4dbc37faa081a1934d0972db9961d46f25d264ff9">DUPREQ_SUCCESS</a>)
<a name="l00981"></a>00981                     {
<a name="l00982"></a>00982                       <a class="code" href="test__findlog_8c.html#adfd9432c5478fa14c7d678edb301feed">LogCrit</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l00983"></a>00983                               <span class="stringliteral">&quot;Attempt to delete duplicate request failed on &quot;</span>
<a name="l00984"></a>00984                               <span class="stringliteral">&quot;line %d&quot;</span>, __LINE__);
<a name="l00985"></a>00985                     }
<a name="l00986"></a>00986                   <span class="keywordflow">return</span>;
<a name="l00987"></a>00987                 }
<a name="l00988"></a>00988 
<a name="l00989"></a>00989               <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l00990"></a>00990                            <span class="stringliteral">&quot;Found export entry for dirname=%s as exportid=%d&quot;</span>,
<a name="l00991"></a>00991                            pexport-&gt;<a class="code" href="structexportlist____.html#aed69da9ea94f07652e30b8393311c025">dirname</a>, pexport-&gt;<a class="code" href="structexportlist____.html#a6cdf6b3326db83e0af2976000c374b12">id</a>);
<a name="l00992"></a>00992             }
<a name="l00993"></a>00993           <span class="keywordflow">else</span>
<a name="l00994"></a>00994             pexport = <a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#ac8fc09bcd317cc133cd1f8b6b3478aa3">pexportlist</a>;
<a name="l00995"></a>00995 
<a name="l00996"></a>00996           <span class="keywordflow">break</span>;
<a name="l00997"></a>00997 
<a name="l00998"></a>00998         <span class="keywordflow">case</span> <a class="code" href="nfs23_8h.html#ad0f0a57c0aacb6093af91d085b807cbd">NFS_V3</a>:
<a name="l00999"></a>00999           <span class="keywordflow">if</span>(req-&gt;rq_proc != <a class="code" href="nfs23_8h.html#a89801cea943f5ad4c708b2b7411bacda">NFSPROC_NULL</a>)
<a name="l01000"></a>01000             {
<a name="l01001"></a>01001               exportid = <a class="code" href="nfs__file__handle_8h.html#a8453425f543449aa0b989e06731395f3">nfs3_FhandleToExportId</a>((<a class="code" href="structnfs__fh3.html">nfs_fh3</a> *) parg_nfs);
<a name="l01002"></a>01002 
<a name="l01003"></a>01003               <span class="keywordflow">if</span>(exportid &lt; 0 ||
<a name="l01004"></a>01004                  (pexport = <a class="code" href="nfs__exports_8h.html#a7ccd248588595588755f71322288a8df">nfs_Get_export_by_id</a>(<a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#ac8fc09bcd317cc133cd1f8b6b3478aa3">pexportlist</a>,
<a name="l01005"></a>01005                                                  exportid)) == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> ||
<a name="l01006"></a>01006                  (pexport-&gt;<a class="code" href="structexportlist____.html#a47d40937207a0fd8e67e191415ffef60">options</a> &amp; <a class="code" href="nfs__exports_8h.html#a8eb509796037d78741ada0471bd6625d">EXPORT_OPTION_NFSV3</a>) == 0)
<a name="l01007"></a>01007                 {
<a name="l01008"></a>01008                   <span class="comment">/* Reject the request for authentication reason (incompatible</span>
<a name="l01009"></a>01009 <span class="comment">                   * file handle) */</span>
<a name="l01010"></a>01010                   <span class="keywordflow">if</span>(<a class="code" href="log_8h.html#a3f69d7a1490bad51754c04781bff6f54">isInfo</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>))
<a name="l01011"></a>01011                     {
<a name="l01012"></a>01012                       <span class="keywordtype">char</span> dumpfh[1024];
<a name="l01013"></a>01013                       <span class="keywordtype">char</span> *reason;
<a name="l01014"></a>01014                       <span class="keywordtype">char</span> addrbuf[<a class="code" href="ganesha__rpc_8h.html#a9174d973fdbe2abdc1987d702b5b7d1a">SOCK_NAME_MAX</a>];
<a name="l01015"></a>01015                       <a class="code" href="ganesha__rpc_8h.html#a798e3040dc5734e965e36b405958f984">sprint_sockaddr</a>(&amp;hostaddr, addrbuf, <span class="keyword">sizeof</span>(addrbuf));
<a name="l01016"></a>01016                       <span class="keywordflow">if</span>(exportid &lt; 0)
<a name="l01017"></a>01017                         reason = <span class="stringliteral">&quot;has badly formed handle&quot;</span>;
<a name="l01018"></a>01018                       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(pexport == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01019"></a>01019                         reason = <span class="stringliteral">&quot;has invalid export&quot;</span>;
<a name="l01020"></a>01020                       <span class="keywordflow">else</span>
<a name="l01021"></a>01021                         reason = <span class="stringliteral">&quot;V3 not allowed on this export&quot;</span>;
<a name="l01022"></a>01022                       <a class="code" href="nfs__file__handle_8h.html#aacf77e57e01373c6e5bc261be964bb6e">sprint_fhandle3</a>(dumpfh, (<a class="code" href="structnfs__fh3.html">nfs_fh3</a> *) parg_nfs);
<a name="l01023"></a>01023                       <a class="code" href="log_8h.html#a3cf3c22fac6bb9871e25007551caeb13">LogMajor</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l01024"></a>01024                                <span class="stringliteral">&quot;NFS3 Request from host %s %s, proc=%d, FH=%s&quot;</span>,
<a name="l01025"></a>01025                                addrbuf, reason,
<a name="l01026"></a>01026                                (<span class="keywordtype">int</span>)req-&gt;rq_proc, dumpfh);
<a name="l01027"></a>01027                     }
<a name="l01028"></a>01028                   <span class="comment">/* Bad argument */</span>
<a name="l01029"></a>01029                   svc_dplx_lock_x(xprt, &amp;pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a45a5ae3cb189d60666f7cd4e5fc4f8c5">sigmask</a>);
<a name="l01030"></a>01030                   svcerr_auth2(xprt, req, AUTH_FAILED);
<a name="l01031"></a>01031                   svc_dplx_unlock_x(xprt, &amp;pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a45a5ae3cb189d60666f7cd4e5fc4f8c5">sigmask</a>);
<a name="l01032"></a>01032                   <span class="keywordflow">if</span> (<a class="code" href="nfs__dupreq_8h.html#ad30cdf2e72a3a44f95f951cc1572198d">nfs_dupreq_delete</a>(req) != <a class="code" href="nfs__dupreq_8h.html#a8f699cea0366b683501fe91a4dbc37faa081a1934d0972db9961d46f25d264ff9">DUPREQ_SUCCESS</a>)
<a name="l01033"></a>01033                     {
<a name="l01034"></a>01034                       <a class="code" href="test__findlog_8c.html#adfd9432c5478fa14c7d678edb301feed">LogCrit</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l01035"></a>01035                               <span class="stringliteral">&quot;Attempt to delete duplicate request failed on &quot;</span>
<a name="l01036"></a>01036                               <span class="stringliteral">&quot;line %d&quot;</span>, __LINE__);
<a name="l01037"></a>01037                     }
<a name="l01038"></a>01038                   <span class="keywordflow">return</span>;
<a name="l01039"></a>01039                 }
<a name="l01040"></a>01040 
<a name="l01041"></a>01041               <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l01042"></a>01042                            <span class="stringliteral">&quot;Found export entry for dirname=%s as exportid=%d&quot;</span>,
<a name="l01043"></a>01043                            pexport-&gt;<a class="code" href="structexportlist____.html#aed69da9ea94f07652e30b8393311c025">dirname</a>, pexport-&gt;<a class="code" href="structexportlist____.html#a6cdf6b3326db83e0af2976000c374b12">id</a>);
<a name="l01044"></a>01044             }
<a name="l01045"></a>01045           <span class="keywordflow">else</span>
<a name="l01046"></a>01046             pexport = <a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#ac8fc09bcd317cc133cd1f8b6b3478aa3">pexportlist</a>;
<a name="l01047"></a>01047 
<a name="l01048"></a>01048           <span class="keywordflow">break</span>;
<a name="l01049"></a>01049 
<a name="l01050"></a>01050         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a38cfe5720671dbafe5d1b278f6fe9dec">NFS_V4</a>:
<a name="l01051"></a>01051           <span class="comment">/* NFSv4 requires entire export list */</span>
<a name="l01052"></a>01052           pexport = <a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#ac8fc09bcd317cc133cd1f8b6b3478aa3">pexportlist</a>;
<a name="l01053"></a>01053           <span class="keywordflow">break</span>;
<a name="l01054"></a>01054 
<a name="l01055"></a>01055         <span class="keywordflow">default</span>:
<a name="l01056"></a>01056           <span class="comment">/* NFSv4 or invalid version (which should never get here) */</span>
<a name="l01057"></a>01057           pexport = <a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#ac8fc09bcd317cc133cd1f8b6b3478aa3">pexportlist</a>;
<a name="l01058"></a>01058           <span class="keywordflow">break</span>;
<a name="l01059"></a>01059         }                       <span class="comment">/* switch( ptr_req-&gt;rq_vers ) */</span>
<a name="l01060"></a>01060     }
<a name="l01061"></a>01061 <span class="preprocessor">#ifdef _USE_NLM</span>
<a name="l01062"></a>01062 <span class="preprocessor"></span>  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(req-&gt;rq_prog == <a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#aeef2995e9b54747311db1972d158fd41">core_param</a>.<a class="code" href="structnfs__core__param____.html#aa04e466147819b7a92794e45e67ad2c9">program</a>[P_NLM])
<a name="l01063"></a>01063     {
<a name="l01064"></a>01064       netobj *pfh3 = <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01065"></a>01065 
<a name="l01066"></a>01066       <span class="keywordflow">switch</span>(req-&gt;rq_proc)
<a name="l01067"></a>01067         {
<a name="l01068"></a>01068           <span class="keywordflow">case</span> <a class="code" href="nlm4_8h.html#ace2657a3d6a54eb4d4f3c19cc5d45d77">NLMPROC4_NULL</a>:
<a name="l01069"></a>01069           <span class="keywordflow">case</span> <a class="code" href="nlm4_8h.html#a61eeca147efca59e5d8e7f9a5217c666">NLMPROC4_TEST_RES</a>:
<a name="l01070"></a>01070           <span class="keywordflow">case</span> <a class="code" href="nlm4_8h.html#a33e0e2b3ba76da98b8a2e365918628f2">NLMPROC4_LOCK_RES</a>:
<a name="l01071"></a>01071           <span class="keywordflow">case</span> <a class="code" href="nlm4_8h.html#a0f4a33a13706484a12bf91ee18c0f697">NLMPROC4_CANCEL_RES</a>:
<a name="l01072"></a>01072           <span class="keywordflow">case</span> <a class="code" href="nlm4_8h.html#a98d8362f28bc4be795785290a884beb0">NLMPROC4_UNLOCK_RES</a>:
<a name="l01073"></a>01073           <span class="keywordflow">case</span> <a class="code" href="nlm4_8h.html#ac878bfcff7ab0119884eef9e7618eeaa">NLMPROC4_GRANTED_RES</a>:
<a name="l01074"></a>01074           <span class="keywordflow">case</span> <a class="code" href="nlm4_8h.html#aa1349a564f4673d68d85603bb3f34e91">NLMPROC4_SM_NOTIFY</a>:
<a name="l01075"></a>01075           <span class="keywordflow">case</span> <a class="code" href="nlm4_8h.html#a1d7c91777bc2a3a770046e9ab742ba61">NLMPROC4_FREE_ALL</a>:
<a name="l01076"></a>01076             <span class="keywordflow">break</span>;
<a name="l01077"></a>01077 
<a name="l01078"></a>01078           <span class="keywordflow">case</span> <a class="code" href="nlm4_8h.html#a3c888fffe0ae9b29993eab681f0e3292">NLMPROC4_TEST</a>:
<a name="l01079"></a>01079           <span class="keywordflow">case</span> <a class="code" href="nlm4_8h.html#a3ec07bc97ffe7e20807af5b085cb89c9">NLMPROC4_TEST_MSG</a>:
<a name="l01080"></a>01080           <span class="keywordflow">case</span> <a class="code" href="nlm4_8h.html#a33e0700068fada217480556b7390bd60">NLMPROC4_GRANTED</a>:
<a name="l01081"></a>01081           <span class="keywordflow">case</span> <a class="code" href="nlm4_8h.html#a5cefd0b5eef7266d5585343625d2f413">NLMPROC4_GRANTED_MSG</a>:
<a name="l01082"></a>01082             pfh3 = &amp;parg_nfs-&gt;<a class="code" href="group__NFSprocs.html#ga63a2e63b8b68e9b39a2b657e4dac9807">arg_nlm4_test</a>.<a class="code" href="structnlm4__testargs.html#a8d1641461217e030082238a54d97ad59">alock</a>.<a class="code" href="structnlm4__lock.html#a0c69f88dad1f9625f3b2c16676242548">fh</a>;
<a name="l01083"></a>01083             <span class="keywordflow">break</span>;
<a name="l01084"></a>01084 
<a name="l01085"></a>01085           <span class="keywordflow">case</span> <a class="code" href="nlm4_8h.html#a6d6926d26f7f035bf7204b2d2bbe2778">NLMPROC4_LOCK</a>:
<a name="l01086"></a>01086           <span class="keywordflow">case</span> <a class="code" href="nlm4_8h.html#ae5eafa766d4c34190a2c06a00cbebefd">NLMPROC4_LOCK_MSG</a>:
<a name="l01087"></a>01087           <span class="keywordflow">case</span> <a class="code" href="nlm4_8h.html#a1c97ec33276eaac8f61bfe9be3c4eea1">NLMPROC4_NM_LOCK</a>:
<a name="l01088"></a>01088             pfh3 = &amp;parg_nfs-&gt;<a class="code" href="group__NFSprocs.html#ga410929104c6148d68588ae7ae41a5db3">arg_nlm4_lock</a>.<a class="code" href="structnlm4__lockargs.html#aa4f48533bc660862447366072dfa0870">alock</a>.<a class="code" href="structnlm4__lock.html#a0c69f88dad1f9625f3b2c16676242548">fh</a>;
<a name="l01089"></a>01089             <span class="keywordflow">break</span>;
<a name="l01090"></a>01090 
<a name="l01091"></a>01091           <span class="keywordflow">case</span> <a class="code" href="nlm4_8h.html#a93b7efc2737e2c6c6a3c3eb9a4bfff4c">NLMPROC4_CANCEL</a>:
<a name="l01092"></a>01092           <span class="keywordflow">case</span> <a class="code" href="nlm4_8h.html#a897a0ebc7152e24282f1a9255c3b02f1">NLMPROC4_CANCEL_MSG</a>:
<a name="l01093"></a>01093             pfh3 = &amp;parg_nfs-&gt;<a class="code" href="group__NFSprocs.html#gac49774f60c0334d92fad359a000e1817">arg_nlm4_cancel</a>.<a class="code" href="structnlm4__cancargs.html#a4f980b2eacf82dccbcacbdd1532ac6ad">alock</a>.<a class="code" href="structnlm4__lock.html#a0c69f88dad1f9625f3b2c16676242548">fh</a>;
<a name="l01094"></a>01094             <span class="keywordflow">break</span>;
<a name="l01095"></a>01095 
<a name="l01096"></a>01096           <span class="keywordflow">case</span> <a class="code" href="nlm4_8h.html#a71b2cf4b9c17fd1c3f01ebf06913cc15">NLMPROC4_UNLOCK</a>:
<a name="l01097"></a>01097           <span class="keywordflow">case</span> <a class="code" href="nlm4_8h.html#a4bd8e4c7d8c4609855b8fa1ed4195efa">NLMPROC4_UNLOCK_MSG</a>:
<a name="l01098"></a>01098             pfh3 = &amp;parg_nfs-&gt;<a class="code" href="group__NFSprocs.html#ga9fd0f809c62427ad6c83a63c2daf1fa8">arg_nlm4_unlock</a>.<a class="code" href="structnlm4__unlockargs.html#a9690f0df18ac58e0314c5fda176e4cc6">alock</a>.<a class="code" href="structnlm4__lock.html#a0c69f88dad1f9625f3b2c16676242548">fh</a>;
<a name="l01099"></a>01099             <span class="keywordflow">break</span>;
<a name="l01100"></a>01100 
<a name="l01101"></a>01101           <span class="keywordflow">case</span> <a class="code" href="nlm4_8h.html#abb47fef1bfd08c707907a86ab410a2be">NLMPROC4_SHARE</a>:
<a name="l01102"></a>01102           <span class="keywordflow">case</span> <a class="code" href="nlm4_8h.html#ad810d25d548d502d8a2f62c6cdaeeb41">NLMPROC4_UNSHARE</a>:
<a name="l01103"></a>01103             pfh3 = &amp;parg_nfs-&gt;<a class="code" href="group__NFSprocs.html#ga0a13e498c3e585f8fe6b85ad95c4c4e4">arg_nlm4_share</a>.<a class="code" href="structnlm4__shareargs.html#a340d064336fe090e42bb8788a7af4941">share</a>.<a class="code" href="structnlm4__share.html#a9bf1f3835ba49b5242174ccff98d6abe">fh</a>;
<a name="l01104"></a>01104             <span class="keywordflow">break</span>;
<a name="l01105"></a>01105         }
<a name="l01106"></a>01106       <span class="keywordflow">if</span>(pfh3 != <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01107"></a>01107         {
<a name="l01108"></a>01108           exportid = nlm4_FhandleToExportId(pfh3);
<a name="l01109"></a>01109 
<a name="l01110"></a>01110           <span class="keywordflow">if</span>(exportid &lt; 0 ||
<a name="l01111"></a>01111              (pexport = <a class="code" href="nfs__exports_8h.html#a7ccd248588595588755f71322288a8df">nfs_Get_export_by_id</a>(<a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#ac8fc09bcd317cc133cd1f8b6b3478aa3">pexportlist</a>,
<a name="l01112"></a>01112                                              exportid)) == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> ||
<a name="l01113"></a>01113              (pexport-&gt;<a class="code" href="structexportlist____.html#a47d40937207a0fd8e67e191415ffef60">options</a> &amp; <a class="code" href="nfs__exports_8h.html#a8eb509796037d78741ada0471bd6625d">EXPORT_OPTION_NFSV3</a>) == 0)
<a name="l01114"></a>01114             {
<a name="l01115"></a>01115               <span class="comment">/* Reject the request for authentication reason (incompatible </span>
<a name="l01116"></a>01116 <span class="comment">               * file handle) */</span>
<a name="l01117"></a>01117               <span class="keywordflow">if</span>(<a class="code" href="log_8h.html#a3f69d7a1490bad51754c04781bff6f54">isInfo</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>))
<a name="l01118"></a>01118                 {
<a name="l01119"></a>01119                   <span class="keywordtype">char</span> dumpfh[1024];
<a name="l01120"></a>01120                   <span class="keywordtype">char</span> *reason;
<a name="l01121"></a>01121                   <span class="keywordtype">char</span> addrbuf[<a class="code" href="ganesha__rpc_8h.html#a9174d973fdbe2abdc1987d702b5b7d1a">SOCK_NAME_MAX</a>];
<a name="l01122"></a>01122                   <a class="code" href="ganesha__rpc_8h.html#a798e3040dc5734e965e36b405958f984">sprint_sockaddr</a>(&amp;hostaddr, addrbuf, <span class="keyword">sizeof</span>(addrbuf));
<a name="l01123"></a>01123                   <span class="keywordflow">if</span>(exportid &lt; 0)
<a name="l01124"></a>01124                     reason = <span class="stringliteral">&quot;has badly formed handle&quot;</span>;
<a name="l01125"></a>01125                   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(pexport == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01126"></a>01126                     reason = <span class="stringliteral">&quot;has invalid export&quot;</span>;
<a name="l01127"></a>01127                   <span class="keywordflow">else</span>
<a name="l01128"></a>01128                     reason = <span class="stringliteral">&quot;V3 not allowed on this export&quot;</span>;
<a name="l01129"></a>01129                   <a class="code" href="nfs__file__handle_8h.html#a51bd36d3e7fcc63f7f12569d7fd28901">sprint_fhandle_nlm</a>(dumpfh, pfh3);
<a name="l01130"></a>01130                   <a class="code" href="log_8h.html#a3cf3c22fac6bb9871e25007551caeb13">LogMajor</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l01131"></a>01131                            <span class="stringliteral">&quot;NLM4 Request from host %s %s, proc=%d, FH=%s&quot;</span>,
<a name="l01132"></a>01132                            addrbuf, reason,
<a name="l01133"></a>01133                            (<span class="keywordtype">int</span>)req-&gt;rq_proc, dumpfh);
<a name="l01134"></a>01134                 }
<a name="l01135"></a>01135               <span class="comment">/* Bad argument */</span>
<a name="l01136"></a>01136               svc_dplx_lock_x(xprt, &amp;pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a45a5ae3cb189d60666f7cd4e5fc4f8c5">sigmask</a>);
<a name="l01137"></a>01137               svcerr_auth2(xprt, req, AUTH_FAILED);
<a name="l01138"></a>01138               svc_dplx_unlock_x(xprt, &amp;pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a45a5ae3cb189d60666f7cd4e5fc4f8c5">sigmask</a>);
<a name="l01139"></a>01139               <span class="keywordflow">if</span> (<a class="code" href="nfs__dupreq_8h.html#ad30cdf2e72a3a44f95f951cc1572198d">nfs_dupreq_delete</a>(req) != <a class="code" href="nfs__dupreq_8h.html#a8f699cea0366b683501fe91a4dbc37faa081a1934d0972db9961d46f25d264ff9">DUPREQ_SUCCESS</a>)
<a name="l01140"></a>01140                 {
<a name="l01141"></a>01141                   <a class="code" href="test__findlog_8c.html#adfd9432c5478fa14c7d678edb301feed">LogCrit</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l01142"></a>01142                           <span class="stringliteral">&quot;Attempt to delete duplicate request failed on line &quot;</span>
<a name="l01143"></a>01143                           <span class="stringliteral">&quot;%d&quot;</span>, __LINE__);
<a name="l01144"></a>01144                 }
<a name="l01145"></a>01145               <span class="keywordflow">return</span>;
<a name="l01146"></a>01146             }
<a name="l01147"></a>01147 
<a name="l01148"></a>01148           <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l01149"></a>01149                        <span class="stringliteral">&quot;Found export entry for dirname=%s as exportid=%d&quot;</span>,
<a name="l01150"></a>01150                        pexport-&gt;<a class="code" href="structexportlist____.html#aed69da9ea94f07652e30b8393311c025">dirname</a>, pexport-&gt;<a class="code" href="structexportlist____.html#a6cdf6b3326db83e0af2976000c374b12">id</a>);
<a name="l01151"></a>01151         }
<a name="l01152"></a>01152       <span class="keywordflow">else</span>
<a name="l01153"></a>01153         pexport = <a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#ac8fc09bcd317cc133cd1f8b6b3478aa3">pexportlist</a>;
<a name="l01154"></a>01154     }
<a name="l01155"></a>01155 <span class="preprocessor">#endif                          </span><span class="comment">/* _USE_NLM */</span>
<a name="l01156"></a>01156   <span class="keywordflow">else</span>
<a name="l01157"></a>01157     {
<a name="l01158"></a>01158       <span class="comment">/* All other protocols use the whole export list */</span>
<a name="l01159"></a>01159       pexport = <a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#ac8fc09bcd317cc133cd1f8b6b3478aa3">pexportlist</a>;
<a name="l01160"></a>01160     }
<a name="l01161"></a>01161 
<a name="l01162"></a>01162   <span class="keywordflow">if</span>(pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a9c8362f69383467f564f831889a917e3">pfuncdesc</a>-&gt;<a class="code" href="group__NFSprocs.html#gaf72ed67e54f4f570bdc423fbf18f628b">dispatch_behaviour</a> &amp; <a class="code" href="nfs__proto__functions_8h.html#acf7123a6f73347a399778fd902194a69">SUPPORTS_GSS</a>)
<a name="l01163"></a>01163     {
<a name="l01164"></a>01164       <span class="comment">/* Test if export allows the authentication provided */</span>
<a name="l01165"></a>01165       <span class="keywordflow">if</span> (<a class="code" href="nfs__exports_8h.html#a33c17d2bbbda93508c94f8833487a984">nfs_export_check_security</a>(req, pexport) == <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>)
<a name="l01166"></a>01166         {
<a name="l01167"></a>01167           svc_dplx_lock_x(xprt, &amp;pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a45a5ae3cb189d60666f7cd4e5fc4f8c5">sigmask</a>);
<a name="l01168"></a>01168           svcerr_auth2(xprt, req, AUTH_TOOWEAK);
<a name="l01169"></a>01169           svc_dplx_unlock_x(xprt, &amp;pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a45a5ae3cb189d60666f7cd4e5fc4f8c5">sigmask</a>);
<a name="l01170"></a>01170           <span class="keywordflow">if</span> (<a class="code" href="nfs__dupreq_8h.html#ad30cdf2e72a3a44f95f951cc1572198d">nfs_dupreq_delete</a>(req) != <a class="code" href="nfs__dupreq_8h.html#a8f699cea0366b683501fe91a4dbc37faa081a1934d0972db9961d46f25d264ff9">DUPREQ_SUCCESS</a>)
<a name="l01171"></a>01171             {
<a name="l01172"></a>01172               <a class="code" href="test__findlog_8c.html#adfd9432c5478fa14c7d678edb301feed">LogCrit</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l01173"></a>01173                       <span class="stringliteral">&quot;Attempt to delete duplicate request failed on &quot;</span>
<a name="l01174"></a>01174                       <span class="stringliteral">&quot;line %d&quot;</span>, __LINE__);
<a name="l01175"></a>01175             }
<a name="l01176"></a>01176           <span class="keywordflow">return</span>;
<a name="l01177"></a>01177         }
<a name="l01178"></a>01178     }
<a name="l01179"></a>01179 
<a name="l01180"></a>01180   <span class="comment">/* Zero out timers prior to starting processing */</span>
<a name="l01181"></a>01181   memset(&amp;timer_end, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> timeval));
<a name="l01182"></a>01182   memset(&amp;timer_diff, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> timeval));
<a name="l01183"></a>01183   memset(&amp;queue_timer_diff, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> timeval));
<a name="l01184"></a>01184 
<a name="l01185"></a>01185   <span class="comment">/*</span>
<a name="l01186"></a>01186 <span class="comment">   * It is now time for checking if export list allows the machine to perform</span>
<a name="l01187"></a>01187 <span class="comment">   * the request</span>
<a name="l01188"></a>01188 <span class="comment">   */</span>
<a name="l01189"></a>01189   pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a16e9ef80c974f00aaf012525e7213fd4">hostaddr</a> = hostaddr;
<a name="l01190"></a>01190 
<a name="l01191"></a>01191   <span class="comment">/* Check if client is using a privileged port, but only for NFS protocol */</span>
<a name="l01192"></a>01192   <span class="keywordflow">if</span> ((req-&gt;rq_prog == <a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#aeef2995e9b54747311db1972d158fd41">core_param</a>.<a class="code" href="structnfs__core__param____.html#aa04e466147819b7a92794e45e67ad2c9">program</a>[<a class="code" href="nfs__core_8h.html#a7f6e26c17a511d03a3e095f595a02907a69c56a6ce312422c90b25f97a43d4dc2">P_NFS</a>]) &amp;&amp;
<a name="l01193"></a>01193       (req-&gt;rq_proc != 0))
<a name="l01194"></a>01194     {
<a name="l01195"></a>01195       <span class="keywordflow">if</span> ((pexport-&gt;<a class="code" href="structexportlist____.html#a47d40937207a0fd8e67e191415ffef60">options</a> &amp; <a class="code" href="nfs__exports_8h.html#a3cbf9f0292fabca446f6b3fedd4bb82c">EXPORT_OPTION_PRIVILEGED_PORT</a>) &amp;&amp;
<a name="l01196"></a>01196          (port &gt;= IPPORT_RESERVED))
<a name="l01197"></a>01197         {
<a name="l01198"></a>01198           <a class="code" href="log_8h.html#a12ce2d8580101872ee848b50b59252ae">LogInfo</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l01199"></a>01199                   <span class="stringliteral">&quot;Port %d is too high for this export entry, rejecting client&quot;</span>,
<a name="l01200"></a>01200                   port);
<a name="l01201"></a>01201           svc_dplx_lock_x(xprt, &amp;pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a45a5ae3cb189d60666f7cd4e5fc4f8c5">sigmask</a>);
<a name="l01202"></a>01202           svcerr_auth2(xprt, req, AUTH_TOOWEAK);
<a name="l01203"></a>01203           svc_dplx_unlock_x(xprt, &amp;pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a45a5ae3cb189d60666f7cd4e5fc4f8c5">sigmask</a>);
<a name="l01204"></a>01204           <span class="comment">/* XXX */</span>
<a name="l01205"></a>01205           pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#aec2328cd9338f733ac04fdca7100ab1b">current_xid</a> = 0;    <span class="comment">/* No more xid managed */</span>
<a name="l01206"></a>01206 
<a name="l01207"></a>01207           <span class="keywordflow">if</span> (<a class="code" href="nfs__dupreq_8h.html#ad30cdf2e72a3a44f95f951cc1572198d">nfs_dupreq_delete</a>(req) != <a class="code" href="nfs__dupreq_8h.html#a8f699cea0366b683501fe91a4dbc37faa081a1934d0972db9961d46f25d264ff9">DUPREQ_SUCCESS</a>)
<a name="l01208"></a>01208             {
<a name="l01209"></a>01209               <a class="code" href="test__findlog_8c.html#adfd9432c5478fa14c7d678edb301feed">LogCrit</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l01210"></a>01210                       <span class="stringliteral">&quot;Attempt to delete duplicate request failed on line %d&quot;</span>,
<a name="l01211"></a>01211                       __LINE__);
<a name="l01212"></a>01212             }
<a name="l01213"></a>01213           <span class="keywordflow">return</span>;
<a name="l01214"></a>01214         }
<a name="l01215"></a>01215     }
<a name="l01216"></a>01216 
<a name="l01217"></a>01217   <span class="keywordflow">if</span> (pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a9c8362f69383467f564f831889a917e3">pfuncdesc</a>-&gt;<a class="code" href="group__NFSprocs.html#gaf72ed67e54f4f570bdc423fbf18f628b">dispatch_behaviour</a> &amp; <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a>)
<a name="l01218"></a>01218     {
<a name="l01219"></a>01219       <span class="keywordflow">if</span> (<a class="code" href="nfs__exports_8h.html#a847064b299d18b920879397a76394da7">get_req_uid_gid</a>(req, pexport, &amp;<a class="code" href="structuser__credentials.html">user_credentials</a>) == <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>)
<a name="l01220"></a>01220         {
<a name="l01221"></a>01221           <a class="code" href="log_8h.html#a12ce2d8580101872ee848b50b59252ae">LogInfo</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l01222"></a>01222                   <span class="stringliteral">&quot;could not get uid and gid, rejecting client&quot;</span>);
<a name="l01223"></a>01223           svc_dplx_lock_x(xprt, &amp;pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a45a5ae3cb189d60666f7cd4e5fc4f8c5">sigmask</a>);
<a name="l01224"></a>01224           svcerr_auth2(xprt, req, AUTH_TOOWEAK);
<a name="l01225"></a>01225           svc_dplx_unlock_x(xprt, &amp;pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a45a5ae3cb189d60666f7cd4e5fc4f8c5">sigmask</a>);
<a name="l01226"></a>01226           <span class="comment">/* XXX */</span>
<a name="l01227"></a>01227           pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#aec2328cd9338f733ac04fdca7100ab1b">current_xid</a> = 0;    <span class="comment">/* No more xid managed */</span>
<a name="l01228"></a>01228 
<a name="l01229"></a>01229           <span class="keywordflow">if</span> (<a class="code" href="nfs__dupreq_8h.html#ad30cdf2e72a3a44f95f951cc1572198d">nfs_dupreq_delete</a>(req) != <a class="code" href="nfs__dupreq_8h.html#a8f699cea0366b683501fe91a4dbc37faa081a1934d0972db9961d46f25d264ff9">DUPREQ_SUCCESS</a>)
<a name="l01230"></a>01230             {
<a name="l01231"></a>01231               <a class="code" href="test__findlog_8c.html#adfd9432c5478fa14c7d678edb301feed">LogCrit</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l01232"></a>01232                       <span class="stringliteral">&quot;Attempt to delete duplicate request failed on line %d&quot;</span>,
<a name="l01233"></a>01233                       __LINE__);
<a name="l01234"></a>01234             }
<a name="l01235"></a>01235           <span class="keywordflow">return</span>;
<a name="l01236"></a>01236         }
<a name="l01237"></a>01237     }
<a name="l01238"></a>01238 
<a name="l01239"></a>01239   <span class="comment">/* Be careful (Issue #66) : it makes no sense to check access for</span>
<a name="l01240"></a>01240 <span class="comment">   * a MOUNT request */</span>
<a name="l01241"></a>01241   <span class="keywordflow">if</span>(req-&gt;rq_prog != <a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#aeef2995e9b54747311db1972d158fd41">core_param</a>.<a class="code" href="structnfs__core__param____.html#aa04e466147819b7a92794e45e67ad2c9">program</a>[<a class="code" href="nfs__core_8h.html#a7f6e26c17a511d03a3e095f595a02907a9c790ab4adce0dd1d4dde907f1211eb4">P_MNT</a>])
<a name="l01242"></a>01242    {
<a name="l01243"></a>01243      <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l01244"></a>01244                   <span class="stringliteral">&quot;nfs_rpc_execute about to call nfs_export_check_access&quot;</span>);
<a name="l01245"></a>01245      export_check_result = <a class="code" href="nfs__exports_8h.html#a8dde757a47cad9c8396d6593096f714c">nfs_export_check_access</a>(&amp;pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a16e9ef80c974f00aaf012525e7213fd4">hostaddr</a>,
<a name="l01246"></a>01246                                                    req,
<a name="l01247"></a>01247                                                    pexport,
<a name="l01248"></a>01248                                                    <a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#aeef2995e9b54747311db1972d158fd41">core_param</a>.<a class="code" href="structnfs__core__param____.html#aa04e466147819b7a92794e45e67ad2c9">program</a>[<a class="code" href="nfs__core_8h.html#a7f6e26c17a511d03a3e095f595a02907a69c56a6ce312422c90b25f97a43d4dc2">P_NFS</a>],
<a name="l01249"></a>01249                                                    <a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#aeef2995e9b54747311db1972d158fd41">core_param</a>.<a class="code" href="structnfs__core__param____.html#aa04e466147819b7a92794e45e67ad2c9">program</a>[<a class="code" href="nfs__core_8h.html#a7f6e26c17a511d03a3e095f595a02907a9c790ab4adce0dd1d4dde907f1211eb4">P_MNT</a>],
<a name="l01250"></a>01250                                                    pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a9aeb8c9c91b24d8a777c7aade7ea8f93">ht_ip_stats</a>,
<a name="l01251"></a>01251                                                    ip_stats_pool,
<a name="l01252"></a>01252                                                    &amp;related_client,
<a name="l01253"></a>01253                                                    &amp;<a class="code" href="structuser__credentials.html">user_credentials</a>,
<a name="l01254"></a>01254                                                    (pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a9c8362f69383467f564f831889a917e3">pfuncdesc</a>-&gt;<a class="code" href="group__NFSprocs.html#gaf72ed67e54f4f570bdc423fbf18f628b">dispatch_behaviour</a> &amp; <a class="code" href="nfs__proto__functions_8h.html#a89fef22a3485d2b65f75121673d978b0">MAKES_WRITE</a>) == <a class="code" href="nfs__proto__functions_8h.html#a89fef22a3485d2b65f75121673d978b0">MAKES_WRITE</a>);
<a name="l01255"></a>01255    }
<a name="l01256"></a>01256   <span class="keywordflow">else</span>
<a name="l01257"></a>01257    {
<a name="l01258"></a>01258       <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l01259"></a>01259                    <span class="stringliteral">&quot;Call to a function from the MOUNT protocol, no call to nfs_export_check_access() required&quot;</span> ) ;
<a name="l01260"></a>01260       export_check_result = <a class="code" href="nfs__exports_8h.html#aedc8a2a9a6c318cd94597322e7cf9eb9">EXPORT_PERMISSION_GRANTED</a> ;
<a name="l01261"></a>01261    }
<a name="l01262"></a>01262 
<a name="l01263"></a>01263   <span class="keywordflow">if</span> (export_check_result == <a class="code" href="nfs__exports_8h.html#a2a1bdc919612171f29d4fb2827663615">EXPORT_PERMISSION_DENIED</a>)
<a name="l01264"></a>01264     {
<a name="l01265"></a>01265       <span class="keywordtype">char</span> addrbuf[<a class="code" href="ganesha__rpc_8h.html#a9174d973fdbe2abdc1987d702b5b7d1a">SOCK_NAME_MAX</a>];
<a name="l01266"></a>01266       <a class="code" href="ganesha__rpc_8h.html#a798e3040dc5734e965e36b405958f984">sprint_sockaddr</a>(&amp;hostaddr, addrbuf, <span class="keyword">sizeof</span>(addrbuf));
<a name="l01267"></a>01267       <a class="code" href="log_8h.html#a12ce2d8580101872ee848b50b59252ae">LogInfo</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l01268"></a>01268               <span class="stringliteral">&quot;Host %s is not allowed to access this export entry, vers=%d, proc=%d&quot;</span>,
<a name="l01269"></a>01269               addrbuf,
<a name="l01270"></a>01270               (<span class="keywordtype">int</span>)req-&gt;rq_vers, (<span class="keywordtype">int</span>)req-&gt;rq_proc);
<a name="l01271"></a>01271       svc_dplx_lock_x(xprt, &amp;pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a45a5ae3cb189d60666f7cd4e5fc4f8c5">sigmask</a>);
<a name="l01272"></a>01272       svcerr_auth2(xprt, req, AUTH_TOOWEAK);
<a name="l01273"></a>01273       svc_dplx_unlock_x(xprt, &amp;pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a45a5ae3cb189d60666f7cd4e5fc4f8c5">sigmask</a>);
<a name="l01274"></a>01274       <span class="comment">/* XXX */</span>
<a name="l01275"></a>01275       pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#aec2328cd9338f733ac04fdca7100ab1b">current_xid</a> = 0;        <span class="comment">/* No more xid managed */</span>
<a name="l01276"></a>01276 
<a name="l01277"></a>01277       <span class="keywordflow">if</span> (<a class="code" href="nfs__dupreq_8h.html#ad30cdf2e72a3a44f95f951cc1572198d">nfs_dupreq_delete</a>(req) != <a class="code" href="nfs__dupreq_8h.html#a8f699cea0366b683501fe91a4dbc37faa081a1934d0972db9961d46f25d264ff9">DUPREQ_SUCCESS</a>)
<a name="l01278"></a>01278         {
<a name="l01279"></a>01279           <a class="code" href="test__findlog_8c.html#adfd9432c5478fa14c7d678edb301feed">LogCrit</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l01280"></a>01280                   <span class="stringliteral">&quot;Attempt to delete duplicate request failed on line %d&quot;</span>,
<a name="l01281"></a>01281                   __LINE__);
<a name="l01282"></a>01282         }
<a name="l01283"></a>01283       <span class="keywordflow">return</span>;
<a name="l01284"></a>01284     }
<a name="l01285"></a>01285   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((export_check_result == <a class="code" href="nfs__exports_8h.html#a0a58e2be77e5a42d23f9e2e6d531a170">EXPORT_WRITE_ATTEMPT_WHEN_RO</a>) ||
<a name="l01286"></a>01286            (export_check_result == <a class="code" href="nfs__exports_8h.html#aa9b3fa3a818b215089772138163693f9">EXPORT_WRITE_ATTEMPT_WHEN_MDONLY_RO</a>))
<a name="l01287"></a>01287     {
<a name="l01288"></a>01288       <a class="code" href="log_8h.html#aa7aee8ec65b5baafb430f8d2a7588d53">LogDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l01289"></a>01289                <span class="stringliteral">&quot;Dropping request because nfs_export_check_access() reported this is a RO filesystem.&quot;</span>);
<a name="l01290"></a>01290       <span class="keywordflow">if</span>(req-&gt;rq_prog == <a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#aeef2995e9b54747311db1972d158fd41">core_param</a>.<a class="code" href="structnfs__core__param____.html#aa04e466147819b7a92794e45e67ad2c9">program</a>[<a class="code" href="nfs__core_8h.html#a7f6e26c17a511d03a3e095f595a02907a69c56a6ce312422c90b25f97a43d4dc2">P_NFS</a>])
<a name="l01291"></a>01291         {
<a name="l01292"></a>01292           <span class="keywordflow">if</span>(req-&gt;rq_vers == <a class="code" href="nfs23_8h.html#ab7bf618affb552e91b562c195b52b6a7">NFS_V2</a>)
<a name="l01293"></a>01293             {
<a name="l01294"></a>01294               <span class="comment">/* All the nfs_res structure in V2 have the status at the same place (because it is an union) */</span>
<a name="l01295"></a>01295               res_nfs.<a class="code" href="unionnfs__res____.html#a26c11b17fbdd6c57c13117fed08e2f74">res_attr2</a>.<a class="code" href="structATTR2res.html#a24383705e32232f48d228aaf36dfd867">status</a> = <a class="code" href="nfs23_8h.html#a7aa4ec59cb08c181dab1f366d0c06778a3b87fc50304674e7fdffcbd270146320">NFSERR_ROFS</a>;
<a name="l01296"></a>01296               rc = <a class="code" href="group__NFSprocs.html#ga2c5937c697db19bb296a6393191d5600">NFS_REQ_OK</a>;  <span class="comment">/* Processing of the request is done */</span>
<a name="l01297"></a>01297             }
<a name="l01298"></a>01298           <span class="keywordflow">else</span>
<a name="l01299"></a>01299             {
<a name="l01300"></a>01300               <span class="comment">/* V3 request */</span>
<a name="l01301"></a>01301               <span class="comment">/* All the nfs_res structure in V2 have the status at the same place, and so does V3 ones */</span>
<a name="l01302"></a>01302               res_nfs.<a class="code" href="unionnfs__res____.html#a26c11b17fbdd6c57c13117fed08e2f74">res_attr2</a>.<a class="code" href="structATTR2res.html#a24383705e32232f48d228aaf36dfd867">status</a> = (<a class="code" href="nfs23_8h.html#a7aa4ec59cb08c181dab1f366d0c06778">nfsstat2</a>) <a class="code" href="nfs23_8h.html#a1721ade9b8e43c719c5834eaaf60aac5a837a40b3f0a3c9cdc098895c9ab27615">NFS3ERR_ROFS</a>;
<a name="l01303"></a>01303               rc = <a class="code" href="group__NFSprocs.html#ga2c5937c697db19bb296a6393191d5600">NFS_REQ_OK</a>;  <span class="comment">/* Processing of the request is done */</span>
<a name="l01304"></a>01304             }
<a name="l01305"></a>01305         }
<a name="l01306"></a>01306       <span class="keywordflow">else</span>                      <span class="comment">/* unexpected protocol (mount doesn&#39;t make write) */</span>
<a name="l01307"></a>01307         rc = <a class="code" href="group__NFSprocs.html#gad48913a4e6ea3bdaca974a4c4fccd6c2">NFS_REQ_DROP</a>;
<a name="l01308"></a>01308     }
<a name="l01309"></a>01309   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((export_check_result != <a class="code" href="nfs__exports_8h.html#aedc8a2a9a6c318cd94597322e7cf9eb9">EXPORT_PERMISSION_GRANTED</a>) &amp;&amp;
<a name="l01310"></a>01310            (export_check_result != <a class="code" href="nfs__exports_8h.html#a1728851dac5fda24ca124e4ad0f31d04">EXPORT_MDONLY_GRANTED</a>))
<a name="l01311"></a>01311     {
<a name="l01312"></a>01312       <span class="comment">/* If not EXPORT_PERMISSION_GRANTED, then we are all out of options! */</span>
<a name="l01313"></a>01313       <a class="code" href="log_8h.html#a3cf3c22fac6bb9871e25007551caeb13">LogMajor</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l01314"></a>01314                <span class="stringliteral">&quot;nfs_export_check_access() returned none of the expected flags. This is an unexpected state!&quot;</span>);
<a name="l01315"></a>01315       rc = <a class="code" href="group__NFSprocs.html#gad48913a4e6ea3bdaca974a4c4fccd6c2">NFS_REQ_DROP</a>;
<a name="l01316"></a>01316     }
<a name="l01317"></a>01317   <span class="keywordflow">else</span>  <span class="comment">/* export_check_result == EXPORT_PERMISSION_GRANTED is TRUE */</span>
<a name="l01318"></a>01318     {
<a name="l01319"></a>01319       <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l01320"></a>01320                    <span class="stringliteral">&quot;nfs_export_check_access() reported PERMISSION GRANTED.&quot;</span>);
<a name="l01321"></a>01321 
<a name="l01322"></a>01322       <span class="comment">/* Do the authentication stuff, if needed */</span>
<a name="l01323"></a>01323       <span class="keywordflow">if</span>(pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a9c8362f69383467f564f831889a917e3">pfuncdesc</a>-&gt;<a class="code" href="group__NFSprocs.html#gaf72ed67e54f4f570bdc423fbf18f628b">dispatch_behaviour</a> &amp; <a class="code" href="nfs__proto__functions_8h.html#a65e532e5259344e7602457b7cc49c6ed">NEEDS_CRED</a>)
<a name="l01324"></a>01324         {
<a name="l01325"></a>01325           <span class="comment">/* Swap the anonymous uid/gid if the user should be anonymous */</span>
<a name="l01326"></a>01326           <span class="keywordflow">if</span>(<a class="code" href="nfs__exports_8h.html#ab567937cabef9dc08628909b09662dc8">nfs_check_anon</a>(&amp;related_client, pexport, &amp;<a class="code" href="structuser__credentials.html">user_credentials</a>) == <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>
<a name="l01327"></a>01327              || <a class="code" href="nfs__exports_8h.html#a2c7d1b3908d57b8cd77f54574929c791">nfs_build_fsal_context</a>(req,
<a name="l01328"></a>01328                                        pexport,
<a name="l01329"></a>01329                                        &amp;pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#afa0bb09f4f079b89459660b0f526a6b3">thread_fsal_context</a>,
<a name="l01330"></a>01330                                        &amp;<a class="code" href="structuser__credentials.html">user_credentials</a>) == <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>)
<a name="l01331"></a>01331             {
<a name="l01332"></a>01332               <a class="code" href="log_8h.html#a12ce2d8580101872ee848b50b59252ae">LogInfo</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l01333"></a>01333                       <span class="stringliteral">&quot;authentication failed, rejecting client&quot;</span>);
<a name="l01334"></a>01334               svc_dplx_lock_x(xprt, &amp;pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a45a5ae3cb189d60666f7cd4e5fc4f8c5">sigmask</a>);
<a name="l01335"></a>01335               svcerr_auth2(xprt, req, AUTH_TOOWEAK);
<a name="l01336"></a>01336               svc_dplx_unlock_x(xprt, &amp;pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a45a5ae3cb189d60666f7cd4e5fc4f8c5">sigmask</a>);
<a name="l01337"></a>01337               <span class="comment">/* XXX */</span>
<a name="l01338"></a>01338               pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#aec2328cd9338f733ac04fdca7100ab1b">current_xid</a> = 0;    <span class="comment">/* No more xid managed */</span>
<a name="l01339"></a>01339 
<a name="l01340"></a>01340               <span class="keywordflow">if</span> (<a class="code" href="nfs__dupreq_8h.html#ad30cdf2e72a3a44f95f951cc1572198d">nfs_dupreq_delete</a>(req) != <a class="code" href="nfs__dupreq_8h.html#a8f699cea0366b683501fe91a4dbc37faa081a1934d0972db9961d46f25d264ff9">DUPREQ_SUCCESS</a>)
<a name="l01341"></a>01341                 {
<a name="l01342"></a>01342                   <a class="code" href="test__findlog_8c.html#adfd9432c5478fa14c7d678edb301feed">LogCrit</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l01343"></a>01343                          <span class="stringliteral">&quot;Attempt to delete duplicate request failed on line %d&quot;</span>,
<a name="l01344"></a>01344                          __LINE__);
<a name="l01345"></a>01345                 }
<a name="l01346"></a>01346               <span class="keywordflow">return</span>;
<a name="l01347"></a>01347             }
<a name="l01348"></a>01348         }
<a name="l01349"></a>01349 
<a name="l01350"></a>01350       <span class="comment">/* processing */</span>
<a name="l01351"></a>01351       <a class="code" href="common__utils_8h.html#a13190861330e48fe885da6b2671876a9">P</a>(pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a49237115e9ea710e3544e238236344bf">request_pool_mutex</a>);
<a name="l01352"></a>01352       gettimeofday(timer_start, <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01353"></a>01353 
<a name="l01354"></a>01354       <a class="code" href="log_8h.html#aa7aee8ec65b5baafb430f8d2a7588d53">LogDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l01355"></a>01355                <span class="stringliteral">&quot;NFS DISPATCHER: Calling service function %s start_time %llu.%.6llu&quot;</span>,
<a name="l01356"></a>01356                pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a9c8362f69383467f564f831889a917e3">pfuncdesc</a>-&gt;<a class="code" href="group__NFSprocs.html#gace56bc4b2e8e74de72034c85144cbb7d">funcname</a>,
<a name="l01357"></a>01357                (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>)timer_start-&gt;tv_sec,
<a name="l01358"></a>01358                (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>)timer_start-&gt;tv_usec);
<a name="l01359"></a>01359 
<a name="l01360"></a>01360       <a class="code" href="common__utils_8h.html#a5a9b6f8030959507eee365b226d63b00">V</a>(pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a49237115e9ea710e3544e238236344bf">request_pool_mutex</a>);
<a name="l01361"></a>01361 
<a name="l01362"></a>01362 <span class="preprocessor">#ifdef _ERROR_INJECTION</span>
<a name="l01363"></a>01363 <span class="preprocessor"></span>      <span class="keywordflow">if</span>(<a class="code" href="err__inject_8c.html#a4bfe956756a400c95b86b2e7d018ce4b">worker_delay_time</a> != 0)
<a name="l01364"></a>01364         sleep(<a class="code" href="err__inject_8c.html#a4bfe956756a400c95b86b2e7d018ce4b">worker_delay_time</a>);
<a name="l01365"></a>01365       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="err__inject_8c.html#a50a9509e7853083549b6889e17876235">next_worker_delay_time</a> != 0)
<a name="l01366"></a>01366         {
<a name="l01367"></a>01367           sleep(<a class="code" href="err__inject_8c.html#a50a9509e7853083549b6889e17876235">next_worker_delay_time</a>);
<a name="l01368"></a>01368           <a class="code" href="err__inject_8c.html#a50a9509e7853083549b6889e17876235">next_worker_delay_time</a> = 0;
<a name="l01369"></a>01369         }
<a name="l01370"></a>01370 <span class="preprocessor">#endif</span>
<a name="l01371"></a>01371 <span class="preprocessor"></span>
<a name="l01372"></a>01372       pfsal_op_ctx =  &amp;pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#afa0bb09f4f079b89459660b0f526a6b3">thread_fsal_context</a> ;
<a name="l01373"></a>01373 
<a name="l01374"></a>01374       rc = pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a9c8362f69383467f564f831889a917e3">pfuncdesc</a>-&gt;<a class="code" href="structnfs__function__desc____.html#a2b51da5c6967bfc780a8fccb9d66158f">service_function</a>(parg_nfs,
<a name="l01375"></a>01375                                                      pexport,
<a name="l01376"></a>01376                                                      pfsal_op_ctx,
<a name="l01377"></a>01377                                                      pworker_data,
<a name="l01378"></a>01378                                                      req,
<a name="l01379"></a>01379                                                      &amp;res_nfs);
<a name="l01380"></a>01380     }
<a name="l01381"></a>01381 
<a name="l01382"></a>01382   <span class="comment">/* Perform statistics here */</span>
<a name="l01383"></a>01383   gettimeofday(&amp;timer_end, <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01384"></a>01384 
<a name="l01385"></a>01385   <span class="comment">/* process time */</span>
<a name="l01386"></a>01386   stat_type = (rc == <a class="code" href="group__NFSprocs.html#ga2c5937c697db19bb296a6393191d5600">NFS_REQ_OK</a>) ? <a class="code" href="nfs__stat_8h.html#acb85f9ed5c9d3a0eac7feb6c25fe8298ab386063c742dd293171416cbb1e3fe8a">GANESHA_STAT_SUCCESS</a> : <a class="code" href="nfs__stat_8h.html#acb85f9ed5c9d3a0eac7feb6c25fe8298af202ef055e667d96d6ac9ab4e45b6a15">GANESHA_STAT_DROP</a>;
<a name="l01387"></a>01387   <a class="code" href="common__utils_8h.html#a13190861330e48fe885da6b2671876a9">P</a>(pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a49237115e9ea710e3544e238236344bf">request_pool_mutex</a>);
<a name="l01388"></a>01388   timer_diff = <a class="code" href="nfs__stat_8h.html#acf045ccad77a69933c72ecf0f7beeb14">time_diff</a>(*timer_start, timer_end);
<a name="l01389"></a>01389 
<a name="l01390"></a>01390   <span class="comment">/* this thread is done, reset the timer start to avoid long processing */</span>
<a name="l01391"></a>01391   memset(timer_start, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> timeval));
<a name="l01392"></a>01392   <a class="code" href="common__utils_8h.html#a5a9b6f8030959507eee365b226d63b00">V</a>(pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a49237115e9ea710e3544e238236344bf">request_pool_mutex</a>);
<a name="l01393"></a>01393   latency_stat.type = <a class="code" href="nfs__stat_8h.html#a79866db8732bea7dcafbcebeb4163796a17ab554a04236703ede30a6bec60492b">SVC_TIME</a>;
<a name="l01394"></a>01394   latency_stat.latency = timer_diff.tv_sec * 1000000
<a name="l01395"></a>01395     + timer_diff.tv_usec; <span class="comment">/* microseconds */</span>
<a name="l01396"></a>01396   <a class="code" href="nfs__stat_8h.html#a2d6f8ffcaba0be565784ff5096728a57">nfs_stat_update</a>(stat_type, &amp;(pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#af8c55be2a9a2d1a570e746342d81589c">stats</a>.<a class="code" href="structnfs__worker__stat____.html#a345c9ff027546150e6f33573ddc5ee97">stat_req</a>), req,
<a name="l01397"></a>01397                   &amp;latency_stat);
<a name="l01398"></a>01398 
<a name="l01399"></a>01399   <span class="keywordflow">if</span> ((req-&gt;rq_prog == <a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#aeef2995e9b54747311db1972d158fd41">core_param</a>.<a class="code" href="structnfs__core__param____.html#aa04e466147819b7a92794e45e67ad2c9">program</a>[<a class="code" href="nfs__core_8h.html#a7f6e26c17a511d03a3e095f595a02907a9c790ab4adce0dd1d4dde907f1211eb4">P_MNT</a>]) ||
<a name="l01400"></a>01400       ((req-&gt;rq_prog == <a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#aeef2995e9b54747311db1972d158fd41">core_param</a>.<a class="code" href="structnfs__core__param____.html#aa04e466147819b7a92794e45e67ad2c9">program</a>[<a class="code" href="nfs__core_8h.html#a7f6e26c17a511d03a3e095f595a02907a69c56a6ce312422c90b25f97a43d4dc2">P_NFS</a>]) &amp;&amp;
<a name="l01401"></a>01401        (req-&gt;rq_proc == 0 <span class="comment">/*NULL RPC*/</span> ))) {
<a name="l01402"></a>01402       update_per_share_stats = <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01403"></a>01403   } <span class="keywordflow">else</span> {
<a name="l01404"></a>01404       update_per_share_stats = <a class="code" href="HashTable_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01405"></a>01405   }
<a name="l01406"></a>01406   <span class="comment">/* Update per-share counter and process time */</span>
<a name="l01407"></a>01407   <span class="keywordflow">if</span> (update_per_share_stats) {
<a name="l01408"></a>01408       <a class="code" href="nfs__stat_8h.html#a2d6f8ffcaba0be565784ff5096728a57">nfs_stat_update</a>(stat_type,
<a name="l01409"></a>01409                       &amp;(pexport-&gt;<a class="code" href="structexportlist____.html#aff1ccc12af6ba217b27a97dc86bc1f09">worker_stats</a>[pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#aa3b3a13558358ef3e6209d8c1f8f91ce">worker_index</a>].<a class="code" href="structnfs__worker__stat____.html#a345c9ff027546150e6f33573ddc5ee97">stat_req</a>),
<a name="l01410"></a>01410                       req, &amp;latency_stat);
<a name="l01411"></a>01411   }
<a name="l01412"></a>01412 
<a name="l01413"></a>01413   <span class="comment">/* process time + queue time */</span>
<a name="l01414"></a>01414   queue_timer_diff = <a class="code" href="nfs__stat_8h.html#acf045ccad77a69933c72ecf0f7beeb14">time_diff</a>(preqnfs-&gt;<a class="code" href="structnfs__request__data____.html#a84d544dce7025e0d845e77377e0b4a84">time_queued</a>, timer_end);
<a name="l01415"></a>01415   latency_stat.type = <a class="code" href="nfs__stat_8h.html#a79866db8732bea7dcafbcebeb4163796a52b8b3778ec05ef26645825d321b6258">AWAIT_TIME</a>;
<a name="l01416"></a>01416   latency_stat.latency = queue_timer_diff.tv_sec * 1000000
<a name="l01417"></a>01417     + queue_timer_diff.tv_usec; <span class="comment">/* microseconds */</span>
<a name="l01418"></a>01418   <a class="code" href="nfs__stat_8h.html#a2d6f8ffcaba0be565784ff5096728a57">nfs_stat_update</a>(<a class="code" href="nfs__stat_8h.html#acb85f9ed5c9d3a0eac7feb6c25fe8298ab386063c742dd293171416cbb1e3fe8a">GANESHA_STAT_SUCCESS</a>, &amp;(pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#af8c55be2a9a2d1a570e746342d81589c">stats</a>.<a class="code" href="structnfs__worker__stat____.html#a345c9ff027546150e6f33573ddc5ee97">stat_req</a>), req,
<a name="l01419"></a>01419                   &amp;latency_stat);
<a name="l01420"></a>01420 
<a name="l01421"></a>01421   <span class="comment">/* Update per-share process time + queue time */</span>
<a name="l01422"></a>01422   <span class="keywordflow">if</span> (update_per_share_stats) {
<a name="l01423"></a>01423       <a class="code" href="nfs__stat_8h.html#a2d6f8ffcaba0be565784ff5096728a57">nfs_stat_update</a>(<a class="code" href="nfs__stat_8h.html#acb85f9ed5c9d3a0eac7feb6c25fe8298ab386063c742dd293171416cbb1e3fe8a">GANESHA_STAT_SUCCESS</a>,
<a name="l01424"></a>01424                       &amp;(pexport-&gt;<a class="code" href="structexportlist____.html#aff1ccc12af6ba217b27a97dc86bc1f09">worker_stats</a>[pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#aa3b3a13558358ef3e6209d8c1f8f91ce">worker_index</a>].<a class="code" href="structnfs__worker__stat____.html#a345c9ff027546150e6f33573ddc5ee97">stat_req</a>),
<a name="l01425"></a>01425                       req, &amp;latency_stat);
<a name="l01426"></a>01426 
<a name="l01427"></a>01427       <span class="comment">/* Update per-share total counters */</span>
<a name="l01428"></a>01428       pexport-&gt;<a class="code" href="structexportlist____.html#aff1ccc12af6ba217b27a97dc86bc1f09">worker_stats</a>[pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#aa3b3a13558358ef3e6209d8c1f8f91ce">worker_index</a>].<a class="code" href="structnfs__worker__stat____.html#acdc7df3282a65f80c27e09dacbbd0696">nb_total_req</a> += 1;
<a name="l01429"></a>01429   }
<a name="l01430"></a>01430 
<a name="l01431"></a>01431   <span class="comment">/* Update total counters */</span>
<a name="l01432"></a>01432   pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#af8c55be2a9a2d1a570e746342d81589c">stats</a>.<a class="code" href="structnfs__worker__stat____.html#acdc7df3282a65f80c27e09dacbbd0696">nb_total_req</a> += 1;
<a name="l01433"></a>01433 
<a name="l01434"></a>01434   <span class="keywordflow">if</span>(timer_diff.tv_sec &gt;= <a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#aeef2995e9b54747311db1972d158fd41">core_param</a>.<a class="code" href="structnfs__core__param____.html#a3fbbfb7ec3f8d64cbabfb90c004dbe2f">long_processing_threshold</a>)
<a name="l01435"></a>01435     <a class="code" href="log_8h.html#a014a663a4d20c38e82ab3f35298667e8">LogEvent</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l01436"></a>01436              <span class="stringliteral">&quot;Function %s xid=%u exited with status %d taking %llu.%.6llu seconds to process&quot;</span>,
<a name="l01437"></a>01437              pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a9c8362f69383467f564f831889a917e3">pfuncdesc</a>-&gt;<a class="code" href="group__NFSprocs.html#gace56bc4b2e8e74de72034c85144cbb7d">funcname</a>, req-&gt;rq_xid, rc,
<a name="l01438"></a>01438              (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>)timer_diff.tv_sec,
<a name="l01439"></a>01439              (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>)timer_diff.tv_usec);
<a name="l01440"></a>01440   <span class="keywordflow">else</span>
<a name="l01441"></a>01441     <a class="code" href="log_8h.html#aa7aee8ec65b5baafb430f8d2a7588d53">LogDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l01442"></a>01442              <span class="stringliteral">&quot;Function %s xid=%u exited with status %d taking %llu.%.6llu seconds to process&quot;</span>,
<a name="l01443"></a>01443              pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a9c8362f69383467f564f831889a917e3">pfuncdesc</a>-&gt;<a class="code" href="group__NFSprocs.html#gace56bc4b2e8e74de72034c85144cbb7d">funcname</a>, req-&gt;rq_xid, rc,
<a name="l01444"></a>01444              (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>)timer_diff.tv_sec,
<a name="l01445"></a>01445              (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>)timer_diff.tv_usec);
<a name="l01446"></a>01446 
<a name="l01447"></a>01447   <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l01448"></a>01448                <span class="stringliteral">&quot;Function %s xid=%u: process %llu.%.6llu await %llu.%.6llu&quot;</span>,
<a name="l01449"></a>01449                pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a9c8362f69383467f564f831889a917e3">pfuncdesc</a>-&gt;<a class="code" href="group__NFSprocs.html#gace56bc4b2e8e74de72034c85144cbb7d">funcname</a>, req-&gt;rq_xid,
<a name="l01450"></a>01450                (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)timer_diff.tv_sec,
<a name="l01451"></a>01451                (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)timer_diff.tv_usec,
<a name="l01452"></a>01452                (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)queue_timer_diff.tv_sec,
<a name="l01453"></a>01453                (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>)queue_timer_diff.tv_usec);
<a name="l01454"></a>01454   
<a name="l01455"></a>01455   <span class="comment">/* Perform NFSv4 operations statistics if required */</span>
<a name="l01456"></a>01456   <span class="keywordflow">if</span>(req-&gt;rq_vers == <a class="code" href="nfsv40_8h.html#a38cfe5720671dbafe5d1b278f6fe9dec">NFS_V4</a>)
<a name="l01457"></a>01457       <span class="keywordflow">if</span>(req-&gt;rq_proc == <a class="code" href="nfsv40_8h.html#a8ef9e1ab2fa6753b1ad048a62fc418f7">NFSPROC4_COMPOUND</a>)
<a name="l01458"></a>01458           <a class="code" href="group__NFSprocs.html#ga325407769215fa2792ae7cba29a465d4">nfs4_op_stat_update</a>(parg_nfs, &amp;res_nfs,
<a name="l01459"></a>01459                               &amp;(pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#af8c55be2a9a2d1a570e746342d81589c">stats</a>.<a class="code" href="structnfs__worker__stat____.html#a345c9ff027546150e6f33573ddc5ee97">stat_req</a>));
<a name="l01460"></a>01460 
<a name="l01461"></a>01461   <span class="comment">/* XXX */</span>
<a name="l01462"></a>01462   pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#aec2328cd9338f733ac04fdca7100ab1b">current_xid</a> = 0;        <span class="comment">/* No more xid managed */</span>
<a name="l01463"></a>01463 
<a name="l01464"></a>01464   <span class="comment">/* If request is dropped, no return to the client */</span>
<a name="l01465"></a>01465   <span class="keywordflow">if</span>(rc == <a class="code" href="group__NFSprocs.html#gad48913a4e6ea3bdaca974a4c4fccd6c2">NFS_REQ_DROP</a>)
<a name="l01466"></a>01466     {
<a name="l01467"></a>01467       <span class="comment">/* The request was dropped */</span>
<a name="l01468"></a>01468       <a class="code" href="log_8h.html#aa7aee8ec65b5baafb430f8d2a7588d53">LogDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l01469"></a>01469                <span class="stringliteral">&quot;Drop request rpc_xid=%u, program %u, version %u, function %u&quot;</span>,
<a name="l01470"></a>01470                req-&gt;rq_xid, (<span class="keywordtype">int</span>)req-&gt;rq_prog,
<a name="l01471"></a>01471                (<span class="keywordtype">int</span>)req-&gt;rq_vers, (<span class="keywordtype">int</span>)req-&gt;rq_proc);
<a name="l01472"></a>01472 
<a name="l01473"></a>01473       <span class="comment">/* If the request is not normally cached, then the entry will be removed</span>
<a name="l01474"></a>01474 <span class="comment">       * later. We only remove a reply that is normally cached that has been</span>
<a name="l01475"></a>01475 <span class="comment">       * dropped. */</span>
<a name="l01476"></a>01476       <span class="keywordflow">if</span>(do_dupreq_cache)
<a name="l01477"></a>01477         <span class="keywordflow">if</span> (<a class="code" href="nfs__dupreq_8h.html#ad30cdf2e72a3a44f95f951cc1572198d">nfs_dupreq_delete</a>(req) != <a class="code" href="nfs__dupreq_8h.html#a8f699cea0366b683501fe91a4dbc37faa081a1934d0972db9961d46f25d264ff9">DUPREQ_SUCCESS</a>)
<a name="l01478"></a>01478           {
<a name="l01479"></a>01479             <a class="code" href="test__findlog_8c.html#adfd9432c5478fa14c7d678edb301feed">LogCrit</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l01480"></a>01480                     <span class="stringliteral">&quot;Attempt to delete duplicate request failed on line %d&quot;</span>,
<a name="l01481"></a>01481                     __LINE__);
<a name="l01482"></a>01482           }
<a name="l01483"></a>01483     }
<a name="l01484"></a>01484   <span class="keywordflow">else</span>
<a name="l01485"></a>01485     {
<a name="l01486"></a>01486       <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l01487"></a>01487                    <span class="stringliteral">&quot;Before svc_sendreply on socket %d&quot;</span>,
<a name="l01488"></a>01488                    xprt-&gt;xp_fd);
<a name="l01489"></a>01489 
<a name="l01490"></a>01490       svc_dplx_lock_x(xprt, &amp;pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a45a5ae3cb189d60666f7cd4e5fc4f8c5">sigmask</a>);
<a name="l01491"></a>01491 
<a name="l01492"></a>01492       <span class="comment">/* encoding the result on xdr output */</span>
<a name="l01493"></a>01493       <span class="keywordflow">if</span>(svc_sendreply2(xprt, req, pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a9c8362f69383467f564f831889a917e3">pfuncdesc</a>-&gt;<a class="code" href="group__NFSprocs.html#ga12912f1556e435ca2f4a698dec035a72">xdr_encode_func</a>,
<a name="l01494"></a>01494                         (caddr_t) &amp;res_nfs) == <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>)
<a name="l01495"></a>01495         {
<a name="l01496"></a>01496           <a class="code" href="log_8h.html#aa7aee8ec65b5baafb430f8d2a7588d53">LogDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l01497"></a>01497                    <span class="stringliteral">&quot;NFS DISPATCHER: FAILURE: Error while calling svc_sendreply&quot;</span>);
<a name="l01498"></a>01498           svcerr_systemerr2(xprt, req);
<a name="l01499"></a>01499 
<a name="l01500"></a>01500           <span class="keywordflow">if</span> (<a class="code" href="nfs__dupreq_8h.html#ad30cdf2e72a3a44f95f951cc1572198d">nfs_dupreq_delete</a>(req) != <a class="code" href="nfs__dupreq_8h.html#a8f699cea0366b683501fe91a4dbc37faa081a1934d0972db9961d46f25d264ff9">DUPREQ_SUCCESS</a>)
<a name="l01501"></a>01501             {
<a name="l01502"></a>01502               <a class="code" href="test__findlog_8c.html#adfd9432c5478fa14c7d678edb301feed">LogCrit</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l01503"></a>01503                       <span class="stringliteral">&quot;Attempt to delete duplicate request failed on line %d&quot;</span>,
<a name="l01504"></a>01504                       __LINE__);
<a name="l01505"></a>01505             }
<a name="l01506"></a>01506           svc_dplx_unlock_x(xprt, &amp;pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a45a5ae3cb189d60666f7cd4e5fc4f8c5">sigmask</a>);
<a name="l01507"></a>01507           <span class="keywordflow">return</span>;
<a name="l01508"></a>01508         }
<a name="l01509"></a>01509 
<a name="l01510"></a>01510       <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l01511"></a>01511                    <span class="stringliteral">&quot;After svc_sendreply on socket %d&quot;</span>,
<a name="l01512"></a>01512                    xprt-&gt;xp_fd);
<a name="l01513"></a>01513 
<a name="l01514"></a>01514       <span class="comment">/* Mark request as finished */</span>
<a name="l01515"></a>01515       <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ab22e11ab2329da5c014538bee4066181">COMPONENT_DUPREQ</a>, <span class="stringliteral">&quot;YES?: %d&quot;</span>, do_dupreq_cache);
<a name="l01516"></a>01516       <span class="keywordflow">if</span>(do_dupreq_cache)
<a name="l01517"></a>01517         {
<a name="l01518"></a>01518           dpq_status = <a class="code" href="nfs__dupreq_8h.html#aabab915e080d080a9a4cdd0df471044d">nfs_dupreq_finish</a>(req, &amp;res_nfs, lru_dupreq);
<a name="l01519"></a>01519         }
<a name="l01520"></a>01520     } <span class="comment">/* rc == NFS_REQ_DROP */</span>
<a name="l01521"></a>01521 
<a name="l01522"></a>01522   <span class="comment">/* Free the allocated resources once the work is done */</span>
<a name="l01523"></a>01523   <span class="comment">/* Free the arguments */</span>
<a name="l01524"></a>01524   <span class="keywordflow">if</span>((preqnfs-&gt;<a class="code" href="structnfs__request__data____.html#afddd6756b9d7c6c4e6ab81c7d79ac4a0">req</a>.rq_vers == 2) ||
<a name="l01525"></a>01525      (preqnfs-&gt;<a class="code" href="structnfs__request__data____.html#afddd6756b9d7c6c4e6ab81c7d79ac4a0">req</a>.rq_vers == 3) ||
<a name="l01526"></a>01526      (preqnfs-&gt;<a class="code" href="structnfs__request__data____.html#afddd6756b9d7c6c4e6ab81c7d79ac4a0">req</a>.rq_vers == 4))
<a name="l01527"></a>01527       <span class="keywordflow">if</span>(!SVC_FREEARGS(xprt, pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a9c8362f69383467f564f831889a917e3">pfuncdesc</a>-&gt;<a class="code" href="group__NFSprocs.html#gac1da0ffd4b07434230a44ef3a2ca558f">xdr_decode_func</a>,
<a name="l01528"></a>01528                        (caddr_t) parg_nfs))
<a name="l01529"></a>01529       {
<a name="l01530"></a>01530         <a class="code" href="test__findlog_8c.html#adfd9432c5478fa14c7d678edb301feed">LogCrit</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l01531"></a>01531                 <span class="stringliteral">&quot;NFS DISPATCHER: FAILURE: Bad SVC_FREEARGS for %s&quot;</span>,
<a name="l01532"></a>01532                 pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a9c8362f69383467f564f831889a917e3">pfuncdesc</a>-&gt;<a class="code" href="group__NFSprocs.html#gace56bc4b2e8e74de72034c85144cbb7d">funcname</a>);
<a name="l01533"></a>01533       }
<a name="l01534"></a>01534 
<a name="l01535"></a>01535   <span class="comment">/* XXX we must hold xprt lock across SVC_FREEARGS */</span>
<a name="l01536"></a>01536   svc_dplx_unlock_x(xprt, &amp;pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a45a5ae3cb189d60666f7cd4e5fc4f8c5">sigmask</a>);
<a name="l01537"></a>01537     
<a name="l01538"></a>01538   <span class="comment">/* Free the reply.</span>
<a name="l01539"></a>01539 <span class="comment">   * This should not be done if the request is dupreq cached because this will</span>
<a name="l01540"></a>01540 <span class="comment">   * mark the dupreq cached info eligible for being reuse by other requests */</span>
<a name="l01541"></a>01541   <span class="keywordflow">if</span>(!do_dupreq_cache)
<a name="l01542"></a>01542     {
<a name="l01543"></a>01543       <span class="keywordflow">if</span> (<a class="code" href="nfs__dupreq_8h.html#ad30cdf2e72a3a44f95f951cc1572198d">nfs_dupreq_delete</a>(req) != <a class="code" href="nfs__dupreq_8h.html#a8f699cea0366b683501fe91a4dbc37faa081a1934d0972db9961d46f25d264ff9">DUPREQ_SUCCESS</a>)
<a name="l01544"></a>01544         {
<a name="l01545"></a>01545           <a class="code" href="test__findlog_8c.html#adfd9432c5478fa14c7d678edb301feed">LogCrit</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l01546"></a>01546                   <span class="stringliteral">&quot;Attempt to delete duplicate request failed on line %d&quot;</span>,
<a name="l01547"></a>01547                   __LINE__);
<a name="l01548"></a>01548         }
<a name="l01549"></a>01549       <span class="comment">/* Free only the non dropped requests */</span>
<a name="l01550"></a>01550       <span class="keywordflow">if</span>(rc == <a class="code" href="group__NFSprocs.html#ga2c5937c697db19bb296a6393191d5600">NFS_REQ_OK</a>) {
<a name="l01551"></a>01551           pworker_data-&gt;<a class="code" href="structnfs__worker__data____.html#a9c8362f69383467f564f831889a917e3">pfuncdesc</a>-&gt;<a class="code" href="group__NFSprocs.html#gaba4e84d16617a16550fa57dcc42ecee0">free_function</a>(&amp;res_nfs);
<a name="l01552"></a>01552       }
<a name="l01553"></a>01553     }
<a name="l01554"></a>01554 
<a name="l01555"></a>01555   <span class="comment">/* By now the dupreq cache entry should have been completed w/ a request</span>
<a name="l01556"></a>01556 <span class="comment">   * that is reusable or the dupreq cache entry should have been removed. */</span>
<a name="l01557"></a>01557   <span class="keywordflow">return</span>;
<a name="l01558"></a>01558 }                               <span class="comment">/* nfs_rpc_execute */</span>
<a name="l01559"></a>01559 
<a name="l01573"></a><a class="code" href="nfs__worker__thread_8c.html#a54da0e0072dd8137cb2f1ad3e70fe786">01573</a> <span class="keywordtype">int</span> <a class="code" href="nfs__core_8h.html#a54da0e0072dd8137cb2f1ad3e70fe786">nfs_Init_worker_data</a>(<a class="code" href="structnfs__worker__data____.html">nfs_worker_data_t</a> * <a class="code" href="nfs__rpc__dispatcher__thread_8c.html#ae19b5cb1e7688def1ee7b7668378cfbc">pdata</a>)
<a name="l01574"></a>01574 {
<a name="l01575"></a>01575   <a class="code" href="LRU__List_8h.html#a311d7eceb3c6397078a27534b3744599">LRU_status_t</a> status = <a class="code" href="LRU__List_8h.html#acee9f086802570374777af36ac0527a8">LRU_LIST_SUCCESS</a>;
<a name="l01576"></a>01576   <span class="keywordtype">char</span> <a class="code" href="mount_8h.html#a2946c588fc7fa2fa5b43ac54b7872725">name</a>[256];
<a name="l01577"></a>01577 
<a name="l01578"></a>01578   <span class="keywordflow">if</span>(pthread_mutex_init(&amp;(pdata-&gt;<a class="code" href="structnfs__worker__data____.html#a49237115e9ea710e3544e238236344bf">request_pool_mutex</a>), <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) != 0)
<a name="l01579"></a>01579     <span class="keywordflow">return</span> -1;
<a name="l01580"></a>01580 
<a name="l01581"></a>01581   sprintf(name, <span class="stringliteral">&quot;Worker Thread #%u&quot;</span>, (<span class="keywordtype">int</span>)pdata-&gt;<a class="code" href="structnfs__worker__data____.html#aa3b3a13558358ef3e6209d8c1f8f91ce">worker_index</a>);
<a name="l01582"></a>01582   <span class="keywordflow">if</span>(<a class="code" href="nfs__tcb_8h.html#aeec811dc6959321301528a121112297d">tcb_new</a>(&amp;(pdata-&gt;<a class="code" href="structnfs__worker__data____.html#afee6ba7633212a86680a5b141b45267c">wcb</a>), name) != 0)
<a name="l01583"></a>01583     <span class="keywordflow">return</span> -1;
<a name="l01584"></a>01584 
<a name="l01585"></a>01585   init_glist(&amp;pdata-&gt;<a class="code" href="structnfs__worker__data____.html#a271303e56c35c8d0f0f478c3dcbe5e12">pending_request</a>);
<a name="l01586"></a>01586   pdata-&gt;<a class="code" href="structnfs__worker__data____.html#af3c93c9919145a7078b195fa72bc9bd6">pending_request_len</a> = 0;
<a name="l01587"></a>01587 
<a name="l01588"></a>01588   sprintf(name, <span class="stringliteral">&quot;Worker Thread #%u Duplicate Request&quot;</span>, pdata-&gt;<a class="code" href="structnfs__worker__data____.html#aa3b3a13558358ef3e6209d8c1f8f91ce">worker_index</a>);
<a name="l01589"></a>01589   <a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#adaf127ebcf4eea500e79011b862c6899">worker_param</a>.<a class="code" href="structnfs__worker__param____.html#a0074e24cd0651d45e97ea9f20db9a55e">lru_dupreq</a>.<a class="code" href="structlru__param____.html#a4122362201bf5d2cebc21a94f4e6099a">lp_name</a> = <a class="code" href="mount_8h.html#a2946c588fc7fa2fa5b43ac54b7872725">name</a>;
<a name="l01590"></a>01590 
<a name="l01591"></a>01591   <span class="keywordflow">if</span>((pdata-&gt;<a class="code" href="structnfs__worker__data____.html#a5dcb7ab5d79badb75a9fe1b37b6a24cb">duplicate_request</a> =
<a name="l01592"></a>01592       <a class="code" href="group__LRUExportedFunctions.html#ga5c11aa9a651e67795871ff66d540c86e">LRU_Init</a>(<a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#adaf127ebcf4eea500e79011b862c6899">worker_param</a>.<a class="code" href="structnfs__worker__param____.html#a0074e24cd0651d45e97ea9f20db9a55e">lru_dupreq</a>, &amp;status)) == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01593"></a>01593     {
<a name="l01594"></a>01594       <a class="code" href="log_8h.html#a367b67f5a0b29160763c3ce8efce0875">LogError</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>, <a class="code" href="log_8h.html#a1d5aa144adc9eb234eae520722ffc747">ERR_LRU</a>, <a class="code" href="err__LRU__List_8h.html#a6bfbde59e5bd330295664a9d85888bcc">ERR_LRU_LIST_INIT</a>, status);
<a name="l01595"></a>01595       <span class="keywordflow">return</span> -1;
<a name="l01596"></a>01596     }
<a name="l01597"></a>01597 
<a name="l01598"></a>01598   pdata-&gt;<a class="code" href="structnfs__worker__data____.html#a1cf7b7678508113f59ba272bb574f3d2">passcounter</a> = 0;
<a name="l01599"></a>01599   pdata-&gt;<a class="code" href="structnfs__worker__data____.html#afee6ba7633212a86680a5b141b45267c">wcb</a>.<a class="code" href="structnfs__thread__control__block____.html#ad86575e24746da45835b6d1ba207b06a">tcb_ready</a> = <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01600"></a>01600   pdata-&gt;<a class="code" href="structnfs__worker__data____.html#a3aa5cacdd2f277273c8701a46e74f646">gc_in_progress</a> = <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01601"></a>01601   pdata-&gt;<a class="code" href="structnfs__worker__data____.html#a9c8362f69383467f564f831889a917e3">pfuncdesc</a> = <a class="code" href="nfs__core_8h.html#a5ecbbf13d82cd2cbf2d6d80cb61624c5">INVALID_FUNCDESC</a>;
<a name="l01602"></a>01602 
<a name="l01603"></a>01603   <span class="keywordflow">return</span> 0;
<a name="l01604"></a>01604 }                               <span class="comment">/* nfs_Init_worker_data */</span>
<a name="l01605"></a>01605 
<a name="l01606"></a><a class="code" href="nfs__worker__thread_8c.html#a4af3637fa4e0980caa4680291b70c3a8">01606</a> <span class="keywordtype">void</span> <a class="code" href="nfs__core_8h.html#abba8cdbb10262bb26f79df7de174cfd5">DispatchWorkNFS</a>(<a class="code" href="structrequest__data____.html">request_data_t</a> *nfsreq, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> worker_index)
<a name="l01607"></a>01607 {
<a name="l01608"></a>01608   <span class="keyword">struct </span>svc_req *req = <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01609"></a>01609   <a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> rpcxid = 0;
<a name="l01610"></a>01610 
<a name="l01611"></a>01611   <span class="keywordflow">switch</span> (nfsreq-&gt;<a class="code" href="structrequest__data____.html#a8cf32a1a85150da63fc542b7806d95ac">rtype</a>) {
<a name="l01612"></a>01612   <span class="keywordflow">case</span> <a class="code" href="nfs__core_8h.html#a1d4f2ab85979b1e390d2527d1fd7f0cda363aee72d239bd50c69414aad4e469fd">NFS_CALL</a>:
<a name="l01613"></a>01613       <span class="keywordflow">break</span>;
<a name="l01614"></a>01614   <span class="keywordflow">default</span>:
<a name="l01615"></a>01615       req = &amp;nfsreq-&gt;<a class="code" href="structrequest__data____.html#a418c071aa5cff12637b7668645e371ba">r_u</a>.<a class="code" href="unionrequest__data_____1_1request__content____.html#aa3080af499da22a494e6dd32f5e4c7ce">nfs</a>-&gt;<a class="code" href="structnfs__request__data____.html#afddd6756b9d7c6c4e6ab81c7d79ac4a0">req</a>;
<a name="l01616"></a>01616       rpcxid = req-&gt;rq_xid;
<a name="l01617"></a>01617   }
<a name="l01618"></a>01618 
<a name="l01619"></a>01619   <a class="code" href="log_8h.html#aa7aee8ec65b5baafb430f8d2a7588d53">LogDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l01620"></a>01620            <span class="stringliteral">&quot;Awaking Worker Thread #%u for request %p, rtype=%d xid=%u&quot;</span>,
<a name="l01621"></a>01621            worker_index, nfsreq, nfsreq-&gt;<a class="code" href="structrequest__data____.html#a8cf32a1a85150da63fc542b7806d95ac">rtype</a>, rpcxid);
<a name="l01622"></a>01622 
<a name="l01623"></a>01623   <a class="code" href="common__utils_8h.html#a13190861330e48fe885da6b2671876a9">P</a>(workers_data[worker_index].wcb.tcb_mutex);
<a name="l01624"></a>01624   <a class="code" href="common__utils_8h.html#a13190861330e48fe885da6b2671876a9">P</a>(workers_data[worker_index].request_pool_mutex);
<a name="l01625"></a>01625 
<a name="l01626"></a>01626   glist_add_tail(&amp;workers_data[worker_index].pending_request, &amp;nfsreq-&gt;<a class="code" href="structrequest__data____.html#af325af5e46693449aced00a7c58f03df">pending_req_queue</a>);
<a name="l01627"></a>01627   workers_data[worker_index].<a class="code" href="structnfs__worker__data____.html#af3c93c9919145a7078b195fa72bc9bd6">pending_request_len</a>++;
<a name="l01628"></a>01628 
<a name="l01629"></a>01629   <span class="keywordflow">if</span>(pthread_cond_signal(&amp;(workers_data[worker_index].wcb.tcb_condvar)) == -1)
<a name="l01630"></a>01630     {
<a name="l01631"></a>01631       <a class="code" href="common__utils_8h.html#a5a9b6f8030959507eee365b226d63b00">V</a>(workers_data[worker_index].request_pool_mutex);
<a name="l01632"></a>01632       <a class="code" href="common__utils_8h.html#a5a9b6f8030959507eee365b226d63b00">V</a>(workers_data[worker_index].wcb.tcb_mutex);
<a name="l01633"></a>01633       <a class="code" href="log_8h.html#a3cf3c22fac6bb9871e25007551caeb13">LogMajor</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a5aee8007416da5031516318f3efa4511">COMPONENT_THREAD</a>,
<a name="l01634"></a>01634                <span class="stringliteral">&quot;Error %d (%s) while signalling Worker Thread #%u... Exiting&quot;</span>,
<a name="l01635"></a>01635                errno, strerror(errno), worker_index);
<a name="l01636"></a>01636       <a class="code" href="log_8h.html#a3e81b070000b7a60f6dc0bd9fb1c41f9">Fatal</a>();
<a name="l01637"></a>01637     }
<a name="l01638"></a>01638   <a class="code" href="common__utils_8h.html#a5a9b6f8030959507eee365b226d63b00">V</a>(workers_data[worker_index].request_pool_mutex);
<a name="l01639"></a>01639   <a class="code" href="common__utils_8h.html#a5a9b6f8030959507eee365b226d63b00">V</a>(workers_data[worker_index].wcb.tcb_mutex);
<a name="l01640"></a>01640 }
<a name="l01641"></a>01641 
<a name="l01642"></a><a class="code" href="nfs__worker__thread_8c.html#ae3f485bb698c31b704e34f5a2fdc1004">01642</a> <span class="keyword">enum</span> auth_stat <a class="code" href="nfs__core_8h.html#a9aec01d1a440be7479b35dff66a6fcb5">AuthenticateRequest</a>(<a class="code" href="structnfs__request__data____.html">nfs_request_data_t</a> *nfsreq,
<a name="l01643"></a>01643                                    bool_t *no_dispatch)
<a name="l01644"></a>01644 {
<a name="l01645"></a>01645   <span class="keyword">struct </span>rpc_msg *msg;
<a name="l01646"></a>01646   <span class="keyword">struct </span>svc_req *req;
<a name="l01647"></a>01647   SVCXPRT *xprt;
<a name="l01648"></a>01648   <span class="keyword">enum</span> auth_stat why;
<a name="l01649"></a>01649 
<a name="l01650"></a>01650   <span class="comment">/* A few words of explanation are required here:</span>
<a name="l01651"></a>01651 <span class="comment">   * In authentication is AUTH_NONE or AUTH_UNIX, then the value of no_dispatch</span>
<a name="l01652"></a>01652 <span class="comment">   * remains FALSE and the request is proceeded normally.</span>
<a name="l01653"></a>01653 <span class="comment">   * If authentication is RPCSEC_GSS, no_dispatch may have value TRUE, this</span>
<a name="l01654"></a>01654 <span class="comment">   * means that gc-&gt;gc_proc != RPCSEC_GSS_DATA and that the message is in fact</span>
<a name="l01655"></a>01655 <span class="comment">   * an internal negociation message from RPCSEC_GSS using GSSAPI. It then</span>
<a name="l01656"></a>01656 <span class="comment">   * should not be proceed by the worker and SVC_STAT should be returned to</span>
<a name="l01657"></a>01657 <span class="comment">   * the dispatcher.</span>
<a name="l01658"></a>01658 <span class="comment">   */</span>
<a name="l01659"></a>01659 
<a name="l01660"></a>01660   *no_dispatch = <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01661"></a>01661 
<a name="l01662"></a>01662   <span class="comment">/* Set pointers */</span>
<a name="l01663"></a>01663   msg = &amp;(nfsreq-&gt;<a class="code" href="structnfs__request__data____.html#a21979ea41fa09472ae4236019dfd1823">msg</a>);
<a name="l01664"></a>01664   req = &amp;(nfsreq-&gt;<a class="code" href="structnfs__request__data____.html#afddd6756b9d7c6c4e6ab81c7d79ac4a0">req</a>);
<a name="l01665"></a>01665   xprt = nfsreq-&gt;<a class="code" href="structnfs__request__data____.html#aa61bc5d11af7e64be2f23a5b2a5ef0da">xprt</a>;
<a name="l01666"></a>01666 
<a name="l01667"></a>01667   req-&gt;rq_xprt = nfsreq-&gt;<a class="code" href="structnfs__request__data____.html#aa61bc5d11af7e64be2f23a5b2a5ef0da">xprt</a>;
<a name="l01668"></a>01668   req-&gt;rq_prog = msg-&gt;rm_call.cb_prog;
<a name="l01669"></a>01669   req-&gt;rq_vers = msg-&gt;rm_call.cb_vers;
<a name="l01670"></a>01670   req-&gt;rq_proc = msg-&gt;rm_call.cb_proc;
<a name="l01671"></a>01671   req-&gt;rq_xid = msg-&gt;rm_xid;
<a name="l01672"></a>01672 
<a name="l01673"></a>01673   <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l01674"></a>01674                <span class="stringliteral">&quot;About to authenticate Prog=%d, vers=%d, proc=%d xid=%u xprt=%p&quot;</span>,
<a name="l01675"></a>01675                (<span class="keywordtype">int</span>)req-&gt;rq_prog, (<span class="keywordtype">int</span>)req-&gt;rq_vers,
<a name="l01676"></a>01676                (<span class="keywordtype">int</span>)req-&gt;rq_proc, req-&gt;rq_xid, req-&gt;rq_xprt);
<a name="l01677"></a>01677 
<a name="l01678"></a>01678   <span class="comment">/* XXX Restore previously saved GssData.</span>
<a name="l01679"></a>01679 <span class="comment">   * I&#39;m not clear what we&#39;re restoring here.  Operating on xprt means that</span>
<a name="l01680"></a>01680 <span class="comment">   * we do (did) not share buffers with xprt_copy.</span>
<a name="l01681"></a>01681 <span class="comment">   */</span>
<a name="l01682"></a>01682 <span class="preprocessor">#ifdef _HAVE_GSSAPI</span>
<a name="l01683"></a>01683 <span class="preprocessor"></span>  <span class="keywordflow">if</span>((why = <a class="code" href="Svc__auth_8c.html#afeedc44f830ba9db0b49f2adfb22326f">Rpcsecgss__authenticate</a>(req, msg, no_dispatch)) != AUTH_OK)
<a name="l01684"></a>01684 <span class="preprocessor">#else</span>
<a name="l01685"></a>01685 <span class="preprocessor"></span>  <span class="keywordflow">if</span>((why = <a class="code" href="svc__auth_8h.html#aa6b4548ab5cf46e37e57d3ead097172f">_authenticate</a>(req, msg)) != AUTH_OK)
<a name="l01686"></a>01686 <span class="preprocessor">#endif</span>
<a name="l01687"></a>01687 <span class="preprocessor"></span>    {
<a name="l01688"></a>01688       <span class="keywordtype">char</span> auth_str[<a class="code" href="nfs__core_8h.html#ae46ce312f1b7e56e02267b0f08203937">AUTH_STR_LEN</a>];
<a name="l01689"></a>01689       <a class="code" href="nfs__core_8h.html#ac89a01bac2be1b0f78b569bc4aab0738">auth_stat2str</a>(why, auth_str);
<a name="l01690"></a>01690       <a class="code" href="log_8h.html#a12ce2d8580101872ee848b50b59252ae">LogInfo</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l01691"></a>01691               <span class="stringliteral">&quot;Could not authenticate request... rejecting with AUTH_STAT=%s&quot;</span>,
<a name="l01692"></a>01692               auth_str);
<a name="l01693"></a>01693       svcerr_auth2(xprt, req, why);
<a name="l01694"></a>01694       *no_dispatch = <a class="code" href="HashTable_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01695"></a>01695       <span class="keywordflow">return</span> why;
<a name="l01696"></a>01696     }
<a name="l01697"></a>01697   <span class="keywordflow">else</span>
<a name="l01698"></a>01698     {
<a name="l01699"></a>01699 <span class="preprocessor">#ifdef _HAVE_GSSAPI</span>
<a name="l01700"></a>01700 <span class="preprocessor"></span>      <span class="keyword">struct </span>rpc_gss_cred *gc;
<a name="l01701"></a>01701 
<a name="l01702"></a>01702       <span class="keywordflow">if</span>(req-&gt;rq_xprt-&gt;xp_verf.oa_flavor == <a class="code" href="nfsv41_8h.html#ad54dfbf482d8cf617442161f70ef6087">RPCSEC_GSS</a>)
<a name="l01703"></a>01703         {
<a name="l01704"></a>01704           gc = (<span class="keyword">struct </span>rpc_gss_cred *) req-&gt;rq_clntcred;
<a name="l01705"></a>01705           <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l01706"></a>01706                        <span class="stringliteral">&quot;AuthenticateRequest no_dispatch=%d gc-&gt;gc_proc=(%u) %s&quot;</span>,
<a name="l01707"></a>01707                        *no_dispatch, gc-&gt;gc_proc, <a class="code" href="Svc__auth__gss_8c.html#a2b17204965d7a4258d04f699963b84e1">str_gc_proc</a>(gc-&gt;gc_proc));
<a name="l01708"></a>01708         }
<a name="l01709"></a>01709 <span class="preprocessor">#endif</span>
<a name="l01710"></a>01710 <span class="preprocessor"></span>    }             <span class="comment">/* else from if( ( why = _authenticate( preq, pmsg) ) != AUTH_OK) */</span>
<a name="l01711"></a>01711   <span class="keywordflow">return</span> AUTH_OK;
<a name="l01712"></a>01712 }
<a name="l01713"></a>01713 
<a name="l01714"></a>01714 <span class="preprocessor">#ifdef _USE_9P</span>
<a name="l01715"></a>01715 <span class="preprocessor"></span>
<a name="l01726"></a>01726 <span class="keyword">static</span> <span class="keywordtype">void</span> _9p_execute( <a class="code" href="struct__9p__request__data____.html">_9p_request_data_t</a> * preq9p, 
<a name="l01727"></a>01727                           <a class="code" href="structnfs__worker__data____.html">nfs_worker_data_t</a> * pworker_data)
<a name="l01728"></a>01728 {
<a name="l01729"></a>01729   <a class="code" href="9p__interpreter_8c.html#a41f3da3e7d7b74d32ae78b600425341b">_9p_process_request</a>( preq9p, pworker_data ) ;
<a name="l01730"></a>01730   return ;
<a name="l01731"></a>01731 } <span class="comment">/* _9p_execute */</span>
<a name="l01732"></a>01732 <span class="preprocessor">#endif</span>
<a name="l01733"></a>01733 <span class="preprocessor"></span>
<a name="l01734"></a>01734 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">enum</span> xprt_stat
<a name="l01735"></a>01735 cond_multi_dispatch(<a class="code" href="structnfs__worker__data____.html">nfs_worker_data_t</a> *pmydata, <a class="code" href="structrequest__data____.html">request_data_t</a> *nfsreq,
<a name="l01736"></a>01736                     <span class="keywordtype">bool</span> *locked)
<a name="l01737"></a>01737 {
<a name="l01738"></a>01738     <span class="keyword">enum</span> xprt_stat stat;
<a name="l01739"></a>01739     bool_t try_multi = <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, dispatched = <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01740"></a>01740     SVCXPRT *xprt = nfsreq-&gt;<a class="code" href="structrequest__data____.html#a418c071aa5cff12637b7668645e371ba">r_u</a>.<a class="code" href="unionrequest__data_____1_1request__content____.html#aa3080af499da22a494e6dd32f5e4c7ce">nfs</a>-&gt;<a class="code" href="structnfs__request__data____.html#aa61bc5d11af7e64be2f23a5b2a5ef0da">xprt</a>;
<a name="l01741"></a>01741 
<a name="l01742"></a>01742     stat = SVC_STAT(xprt);
<a name="l01743"></a>01743     svc_dplx_unlock_x(xprt, &amp;pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#a45a5ae3cb189d60666f7cd4e5fc4f8c5">sigmask</a>);
<a name="l01744"></a>01744     *locked = <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01745"></a>01745 
<a name="l01746"></a>01746     <span class="keywordflow">if</span> (stat == XPRT_MOREREQS)
<a name="l01747"></a>01747         try_multi = <a class="code" href="HashTable_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01748"></a>01748 
<a name="l01749"></a>01749 <span class="preprocessor">#if 0 </span><span class="comment">/* XXX */</span>
<a name="l01750"></a>01750     try_multi = <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01751"></a>01751 <span class="preprocessor">#endif</span>
<a name="l01752"></a>01752 <span class="preprocessor"></span>
<a name="l01753"></a>01753     <span class="keywordflow">if</span> (try_multi) {
<a name="l01754"></a>01754         <a class="code" href="nfs__core_8h.html#aedeb70d80a9ebf17cbe388ca69f7c617">process_status_t</a> rc_multi <a class="code" href="group__NFSprocs.html#ga7efec2b565bdbe409979ac657775eeaa">__attribute__</a>((unused));
<a name="l01755"></a>01755         <a class="code" href="structgsh__xprt__private.html">gsh_xprt_private_t</a> *xu;
<a name="l01756"></a>01756         pthread_rwlock_wrlock(&amp;xprt-&gt;lock);
<a name="l01757"></a>01757         xu = (<a class="code" href="structgsh__xprt__private.html">gsh_xprt_private_t</a> *) xprt-&gt;xp_u1;
<a name="l01758"></a>01758 
<a name="l01759"></a>01759         <a class="code" href="log_8h.html#aa7aee8ec65b5baafb430f8d2a7588d53">LogDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>, <span class="stringliteral">&quot;xprt=%p try_multi=TRUE multi_cnt=%u &quot;</span>
<a name="l01760"></a>01760                 <span class="stringliteral">&quot;refcnt=%u&quot;</span>,
<a name="l01761"></a>01761                 xprt,
<a name="l01762"></a>01762                 xu-&gt;<a class="code" href="structgsh__xprt__private.html#ab6936d34c148d54916f3fda1e5353106">multi_cnt</a>,
<a name="l01763"></a>01763                 xu-&gt;<a class="code" href="structgsh__xprt__private.html#a310a0a688bdb102cadc53c3e647de12b">refcnt</a>);
<a name="l01764"></a>01764 
<a name="l01765"></a>01765         <span class="comment">/* we need an atomic total-outstanding counter, check against hiwat */</span>
<a name="l01766"></a>01766         <span class="keywordflow">if</span> (xu-&gt;<a class="code" href="structgsh__xprt__private.html#ab6936d34c148d54916f3fda1e5353106">multi_cnt</a> &lt; <a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#aeef2995e9b54747311db1972d158fd41">core_param</a>.<a class="code" href="structnfs__core__param____.html#a4b2c64a52bfb292789402a55d8788299">dispatch_multi_xprt_max</a>) {
<a name="l01767"></a>01767             ++(xu-&gt;<a class="code" href="structgsh__xprt__private.html#ab6936d34c148d54916f3fda1e5353106">multi_cnt</a>);
<a name="l01768"></a>01768             <span class="comment">/* dispatch it */</span>
<a name="l01769"></a>01769             rc_multi = <a class="code" href="nfs__core_8h.html#aa34937b74ee69aa4806e0a5f8ea34896">dispatch_rpc_subrequest</a>(pmydata, nfsreq);
<a name="l01770"></a>01770             dispatched = <a class="code" href="HashTable_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01771"></a>01771         }
<a name="l01772"></a>01772         pthread_rwlock_unlock(&amp;xprt-&gt;lock);
<a name="l01773"></a>01773     }
<a name="l01774"></a>01774 
<a name="l01775"></a>01775     <span class="keywordflow">if</span> (! dispatched) {
<a name="l01776"></a>01776         <span class="comment">/* Execute it */</span>
<a name="l01777"></a>01777         nfs_rpc_execute(nfsreq, pmydata);
<a name="l01778"></a>01778     }
<a name="l01779"></a>01779 
<a name="l01780"></a>01780     <span class="keywordflow">return</span> (stat);
<a name="l01781"></a>01781 }
<a name="l01782"></a>01782 
<a name="l01788"></a><a class="code" href="nfs__worker__thread_8c.html#aee0fb919ad4f9552e4b6d05da722f5a5">01788</a> <span class="preprocessor">#define DISP_LOCK(x) do { \</span>
<a name="l01789"></a>01789 <span class="preprocessor">    if (! locked) { \</span>
<a name="l01790"></a>01790 <span class="preprocessor">        svc_dplx_lock_x(xprt, &amp;pmydata-&gt;sigmask); \</span>
<a name="l01791"></a>01791 <span class="preprocessor">        locked = TRUE; \</span>
<a name="l01792"></a>01792 <span class="preprocessor">      }\</span>
<a name="l01793"></a>01793 <span class="preprocessor">    } while (0);</span>
<a name="l01794"></a>01794 <span class="preprocessor"></span>
<a name="l01795"></a><a class="code" href="nfs__worker__thread_8c.html#abf7739150019ffed59163df416d585b9">01795</a> <span class="preprocessor">#define DISP_UNLOCK(x) do { \</span>
<a name="l01796"></a>01796 <span class="preprocessor">    if (locked) { \</span>
<a name="l01797"></a>01797 <span class="preprocessor">        svc_dplx_unlock_x(xprt, &amp;pmydata-&gt;sigmask); \</span>
<a name="l01798"></a>01798 <span class="preprocessor">        locked = FALSE; \</span>
<a name="l01799"></a>01799 <span class="preprocessor">      }\</span>
<a name="l01800"></a>01800 <span class="preprocessor">    } while (0);</span>
<a name="l01801"></a>01801 <span class="preprocessor"></span>
<a name="l01802"></a>01802 <a class="code" href="nfs__core_8h.html#aedeb70d80a9ebf17cbe388ca69f7c617">process_status_t</a>
<a name="l01803"></a><a class="code" href="nfs__worker__thread_8c.html#a8801fc33b03d8a513440a0007b71493e">01803</a> <a class="code" href="nfs__worker__thread_8c.html#a8801fc33b03d8a513440a0007b71493e">nfs_worker_process_rpc_requests</a>(<a class="code" href="structnfs__worker__data____.html">nfs_worker_data_t</a> *pmydata,
<a name="l01804"></a>01804                                 <a class="code" href="structrequest__data____.html">request_data_t</a> *nfsreq)
<a name="l01805"></a>01805 {
<a name="l01806"></a>01806   <span class="keyword">enum</span> xprt_stat stat = XPRT_IDLE;
<a name="l01807"></a>01807   <span class="keyword">struct </span>rpc_msg *pmsg;
<a name="l01808"></a>01808   <span class="keyword">struct </span>svc_req *preq;
<a name="l01809"></a>01809   <span class="keyword">const</span> <a class="code" href="structnfs__function__desc____.html">nfs_function_desc_t</a> *pfuncdesc;
<a name="l01810"></a>01810   bool_t no_dispatch = <a class="code" href="HashTable_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, recv_status;
<a name="l01811"></a>01811   <a class="code" href="nfs__core_8h.html#aedeb70d80a9ebf17cbe388ca69f7c617">process_status_t</a> rc = <a class="code" href="nfs__core_8h.html#a85ec14146044508e4f84e2574bd3d73caad7843560a14d24388d6720d4d0d896d">PROCESS_DONE</a>;
<a name="l01812"></a>01812   SVCXPRT *xprt;
<a name="l01813"></a>01813   <span class="keywordtype">bool</span> locked = <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01814"></a>01814 again:
<a name="l01815"></a>01815   <span class="comment">/*</span>
<a name="l01816"></a>01816 <span class="comment">   * Receive from socket.</span>
<a name="l01817"></a>01817 <span class="comment">   * Will block until the client operates on the socket</span>
<a name="l01818"></a>01818 <span class="comment">   */</span>
<a name="l01819"></a>01819   xprt = nfsreq-&gt;<a class="code" href="structrequest__data____.html#a418c071aa5cff12637b7668645e371ba">r_u</a>.<a class="code" href="unionrequest__data_____1_1request__content____.html#aa3080af499da22a494e6dd32f5e4c7ce">nfs</a>-&gt;<a class="code" href="structnfs__request__data____.html#aa61bc5d11af7e64be2f23a5b2a5ef0da">xprt</a>;
<a name="l01820"></a>01820 
<a name="l01821"></a>01821   <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l01822"></a>01822                <span class="stringliteral">&quot;Before calling SVC_RECV on socket %d&quot;</span>,
<a name="l01823"></a>01823                xprt-&gt;xp_fd);
<a name="l01824"></a>01824 
<a name="l01825"></a>01825   rc = <a class="code" href="nfs__core_8h.html#a85ec14146044508e4f84e2574bd3d73caad7843560a14d24388d6720d4d0d896d">PROCESS_DONE</a>;
<a name="l01826"></a>01826 
<a name="l01827"></a>01827   preq = &amp;nfsreq-&gt;<a class="code" href="structrequest__data____.html#a418c071aa5cff12637b7668645e371ba">r_u</a>.<a class="code" href="unionrequest__data_____1_1request__content____.html#aa3080af499da22a494e6dd32f5e4c7ce">nfs</a>-&gt;<a class="code" href="structnfs__request__data____.html#afddd6756b9d7c6c4e6ab81c7d79ac4a0">req</a>;
<a name="l01828"></a>01828   pmsg = &amp;nfsreq-&gt;<a class="code" href="structrequest__data____.html#a418c071aa5cff12637b7668645e371ba">r_u</a>.<a class="code" href="unionrequest__data_____1_1request__content____.html#aa3080af499da22a494e6dd32f5e4c7ce">nfs</a>-&gt;<a class="code" href="structnfs__request__data____.html#a21979ea41fa09472ae4236019dfd1823">msg</a>;
<a name="l01829"></a>01829 
<a name="l01830"></a>01830   <a class="code" href="nfs__worker__thread_8c.html#aee0fb919ad4f9552e4b6d05da722f5a5">DISP_LOCK</a>(xprt);
<a name="l01831"></a>01831   recv_status = SVC_RECV(xprt, pmsg);
<a name="l01832"></a>01832 
<a name="l01833"></a>01833   <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l01834"></a>01834                <span class="stringliteral">&quot;Status for SVC_RECV on socket %d is %d, xid=%lu&quot;</span>,
<a name="l01835"></a>01835                xprt-&gt;xp_fd,
<a name="l01836"></a>01836                recv_status,
<a name="l01837"></a>01837                (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)pmsg-&gt;rm_xid);
<a name="l01838"></a>01838 
<a name="l01839"></a>01839   <span class="comment">/* If status is ok, the request will be processed by the related</span>
<a name="l01840"></a>01840 <span class="comment">   * worker, otherwise, it should be released by being tagged as invalid. */</span>
<a name="l01841"></a>01841   <span class="keywordflow">if</span> (!recv_status)
<a name="l01842"></a>01842     {
<a name="l01843"></a>01843       <span class="comment">/* RPC over TCP specific: RPC/UDP&#39;s xprt know only one state: XPRT_IDLE,</span>
<a name="l01844"></a>01844 <span class="comment">       * because UDP is mostly a stateless protocol.  With RPC/TCP, they can be</span>
<a name="l01845"></a>01845 <span class="comment">       * XPRT_DIED especially when the client closes the peer&#39;s socket. We</span>
<a name="l01846"></a>01846 <span class="comment">       * have to cope with this aspect in the next lines.  Finally, xdrrec</span>
<a name="l01847"></a>01847 <span class="comment">       * uses XPRT_MOREREQS to indicate that additional records are ready to</span>
<a name="l01848"></a>01848 <span class="comment">       * be consumed immediately. */</span>
<a name="l01849"></a>01849 
<a name="l01850"></a>01850         <span class="comment">/* XXXX */</span>
<a name="l01851"></a>01851       <a class="code" href="ganesha__rpc_8h.html#a42f3261a45141da24a6d18194eae1c91">sockaddr_t</a> addr;
<a name="l01852"></a>01852       <span class="keywordtype">char</span> addrbuf[<a class="code" href="ganesha__rpc_8h.html#a9174d973fdbe2abdc1987d702b5b7d1a">SOCK_NAME_MAX</a>];
<a name="l01853"></a>01853 
<a name="l01854"></a>01854       <span class="keywordflow">if</span>(<a class="code" href="ganesha__rpc_8h.html#ac79de7952a084c98f9dfeba5e1ac0556">copy_xprt_addr</a>(&amp;addr, xprt) == 1)
<a name="l01855"></a>01855         <a class="code" href="ganesha__rpc_8h.html#a798e3040dc5734e965e36b405958f984">sprint_sockaddr</a>(&amp;addr, addrbuf, <span class="keyword">sizeof</span>(addrbuf));
<a name="l01856"></a>01856       <span class="keywordflow">else</span>
<a name="l01857"></a>01857         sprintf(addrbuf, <span class="stringliteral">&quot;&lt;unresolved&gt;&quot;</span>);
<a name="l01858"></a>01858 
<a name="l01859"></a>01859       stat = SVC_STAT(xprt);
<a name="l01860"></a>01860       <a class="code" href="nfs__worker__thread_8c.html#abf7739150019ffed59163df416d585b9">DISP_UNLOCK</a>(xprt);
<a name="l01861"></a>01861 
<a name="l01862"></a>01862       <span class="keywordflow">if</span>(stat == XPRT_DIED)
<a name="l01863"></a>01863         {
<a name="l01864"></a>01864 
<a name="l01865"></a>01865           <a class="code" href="log_8h.html#aa7aee8ec65b5baafb430f8d2a7588d53">LogDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l01866"></a>01866                    <span class="stringliteral">&quot;Client on socket=%d, addr=%s disappeared...&quot;</span>,
<a name="l01867"></a>01867                    xprt-&gt;xp_fd, addrbuf);
<a name="l01868"></a>01868           <a class="code" href="nfs__worker__thread_8c.html#aee0fb919ad4f9552e4b6d05da722f5a5">DISP_LOCK</a>(xprt);
<a name="l01869"></a>01869           gsh_xprt_destroy(xprt);
<a name="l01870"></a>01870           rc = <a class="code" href="nfs__core_8h.html#a85ec14146044508e4f84e2574bd3d73ca965fb82ae0fd31a939291f853a5b080f">PROCESS_LOST_CONN</a>;
<a name="l01871"></a>01871         }
<a name="l01872"></a>01872       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(stat == XPRT_MOREREQS)
<a name="l01873"></a>01873         {
<a name="l01874"></a>01874           <span class="comment">/* unexpected case */</span>
<a name="l01875"></a>01875           <a class="code" href="log_8h.html#aa7aee8ec65b5baafb430f8d2a7588d53">LogDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l01876"></a>01876                    <span class="stringliteral">&quot;Client on socket=%d, addr=%s has status XPRT_MOREREQS&quot;</span>,
<a name="l01877"></a>01877                    xprt-&gt;xp_fd, addrbuf);
<a name="l01878"></a>01878         }
<a name="l01879"></a>01879       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(stat == XPRT_IDLE)
<a name="l01880"></a>01880         {
<a name="l01881"></a>01881           <a class="code" href="log_8h.html#aa7aee8ec65b5baafb430f8d2a7588d53">LogDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l01882"></a>01882                    <span class="stringliteral">&quot;Client on socket=%d, addr=%s has status XPRT_IDLE&quot;</span>,
<a name="l01883"></a>01883                    xprt-&gt;xp_fd, addrbuf);
<a name="l01884"></a>01884         }
<a name="l01885"></a>01885       <span class="keywordflow">else</span>
<a name="l01886"></a>01886         {
<a name="l01887"></a>01887           <a class="code" href="log_8h.html#aa7aee8ec65b5baafb430f8d2a7588d53">LogDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l01888"></a>01888                    <span class="stringliteral">&quot;Client on socket=%d, addr=%s has status unknown (%d)&quot;</span>,
<a name="l01889"></a>01889                    xprt-&gt;xp_fd, addrbuf, (<span class="keywordtype">int</span>)stat);
<a name="l01890"></a>01890         }
<a name="l01891"></a>01891       <span class="keywordflow">goto</span> unblock;
<a name="l01892"></a>01892     }
<a name="l01893"></a>01893   <span class="keywordflow">else</span>
<a name="l01894"></a>01894     {
<a name="l01895"></a>01895       nfsreq-&gt;<a class="code" href="structrequest__data____.html#a418c071aa5cff12637b7668645e371ba">r_u</a>.<a class="code" href="unionrequest__data_____1_1request__content____.html#aa3080af499da22a494e6dd32f5e4c7ce">nfs</a>-&gt;<a class="code" href="structnfs__request__data____.html#afddd6756b9d7c6c4e6ab81c7d79ac4a0">req</a>.rq_prog = pmsg-&gt;rm_call.cb_prog;
<a name="l01896"></a>01896       nfsreq-&gt;<a class="code" href="structrequest__data____.html#a418c071aa5cff12637b7668645e371ba">r_u</a>.<a class="code" href="unionrequest__data_____1_1request__content____.html#aa3080af499da22a494e6dd32f5e4c7ce">nfs</a>-&gt;<a class="code" href="structnfs__request__data____.html#afddd6756b9d7c6c4e6ab81c7d79ac4a0">req</a>.rq_vers = pmsg-&gt;rm_call.cb_vers;
<a name="l01897"></a>01897       nfsreq-&gt;<a class="code" href="structrequest__data____.html#a418c071aa5cff12637b7668645e371ba">r_u</a>.<a class="code" href="unionrequest__data_____1_1request__content____.html#aa3080af499da22a494e6dd32f5e4c7ce">nfs</a>-&gt;<a class="code" href="structnfs__request__data____.html#afddd6756b9d7c6c4e6ab81c7d79ac4a0">req</a>.rq_proc = pmsg-&gt;rm_call.cb_proc;
<a name="l01898"></a>01898       nfsreq-&gt;<a class="code" href="structrequest__data____.html#a418c071aa5cff12637b7668645e371ba">r_u</a>.<a class="code" href="unionrequest__data_____1_1request__content____.html#aa3080af499da22a494e6dd32f5e4c7ce">nfs</a>-&gt;<a class="code" href="structnfs__request__data____.html#afddd6756b9d7c6c4e6ab81c7d79ac4a0">req</a>.rq_xid = pmsg-&gt;rm_xid;
<a name="l01899"></a>01899 
<a name="l01900"></a>01900       pfuncdesc = <a class="code" href="nfs__core_8h.html#aeba106915769b419aebf2f3ab19b654a">nfs_rpc_get_funcdesc</a>(nfsreq-&gt;<a class="code" href="structrequest__data____.html#a418c071aa5cff12637b7668645e371ba">r_u</a>.<a class="code" href="unionrequest__data_____1_1request__content____.html#aa3080af499da22a494e6dd32f5e4c7ce">nfs</a>);
<a name="l01901"></a>01901       <span class="keywordflow">if</span>(pfuncdesc == INVALID_FUNCDESC)
<a name="l01902"></a>01902           <span class="keywordflow">goto</span> unblock;
<a name="l01903"></a>01903 
<a name="l01904"></a>01904       <a class="code" href="nfs__worker__thread_8c.html#aee0fb919ad4f9552e4b6d05da722f5a5">DISP_LOCK</a>(xprt);
<a name="l01905"></a>01905       <span class="keywordflow">if</span>(<a class="code" href="nfs__core_8h.html#a9aec01d1a440be7479b35dff66a6fcb5">AuthenticateRequest</a>(nfsreq-&gt;<a class="code" href="structrequest__data____.html#a418c071aa5cff12637b7668645e371ba">r_u</a>.<a class="code" href="unionrequest__data_____1_1request__content____.html#aa3080af499da22a494e6dd32f5e4c7ce">nfs</a>,
<a name="l01906"></a>01906                              &amp;no_dispatch) != AUTH_OK || no_dispatch) {
<a name="l01907"></a>01907           <span class="keywordflow">goto</span> unblock;
<a name="l01908"></a>01908       }
<a name="l01909"></a>01909 
<a name="l01910"></a>01910       <span class="keywordflow">if</span>(!<a class="code" href="nfs__core_8h.html#a77e8f030d1fde829450a2c9fc196362d">nfs_rpc_get_args</a>(nfsreq-&gt;<a class="code" href="structrequest__data____.html#a418c071aa5cff12637b7668645e371ba">r_u</a>.<a class="code" href="unionrequest__data_____1_1request__content____.html#aa3080af499da22a494e6dd32f5e4c7ce">nfs</a>, pfuncdesc))
<a name="l01911"></a>01911           <span class="keywordflow">goto</span> unblock;
<a name="l01912"></a>01912 
<a name="l01913"></a>01913       preq-&gt;rq_xprt = xprt;
<a name="l01914"></a>01914 
<a name="l01915"></a>01915       <span class="comment">/* Validate the rpc request as being a valid program, version,</span>
<a name="l01916"></a>01916 <span class="comment">       * and proc. If not, report the error. Otherwise, execute the</span>
<a name="l01917"></a>01917 <span class="comment">       * funtion. */</span>
<a name="l01918"></a>01918       <span class="keywordflow">if</span>(<a class="code" href="nfs__worker__thread_8c.html#a4fd1c8c2a69cec20ceec98348a679f34">is_rpc_call_valid</a>(preq-&gt;rq_xprt, preq) == <a class="code" href="HashTable_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>)
<a name="l01919"></a>01919           stat = cond_multi_dispatch(pmydata, nfsreq, &amp;locked);
<a name="l01920"></a>01920 
<a name="l01921"></a>01921       rc = <a class="code" href="nfs__core_8h.html#a85ec14146044508e4f84e2574bd3d73ca73e7ffd42db53177bb8a1f8b31a02958">PROCESS_DISPATCHED</a>;
<a name="l01922"></a>01922     }
<a name="l01923"></a>01923 
<a name="l01924"></a>01924 unblock:
<a name="l01925"></a>01925   <span class="comment">/* continue receiving if data is available--this isn&#39;t optional, because</span>
<a name="l01926"></a>01926 <span class="comment">   * irrespective of TI-RPC &quot;nonblock&quot; mode, we will frequently have consumed</span>
<a name="l01927"></a>01927 <span class="comment">   * additional RPC records (TCP).  Also, we expect to move the SVC_RECV</span>
<a name="l01928"></a>01928 <span class="comment">   * into the worker thread, so this will asynchronous wrt to the shared</span>
<a name="l01929"></a>01929 <span class="comment">   * event loop */</span>
<a name="l01930"></a>01930   <span class="keywordflow">if</span> (rc == <a class="code" href="nfs__core_8h.html#a85ec14146044508e4f84e2574bd3d73ca73e7ffd42db53177bb8a1f8b31a02958">PROCESS_DISPATCHED</a>) {
<a name="l01931"></a>01931       <span class="keywordflow">if</span> (stat == XPRT_MOREREQS)
<a name="l01932"></a>01932           <span class="keywordflow">goto</span> again;
<a name="l01933"></a>01933       <span class="keywordflow">else</span> {
<a name="l01934"></a>01934           <span class="comment">/* XXX dont bother re-arming epoll for xprt if there is data </span>
<a name="l01935"></a>01935 <span class="comment">           * waiting */</span>
<a name="l01936"></a>01936           <span class="keyword">struct </span>pollfd fd;
<a name="l01937"></a>01937           fd.fd = xprt-&gt;xp_fd;
<a name="l01938"></a>01938           fd.events = POLLIN;
<a name="l01939"></a>01939           <span class="keywordflow">if</span> (poll(&amp;fd, 1, 0 <span class="comment">/* ms, ie, now */</span>) &gt; 0)
<a name="l01940"></a>01940               <span class="keywordflow">goto</span> again;
<a name="l01941"></a>01941       }
<a name="l01942"></a>01942   }
<a name="l01943"></a>01943 
<a name="l01944"></a>01944   <a class="code" href="nfs__worker__thread_8c.html#abf7739150019ffed59163df416d585b9">DISP_UNLOCK</a>(xprt);
<a name="l01945"></a>01945 
<a name="l01946"></a>01946   <span class="keywordflow">if</span> (rc != <a class="code" href="nfs__core_8h.html#a85ec14146044508e4f84e2574bd3d73ca965fb82ae0fd31a939291f853a5b080f">PROCESS_LOST_CONN</a>)
<a name="l01947"></a>01947       (void) svc_rqst_unblock_events(nfsreq-&gt;<a class="code" href="structrequest__data____.html#a418c071aa5cff12637b7668645e371ba">r_u</a>.<a class="code" href="unionrequest__data_____1_1request__content____.html#aa3080af499da22a494e6dd32f5e4c7ce">nfs</a>-&gt;<a class="code" href="structnfs__request__data____.html#aa61bc5d11af7e64be2f23a5b2a5ef0da">xprt</a>,
<a name="l01948"></a>01948                                      SVC_RQST_FLAG_NONE);
<a name="l01949"></a>01949 
<a name="l01950"></a>01950   <span class="keywordflow">return</span> (rc);
<a name="l01951"></a>01951 }
<a name="l01952"></a>01952 
<a name="l01966"></a><a class="code" href="nfs__worker__thread_8c.html#a41686d8afdef1000024e8a353076b3fe">01966</a> <span class="keywordtype">void</span> *<a class="code" href="nfs__core_8h.html#a41686d8afdef1000024e8a353076b3fe">worker_thread</a>(<span class="keywordtype">void</span> *IndexArg)
<a name="l01967"></a>01967 {
<a name="l01968"></a>01968   <a class="code" href="structrequest__data____.html">request_data_t</a> *nfsreq;
<a name="l01969"></a>01969   <span class="keywordtype">int</span> rc = 0;
<a name="l01970"></a>01970   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> gc_allowed = <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l01971"></a>01971   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> worker_index = (<span class="keywordtype">unsigned</span> long) IndexArg;
<a name="l01972"></a>01972   <a class="code" href="structnfs__worker__data____.html">nfs_worker_data_t</a> *pmydata = &amp;(workers_data[worker_index]);
<a name="l01973"></a>01973   <span class="keywordtype">char</span> thr_name[32];
<a name="l01974"></a>01974   <a class="code" href="structgsh__xprt__private.html">gsh_xprt_private_t</a> *xu = <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01975"></a>01975 
<a name="l01976"></a>01976 <span class="preprocessor">#ifdef _USE_SHARED_FSAL</span>
<a name="l01977"></a>01977 <span class="preprocessor"></span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0 ;
<a name="l01978"></a>01978   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fsalid = 0 ;
<a name="l01979"></a>01979 <span class="preprocessor">#endif</span>
<a name="l01980"></a>01980 <span class="preprocessor"></span>
<a name="l01981"></a>01981   snprintf(thr_name, <span class="keyword">sizeof</span>(thr_name), <span class="stringliteral">&quot;Worker Thread #%lu&quot;</span>, worker_index);
<a name="l01982"></a>01982   <a class="code" href="log_8h.html#aca6ef6a917e3178e7d309664cb668bec">SetNameFunction</a>(thr_name);
<a name="l01983"></a>01983 
<a name="l01984"></a>01984   <span class="comment">/* save current signal mask */</span>
<a name="l01985"></a>01985   rc = pthread_sigmask(SIG_SETMASK, (sigset_t *) 0, &amp;pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#a45a5ae3cb189d60666f7cd4e5fc4f8c5">sigmask</a>);
<a name="l01986"></a>01986   <span class="keywordflow">if</span> (rc) {
<a name="l01987"></a>01987       <a class="code" href="log_8h.html#a4566d092fb3fb47391fec6b878e8aa7b">LogFatal</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l01988"></a>01988                <span class="stringliteral">&quot;pthread_sigmask returned %d&quot;</span>, rc);
<a name="l01989"></a>01989   }
<a name="l01990"></a>01990 
<a name="l01991"></a>01991   <span class="keywordflow">if</span>(<a class="code" href="nfs__tcb_8h.html#afa3ca3e05800e03fba452d09fa54b0c1">mark_thread_existing</a>(&amp;(pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#afee6ba7633212a86680a5b141b45267c">wcb</a>)) == <a class="code" href="nfs__core_8h.html#a4af359b26b6ae1a8a8ba5251c68f0088a76e4de3f46d3338f8d844de27ae3b0b1">PAUSE_EXIT</a>)
<a name="l01992"></a>01992     {
<a name="l01993"></a>01993       <span class="comment">/* Oops, that didn&#39;t last long... exit. */</span>
<a name="l01994"></a>01994       <a class="code" href="nfs__tcb_8h.html#af0e23832992ff6cbb2c234f125e4198e">mark_thread_done</a>(&amp;(pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#afee6ba7633212a86680a5b141b45267c">wcb</a>));
<a name="l01995"></a>01995       <a class="code" href="log_8h.html#aa7aee8ec65b5baafb430f8d2a7588d53">LogDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l01996"></a>01996                <span class="stringliteral">&quot;Worker exiting before initialization&quot;</span>);
<a name="l01997"></a>01997       <span class="keywordflow">return</span> <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01998"></a>01998     }
<a name="l01999"></a>01999 
<a name="l02000"></a>02000   <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l02001"></a>02001                <span class="stringliteral">&quot;Starting, pending=%d&quot;</span>, pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#af3c93c9919145a7078b195fa72bc9bd6">pending_request_len</a>);
<a name="l02002"></a>02002 
<a name="l02003"></a>02003   <a class="code" href="log_8h.html#aa7aee8ec65b5baafb430f8d2a7588d53">LogDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>, <span class="stringliteral">&quot;NFS WORKER #%lu: my pthread id is %p&quot;</span>,
<a name="l02004"></a>02004            worker_index, (caddr_t) pthread_self());
<a name="l02005"></a>02005 
<a name="l02006"></a>02006   <span class="comment">/* Initialisation of credential for current thread */</span>
<a name="l02007"></a>02007   <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l02008"></a>02008                <span class="stringliteral">&quot;NFS WORKER #%lu: Initialization of thread&#39;s credential&quot;</span>,
<a name="l02009"></a>02009                worker_index);
<a name="l02010"></a>02010 
<a name="l02011"></a>02011   <span class="keywordflow">if</span>(<a class="code" href="fsal_8h.html#a7c2a97ec2fa552dea8e497c7dd8a2b86">FSAL_IS_ERROR</a>(<a class="code" href="fsal__glue_8c.html#a9f4ac7f916d29b4a28556332e735143c">FSAL_InitClientContext</a>(&amp;pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#afa0bb09f4f079b89459660b0f526a6b3">thread_fsal_context</a>)))
<a name="l02012"></a>02012     {
<a name="l02013"></a>02013       <span class="comment">/* Failed init */</span>
<a name="l02014"></a>02014       <a class="code" href="log_8h.html#a4566d092fb3fb47391fec6b878e8aa7b">LogFatal</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l02015"></a>02015                <span class="stringliteral">&quot;Error initializing thread&#39;s credential&quot;</span>);
<a name="l02016"></a>02016     }
<a name="l02017"></a>02017 
<a name="l02018"></a>02018   <a class="code" href="log_8h.html#a12ce2d8580101872ee848b50b59252ae">LogInfo</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>, <span class="stringliteral">&quot;Worker successfully initialized&quot;</span>);
<a name="l02019"></a>02019 
<a name="l02020"></a>02020   <span class="comment">/* Worker&#39;s infinite loop */</span>
<a name="l02021"></a>02021   <span class="keywordflow">while</span>(1)
<a name="l02022"></a>02022     {
<a name="l02023"></a>02023       <span class="comment">/* update memory and FSAL stats,</span>
<a name="l02024"></a>02024 <span class="comment">       * twice often than stats display.</span>
<a name="l02025"></a>02025 <span class="comment">       */</span>
<a name="l02026"></a>02026       <span class="keywordflow">if</span>(time(<a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) - pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#af8c55be2a9a2d1a570e746342d81589c">stats</a>.<a class="code" href="structnfs__worker__stat____.html#a7e9fa4476696e15197aa2f2ef4c17996">last_stat_update</a> &gt;
<a name="l02027"></a>02027          (<span class="keywordtype">int</span>)<a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#aeef2995e9b54747311db1972d158fd41">core_param</a>.<a class="code" href="structnfs__core__param____.html#a8bf18791d78c55156e4900cd7d05a581">stats_update_delay</a> / 2)
<a name="l02028"></a>02028         {
<a name="l02029"></a>02029 
<a name="l02030"></a>02030           <a class="code" href="fsal__glue_8c.html#a53090fb7553dff52c8eb452df2b62fe9">FSAL_get_stats</a>(&amp;pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#af8c55be2a9a2d1a570e746342d81589c">stats</a>.<a class="code" href="structnfs__worker__stat____.html#a9e798a3fbb3b380968497517ad5ee5bc">fsal_stats</a>, <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l02031"></a>02031 
<a name="l02032"></a>02032           <span class="comment">/* reset last stat */</span>
<a name="l02033"></a>02033           pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#af8c55be2a9a2d1a570e746342d81589c">stats</a>.<a class="code" href="structnfs__worker__stat____.html#a7e9fa4476696e15197aa2f2ef4c17996">last_stat_update</a> = time(<a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l02034"></a>02034         }
<a name="l02035"></a>02035 
<a name="l02036"></a>02036       <span class="comment">/* Wait on condition variable for work to be done */</span>
<a name="l02037"></a>02037       <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l02038"></a>02038                    <span class="stringliteral">&quot;waiting for requests to process, pending=%d&quot;</span>,
<a name="l02039"></a>02039                    pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#af3c93c9919145a7078b195fa72bc9bd6">pending_request_len</a>);
<a name="l02040"></a>02040 
<a name="l02041"></a>02041       <span class="comment">/* Get the state without lock first, if things are fine</span>
<a name="l02042"></a>02042 <span class="comment">       * don&#39;t bother to check under lock.</span>
<a name="l02043"></a>02043 <span class="comment">       */</span>
<a name="l02044"></a>02044       <span class="keywordflow">if</span>((pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#afee6ba7633212a86680a5b141b45267c">wcb</a>.<a class="code" href="structnfs__thread__control__block____.html#a8e5e3aff42f8a45404649f1176448a0c">tcb_state</a> != <a class="code" href="nfs__core_8h.html#a9042b784aff5dfd284f96043b13eeeb8a2ba89c4b960e927feb07e6087b6338bd">STATE_AWAKE</a>) ||
<a name="l02045"></a>02045           (pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#af3c93c9919145a7078b195fa72bc9bd6">pending_request_len</a> == 0)) {
<a name="l02046"></a>02046           <span class="keywordflow">while</span>(1)
<a name="l02047"></a>02047             {
<a name="l02048"></a>02048               <a class="code" href="common__utils_8h.html#a13190861330e48fe885da6b2671876a9">P</a>(pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#afee6ba7633212a86680a5b141b45267c">wcb</a>.<a class="code" href="structnfs__thread__control__block____.html#a62e5785a1ec77581e678f13e84a5dd97">tcb_mutex</a>);
<a name="l02049"></a>02049               <span class="keywordflow">if</span>(pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#afee6ba7633212a86680a5b141b45267c">wcb</a>.<a class="code" href="structnfs__thread__control__block____.html#a8e5e3aff42f8a45404649f1176448a0c">tcb_state</a> == <a class="code" href="nfs__core_8h.html#a9042b784aff5dfd284f96043b13eeeb8a2ba89c4b960e927feb07e6087b6338bd">STATE_AWAKE</a> &amp;&amp;
<a name="l02050"></a>02050                  (pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#af3c93c9919145a7078b195fa72bc9bd6">pending_request_len</a> != 0)) {
<a name="l02051"></a>02051                   <a class="code" href="common__utils_8h.html#a5a9b6f8030959507eee365b226d63b00">V</a>(pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#afee6ba7633212a86680a5b141b45267c">wcb</a>.<a class="code" href="structnfs__thread__control__block____.html#a62e5785a1ec77581e678f13e84a5dd97">tcb_mutex</a>);
<a name="l02052"></a>02052                   <span class="keywordflow">break</span>;
<a name="l02053"></a>02053                 }
<a name="l02054"></a>02054               <span class="keywordflow">switch</span>(<a class="code" href="nfs__tcb_8h.html#a782b987cbb2c71f880082fc33d3e862b">thread_sm_locked</a>(&amp;pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#afee6ba7633212a86680a5b141b45267c">wcb</a>))
<a name="l02055"></a>02055                 {
<a name="l02056"></a>02056                   <span class="keywordflow">case</span> <a class="code" href="nfs__tcb_8h.html#a40a9b7bec6bd1585e6c7149c3393f2aaa413c6d22c2b9f9b2f3097ed88c01cb56">THREAD_SM_RECHECK</a>:
<a name="l02057"></a>02057                     <a class="code" href="common__utils_8h.html#a5a9b6f8030959507eee365b226d63b00">V</a>(pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#afee6ba7633212a86680a5b141b45267c">wcb</a>.<a class="code" href="structnfs__thread__control__block____.html#a62e5785a1ec77581e678f13e84a5dd97">tcb_mutex</a>);
<a name="l02058"></a>02058                     <span class="keywordflow">continue</span>;
<a name="l02059"></a>02059 
<a name="l02060"></a>02060                   <span class="keywordflow">case</span> <a class="code" href="nfs__tcb_8h.html#a40a9b7bec6bd1585e6c7149c3393f2aaae4487301a873ae32394e52adf8362c6b">THREAD_SM_BREAK</a>:
<a name="l02061"></a>02061                     <span class="keywordflow">if</span>(pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#af3c93c9919145a7078b195fa72bc9bd6">pending_request_len</a> == 0) {
<a name="l02062"></a>02062                         <span class="comment">/* No work; wait */</span>
<a name="l02063"></a>02063                         pthread_cond_wait(&amp;(pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#afee6ba7633212a86680a5b141b45267c">wcb</a>.<a class="code" href="structnfs__thread__control__block____.html#a2b79af4a1f8846233efd9e87309c947b">tcb_condvar</a>),
<a name="l02064"></a>02064                                           &amp;(pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#afee6ba7633212a86680a5b141b45267c">wcb</a>.<a class="code" href="structnfs__thread__control__block____.html#a62e5785a1ec77581e678f13e84a5dd97">tcb_mutex</a>));
<a name="l02065"></a>02065                         <a class="code" href="common__utils_8h.html#a5a9b6f8030959507eee365b226d63b00">V</a>(pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#afee6ba7633212a86680a5b141b45267c">wcb</a>.<a class="code" href="structnfs__thread__control__block____.html#a62e5785a1ec77581e678f13e84a5dd97">tcb_mutex</a>);
<a name="l02066"></a>02066                         <span class="keywordflow">continue</span>;
<a name="l02067"></a>02067                       }
<a name="l02068"></a>02068 
<a name="l02069"></a>02069                   <span class="keywordflow">case</span> <a class="code" href="nfs__tcb_8h.html#a40a9b7bec6bd1585e6c7149c3393f2aaa1cd16206e3eb784012cc5da68e588d6d">THREAD_SM_EXIT</a>:
<a name="l02070"></a>02070                     <a class="code" href="log_8h.html#aa7aee8ec65b5baafb430f8d2a7588d53">LogDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>, <span class="stringliteral">&quot;Worker exiting as requested&quot;</span>);
<a name="l02071"></a>02071                     <a class="code" href="common__utils_8h.html#a5a9b6f8030959507eee365b226d63b00">V</a>(pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#afee6ba7633212a86680a5b141b45267c">wcb</a>.<a class="code" href="structnfs__thread__control__block____.html#a62e5785a1ec77581e678f13e84a5dd97">tcb_mutex</a>);
<a name="l02072"></a>02072                     <span class="keywordflow">return</span> <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02073"></a>02073                 }
<a name="l02074"></a>02074             }
<a name="l02075"></a>02075         }
<a name="l02076"></a>02076 
<a name="l02077"></a>02077       <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l02078"></a>02078                    <span class="stringliteral">&quot;Processing a new request, pause_state: %s, pending=%u&quot;</span>,
<a name="l02079"></a>02079                    pause_state_str[pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#afee6ba7633212a86680a5b141b45267c">wcb</a>.<a class="code" href="structnfs__thread__control__block____.html#a8e5e3aff42f8a45404649f1176448a0c">tcb_state</a>],
<a name="l02080"></a>02080                    pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#af3c93c9919145a7078b195fa72bc9bd6">pending_request_len</a>);
<a name="l02081"></a>02081 
<a name="l02082"></a>02082       <a class="code" href="common__utils_8h.html#a13190861330e48fe885da6b2671876a9">P</a>(pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#a49237115e9ea710e3544e238236344bf">request_pool_mutex</a>);
<a name="l02083"></a>02083       nfsreq = <a class="code" href="nlm__list_8h.html#a8485362f3c7549aa03d4b417003ffed3">glist_first_entry</a>(&amp;pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#a271303e56c35c8d0f0f478c3dcbe5e12">pending_request</a>, <a class="code" href="structrequest__data____.html">request_data_t</a>,
<a name="l02084"></a>02084                                   pending_req_queue);
<a name="l02085"></a>02085       <span class="keywordflow">if</span> (nfsreq == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l02086"></a>02086         <a class="code" href="common__utils_8h.html#a5a9b6f8030959507eee365b226d63b00">V</a>(pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#a49237115e9ea710e3544e238236344bf">request_pool_mutex</a>);
<a name="l02087"></a>02087         <a class="code" href="log_8h.html#a3cf3c22fac6bb9871e25007551caeb13">LogMajor</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>, <span class="stringliteral">&quot;No pending request available&quot;</span>);
<a name="l02088"></a>02088         <span class="keywordflow">continue</span>;             <span class="comment">/* return to main loop */</span>
<a name="l02089"></a>02089       }
<a name="l02090"></a>02090       glist_del(&amp;nfsreq-&gt;<a class="code" href="structrequest__data____.html#af325af5e46693449aced00a7c58f03df">pending_req_queue</a>);
<a name="l02091"></a>02091       pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#af3c93c9919145a7078b195fa72bc9bd6">pending_request_len</a>--;
<a name="l02092"></a>02092       <a class="code" href="common__utils_8h.html#a5a9b6f8030959507eee365b226d63b00">V</a>(pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#a49237115e9ea710e3544e238236344bf">request_pool_mutex</a>);
<a name="l02093"></a>02093 
<a name="l02094"></a>02094       <span class="comment">/* Check for destroyed xprts */</span>
<a name="l02095"></a>02095       <span class="keywordflow">switch</span>(nfsreq-&gt;<a class="code" href="structrequest__data____.html#a8cf32a1a85150da63fc542b7806d95ac">rtype</a>) {
<a name="l02096"></a>02096       <span class="keywordflow">case</span> <a class="code" href="nfs__core_8h.html#a1d4f2ab85979b1e390d2527d1fd7f0cda315ac8a1c1b06ce7da659c5ed3871734">NFS_REQUEST_LEADER</a>:
<a name="l02097"></a>02097       <span class="keywordflow">case</span> <a class="code" href="nfs__core_8h.html#a1d4f2ab85979b1e390d2527d1fd7f0cda96f7a7d009b8f5eed8158f4f2d1d4fe1">NFS_REQUEST</a>:
<a name="l02098"></a>02098           xu = (<a class="code" href="structgsh__xprt__private.html">gsh_xprt_private_t</a> *) nfsreq-&gt;<a class="code" href="structrequest__data____.html#a418c071aa5cff12637b7668645e371ba">r_u</a>.<a class="code" href="unionrequest__data_____1_1request__content____.html#aa3080af499da22a494e6dd32f5e4c7ce">nfs</a>-&gt;<a class="code" href="structnfs__request__data____.html#aa61bc5d11af7e64be2f23a5b2a5ef0da">xprt</a>-&gt;xp_u1;
<a name="l02099"></a>02099           pthread_rwlock_rdlock(&amp;nfsreq-&gt;<a class="code" href="structrequest__data____.html#a418c071aa5cff12637b7668645e371ba">r_u</a>.<a class="code" href="unionrequest__data_____1_1request__content____.html#aa3080af499da22a494e6dd32f5e4c7ce">nfs</a>-&gt;<a class="code" href="structnfs__request__data____.html#aa61bc5d11af7e64be2f23a5b2a5ef0da">xprt</a>-&gt;lock);
<a name="l02100"></a>02100           <span class="keywordflow">if</span> (xu-&gt;<a class="code" href="structgsh__xprt__private.html#a03bde622ba7eaa2f47d4ce77a649b4f5">flags</a> &amp; <a class="code" href="ganesha__rpc_8h.html#adbbe2331365e502fd02585d57a6848a8">XPRT_PRIVATE_FLAG_DESTROYED</a>) {
<a name="l02101"></a>02101               pthread_rwlock_unlock(&amp;nfsreq-&gt;<a class="code" href="structrequest__data____.html#a418c071aa5cff12637b7668645e371ba">r_u</a>.<a class="code" href="unionrequest__data_____1_1request__content____.html#aa3080af499da22a494e6dd32f5e4c7ce">nfs</a>-&gt;<a class="code" href="structnfs__request__data____.html#aa61bc5d11af7e64be2f23a5b2a5ef0da">xprt</a>-&gt;lock);
<a name="l02102"></a>02102               <span class="keywordflow">goto</span> finalize_req;
<a name="l02103"></a>02103           }
<a name="l02104"></a>02104           pthread_rwlock_unlock(&amp;nfsreq-&gt;<a class="code" href="structrequest__data____.html#a418c071aa5cff12637b7668645e371ba">r_u</a>.<a class="code" href="unionrequest__data_____1_1request__content____.html#aa3080af499da22a494e6dd32f5e4c7ce">nfs</a>-&gt;<a class="code" href="structnfs__request__data____.html#aa61bc5d11af7e64be2f23a5b2a5ef0da">xprt</a>-&gt;lock);
<a name="l02105"></a>02105           <span class="keywordflow">break</span>;
<a name="l02106"></a>02106       <span class="keywordflow">default</span>:
<a name="l02107"></a>02107           <span class="keywordflow">break</span>;
<a name="l02108"></a>02108       }
<a name="l02109"></a>02109 
<a name="l02110"></a>02110       <span class="keywordflow">switch</span>(nfsreq-&gt;<a class="code" href="structrequest__data____.html#a8cf32a1a85150da63fc542b7806d95ac">rtype</a>)
<a name="l02111"></a>02111        {
<a name="l02112"></a>02112           <span class="keywordflow">case</span> <a class="code" href="nfs__core_8h.html#a1d4f2ab85979b1e390d2527d1fd7f0cda315ac8a1c1b06ce7da659c5ed3871734">NFS_REQUEST_LEADER</a>:
<a name="l02113"></a>02113               <a class="code" href="log_8h.html#aa7aee8ec65b5baafb430f8d2a7588d53">LogDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l02114"></a>02114                        <span class="stringliteral">&quot;Multi-dispatch leader, nfsreq=%p, pending=%d, &quot;</span>
<a name="l02115"></a>02115                        <span class="stringliteral">&quot;xid=%u xprt=%p refcnt=%u&quot;</span>,
<a name="l02116"></a>02116                        nfsreq,
<a name="l02117"></a>02117                        pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#af3c93c9919145a7078b195fa72bc9bd6">pending_request_len</a>,
<a name="l02118"></a>02118                        nfsreq-&gt;<a class="code" href="structrequest__data____.html#a418c071aa5cff12637b7668645e371ba">r_u</a>.<a class="code" href="unionrequest__data_____1_1request__content____.html#aa3080af499da22a494e6dd32f5e4c7ce">nfs</a>-&gt;<a class="code" href="structnfs__request__data____.html#a21979ea41fa09472ae4236019dfd1823">msg</a>.rm_xid,
<a name="l02119"></a>02119                        nfsreq-&gt;<a class="code" href="structrequest__data____.html#a418c071aa5cff12637b7668645e371ba">r_u</a>.<a class="code" href="unionrequest__data_____1_1request__content____.html#aa3080af499da22a494e6dd32f5e4c7ce">nfs</a>-&gt;<a class="code" href="structnfs__request__data____.html#aa61bc5d11af7e64be2f23a5b2a5ef0da">xprt</a>,
<a name="l02120"></a>02120                        xu-&gt;<a class="code" href="structgsh__xprt__private.html#a310a0a688bdb102cadc53c3e647de12b">refcnt</a>);
<a name="l02121"></a>02121 
<a name="l02122"></a>02122            <span class="keywordflow">if</span>(nfsreq-&gt;<a class="code" href="structrequest__data____.html#a418c071aa5cff12637b7668645e371ba">r_u</a>.<a class="code" href="unionrequest__data_____1_1request__content____.html#aa3080af499da22a494e6dd32f5e4c7ce">nfs</a>-&gt;<a class="code" href="structnfs__request__data____.html#aa61bc5d11af7e64be2f23a5b2a5ef0da">xprt</a>-&gt;xp_fd == 0)
<a name="l02123"></a>02123              {
<a name="l02124"></a>02124                <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l02125"></a>02125                             <span class="stringliteral">&quot;RPC dispatch error:  nfsreq=%p, xp_fd==0&quot;</span>,
<a name="l02126"></a>02126                             nfsreq);
<a name="l02127"></a>02127              }
<a name="l02128"></a>02128            <span class="keywordflow">else</span>
<a name="l02129"></a>02129              {
<a name="l02130"></a>02130                <span class="comment">/* Process the sequence */</span>
<a name="l02131"></a>02131                (void) <a class="code" href="nfs__worker__thread_8c.html#a8801fc33b03d8a513440a0007b71493e">nfs_worker_process_rpc_requests</a>(pmydata, nfsreq);
<a name="l02132"></a>02132              }
<a name="l02133"></a>02133            <span class="keywordflow">break</span>;
<a name="l02134"></a>02134 
<a name="l02135"></a>02135        <span class="keywordflow">case</span> <a class="code" href="nfs__core_8h.html#a1d4f2ab85979b1e390d2527d1fd7f0cda96f7a7d009b8f5eed8158f4f2d1d4fe1">NFS_REQUEST</a>:
<a name="l02136"></a>02136            <a class="code" href="log_8h.html#aa7aee8ec65b5baafb430f8d2a7588d53">LogDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l02137"></a>02137                     <span class="stringliteral">&quot;Multi-dispatch subrequest, nfsreq=%p, pending=%d, &quot;</span>
<a name="l02138"></a>02138                     <span class="stringliteral">&quot;xid=%u xprt=%p refcnt=%u&quot;</span>,
<a name="l02139"></a>02139                     nfsreq,
<a name="l02140"></a>02140                     pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#af3c93c9919145a7078b195fa72bc9bd6">pending_request_len</a>,
<a name="l02141"></a>02141                     nfsreq-&gt;<a class="code" href="structrequest__data____.html#a418c071aa5cff12637b7668645e371ba">r_u</a>.<a class="code" href="unionrequest__data_____1_1request__content____.html#aa3080af499da22a494e6dd32f5e4c7ce">nfs</a>-&gt;<a class="code" href="structnfs__request__data____.html#a21979ea41fa09472ae4236019dfd1823">msg</a>.rm_xid,
<a name="l02142"></a>02142                     nfsreq-&gt;<a class="code" href="structrequest__data____.html#a418c071aa5cff12637b7668645e371ba">r_u</a>.<a class="code" href="unionrequest__data_____1_1request__content____.html#aa3080af499da22a494e6dd32f5e4c7ce">nfs</a>-&gt;<a class="code" href="structnfs__request__data____.html#aa61bc5d11af7e64be2f23a5b2a5ef0da">xprt</a>,
<a name="l02143"></a>02143                     xu-&gt;<a class="code" href="structgsh__xprt__private.html#a310a0a688bdb102cadc53c3e647de12b">refcnt</a>);
<a name="l02144"></a>02144            nfs_rpc_execute(nfsreq, pmydata);
<a name="l02145"></a>02145            <span class="keywordflow">break</span>;
<a name="l02146"></a>02146 
<a name="l02147"></a>02147        <span class="keywordflow">case</span> <a class="code" href="nfs__core_8h.html#a1d4f2ab85979b1e390d2527d1fd7f0cda363aee72d239bd50c69414aad4e469fd">NFS_CALL</a>:
<a name="l02148"></a>02148            <span class="comment">/* NFSv4 rpc call (callback) */</span>
<a name="l02149"></a>02149            <a class="code" href="nfs__core_8h.html#a3c8c4f6f62ac4a001fdd616196eec818">nfs_rpc_dispatch_call</a>(nfsreq-&gt;<a class="code" href="structrequest__data____.html#a418c071aa5cff12637b7668645e371ba">r_u</a>.<a class="code" href="unionrequest__data_____1_1request__content____.html#a4a77b4a27d727f51934ae2836453dced">call</a>, 0 <span class="comment">/* XXX flags */</span>);
<a name="l02150"></a>02150            <span class="keywordflow">break</span>;
<a name="l02151"></a>02151 
<a name="l02152"></a>02152        <span class="keywordflow">case</span> <a class="code" href="nfs__core_8h.html#a1d4f2ab85979b1e390d2527d1fd7f0cda4f4d1d78a3f0e9edc4fc7d8a06bbe629">_9P_REQUEST</a>:
<a name="l02153"></a>02153 <span class="preprocessor">#ifdef _USE_9P</span>
<a name="l02154"></a>02154 <span class="preprocessor"></span>           _9p_execute(&amp;nfsreq-&gt;<a class="code" href="structrequest__data____.html#a418c071aa5cff12637b7668645e371ba">r_u</a>._9p, pmydata);
<a name="l02155"></a>02155 <span class="preprocessor">#else</span>
<a name="l02156"></a>02156 <span class="preprocessor"></span>           <a class="code" href="test__findlog_8c.html#adfd9432c5478fa14c7d678edb301feed">LogCrit</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>, <span class="stringliteral">&quot;Implementation error, 9P message &quot;</span>
<a name="l02157"></a>02157                      <span class="stringliteral">&quot;when 9P support is disabled&quot;</span> ) ;
<a name="l02158"></a>02158 <span class="preprocessor">#endif</span>
<a name="l02159"></a>02159 <span class="preprocessor"></span>           <span class="keywordflow">break</span>;
<a name="l02160"></a>02160          }
<a name="l02161"></a>02161 
<a name="l02162"></a>02162     finalize_req:
<a name="l02163"></a>02163       <span class="comment">/* XXX Signal the request processing has completed, though at</span>
<a name="l02164"></a>02164 <span class="comment">       * present there may be no effect. */</span>
<a name="l02165"></a>02165       <a class="code" href="log_8h.html#a12ce2d8580101872ee848b50b59252ae">LogInfo</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>, <span class="stringliteral">&quot;Signaling completion of request&quot;</span>);
<a name="l02166"></a>02166 
<a name="l02167"></a>02167       <span class="comment">/* Drop multi_cnt and xprt refcnt, if appropriate */</span>
<a name="l02168"></a>02168       <span class="keywordflow">switch</span>(nfsreq-&gt;<a class="code" href="structrequest__data____.html#a8cf32a1a85150da63fc542b7806d95ac">rtype</a>) {
<a name="l02169"></a>02169        <span class="keywordflow">case</span> <a class="code" href="nfs__core_8h.html#a1d4f2ab85979b1e390d2527d1fd7f0cda315ac8a1c1b06ce7da659c5ed3871734">NFS_REQUEST_LEADER</a>:
<a name="l02170"></a>02170            gsh_xprt_unref(
<a name="l02171"></a>02171                nfsreq-&gt;<a class="code" href="structrequest__data____.html#a418c071aa5cff12637b7668645e371ba">r_u</a>.<a class="code" href="unionrequest__data_____1_1request__content____.html#aa3080af499da22a494e6dd32f5e4c7ce">nfs</a>-&gt;<a class="code" href="structnfs__request__data____.html#aa61bc5d11af7e64be2f23a5b2a5ef0da">xprt</a>, <a class="code" href="ganesha__rpc_8h.html#ab49fb71548fb923d5e87c8ab34efe16b">XPRT_PRIVATE_FLAG_NONE</a>);
<a name="l02172"></a>02172            <span class="keywordflow">break</span>;
<a name="l02173"></a>02173        <span class="keywordflow">case</span> <a class="code" href="nfs__core_8h.html#a1d4f2ab85979b1e390d2527d1fd7f0cda96f7a7d009b8f5eed8158f4f2d1d4fe1">NFS_REQUEST</a>:
<a name="l02174"></a>02174            pthread_rwlock_wrlock(&amp;nfsreq-&gt;<a class="code" href="structrequest__data____.html#a418c071aa5cff12637b7668645e371ba">r_u</a>.<a class="code" href="unionrequest__data_____1_1request__content____.html#aa3080af499da22a494e6dd32f5e4c7ce">nfs</a>-&gt;<a class="code" href="structnfs__request__data____.html#aa61bc5d11af7e64be2f23a5b2a5ef0da">xprt</a>-&gt;lock);
<a name="l02175"></a>02175            --(xu-&gt;<a class="code" href="structgsh__xprt__private.html#ab6936d34c148d54916f3fda1e5353106">multi_cnt</a>);
<a name="l02176"></a>02176            gsh_xprt_unref(
<a name="l02177"></a>02177                nfsreq-&gt;<a class="code" href="structrequest__data____.html#a418c071aa5cff12637b7668645e371ba">r_u</a>.<a class="code" href="unionrequest__data_____1_1request__content____.html#aa3080af499da22a494e6dd32f5e4c7ce">nfs</a>-&gt;<a class="code" href="structnfs__request__data____.html#aa61bc5d11af7e64be2f23a5b2a5ef0da">xprt</a>, <a class="code" href="ganesha__rpc_8h.html#af1f318fbab899387ef0dd86c7c7f0fbd">XPRT_PRIVATE_FLAG_LOCKED</a>);
<a name="l02178"></a>02178            <span class="keywordflow">break</span>;
<a name="l02179"></a>02179        <span class="keywordflow">case</span> <a class="code" href="nfs__core_8h.html#a1d4f2ab85979b1e390d2527d1fd7f0cda363aee72d239bd50c69414aad4e469fd">NFS_CALL</a>:
<a name="l02180"></a>02180            <span class="keywordflow">break</span>;
<a name="l02181"></a>02181        <span class="keywordflow">default</span>:
<a name="l02182"></a>02182            <span class="keywordflow">break</span>;
<a name="l02183"></a>02183        }
<a name="l02184"></a>02184 
<a name="l02185"></a>02185       <span class="comment">/* Free the req by releasing the entry */</span>
<a name="l02186"></a>02186       <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l02187"></a>02187                    <span class="stringliteral">&quot;Invalidating processed entry&quot;</span>);
<a name="l02188"></a>02188       <span class="keywordflow">if</span>( nfsreq-&gt;<a class="code" href="structrequest__data____.html#a8cf32a1a85150da63fc542b7806d95ac">rtype</a> != <a class="code" href="nfs__core_8h.html#a1d4f2ab85979b1e390d2527d1fd7f0cda4f4d1d78a3f0e9edc4fc7d8a06bbe629">_9P_REQUEST</a> &amp;&amp; nfsreq-&gt;<a class="code" href="structrequest__data____.html#a418c071aa5cff12637b7668645e371ba">r_u</a>.<a class="code" href="unionrequest__data_____1_1request__content____.html#aa3080af499da22a494e6dd32f5e4c7ce">nfs</a> ) 
<a name="l02189"></a>02189         pool_free(request_data_pool, nfsreq-&gt;<a class="code" href="structrequest__data____.html#a418c071aa5cff12637b7668645e371ba">r_u</a>.<a class="code" href="unionrequest__data_____1_1request__content____.html#aa3080af499da22a494e6dd32f5e4c7ce">nfs</a>);
<a name="l02190"></a>02190       pool_free(request_pool, nfsreq);
<a name="l02191"></a>02191 
<a name="l02192"></a>02192       <span class="keywordflow">if</span>(pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#a1cf7b7678508113f59ba272bb574f3d2">passcounter</a> &gt; <a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#adaf127ebcf4eea500e79011b862c6899">worker_param</a>.<a class="code" href="structnfs__worker__param____.html#a7f2bbcb47ee048f83c0192de0f3b0e99">nb_before_gc</a>)
<a name="l02193"></a>02193         {
<a name="l02194"></a>02194           <span class="comment">/* Garbage collection on dup req cache */</span>
<a name="l02195"></a>02195           <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l02196"></a>02196                        <span class="stringliteral">&quot;before dupreq invalidation nb_entry=%d nb_invalid=%d&quot;</span>,
<a name="l02197"></a>02197                        pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#a5dcb7ab5d79badb75a9fe1b37b6a24cb">duplicate_request</a>-&gt;<a class="code" href="structlru__list____.html#a894f69046e0a2e5bc4ba843941162b1d">nb_entry</a>,
<a name="l02198"></a>02198                        pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#a5dcb7ab5d79badb75a9fe1b37b6a24cb">duplicate_request</a>-&gt;<a class="code" href="structlru__list____.html#ac14c430503920a866071f16ea07cbbe4">nb_invalid</a>);
<a name="l02199"></a>02199           <span class="keywordflow">if</span>((rc =
<a name="l02200"></a>02200               <a class="code" href="group__LRUExportedFunctions.html#ga7dd2fad27347334adf7270b46fdd2d19">LRU_invalidate_by_function</a>(pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#a5dcb7ab5d79badb75a9fe1b37b6a24cb">duplicate_request</a>,
<a name="l02201"></a>02201                                          <a class="code" href="nfs__dupreq_8h.html#a35d644f1f1b2c333ddc223251d615205">nfs_dupreq_gc_function</a>,
<a name="l02202"></a>02202                                          <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) != <a class="code" href="LRU__List_8h.html#acee9f086802570374777af36ac0527a8">LRU_LIST_SUCCESS</a>)
<a name="l02203"></a>02203             {
<a name="l02204"></a>02204               <a class="code" href="test__findlog_8c.html#adfd9432c5478fa14c7d678edb301feed">LogCrit</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l02205"></a>02205                       <span class="stringliteral">&quot;FAILURE: Impossible to invalidate entries for duplicate &quot;</span>
<a name="l02206"></a>02206                       <span class="stringliteral">&quot;request cache (error %d)&quot;</span>,
<a name="l02207"></a>02207                       rc);
<a name="l02208"></a>02208             }
<a name="l02209"></a>02209           <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l02210"></a>02210                        <span class="stringliteral">&quot;after dupreq invalidation nb_entry=%d nb_invalid=%d&quot;</span>,
<a name="l02211"></a>02211                        pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#a5dcb7ab5d79badb75a9fe1b37b6a24cb">duplicate_request</a>-&gt;<a class="code" href="structlru__list____.html#a894f69046e0a2e5bc4ba843941162b1d">nb_entry</a>,
<a name="l02212"></a>02212                        pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#a5dcb7ab5d79badb75a9fe1b37b6a24cb">duplicate_request</a>-&gt;<a class="code" href="structlru__list____.html#ac14c430503920a866071f16ea07cbbe4">nb_invalid</a>);
<a name="l02213"></a>02213           <span class="keywordflow">if</span>((rc =
<a name="l02214"></a>02214               <a class="code" href="group__LRUExportedFunctions.html#gaeaff4bce3efdf4087b96ba83912388bd">LRU_gc_invalid</a>(pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#a5dcb7ab5d79badb75a9fe1b37b6a24cb">duplicate_request</a>, <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02215"></a>02215               != <a class="code" href="LRU__List_8h.html#acee9f086802570374777af36ac0527a8">LRU_LIST_SUCCESS</a>))
<a name="l02216"></a>02216             <a class="code" href="test__findlog_8c.html#adfd9432c5478fa14c7d678edb301feed">LogCrit</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l02217"></a>02217                     <span class="stringliteral">&quot;FAILURE: Impossible to gc entries for duplicate request &quot;</span>
<a name="l02218"></a>02218                     <span class="stringliteral">&quot;cache (error %d)&quot;</span>,
<a name="l02219"></a>02219                     rc);
<a name="l02220"></a>02220           <span class="keywordflow">else</span>
<a name="l02221"></a>02221             <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l02222"></a>02222                          <span class="stringliteral">&quot;gc entries for duplicate request cache OK&quot;</span>);
<a name="l02223"></a>02223 
<a name="l02224"></a>02224           <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l02225"></a>02225                        <span class="stringliteral">&quot;after dupreq gc nb_entry=%d nb_invalid=%d&quot;</span>,
<a name="l02226"></a>02226                        pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#a5dcb7ab5d79badb75a9fe1b37b6a24cb">duplicate_request</a>-&gt;<a class="code" href="structlru__list____.html#a894f69046e0a2e5bc4ba843941162b1d">nb_entry</a>,
<a name="l02227"></a>02227                        pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#a5dcb7ab5d79badb75a9fe1b37b6a24cb">duplicate_request</a>-&gt;<a class="code" href="structlru__list____.html#ac14c430503920a866071f16ea07cbbe4">nb_invalid</a>);
<a name="l02228"></a>02228 
<a name="l02229"></a>02229           <span class="comment">/* Performing garbabbge collection */</span>
<a name="l02230"></a>02230           <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l02231"></a>02231                        <span class="stringliteral">&quot;Garbage collecting on pending request list&quot;</span>);
<a name="l02232"></a>02232           pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#a1cf7b7678508113f59ba272bb574f3d2">passcounter</a> = 0;
<a name="l02233"></a>02233         }
<a name="l02234"></a>02234       <span class="keywordflow">else</span>
<a name="l02235"></a>02235         <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l02236"></a>02236                      <span class="stringliteral">&quot;garbage collection isn&#39;t necessary count=%d, max=%d&quot;</span>,
<a name="l02237"></a>02237                      pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#a1cf7b7678508113f59ba272bb574f3d2">passcounter</a>,
<a name="l02238"></a>02238                      <a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#adaf127ebcf4eea500e79011b862c6899">worker_param</a>.<a class="code" href="structnfs__worker__param____.html#a7f2bbcb47ee048f83c0192de0f3b0e99">nb_before_gc</a>);
<a name="l02239"></a>02239       pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#a1cf7b7678508113f59ba272bb574f3d2">passcounter</a> += 1;
<a name="l02240"></a>02240 
<a name="l02241"></a>02241       <span class="comment">/* If needed, perform garbage collection on cache_inode layer */</span>
<a name="l02242"></a>02242       <a class="code" href="common__utils_8h.html#a13190861330e48fe885da6b2671876a9">P</a>(<a class="code" href="nfs__worker__thread_8c.html#abe04e34ee93c05b0ef368bc7f20f5656">lock_nb_current_gc_workers</a>);
<a name="l02243"></a>02243       <span class="keywordflow">if</span>(<a class="code" href="nfs__worker__thread_8c.html#a1aaee2caa31305958d161507860bda96">nb_current_gc_workers</a> &lt; <a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#aeef2995e9b54747311db1972d158fd41">core_param</a>.<a class="code" href="structnfs__core__param____.html#ad4146526bb82c81c5fdce64dc1e9aa44">nb_max_concurrent_gc</a>)
<a name="l02244"></a>02244         {
<a name="l02245"></a>02245           <a class="code" href="nfs__worker__thread_8c.html#a1aaee2caa31305958d161507860bda96">nb_current_gc_workers</a> += 1;
<a name="l02246"></a>02246           gc_allowed = <a class="code" href="HashTable_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l02247"></a>02247         }
<a name="l02248"></a>02248       <span class="keywordflow">else</span>
<a name="l02249"></a>02249         gc_allowed = <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02250"></a>02250       <a class="code" href="common__utils_8h.html#a5a9b6f8030959507eee365b226d63b00">V</a>(<a class="code" href="nfs__worker__thread_8c.html#abe04e34ee93c05b0ef368bc7f20f5656">lock_nb_current_gc_workers</a>);
<a name="l02251"></a>02251 
<a name="l02252"></a>02252       <a class="code" href="common__utils_8h.html#a13190861330e48fe885da6b2671876a9">P</a>(pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#afee6ba7633212a86680a5b141b45267c">wcb</a>.<a class="code" href="structnfs__thread__control__block____.html#a62e5785a1ec77581e678f13e84a5dd97">tcb_mutex</a>);
<a name="l02253"></a>02253       <span class="keywordflow">if</span>(gc_allowed == <a class="code" href="HashTable_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a> &amp;&amp; pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#afee6ba7633212a86680a5b141b45267c">wcb</a>.<a class="code" href="structnfs__thread__control__block____.html#a8e5e3aff42f8a45404649f1176448a0c">tcb_state</a> == <a class="code" href="nfs__core_8h.html#a9042b784aff5dfd284f96043b13eeeb8a2ba89c4b960e927feb07e6087b6338bd">STATE_AWAKE</a>)
<a name="l02254"></a>02254         {
<a name="l02255"></a>02255           pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#a3aa5cacdd2f277273c8701a46e74f646">gc_in_progress</a> = <a class="code" href="HashTable_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l02256"></a>02256           <a class="code" href="common__utils_8h.html#a5a9b6f8030959507eee365b226d63b00">V</a>(pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#afee6ba7633212a86680a5b141b45267c">wcb</a>.<a class="code" href="structnfs__thread__control__block____.html#a62e5785a1ec77581e678f13e84a5dd97">tcb_mutex</a>);
<a name="l02257"></a>02257           <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l02258"></a>02258                        <span class="stringliteral">&quot;There are %d concurrent garbage collection&quot;</span>,
<a name="l02259"></a>02259                        <a class="code" href="nfs__worker__thread_8c.html#a1aaee2caa31305958d161507860bda96">nb_current_gc_workers</a>);
<a name="l02260"></a>02260 
<a name="l02261"></a>02261           <a class="code" href="common__utils_8h.html#a13190861330e48fe885da6b2671876a9">P</a>(<a class="code" href="nfs__worker__thread_8c.html#abe04e34ee93c05b0ef368bc7f20f5656">lock_nb_current_gc_workers</a>);
<a name="l02262"></a>02262           <a class="code" href="nfs__worker__thread_8c.html#a1aaee2caa31305958d161507860bda96">nb_current_gc_workers</a> -= 1;
<a name="l02263"></a>02263           <a class="code" href="common__utils_8h.html#a5a9b6f8030959507eee365b226d63b00">V</a>(<a class="code" href="nfs__worker__thread_8c.html#abe04e34ee93c05b0ef368bc7f20f5656">lock_nb_current_gc_workers</a>);
<a name="l02264"></a>02264 
<a name="l02265"></a>02265           <a class="code" href="common__utils_8h.html#a13190861330e48fe885da6b2671876a9">P</a>(pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#afee6ba7633212a86680a5b141b45267c">wcb</a>.<a class="code" href="structnfs__thread__control__block____.html#a62e5785a1ec77581e678f13e84a5dd97">tcb_mutex</a>);
<a name="l02266"></a>02266           pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#a3aa5cacdd2f277273c8701a46e74f646">gc_in_progress</a> = <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02267"></a>02267         }
<a name="l02268"></a>02268       <a class="code" href="common__utils_8h.html#a5a9b6f8030959507eee365b226d63b00">V</a>(pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#afee6ba7633212a86680a5b141b45267c">wcb</a>.<a class="code" href="structnfs__thread__control__block____.html#a62e5785a1ec77581e678f13e84a5dd97">tcb_mutex</a>);
<a name="l02269"></a>02269 
<a name="l02270"></a>02270     }                           <span class="comment">/* while( 1 ) */</span>
<a name="l02271"></a>02271   <a class="code" href="nfs__tcb_8h.html#ae02121499ff02eee64d888bb6e7d6956">tcb_remove</a>(&amp;pmydata-&gt;<a class="code" href="structnfs__worker__data____.html#afee6ba7633212a86680a5b141b45267c">wcb</a>);
<a name="l02272"></a>02272   <span class="keywordflow">return</span> <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02273"></a>02273 }                               <span class="comment">/* worker_thread */</span>
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Wed Nov 21 2012 for nfs-ganesha by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </small></address>
</body>
</html>
