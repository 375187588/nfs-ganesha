<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>nfs-ganesha: cache_inode_weakref.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.3 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">nfs-ganesha&#160;<span id="projectnumber">1.4</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<h1>cache_inode_weakref.h File Reference</h1>  </div>
</div>
<div class="contents">

<p>Generic weak reference package.  
<a href="#_details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="log_8h_source.html">log.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="cache__inode_8h_source.html">cache_inode.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="generic__weakref_8h_source.html">generic_weakref.h</a>&quot;</code><br/>
</div>
<p><a href="cache__inode__weakref_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cache__inode__weakref_8h.html#a285d5c12cbe02330e8adedeed419971f">cache_inode_weakref_init</a> (void)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Init package.  <a href="#a285d5c12cbe02330e8adedeed419971f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structgweakref__.html">gweakref_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cache__inode__weakref_8h.html#ab07489efd8ad959722b1cfd729f12d98">cache_inode_weakref_insert</a> (struct <a class="el" href="structcache__entry__t.html">cache_entry_t</a> *entry)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Install an entry in the weakref table.  <a href="#ab07489efd8ad959722b1cfd729f12d98"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structcache__entry__t.html">cache_entry_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cache__inode__weakref_8h.html#a0b7d5508262280c8c8a27b2a78a3ea8e">cache_inode_weakref_get</a> (<a class="el" href="structgweakref__.html">gweakref_t</a> *ref, <a class="el" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> flags)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Get a reference from the weakref.  <a href="#a0b7d5508262280c8c8a27b2a78a3ea8e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cache__inode__weakref_8h.html#a80a53fef4f68f453b930bb7bbca90137">cache_inode_weakref_delete</a> (<a class="el" href="structgweakref__.html">gweakref_t</a> *ref)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Delete a reference from the table.  <a href="#a80a53fef4f68f453b930bb7bbca90137"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="cache__inode__weakref_8h.html#ad85386117bf7cb036a623f42bd22b1c6">cache_inode_weakref_shutdown</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Clean up on shutdown.  <a href="#ad85386117bf7cb036a623f42bd22b1c6"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Generic weak reference package. </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Matt Benjamin </dd></dl>
<h2><a class="anchor" id="DESCRIPTION"></a>
DESCRIPTION</h2>
<p>Manage weak references to cache inode objects (e.g., references from directory entries). </p>

<p>Definition in file <a class="el" href="cache__inode__weakref_8h_source.html">cache_inode_weakref.h</a>.</p>
</div><hr/><h2>Function Documentation</h2>
<a class="anchor" id="a80a53fef4f68f453b930bb7bbca90137"></a><!-- doxytag: member="cache_inode_weakref.h::cache_inode_weakref_delete" ref="a80a53fef4f68f453b930bb7bbca90137" args="(gweakref_t *ref)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cache_inode_weakref_delete </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structgweakref__.html">gweakref_t</a> *&#160;</td>
          <td class="paramname"><em>ref</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Delete a reference from the table. </p>
<p>This function deletes a weak reference and is expected to be used only by cache_inode_lru_unref, cache_inode_get, and cache_inode_kill_entry.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ref</td><td>The entry to delete </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="cache__inode__weakref_8c_source.html#l00146">146</a> of file <a class="el" href="cache__inode__weakref_8c_source.html">cache_inode_weakref.c</a>.</p>

</div>
</div>
<a class="anchor" id="a0b7d5508262280c8c8a27b2a78a3ea8e"></a><!-- doxytag: member="cache_inode_weakref.h::cache_inode_weakref_get" ref="a0b7d5508262280c8c8a27b2a78a3ea8e" args="(gweakref_t *ref, uint32_t flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structcache__entry__t.html">cache_entry_t</a>* cache_inode_weakref_get </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structgweakref__.html">gweakref_t</a> *&#160;</td>
          <td class="paramname"><em>ref</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get a reference from the weakref. </p>
<p>Attempt to get a reference on a weakref. In order to prevent a race condition, the function retains the read lock on the table (blocking any delete) and acquires the mutex on the lru entry before releasing it. If the entry has type RECYCLED or cache_inode_lru_ref fails (which it will if the refcount has dropped to 0) it will act as if the entry has not existed.</p>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="cache__inode__lru_8h.html#a84096eac6e9589aed54c83040a4b0b2a" title="Relinquish a reference.">cache_inode_lru_unref</a> for the other half of the story.</dd></dl>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ref</td><td>The weakref from which to derive a reference </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">flags</td><td>Flags passed in to cache_inode_lru_ref, for scan resistance</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>A pointer to the <a class="el" href="structcache__entry__t.html" title="Represents a cached inode.">cache_entry_t</a> on success, or NULL on failure. </dd></dl>

<p>Definition at line <a class="el" href="cache__inode__weakref_8c_source.html#l00117">117</a> of file <a class="el" href="cache__inode__weakref_8c_source.html">cache_inode_weakref.c</a>.</p>

</div>
</div>
<a class="anchor" id="a285d5c12cbe02330e8adedeed419971f"></a><!-- doxytag: member="cache_inode_weakref.h::cache_inode_weakref_init" ref="a285d5c12cbe02330e8adedeed419971f" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cache_inode_weakref_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Init package. </p>
<p>Create the global reference table. </p>

<p>Definition at line <a class="el" href="cache__inode__weakref_8c_source.html#l00075">75</a> of file <a class="el" href="cache__inode__weakref_8c_source.html">cache_inode_weakref.c</a>.</p>

</div>
</div>
<a class="anchor" id="ab07489efd8ad959722b1cfd729f12d98"></a><!-- doxytag: member="cache_inode_weakref.h::cache_inode_weakref_insert" ref="ab07489efd8ad959722b1cfd729f12d98" args="(struct cache_entry_t *entry)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structgweakref__.html">gweakref_t</a> cache_inode_weakref_insert </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structcache__entry__t.html">cache_entry_t</a> *&#160;</td>
          <td class="paramname"><em>entry</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Install an entry in the weakref table. </p>
<p>This function installs an entry in the weakref table. The caller must already hold a reference to it. It is expected this function will only be called by cache_inode_new_entry.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">entry</td><td>The entry to be installed</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>The weak reference created </dd></dl>

<p>Definition at line <a class="el" href="cache__inode__weakref_8c_source.html#l00092">92</a> of file <a class="el" href="cache__inode__weakref_8c_source.html">cache_inode_weakref.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad85386117bf7cb036a623f42bd22b1c6"></a><!-- doxytag: member="cache_inode_weakref.h::cache_inode_weakref_shutdown" ref="ad85386117bf7cb036a623f42bd22b1c6" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cache_inode_weakref_shutdown </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Clean up on shutdown. </p>
<p>Destroy the weakref table and free all resources associated with it. </p>

<p>Definition at line <a class="el" href="cache__inode__weakref_8c_source.html#l00157">157</a> of file <a class="el" href="cache__inode__weakref_8c_source.html">cache_inode_weakref.c</a>.</p>

</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Wed Nov 21 2012 for nfs-ganesha by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </small></address>
</body>
</html>
