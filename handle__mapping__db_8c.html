<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>nfs-ganesha: handle_mapping_db.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.3 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">nfs-ganesha&#160;<span id="projectnumber">1.4</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Defines</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<h1>handle_mapping_db.c File Reference</h1>  </div>
</div>
<div class="contents">
<div class="textblock"><code>#include &quot;config.h&quot;</code><br/>
<code>#include &quot;<a class="el" href="handle__mapping_8h_source.html">handle_mapping.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="handle__mapping__db_8h_source.html">handle_mapping_db.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="handle__mapping__internal_8h_source.html">handle_mapping_internal.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="FSAL__PROXY_2fsal__internal_8h_source.html">../fsal_internal.h</a>&quot;</code><br/>
<code>#include &lt;sqlite3.h&gt;</code><br/>
<code>#include &lt;sys/types.h&gt;</code><br/>
<code>#include &lt;dirent.h&gt;</code><br/>
<code>#include &lt;fnmatch.h&gt;</code><br/>
<code>#include &lt;pthread.h&gt;</code><br/>
</div>
<p><a href="handle__mapping__db_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structdb__op__item____.html">db_op_item__</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structflusher__queue____.html">flusher_queue__</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structdb__thread__info____.html">db_thread_info__</a></td></tr>
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handle__mapping__db_8c.html#a9914babc0a69032da0c3248a1b0e62ed">CheckTable</a>(_p_conn_, _code_, _msg_str_, _result_)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handle__mapping__db_8c.html#a940404598e41a57b8c7f25bf84ce5288">CheckCommand</a>(_p_conn_, _code_, _msg_str_)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handle__mapping__db_8c.html#a16e6b0f12a24c4a0543b9770a663d4e5">CheckPrepare</a>(_p_conn_, _code_)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handle__mapping__db_8c.html#a4366fc1821f11fe84bbf9c7678ac8c0a">CheckBind</a>(_p_conn_, _code_, _stmt_)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handle__mapping__db_8c.html#ad5d6e434d2acae9401be376e27b073d0">CheckStep</a>(_p_conn_, _code_, _stmt_)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handle__mapping__db_8c.html#a735470af0d42e9ac114515edb17f52c2">LOAD_ALL_STATEMENT</a>&#160;&#160;&#160;0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handle__mapping__db_8c.html#aea2b2c0acefde95b4c574cb4f1127659">INSERT_STATEMENT</a>&#160;&#160;&#160;1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handle__mapping__db_8c.html#a7a79fed29079d6861040369fc2c5b798">DELETE_STATEMENT</a>&#160;&#160;&#160;2</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handle__mapping__db_8c.html#ad68375626d3256d0ada5dd1c6adfb36f">STATEMENT_COUNT</a>&#160;&#160;&#160;3</td></tr>
<tr><td colspan="2"><h2><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structdb__op__item____.html">db_op_item__</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handle__mapping__db_8c.html#acf0cc1abd3619b61e02b6f6e9a93f8a7">db_op_item_t</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structflusher__queue____.html">flusher_queue__</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handle__mapping__db_8c.html#abab0f299fb2762462f663b2eb056128c">flusher_queue_t</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structdb__thread__info____.html">db_thread_info__</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handle__mapping__db_8c.html#a22dfbeac737446d6d656131797838d54">db_thread_info_t</a></td></tr>
<tr><td colspan="2"><h2><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handle__mapping__db_8c.html#a53ca67ed3259f1f2e101ad5575999022">db_op_type</a> { <a class="el" href="handle__mapping__db_8c.html#a53ca67ed3259f1f2e101ad5575999022a972dbcdf74cff71e20bdcfb53be9c391">LOAD</a> =  1, 
<a class="el" href="handle__mapping__db_8c.html#a53ca67ed3259f1f2e101ad5575999022aa15c451953b2d2a93403afe786930d0f">INSERT</a>, 
<a class="el" href="handle__mapping__db_8c.html#a53ca67ed3259f1f2e101ad5575999022a9d61e82a9a12752f10aece1b22183913">DELETE</a>
 }</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handle__mapping__db_8c.html#a65211e81cdb4243b7ca7013b437f8062">handlemap_db_count</a> (const char *dir)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handle__mapping__db_8c.html#ae1d45291a859f3da8d7c56ab018aa271">select_db_queue</a> (const <a class="el" href="structnfs23__map__handle____.html">nfs23_map_handle_t</a> *p_nfs23_digest)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handle__mapping__db_8c.html#a7d4c84d25d5186bfc841894804c0a0a7">handlemap_db_init</a> (const char *db_dir, const char *tmp_dir, unsigned int db_count, unsigned int nb_dbop_prealloc, int synchronous_insert)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handle__mapping__db_8c.html#ae1ee2f5c3aa50da08f42057d68c3a788">handlemap_db_reaload_all</a> (<a class="el" href="structhash__table.html">hash_table_t</a> *target_hash)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handle__mapping__db_8c.html#a6023d6d71f28fb6cc9d60564385742f5">handlemap_db_insert</a> (<a class="el" href="structnfs23__map__handle____.html">nfs23_map_handle_t</a> *p_in_nfs23_digest, <a class="el" href="structfsal__handle____.html">fsal_handle_t</a> *p_in_handle)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handle__mapping__db_8c.html#ada3129912ad3922ded904906a58c46fe">handlemap_db_delete</a> (<a class="el" href="structnfs23__map__handle____.html">nfs23_map_handle_t</a> *p_in_nfs23_digest)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="handle__mapping__db_8c.html#a490b32e5e8ea302d9a24948be1704785">handlemap_db_flush</a> ()</td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a4366fc1821f11fe84bbf9c7678ac8c0a"></a><!-- doxytag: member="handle_mapping_db.c::CheckBind" ref="a4366fc1821f11fe84bbf9c7678ac8c0a" args="(_p_conn_, _code_, _stmt_)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CheckBind</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_p_conn_, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_code_, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_stmt_&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment"><span class="keywordflow">do</span> { \
  <span class="keywordflow">if</span> ( (_code_) != SQLITE_OK)                                                        \
    {                                                                                \
        <a class="code" href="test__findlog_8c.html#adfd9432c5478fa14c7d678edb301feed">LogCrit</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a384d74248e2dfa73e41e7a2c66d68248">COMPONENT_FSAL</a>, <span class="stringliteral">&quot;SQLite parameter binding failed in %s line %i&quot;</span>, __FUNCTION__, __LINE__); \
        <a class="code" href="test__findlog_8c.html#adfd9432c5478fa14c7d678edb301feed">LogCrit</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a384d74248e2dfa73e41e7a2c66d68248">COMPONENT_FSAL</a>, <span class="stringliteral">&quot;%s (%d)&quot;</span>, sqlite3_errmsg( _p_conn_ ), _code_ ); \
        sqlite3_clear_bindings( _stmt_ ); \
        <span class="keywordflow">return</span> <a class="code" href="handle__mapping_8h.html#a5be7ad652d64e072646badca9613c8a1">HANDLEMAP_DB_ERROR</a>;  \
    }  \
  } <span class="keywordflow">while</span> (0)
</pre></div>
<p>Definition at line <a class="el" href="handle__mapping__db_8c_source.html#l00044">44</a> of file <a class="el" href="handle__mapping__db_8c_source.html">handle_mapping_db.c</a>.</p>

</div>
</div>
<a class="anchor" id="a940404598e41a57b8c7f25bf84ce5288"></a><!-- doxytag: member="handle_mapping_db.c::CheckCommand" ref="a940404598e41a57b8c7f25bf84ce5288" args="(_p_conn_, _code_, _msg_str_)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CheckCommand</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_p_conn_, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_code_, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_msg_str_&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment"><span class="keywordflow">do</span> { \
  <span class="keywordflow">if</span> ( (_code_) != SQLITE_OK ) \
    {                                                                             \
        <a class="code" href="test__findlog_8c.html#adfd9432c5478fa14c7d678edb301feed">LogCrit</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a384d74248e2dfa73e41e7a2c66d68248">COMPONENT_FSAL</a>, <span class="stringliteral">&quot;SQLite command failed in %s line %i&quot;</span>, __FUNCTION__, __LINE__); \
        <a class="code" href="test__findlog_8c.html#adfd9432c5478fa14c7d678edb301feed">LogCrit</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a384d74248e2dfa73e41e7a2c66d68248">COMPONENT_FSAL</a>, <span class="stringliteral">&quot;%s (%d)&quot;</span>, (_msg_str_?_msg_str_:sqlite3_errmsg(_p_conn_)), _code_ ); \
        <span class="keywordflow">if</span> (_msg_str_) {sqlite3_free( _msg_str_); _msg_str_ = <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> ; } \
        <span class="keywordflow">return</span> <a class="code" href="handle__mapping_8h.html#a5be7ad652d64e072646badca9613c8a1">HANDLEMAP_DB_ERROR</a>;  \
    } \
  } <span class="keywordflow">while</span> (0)
</pre></div>
<p>Definition at line <a class="el" href="handle__mapping__db_8c_source.html#l00025">25</a> of file <a class="el" href="handle__mapping__db_8c_source.html">handle_mapping_db.c</a>.</p>

</div>
</div>
<a class="anchor" id="a16e6b0f12a24c4a0543b9770a663d4e5"></a><!-- doxytag: member="handle_mapping_db.c::CheckPrepare" ref="a16e6b0f12a24c4a0543b9770a663d4e5" args="(_p_conn_, _code_)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CheckPrepare</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_p_conn_, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_code_&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment"><span class="keywordflow">do</span> { \
  <span class="keywordflow">if</span> ( (_code_) != SQLITE_OK)                        \
    {                                                                             \
        <a class="code" href="test__findlog_8c.html#adfd9432c5478fa14c7d678edb301feed">LogCrit</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a384d74248e2dfa73e41e7a2c66d68248">COMPONENT_FSAL</a>, <span class="stringliteral">&quot;SQLite prepare statement failed in %s line %i&quot;</span>, __FUNCTION__, __LINE__); \
        <a class="code" href="test__findlog_8c.html#adfd9432c5478fa14c7d678edb301feed">LogCrit</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a384d74248e2dfa73e41e7a2c66d68248">COMPONENT_FSAL</a>, <span class="stringliteral">&quot;%s (%d)&quot;</span>, sqlite3_errmsg( _p_conn_ ), _code_ ); \
        <span class="keywordflow">return</span> <a class="code" href="handle__mapping_8h.html#a5be7ad652d64e072646badca9613c8a1">HANDLEMAP_DB_ERROR</a>;  \
    } \
  } <span class="keywordflow">while</span> (0)
</pre></div>
<p>Definition at line <a class="el" href="handle__mapping__db_8c_source.html#l00035">35</a> of file <a class="el" href="handle__mapping__db_8c_source.html">handle_mapping_db.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad5d6e434d2acae9401be376e27b073d0"></a><!-- doxytag: member="handle_mapping_db.c::CheckStep" ref="ad5d6e434d2acae9401be376e27b073d0" args="(_p_conn_, _code_, _stmt_)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CheckStep</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_p_conn_, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_code_, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_stmt_&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment"><span class="keywordflow">do</span> { \
  <span class="keywordflow">if</span> ( (_code_) != SQLITE_OK  &amp;&amp; (_code_) != SQLITE_ROW &amp;&amp; (_code_) != SQLITE_DONE ) \
    {                                                                                \
        <a class="code" href="test__findlog_8c.html#adfd9432c5478fa14c7d678edb301feed">LogCrit</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a384d74248e2dfa73e41e7a2c66d68248">COMPONENT_FSAL</a>, <span class="stringliteral">&quot;SQLite command failed in %s line %i&quot;</span>, __FUNCTION__, __LINE__); \
        <a class="code" href="test__findlog_8c.html#adfd9432c5478fa14c7d678edb301feed">LogCrit</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a384d74248e2dfa73e41e7a2c66d68248">COMPONENT_FSAL</a>, <span class="stringliteral">&quot;%s (%d)&quot;</span>, sqlite3_errmsg( _p_conn_ ), _code_ ); \
        sqlite3_reset( _stmt_ );    \
        <span class="keywordflow">return</span> <a class="code" href="handle__mapping_8h.html#a5be7ad652d64e072646badca9613c8a1">HANDLEMAP_DB_ERROR</a>;  \
    }  \
  } <span class="keywordflow">while</span> (0)
</pre></div>
<p>Definition at line <a class="el" href="handle__mapping__db_8c_source.html#l00054">54</a> of file <a class="el" href="handle__mapping__db_8c_source.html">handle_mapping_db.c</a>.</p>

</div>
</div>
<a class="anchor" id="a9914babc0a69032da0c3248a1b0e62ed"></a><!-- doxytag: member="handle_mapping_db.c::CheckTable" ref="a9914babc0a69032da0c3248a1b0e62ed" args="(_p_conn_, _code_, _msg_str_, _result_)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CheckTable</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_p_conn_, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_code_, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_msg_str_, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">_result_&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment"><span class="keywordflow">do</span> { \
 <span class="keywordflow">if</span> ( (_code_) != SQLITE_OK ) \
    {                                                                             \
        <a class="code" href="test__findlog_8c.html#adfd9432c5478fa14c7d678edb301feed">LogCrit</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a384d74248e2dfa73e41e7a2c66d68248">COMPONENT_FSAL</a>, <span class="stringliteral">&quot;SQLite command failed in %s line %i&quot;</span>, __FUNCTION__, __LINE__); \
        <a class="code" href="test__findlog_8c.html#adfd9432c5478fa14c7d678edb301feed">LogCrit</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a384d74248e2dfa73e41e7a2c66d68248">COMPONENT_FSAL</a>, <span class="stringliteral">&quot;%s (%d)&quot;</span>, (_msg_str_?_msg_str_:sqlite3_errmsg(_p_conn_)), _code_ ); \
        <span class="keywordflow">if</span> (_msg_str_) { sqlite3_free( _msg_str_); _msg_str_ = <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; }     \
        <span class="keywordflow">if</span> (_result_) { sqlite3_free_table( _result_ ); _result_ = <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; } \
        <span class="keywordflow">return</span> <a class="code" href="handle__mapping_8h.html#a5be7ad652d64e072646badca9613c8a1">HANDLEMAP_DB_ERROR</a>;  \
    } \
  } <span class="keywordflow">while</span> (0)
</pre></div>
<p>Definition at line <a class="el" href="handle__mapping__db_8c_source.html#l00014">14</a> of file <a class="el" href="handle__mapping__db_8c_source.html">handle_mapping_db.c</a>.</p>

</div>
</div>
<a class="anchor" id="a7a79fed29079d6861040369fc2c5b798"></a><!-- doxytag: member="handle_mapping_db.c::DELETE_STATEMENT" ref="a7a79fed29079d6861040369fc2c5b798" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DELETE_STATEMENT&#160;&#160;&#160;2</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="handle__mapping__db_8c_source.html#l00122">122</a> of file <a class="el" href="handle__mapping__db_8c_source.html">handle_mapping_db.c</a>.</p>

</div>
</div>
<a class="anchor" id="aea2b2c0acefde95b4c574cb4f1127659"></a><!-- doxytag: member="handle_mapping_db.c::INSERT_STATEMENT" ref="aea2b2c0acefde95b4c574cb4f1127659" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define INSERT_STATEMENT&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="handle__mapping__db_8c_source.html#l00121">121</a> of file <a class="el" href="handle__mapping__db_8c_source.html">handle_mapping_db.c</a>.</p>

</div>
</div>
<a class="anchor" id="a735470af0d42e9ac114515edb17f52c2"></a><!-- doxytag: member="handle_mapping_db.c::LOAD_ALL_STATEMENT" ref="a735470af0d42e9ac114515edb17f52c2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LOAD_ALL_STATEMENT&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="handle__mapping__db_8c_source.html#l00120">120</a> of file <a class="el" href="handle__mapping__db_8c_source.html">handle_mapping_db.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad68375626d3256d0ada5dd1c6adfb36f"></a><!-- doxytag: member="handle_mapping_db.c::STATEMENT_COUNT" ref="ad68375626d3256d0ada5dd1c6adfb36f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STATEMENT_COUNT&#160;&#160;&#160;3</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="handle__mapping__db_8c_source.html#l00124">124</a> of file <a class="el" href="handle__mapping__db_8c_source.html">handle_mapping_db.c</a>.</p>

</div>
</div>
<hr/><h2>Typedef Documentation</h2>
<a class="anchor" id="acf0cc1abd3619b61e02b6f6e9a93f8a7"></a><!-- doxytag: member="handle_mapping_db.c::db_op_item_t" ref="acf0cc1abd3619b61e02b6f6e9a93f8a7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structdb__op__item____.html">db_op_item__</a>  <a class="el" href="structdb__op__item____.html">db_op_item_t</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a22dfbeac737446d6d656131797838d54"></a><!-- doxytag: member="handle_mapping_db.c::db_thread_info_t" ref="a22dfbeac737446d6d656131797838d54" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structdb__thread__info____.html">db_thread_info__</a>  <a class="el" href="structdb__thread__info____.html">db_thread_info_t</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="abab0f299fb2762462f663b2eb056128c"></a><!-- doxytag: member="handle_mapping_db.c::flusher_queue_t" ref="abab0f299fb2762462f663b2eb056128c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structflusher__queue____.html">flusher_queue__</a>  <a class="el" href="structflusher__queue____.html">flusher_queue_t</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/><h2>Enumeration Type Documentation</h2>
<a class="anchor" id="a53ca67ed3259f1f2e101ad5575999022"></a><!-- doxytag: member="handle_mapping_db.c::db_op_type" ref="a53ca67ed3259f1f2e101ad5575999022" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="handle__mapping__db_8c.html#a53ca67ed3259f1f2e101ad5575999022">db_op_type</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a53ca67ed3259f1f2e101ad5575999022a972dbcdf74cff71e20bdcfb53be9c391"></a><!-- doxytag: member="LOAD" ref="a53ca67ed3259f1f2e101ad5575999022a972dbcdf74cff71e20bdcfb53be9c391" args="" -->LOAD</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a53ca67ed3259f1f2e101ad5575999022aa15c451953b2d2a93403afe786930d0f"></a><!-- doxytag: member="INSERT" ref="a53ca67ed3259f1f2e101ad5575999022aa15c451953b2d2a93403afe786930d0f" args="" -->INSERT</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a53ca67ed3259f1f2e101ad5575999022a9d61e82a9a12752f10aece1b22183913"></a><!-- doxytag: member="DELETE" ref="a53ca67ed3259f1f2e101ad5575999022a9d61e82a9a12752f10aece1b22183913" args="" -->DELETE</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="handle__mapping__db_8c_source.html#l00065">65</a> of file <a class="el" href="handle__mapping__db_8c_source.html">handle_mapping_db.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a65211e81cdb4243b7ca7013b437f8062"></a><!-- doxytag: member="handle_mapping_db.c::handlemap_db_count" ref="a65211e81cdb4243b7ca7013b437f8062" args="(const char *dir)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int handlemap_db_count </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>dir</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>count the number of database instances in a given directory (this is used for checking that the number of db matches the number of threads) </p>

<p>Definition at line <a class="el" href="handle__mapping__db_8c_source.html#l00609">609</a> of file <a class="el" href="handle__mapping__db_8c_source.html">handle_mapping_db.c</a>.</p>

</div>
</div>
<a class="anchor" id="ada3129912ad3922ded904906a58c46fe"></a><!-- doxytag: member="handle_mapping_db.c::handlemap_db_delete" ref="ada3129912ad3922ded904906a58c46fe" args="(nfs23_map_handle_t *p_in_nfs23_digest)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int handlemap_db_delete </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structnfs23__map__handle____.html">nfs23_map_handle_t</a> *&#160;</td>
          <td class="paramname"><em>p_in_nfs23_digest</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Submit a db 'delete' request. The request is inserted in the appropriate db queue. (always asynchronous) </p>

<p>Definition at line <a class="el" href="handle__mapping__db_8c_source.html#l00848">848</a> of file <a class="el" href="handle__mapping__db_8c_source.html">handle_mapping_db.c</a>.</p>

</div>
</div>
<a class="anchor" id="a490b32e5e8ea302d9a24948be1704785"></a><!-- doxytag: member="handle_mapping_db.c::handlemap_db_flush" ref="a490b32e5e8ea302d9a24948be1704785" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int handlemap_db_flush </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Wait for all queues to be empty and all current DB request to be done. </p>

<p>Definition at line <a class="el" href="handle__mapping__db_8c_source.html#l00885">885</a> of file <a class="el" href="handle__mapping__db_8c_source.html">handle_mapping_db.c</a>.</p>

</div>
</div>
<a class="anchor" id="a7d4c84d25d5186bfc841894804c0a0a7"></a><!-- doxytag: member="handle_mapping_db.c::handlemap_db_init" ref="a7d4c84d25d5186bfc841894804c0a0a7" args="(const char *db_dir, const char *tmp_dir, unsigned int db_count, unsigned int nb_dbop_prealloc, int synchronous_insert)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int handlemap_db_init </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>db_dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>tmp_dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>db_count</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>nb_dbop_prealloc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>synchronous_insert</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Initialize databases access</p>
<ul>
<li>init DB queues</li>
<li>start threads</li>
<li>establish DB connections</li>
<li>create db schema if it was empty </li>
</ul>

<p><dl class="todo"><dt><b><a class="el" href="todo.html#_todo000052">Todo:</a></b></dt><dd>ici coller out_parameter-&gt;fs_specific_info.hdlmap_nb_db_op_prealloc </dd></dl>
</p>

<p>Definition at line <a class="el" href="handle__mapping__db_8c_source.html#l00692">692</a> of file <a class="el" href="handle__mapping__db_8c_source.html">handle_mapping_db.c</a>.</p>

</div>
</div>
<a class="anchor" id="a6023d6d71f28fb6cc9d60564385742f5"></a><!-- doxytag: member="handle_mapping_db.c::handlemap_db_insert" ref="a6023d6d71f28fb6cc9d60564385742f5" args="(nfs23_map_handle_t *p_in_nfs23_digest, fsal_handle_t *p_in_handle)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int handlemap_db_insert </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structnfs23__map__handle____.html">nfs23_map_handle_t</a> *&#160;</td>
          <td class="paramname"><em>p_in_nfs23_digest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfsal__handle____.html">fsal_handle_t</a> *&#160;</td>
          <td class="paramname"><em>p_in_handle</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Submit a db 'insert' request. The request is inserted in the appropriate db queue. </p>

<p>Definition at line <a class="el" href="handle__mapping__db_8c_source.html#l00804">804</a> of file <a class="el" href="handle__mapping__db_8c_source.html">handle_mapping_db.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae1ee2f5c3aa50da08f42057d68c3a788"></a><!-- doxytag: member="handle_mapping_db.c::handlemap_db_reaload_all" ref="ae1ee2f5c3aa50da08f42057d68c3a788" args="(hash_table_t *target_hash)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int handlemap_db_reaload_all </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structhash__table.html">hash_table_t</a> *&#160;</td>
          <td class="paramname"><em>target_hash</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Gives the order to each DB thread to reload the content of its database and insert it to the hash table. The function blocks until all threads have loaded their data. </p>

<p>Definition at line <a class="el" href="handle__mapping__db_8c_source.html#l00760">760</a> of file <a class="el" href="handle__mapping__db_8c_source.html">handle_mapping_db.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae1d45291a859f3da8d7c56ab018aa271"></a><!-- doxytag: member="handle_mapping_db.c::select_db_queue" ref="ae1d45291a859f3da8d7c56ab018aa271" args="(const nfs23_map_handle_t *p_nfs23_digest)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int select_db_queue </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structnfs23__map__handle____.html">nfs23_map_handle_t</a> *&#160;</td>
          <td class="paramname"><em>p_nfs23_digest</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="handle__mapping__db_8c_source.html#l00675">675</a> of file <a class="el" href="handle__mapping__db_8c_source.html">handle_mapping_db.c</a>.</p>

</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Wed Nov 21 2012 for nfs-ganesha by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </small></address>
</body>
</html>
