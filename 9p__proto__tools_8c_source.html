<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>nfs-ganesha: 9p_proto_tools.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.3 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">nfs-ganesha&#160;<span id="projectnumber">1.4</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>9p_proto_tools.c</h1>  </div>
</div>
<div class="contents">
<a href="9p__proto__tools_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * vim:expandtab:shiftwidth=8:tabstop=8:</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * Copyright CEA/DAM/DIF  (2011)</span>
<a name="l00005"></a>00005 <span class="comment"> * contributeur : Philippe DENIEL   philippe.deniel@cea.fr</span>
<a name="l00006"></a>00006 <span class="comment"> *                Thomas LEIBOVICI  thomas.leibovici@cea.fr</span>
<a name="l00007"></a>00007 <span class="comment"> *</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00010"></a>00010 <span class="comment"> * modify it under the terms of the GNU Lesser General Public</span>
<a name="l00011"></a>00011 <span class="comment"> * License as published by the Free Software Foundation; either</span>
<a name="l00012"></a>00012 <span class="comment"> * version 3 of the License, or (at your option) any later version.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00015"></a>00015 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00016"></a>00016 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<a name="l00017"></a>00017 <span class="comment"> * Lesser General Public License for more details.</span>
<a name="l00018"></a>00018 <span class="comment"> *</span>
<a name="l00019"></a>00019 <span class="comment"> * You should have received a copy of the GNU Lesser General Public</span>
<a name="l00020"></a>00020 <span class="comment"> * License along with this library; if not, write to the Free Software</span>
<a name="l00021"></a>00021 <span class="comment"> * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * ---------------------------------------</span>
<a name="l00024"></a>00024 <span class="comment"> */</span>
<a name="l00025"></a>00025 
<a name="l00034"></a>00034 <span class="preprocessor">#ifdef HAVE_CONFIG_H</span>
<a name="l00035"></a>00035 <span class="preprocessor"></span><span class="preprocessor">#include &quot;config.h&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#endif</span>
<a name="l00037"></a>00037 <span class="preprocessor"></span>
<a name="l00038"></a>00038 <span class="preprocessor">#ifdef _SOLARIS</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span><span class="preprocessor">#include &quot;solaris_port.h&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#endif</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &lt;pthread.h&gt;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &lt;sys/types.h&gt;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &lt;pwd.h&gt;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &lt;sys/stat.h&gt;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &lt;fcntl.h&gt;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;nfs_core.h&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;log.h&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;9p.h&quot;</span>
<a name="l00052"></a>00052 
<a name="l00053"></a><a class="code" href="9p__proto__tools_8c.html#ae3216881cff0207498d3693ad47007f9">00053</a> <span class="keywordtype">int</span> <a class="code" href="9p_8h.html#ae3216881cff0207498d3693ad47007f9">_9p_init</a>(  <a class="code" href="struct__9p__param____.html">_9p_parameter_t</a> * pparam ) 
<a name="l00054"></a>00054 {
<a name="l00055"></a>00055   <span class="keywordflow">return</span> 0 ;
<a name="l00056"></a>00056 } <span class="comment">/* _9p_init */</span>
<a name="l00057"></a>00057 
<a name="l00058"></a><a class="code" href="9p__proto__tools_8c.html#ad5b3546b6fe44f1f09d5be7b24463e2b">00058</a> <span class="keywordtype">int</span> <a class="code" href="9p_8h.html#ad5b3546b6fe44f1f09d5be7b24463e2b">_9p_tools_get_fsal_op_context_by_uid</a>( <a class="code" href="9p_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> uid, <a class="code" href="struct__9p__fid____.html">_9p_fid_t</a> * pfid ) 
<a name="l00059"></a>00059 {
<a name="l00060"></a>00060   <span class="keywordtype">char</span> buff[1024];
<a name="l00061"></a>00061   <span class="keyword">struct </span>passwd p;
<a name="l00062"></a>00062   <span class="keyword">struct </span>passwd *pp;
<a name="l00063"></a>00063   gid_t gid ;
<a name="l00064"></a>00064   <a class="code" href="structfsal__status____.html">fsal_status_t</a> fsal_status ;
<a name="l00065"></a>00065 
<a name="l00066"></a>00066   <span class="keywordflow">if</span>((getpwuid_r( uid, &amp;p, buff, <a class="code" href="tests_8h.html#addfa831c1473e710d2b71b72fd7fcfa5">MAXPATHLEN</a>, &amp;pp) != 0) || (pp == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))
<a name="l00067"></a>00067     {
<a name="l00068"></a>00068       <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a21e760b50c8323fd5565edf084692370">COMPONENT_IDMAPPER</a>, <span class="stringliteral">&quot;getpwuid_r %d failed&quot;</span>, uid ) ;
<a name="l00069"></a>00069       <span class="keywordflow">return</span> -ENOENT;
<a name="l00070"></a>00070     }
<a name="l00071"></a>00071   <span class="keywordflow">else</span>
<a name="l00072"></a>00072    gid = p.pw_gid ;
<a name="l00073"></a>00073   
<a name="l00074"></a>00074 
<a name="l00075"></a>00075   fsal_status = <a class="code" href="fsal__glue_8c.html#ac9d7f36333e895d045a6e484589fda10">FSAL_GetClientContext</a>( &amp;pfid-&gt;<a class="code" href="struct__9p__fid____.html#a8fbdf010f149eaca1e0a295d6eb68d48">fsal_op_context</a>,
<a name="l00076"></a>00076                                        &amp;pfid-&gt;<a class="code" href="struct__9p__fid____.html#a61989a6dda1526e25c3ae21e10e2d155">pexport</a>-&gt;<a class="code" href="structexportlist____.html#abbe82cf495253f375cd7f4bf47406aca">FS_export_context</a>,
<a name="l00077"></a>00077                                        uid, gid, <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0 ) ;
<a name="l00078"></a>00078   <span class="keywordflow">if</span>( <a class="code" href="fsal_8h.html#a7c2a97ec2fa552dea8e497c7dd8a2b86">FSAL_IS_ERROR</a>( fsal_status ) )
<a name="l00079"></a>00079    <span class="keywordflow">return</span> -fsal_status.<a class="code" href="structfsal__status____.html#ab12ffb4b1b65891a5dd5939fc7d543de">major</a> ; 
<a name="l00080"></a>00080 
<a name="l00081"></a>00081   <span class="keywordflow">return</span> 0 ;
<a name="l00082"></a>00082 } <span class="comment">/* _9p_tools_get_fsal_cred */</span>
<a name="l00083"></a>00083 
<a name="l00084"></a><a class="code" href="9p__proto__tools_8c.html#a8c5f3fbfc93e3215dd13d75d96c6502b">00084</a> <span class="keywordtype">int</span> <a class="code" href="9p_8h.html#a8c5f3fbfc93e3215dd13d75d96c6502b">_9p_tools_get_fsal_op_context_by_name</a>( <span class="keywordtype">int</span> uname_len, <span class="keywordtype">char</span> * uname_str, <a class="code" href="struct__9p__fid____.html">_9p_fid_t</a> * pfid ) 
<a name="l00085"></a>00085 {
<a name="l00086"></a>00086   <span class="keywordtype">char</span> <a class="code" href="mount_8h.html#a2946c588fc7fa2fa5b43ac54b7872725">name</a>[1024] ;
<a name="l00087"></a>00087   uid_t uid ;
<a name="l00088"></a>00088 
<a name="l00089"></a>00089   strncpy( name, uname_str, uname_len) ;
<a name="l00090"></a>00090 
<a name="l00091"></a>00091   <span class="keywordflow">if</span>(<a class="code" href="group__NFSprocs.html#ga14133e9de01b4edd585a73dd55b9fcdc">name2uid</a>(name, &amp;uid) )
<a name="l00092"></a>00092     {
<a name="l00093"></a>00093       <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a21e760b50c8323fd5565edf084692370">COMPONENT_IDMAPPER</a>, <span class="stringliteral">&quot;uidmap_get mapped %s to uid= %d&quot;</span>,
<a name="l00094"></a>00094                    name, uid);
<a name="l00095"></a>00095     }
<a name="l00096"></a>00096   <span class="keywordflow">else</span>
<a name="l00097"></a>00097     <span class="keywordflow">return</span> -ENOENT ;
<a name="l00098"></a>00098   
<a name="l00099"></a>00099   <span class="keywordflow">return</span> <a class="code" href="9p_8h.html#ad5b3546b6fe44f1f09d5be7b24463e2b">_9p_tools_get_fsal_op_context_by_uid</a>( uid, pfid ) ; 
<a name="l00100"></a>00100 } <span class="comment">/* _9p_tools_get_fsal_cred */</span>
<a name="l00101"></a>00101 
<a name="l00102"></a>00102 
<a name="l00103"></a><a class="code" href="9p__proto__tools_8c.html#ad4f9d0c8c882510f519768cffed6ae58">00103</a> <span class="keywordtype">int</span> <a class="code" href="9p_8h.html#ad4f9d0c8c882510f519768cffed6ae58">_9p_tools_errno</a>( <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2">cache_inode_status_t</a> cache_status )
<a name="l00104"></a>00104 {
<a name="l00105"></a>00105   <span class="keywordtype">int</span> rc = 0 ;
<a name="l00106"></a>00106 
<a name="l00107"></a>00107   <span class="keywordflow">switch</span>( cache_status )
<a name="l00108"></a>00108    {
<a name="l00109"></a>00109      <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a3fdbbb2367268ae84ac11d7b189643d8">CACHE_INODE_SUCCESS</a>:
<a name="l00110"></a>00110         rc = 0 ;
<a name="l00111"></a>00111         break ;
<a name="l00112"></a>00112 
<a name="l00113"></a>00113      <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a1915843665e061f9b874510cc6382bc9">CACHE_INODE_MALLOC_ERROR</a>:
<a name="l00114"></a>00114         rc = ENOMEM ;
<a name="l00115"></a>00115         break ;
<a name="l00116"></a>00116 
<a name="l00117"></a>00117      <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a31102fd54b8481b29ee40b6a7f692e75">CACHE_INODE_NOT_A_DIRECTORY</a>:
<a name="l00118"></a>00118         rc = ENOTDIR ;
<a name="l00119"></a>00119         break ;
<a name="l00120"></a>00120 
<a name="l00121"></a>00121      <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2ae81d3dfa51b14e0e0a26bb33b2f46490">CACHE_INODE_ENTRY_EXISTS</a>:
<a name="l00122"></a>00122         rc = EEXIST ;
<a name="l00123"></a>00123         break ;
<a name="l00124"></a>00124 
<a name="l00125"></a>00125      <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2aa13bf3166511315448442f01b9909bfa">CACHE_INODE_DIR_NOT_EMPTY</a>:
<a name="l00126"></a>00126         rc = ENOTEMPTY ;
<a name="l00127"></a>00127         break ;
<a name="l00128"></a>00128 
<a name="l00129"></a>00129      <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a49bfbcb4177d74986dd63a1c8aaaadfc">CACHE_INODE_NOT_FOUND</a>:
<a name="l00130"></a>00130         rc = ENOENT ;
<a name="l00131"></a>00131         break ;
<a name="l00132"></a>00132 
<a name="l00133"></a>00133      <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a3c0860cc76f604bcfc7bc09779d3d06c">CACHE_INODE_IS_A_DIRECTORY</a>:
<a name="l00134"></a>00134         rc = EISDIR ;
<a name="l00135"></a>00135         break ;
<a name="l00136"></a>00136 
<a name="l00137"></a>00137      <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2aaf42a5520c80584c436e6577c848fbed">CACHE_INODE_FSAL_EPERM</a>:
<a name="l00138"></a>00138      <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2acdd7ce7a12331e8bd87270730d23b298">CACHE_INODE_FSAL_ERR_SEC</a>:
<a name="l00139"></a>00139         rc = EPERM ;
<a name="l00140"></a>00140         break ;
<a name="l00141"></a>00141 
<a name="l00142"></a>00142      <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a07fdf53f0646a04f877c108ed99c293b">CACHE_INODE_INVALID_ARGUMENT</a>:
<a name="l00143"></a>00143      <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2aca5633ef3c1b4ca3d7b6c757b33e6cad">CACHE_INODE_NAME_TOO_LONG</a>:
<a name="l00144"></a>00144      <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a1fb3e5d693699c6142279757810ae6c3">CACHE_INODE_UNAPPROPRIATED_KEY</a>:
<a name="l00145"></a>00145      <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a3b4d85140a3d8f501b3e318c82f0d13a">CACHE_INODE_INCONSISTENT_ENTRY</a>:
<a name="l00146"></a>00146      <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2aa3de98320a1cba72aeeefd31e124712a">CACHE_INODE_FSAL_ERROR</a>:
<a name="l00147"></a>00147      <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a461c7aae0d7d8861bc61ee7031bf79a9">CACHE_INODE_BAD_TYPE</a>: 
<a name="l00148"></a>00148      <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2ad34d88bf1ed87798b4c684a4fa5ac940">CACHE_INODE_STATE_CONFLICT</a>:
<a name="l00149"></a>00149      <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a30d77d9ece8c0b24f90e6839eba76906">CACHE_INODE_STATE_ERROR</a>:
<a name="l00150"></a>00150      <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a9cf5e7e7d9af15c56de98d2e3a8528ce">CACHE_INODE_POOL_MUTEX_INIT_ERROR</a>:
<a name="l00151"></a>00151      <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a86613bc3a05ba135756f102393944133">CACHE_INODE_INIT_ENTRY_FAILED</a>:
<a name="l00152"></a>00152         rc = EINVAL ;
<a name="l00153"></a>00153         break ;
<a name="l00154"></a>00154 
<a name="l00155"></a>00155      <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a0b3b3a0e6a65c9f375c366e6d0349852">CACHE_INODE_NO_SPACE_LEFT</a>:
<a name="l00156"></a>00156         rc = ENOSPC ;
<a name="l00157"></a>00157         break ;
<a name="l00158"></a>00158 
<a name="l00159"></a>00159      <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a2735653dbb65fcae621e042fe40316e3">CACHE_INODE_READ_ONLY_FS</a>: 
<a name="l00160"></a>00160         rc = EROFS ;
<a name="l00161"></a>00161         break ;
<a name="l00162"></a>00162 
<a name="l00163"></a>00163      <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a753b5e42145f8290242d1990792dbb0d">CACHE_INODE_FSAL_ESTALE</a>:
<a name="l00164"></a>00164      <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2ac52f764b2c5c664df1cf11d8751965fb">CACHE_INODE_DEAD_ENTRY</a>:
<a name="l00165"></a>00165         rc = ESTALE ;
<a name="l00166"></a>00166         break ;
<a name="l00167"></a>00167 
<a name="l00168"></a>00168      <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2af5c6f8a87057aebc9e59154de348d56a">CACHE_INODE_QUOTA_EXCEEDED</a>:
<a name="l00169"></a>00169         rc = EDQUOT ;
<a name="l00170"></a>00170         break ; 
<a name="l00171"></a>00171 
<a name="l00172"></a>00172      <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a6ea3d914d4fb4de66c7d13f31245a5ac">CACHE_INODE_CACHE_CONTENT_ERROR</a>:
<a name="l00173"></a>00173      <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2ab5b3592038c0b37022a99a7b0c87aa17">CACHE_INODE_CACHE_CONTENT_EXISTS</a>:
<a name="l00174"></a>00174      <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2ad76de37772e149413ed754160f118752">CACHE_INODE_CACHE_CONTENT_EMPTY</a>:
<a name="l00175"></a>00175      <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2acc50439e4e107ce5487e79adfdbf4dc0">CACHE_INODE_IO_ERROR</a>:
<a name="l00176"></a>00176      <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a216876f1f0ed1ec8c7e61969e9e6cbfb">CACHE_INODE_ASYNC_POST_ERROR</a>:
<a name="l00177"></a>00177      <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a7fce719c38bc7c5184590549d6d659d1">CACHE_INODE_GET_NEW_LRU_ENTRY</a>:
<a name="l00178"></a>00178      <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a076de8b129f67057d1294bedf7094aed">CACHE_INODE_LRU_ERROR</a>:
<a name="l00179"></a>00179      <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2ac1838632304273d612cd61d2ab31a1ce">CACHE_INODE_HASH_SET_ERROR</a>:
<a name="l00180"></a>00180      <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2af9495df7ccc04c50609ceaf8f81e9c9b">CACHE_INODE_INSERT_ERROR</a>:
<a name="l00181"></a>00181      <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a37c51c9a4e1098130f3d50e15af58635">CACHE_INODE_HASH_TABLE_ERROR</a>:
<a name="l00182"></a>00182         rc = EIO ;
<a name="l00183"></a>00183         break ;
<a name="l00184"></a>00184 
<a name="l00185"></a>00185      <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a58fc37d01af497af261b2ee8ce65f137">CACHE_INODE_NOT_SUPPORTED</a>:
<a name="l00186"></a>00186         rc = ENOTSUP ;
<a name="l00187"></a>00187         break ;
<a name="l00188"></a>00188 
<a name="l00189"></a>00189      <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2afa6e4cda579bf50a4cc7efddccab904b">CACHE_INODE_FSAL_EACCESS</a>:
<a name="l00190"></a>00190         rc = EACCES ;
<a name="l00191"></a>00191         break ;
<a name="l00192"></a>00192 
<a name="l00193"></a>00193      <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a682d21c0f90702d383c9b658e169f534">CACHE_INODE_DELAY</a>:
<a name="l00194"></a>00194         rc = EAGAIN ;
<a name="l00195"></a>00195         break ;
<a name="l00196"></a>00196 
<a name="l00197"></a>00197      <span class="keywordflow">default</span>:
<a name="l00198"></a>00198         rc = EIO ;
<a name="l00199"></a>00199         break ; 
<a name="l00200"></a>00200    }
<a name="l00201"></a>00201 
<a name="l00202"></a>00202   <span class="keywordflow">return</span> rc ;
<a name="l00203"></a>00203 } <span class="comment">/* _9p_tools_errno */</span>
<a name="l00204"></a>00204 
<a name="l00205"></a><a class="code" href="9p__proto__tools_8c.html#a764b8796e1d8daae406e20db64e953bf">00205</a> <span class="keywordtype">void</span> <a class="code" href="9p_8h.html#a764b8796e1d8daae406e20db64e953bf">_9p_tools_fsal_attr2stat</a>( <a class="code" href="structfsal__attrib__list____.html">fsal_attrib_list_t</a> * pfsalattr, <span class="keyword">struct</span> stat * pstat )
<a name="l00206"></a>00206 {
<a name="l00207"></a>00207   <span class="comment">/* zero output structure */</span>
<a name="l00208"></a>00208   memset( (<span class="keywordtype">char</span> *)pstat, 0, <span class="keyword">sizeof</span>( <span class="keyword">struct</span> stat ) ) ;
<a name="l00209"></a>00209 
<a name="l00210"></a>00210   pstat-&gt;st_dev   = 0 ; <span class="comment">/* Omitted in 9P */</span>
<a name="l00211"></a>00211   pstat-&gt;st_ino   = pfsalattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a657a3efbc26891ced4b16f48791452c3">fileid</a> ;
<a name="l00212"></a>00212 
<a name="l00213"></a>00213   pstat-&gt;st_mode  = pfsalattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a6611fe8fc39ff41d2c21d194213322e7">mode</a> ;
<a name="l00214"></a>00214   <span class="keywordflow">if</span>( pfsalattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a03249aca39ba1b16b4712079d93b025e">type</a> == <a class="code" href="fsal__types_8h.html#a368aa63441663f9326d0201857bfcea3a302bac21d091a1f3fc1ef5adb50661c3">FSAL_TYPE_DIR</a> ) pstat-&gt;st_mode  |= __S_IFDIR  ;
<a name="l00215"></a>00215   <span class="keywordflow">if</span>( pfsalattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a03249aca39ba1b16b4712079d93b025e">type</a> == <a class="code" href="fsal__types_8h.html#a368aa63441663f9326d0201857bfcea3afb0cf0224b4c4d6adaec28b1f3d65400">FSAL_TYPE_FILE</a> ) pstat-&gt;st_mode |= __S_IFREG  ;
<a name="l00216"></a>00216   <span class="keywordflow">if</span>( pfsalattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a03249aca39ba1b16b4712079d93b025e">type</a> == <a class="code" href="fsal__types_8h.html#a368aa63441663f9326d0201857bfcea3adca35a94946e3fba05a201e70f98c3a8">FSAL_TYPE_LNK</a> ) pstat-&gt;st_mode  |= __S_IFLNK  ;
<a name="l00217"></a>00217   <span class="keywordflow">if</span>( pfsalattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a03249aca39ba1b16b4712079d93b025e">type</a> == <a class="code" href="fsal__types_8h.html#a368aa63441663f9326d0201857bfcea3a832898ed571b62a052b344b6c3460b44">FSAL_TYPE_SOCK</a> ) pstat-&gt;st_mode |= __S_IFSOCK ;
<a name="l00218"></a>00218   <span class="keywordflow">if</span>( pfsalattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a03249aca39ba1b16b4712079d93b025e">type</a> == <a class="code" href="fsal__types_8h.html#a368aa63441663f9326d0201857bfcea3a4889072a63eda04f5c8d92a5a5bc04cd">FSAL_TYPE_BLK</a> ) pstat-&gt;st_mode  |= __S_IFBLK  ;
<a name="l00219"></a>00219   <span class="keywordflow">if</span>( pfsalattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a03249aca39ba1b16b4712079d93b025e">type</a> == <a class="code" href="fsal__types_8h.html#a368aa63441663f9326d0201857bfcea3ab2cc09e4ad4298e2b0238df7ebc18adc">FSAL_TYPE_CHR</a> ) pstat-&gt;st_mode  |= __S_IFCHR  ;
<a name="l00220"></a>00220   <span class="keywordflow">if</span>( pfsalattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a03249aca39ba1b16b4712079d93b025e">type</a> == <a class="code" href="fsal__types_8h.html#a368aa63441663f9326d0201857bfcea3a162623715e400bfeb41be0a079f9856e">FSAL_TYPE_FIFO</a> ) pstat-&gt;st_mode |= __S_IFIFO  ;
<a name="l00221"></a>00221 
<a name="l00222"></a>00222   pstat-&gt;st_nlink   = (<a class="code" href="9p_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a>)pfsalattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a3ed4337021700c7a893c23668d6c0f33">numlinks</a> ;
<a name="l00223"></a>00223   pstat-&gt;st_uid     = pfsalattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a89670e3e52193381c240c0b7d93d6aa6">owner</a> ;
<a name="l00224"></a>00224   pstat-&gt;st_gid     = pfsalattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e4622af711f91b5f598fce5e0bee9fa">group</a> ;
<a name="l00225"></a>00225   pstat-&gt;st_rdev    = pfsalattr-&gt;<a class="code" href="structfsal__attrib__list____.html#ae500abbe897ddad0af25160793468ae1">rawdev</a>.<a class="code" href="structfsal__dev____.html#af03e5fde9bbeec4835a2dbdbcdbad11b">major</a> ;
<a name="l00226"></a>00226   pstat-&gt;st_size    = pfsalattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a0105c962cf3b7c8d11e2e2d1c5acff31">filesize</a> ;
<a name="l00227"></a>00227   pstat-&gt;st_blksize = 4096 ;
<a name="l00228"></a>00228   pstat-&gt;st_blocks  = (pfsalattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a0105c962cf3b7c8d11e2e2d1c5acff31">filesize</a>/4096) + 1 ; 
<a name="l00229"></a>00229   pstat-&gt;st_atime   = pfsalattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a48293ea65b5bb7282d4421ad079f056f">atime</a>.<a class="code" href="structfsal__time____.html#add92ec6180384f0ba10dd2a79b659548">seconds</a> ;
<a name="l00230"></a>00230   pstat-&gt;st_mtime   = pfsalattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a441daefe7cc86152355f895d81bc2936">mtime</a>.<a class="code" href="structfsal__time____.html#add92ec6180384f0ba10dd2a79b659548">seconds</a> ;
<a name="l00231"></a>00231   pstat-&gt;st_ctime   = pfsalattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7087852b901550fbbc6ba2aed12c96ef">ctime</a>.<a class="code" href="structfsal__time____.html#add92ec6180384f0ba10dd2a79b659548">seconds</a> ;
<a name="l00232"></a>00232 
<a name="l00233"></a>00233 } <span class="comment">/* _9p_tools_fsal_attr2stat */</span>
<a name="l00234"></a>00234 
<a name="l00235"></a><a class="code" href="9p__proto__tools_8c.html#a45d7db8de0a297c9edc20a98686a78a7">00235</a> <span class="keywordtype">void</span> <a class="code" href="9p_8h.html#a45d7db8de0a297c9edc20a98686a78a7">_9p_tools_acess2fsal</a>( <a class="code" href="9p_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> * paccessin, <a class="code" href="fsal__types_8h.html#a67f294990c65fb1f373bd9a21b139d67">fsal_accessflags_t</a> * pfsalaccess )
<a name="l00236"></a>00236 {
<a name="l00237"></a>00237   memset( (<span class="keywordtype">char</span> *)pfsalaccess, 0 , <span class="keyword">sizeof</span>( <a class="code" href="fsal__types_8h.html#a67f294990c65fb1f373bd9a21b139d67">fsal_accessflags_t</a> ) ) ;
<a name="l00238"></a>00238 
<a name="l00239"></a>00239   <span class="keywordflow">if</span>( *paccessin &amp; O_WRONLY ) *pfsalaccess |= <a class="code" href="fsal__types_8h.html#a22aa427f250d1efb3d90764d3c2eab39">FSAL_W_OK</a> ;
<a name="l00240"></a>00240   <span class="keywordflow">if</span>( *paccessin &amp; O_RDONLY ) *pfsalaccess |= <a class="code" href="fsal__types_8h.html#ab020040c9a4e238acb118058e2702199">FSAL_R_OK</a> ;
<a name="l00241"></a>00241   <span class="keywordflow">if</span>( *paccessin &amp; O_RDWR )   *pfsalaccess |= <a class="code" href="fsal__types_8h.html#ab020040c9a4e238acb118058e2702199">FSAL_R_OK</a>|<a class="code" href="fsal__types_8h.html#a22aa427f250d1efb3d90764d3c2eab39">FSAL_W_OK</a> ; 
<a name="l00242"></a>00242 } <span class="comment">/* _9p_tools_acess2fsal */</span>
<a name="l00243"></a>00243 
<a name="l00244"></a><a class="code" href="9p__proto__tools_8c.html#aea51c7d8daf22024481fb8e5796a7562">00244</a> <span class="keywordtype">void</span> <a class="code" href="9p_8h.html#aea51c7d8daf22024481fb8e5796a7562">_9p_chomp_attr_value</a>(<span class="keywordtype">char</span> *str, <span class="keywordtype">size_t</span> size)
<a name="l00245"></a>00245 {
<a name="l00246"></a>00246   <span class="keywordtype">int</span> len;
<a name="l00247"></a>00247 
<a name="l00248"></a>00248   <span class="keywordflow">if</span>(str == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00249"></a>00249     <span class="keywordflow">return</span>;
<a name="l00250"></a>00250 
<a name="l00251"></a>00251   <span class="comment">/* security: set last char to &#39;\0&#39; */</span>
<a name="l00252"></a>00252   str[size - 1] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l00253"></a>00253 
<a name="l00254"></a>00254   len = <a class="code" href="idmapper__cache_8c.html#afc92d2231e45d19988c7894aa2a07f0c">strnlen</a>(str, size);
<a name="l00255"></a>00255   <span class="keywordflow">if</span>((len &gt; 0) &amp;&amp; (str[len - 1] == <span class="charliteral">&#39;\n&#39;</span>))
<a name="l00256"></a>00256     str[len - 1] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l00257"></a>00257 }
<a name="l00258"></a>00258 
<a name="l00259"></a><a class="code" href="9p__proto__tools_8c.html#a7c7edf188b866d1b0aa5a1b6b0666434">00259</a> <span class="keywordtype">void</span> <a class="code" href="9p_8h.html#a7c7edf188b866d1b0aa5a1b6b0666434">_9p_openflags2FSAL</a>( <a class="code" href="9p_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a> * inflags, <a class="code" href="fsal__types_8h.html#a32a4d2db8d51a91baa4adf861fcdd914">fsal_openflags_t</a> * outflags )
<a name="l00260"></a>00260 {
<a name="l00261"></a>00261   <span class="keywordflow">if</span>( inflags == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || outflags == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> )
<a name="l00262"></a>00262     return ; 
<a name="l00263"></a>00263 
<a name="l00264"></a>00264   <span class="keywordflow">if</span>( *inflags &amp; O_WRONLY ) *outflags |= <a class="code" href="fsal__types_8h.html#a5f84bca155cfec06e96536e838d847aa">FSAL_O_WRONLY</a>  ;
<a name="l00265"></a>00265   <span class="keywordflow">if</span>( *inflags &amp; O_RDWR ) *outflags |= <a class="code" href="fsal__types_8h.html#a2f41a66ed7ecd8494344eff0f56f3784">FSAL_O_RDWR</a>  ;
<a name="l00266"></a>00266   <span class="comment">/* Exception : O_RDONLY has value 0, it can&#39;t be tested with a logical and */</span>
<a name="l00267"></a>00267   <span class="comment">/* We consider that a non( has O_WRONLY or has O_RDWR ) case is RD_ONLY */</span>
<a name="l00268"></a>00268   <span class="keywordflow">if</span>( !(*inflags &amp; (O_WRONLY|O_RDWR)) )
<a name="l00269"></a>00269      *outflags = <a class="code" href="fsal__types_8h.html#a22f97adee8595d296f2eb2c3d57265d7">FSAL_O_RDONLY</a> ;
<a name="l00270"></a>00270 
<a name="l00271"></a>00271   return ;
<a name="l00272"></a>00272 } <span class="comment">/* _9p_openflags2FSAL */</span>
<a name="l00273"></a>00273 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Wed Nov 21 2012 for nfs-ganesha by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </small></address>
</body>
</html>
