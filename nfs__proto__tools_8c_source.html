<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>nfs-ganesha: nfs_proto_tools.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.3 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">nfs-ganesha&#160;<span id="projectnumber">1.4</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>nfs_proto_tools.c</h1>  </div>
</div>
<div class="contents">
<a href="nfs__proto__tools_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * vim:expandtab:shiftwidth=8:tabstop=8:</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * Copyright CEA/DAM/DIF  (2008)</span>
<a name="l00005"></a>00005 <span class="comment"> * contributeur : Philippe DENIEL   philippe.deniel@cea.fr</span>
<a name="l00006"></a>00006 <span class="comment"> *                Thomas LEIBOVICI  thomas.leibovici@cea.fr</span>
<a name="l00007"></a>00007 <span class="comment"> *</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00010"></a>00010 <span class="comment"> * modify it under the terms of the GNU Lesser General Public</span>
<a name="l00011"></a>00011 <span class="comment"> * License as published by the Free Software Foundation; either</span>
<a name="l00012"></a>00012 <span class="comment"> * version 3 of the License, or (at your option) any later version.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00015"></a>00015 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00016"></a>00016 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<a name="l00017"></a>00017 <span class="comment"> * Lesser General Public License for more details.</span>
<a name="l00018"></a>00018 <span class="comment"> *</span>
<a name="l00019"></a>00019 <span class="comment"> * You should have received a copy of the GNU Lesser General Public</span>
<a name="l00020"></a>00020 <span class="comment"> * License along with this library; if not, write to the Free Software</span>
<a name="l00021"></a>00021 <span class="comment"> * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * ---------------------------------------</span>
<a name="l00024"></a>00024 <span class="comment"> */</span>
<a name="l00025"></a>00025 
<a name="l00037"></a>00037 <span class="preprocessor">#ifdef HAVE_CONFIG_H</span>
<a name="l00038"></a>00038 <span class="preprocessor"></span><span class="preprocessor">#include &quot;config.h&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#endif</span>
<a name="l00040"></a>00040 <span class="preprocessor"></span>
<a name="l00041"></a>00041 <span class="preprocessor">#ifdef _SOLARIS</span>
<a name="l00042"></a>00042 <span class="preprocessor"></span><span class="preprocessor">#include &quot;solaris_port.h&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#endif</span>
<a name="l00044"></a>00044 <span class="preprocessor"></span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &lt;pthread.h&gt;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &lt;fcntl.h&gt;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &lt;sys/file.h&gt;</span>           <span class="comment">/* for having FNDELAY */</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &lt;pwd.h&gt;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &lt;grp.h&gt;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &lt;stdint.h&gt;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;HashData.h&quot;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;HashTable.h&quot;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;log.h&quot;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;ganesha_rpc.h&quot;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;nfs23.h&quot;</span>
<a name="l00058"></a>00058 <span class="preprocessor">#include &quot;nfs4.h&quot;</span>
<a name="l00059"></a>00059 <span class="preprocessor">#include &quot;mount.h&quot;</span>
<a name="l00060"></a>00060 <span class="preprocessor">#include &quot;nfs_core.h&quot;</span>
<a name="l00061"></a>00061 <span class="preprocessor">#include &quot;cache_inode.h&quot;</span>
<a name="l00062"></a>00062 <span class="preprocessor">#include &quot;nfs_exports.h&quot;</span>
<a name="l00063"></a>00063 <span class="preprocessor">#include &quot;nfs_creds.h&quot;</span>
<a name="l00064"></a>00064 <span class="preprocessor">#include &quot;nfs_proto_functions.h&quot;</span>
<a name="l00065"></a>00065 <span class="preprocessor">#include &quot;nfs_tools.h&quot;</span>
<a name="l00066"></a>00066 <span class="preprocessor">#include &quot;nfs_file_handle.h&quot;</span>
<a name="l00067"></a>00067 <span class="preprocessor">#include &quot;nfs_proto_tools.h&quot;</span>
<a name="l00068"></a>00068 <span class="preprocessor">#include &quot;nfs4_acls.h&quot;</span>
<a name="l00069"></a>00069 <span class="preprocessor">#ifdef _PNFS_MDS</span>
<a name="l00070"></a>00070 <span class="preprocessor"></span><span class="preprocessor">#include &quot;sal_data.h&quot;</span>
<a name="l00071"></a>00071 <span class="preprocessor">#include &quot;sal_functions.h&quot;</span>
<a name="l00072"></a>00072 <span class="preprocessor">#include &quot;fsal.h&quot;</span>
<a name="l00073"></a>00073 <span class="preprocessor">#include &quot;fsal_pnfs.h&quot;</span>
<a name="l00074"></a>00074 <span class="preprocessor">#include &quot;pnfs_common.h&quot;</span>
<a name="l00075"></a>00075 <span class="preprocessor">#endif </span><span class="comment">/* _PNFS_MDS */</span>
<a name="l00076"></a>00076 
<a name="l00077"></a>00077 <span class="preprocessor">#ifdef _USE_NFS4_ACL</span>
<a name="l00078"></a>00078 <span class="preprocessor"></span><span class="comment">/* Define mapping of NFS4 who name and type. */</span>
<a name="l00079"></a>00079 <span class="keyword">static</span> <span class="keyword">struct </span>{
<a name="l00080"></a>00080   <span class="keywordtype">char</span> *string;
<a name="l00081"></a>00081   <span class="keywordtype">int</span>   stringlen;
<a name="l00082"></a>00082   <span class="keywordtype">int</span> type;
<a name="l00083"></a>00083 } whostr_2_type_map[] = {
<a name="l00084"></a>00084   {
<a name="l00085"></a>00085     .string    = <span class="stringliteral">&quot;OWNER@&quot;</span>,
<a name="l00086"></a>00086     .stringlen = <span class="keyword">sizeof</span>(<span class="stringliteral">&quot;OWNER@&quot;</span>) - 1,
<a name="l00087"></a>00087     .type      = <a class="code" href="fsal__types_8h.html#a2377843e282a1c0b129978930eff3aa8">FSAL_ACE_SPECIAL_OWNER</a>,
<a name="l00088"></a>00088   },
<a name="l00089"></a>00089   {
<a name="l00090"></a>00090     .string    = <span class="stringliteral">&quot;GROUP@&quot;</span>,
<a name="l00091"></a>00091     .stringlen = <span class="keyword">sizeof</span>(<span class="stringliteral">&quot;GROUP@&quot;</span>) - 1,
<a name="l00092"></a>00092     .type      = <a class="code" href="fsal__types_8h.html#a73583bef1e6a2691988b8d03f238d8f9">FSAL_ACE_SPECIAL_GROUP</a>,
<a name="l00093"></a>00093   },
<a name="l00094"></a>00094   {
<a name="l00095"></a>00095     .string    = <span class="stringliteral">&quot;EVERYONE@&quot;</span>,
<a name="l00096"></a>00096     .stringlen = <span class="keyword">sizeof</span>(<span class="stringliteral">&quot;EVERYONE@&quot;</span>) - 1,
<a name="l00097"></a>00097     .type      = <a class="code" href="fsal__types_8h.html#ada7433a3ebd1a7ce34085b5ae9ddb894">FSAL_ACE_SPECIAL_EVERYONE</a>,
<a name="l00098"></a>00098   },
<a name="l00099"></a>00099 };
<a name="l00100"></a>00100 <span class="preprocessor">#endif                          </span><span class="comment">/* _USE_NFS4_ACL */</span>
<a name="l00101"></a>00101 
<a name="l00102"></a>00102 <span class="comment">/*</span>
<a name="l00103"></a>00103 <span class="comment"> * String representations of NFS protocol operations.</span>
<a name="l00104"></a>00104 <span class="comment"> */</span>
<a name="l00105"></a><a class="code" href="nfs__proto__tools_8c.html#a9b178d7e8d66f4673b531287afde693d">00105</a> <span class="keywordtype">char</span> *<a class="code" href="nfs__stat_8h.html#a9b178d7e8d66f4673b531287afde693d">nfsv2_function_names</a>[] = {
<a name="l00106"></a>00106   <span class="stringliteral">&quot;NFSv2_null&quot;</span>, <span class="stringliteral">&quot;NFSv2_getattr&quot;</span>, <span class="stringliteral">&quot;NFSv2_setattr&quot;</span>, <span class="stringliteral">&quot;NFSv2_root&quot;</span>,
<a name="l00107"></a>00107   <span class="stringliteral">&quot;NFSv2_lookup&quot;</span>, <span class="stringliteral">&quot;NFSv2_readlink&quot;</span>, <span class="stringliteral">&quot;NFSv2_read&quot;</span>, <span class="stringliteral">&quot;NFSv2_writecache&quot;</span>,
<a name="l00108"></a>00108   <span class="stringliteral">&quot;NFSv2_write&quot;</span>, <span class="stringliteral">&quot;NFSv2_create&quot;</span>, <span class="stringliteral">&quot;NFSv2_remove&quot;</span>, <span class="stringliteral">&quot;NFSv2_rename&quot;</span>,
<a name="l00109"></a>00109   <span class="stringliteral">&quot;NFSv2_link&quot;</span>, <span class="stringliteral">&quot;NFSv2_symlink&quot;</span>, <span class="stringliteral">&quot;NFSv2_mkdir&quot;</span>, <span class="stringliteral">&quot;NFSv2_rmdir&quot;</span>,
<a name="l00110"></a>00110   <span class="stringliteral">&quot;NFSv2_readdir&quot;</span>, <span class="stringliteral">&quot;NFSv2_statfs&quot;</span>
<a name="l00111"></a>00111 };
<a name="l00112"></a>00112 
<a name="l00113"></a><a class="code" href="nfs__proto__tools_8c.html#ada77a3109d93d5459a3a8c9ad5e617e2">00113</a> <span class="keywordtype">char</span> *<a class="code" href="nfs__stat_8h.html#ada77a3109d93d5459a3a8c9ad5e617e2">nfsv3_function_names</a>[] = {
<a name="l00114"></a>00114   <span class="stringliteral">&quot;NFSv3_null&quot;</span>, <span class="stringliteral">&quot;NFSv3_getattr&quot;</span>, <span class="stringliteral">&quot;NFSv3_setattr&quot;</span>, <span class="stringliteral">&quot;NFSv3_lookup&quot;</span>,
<a name="l00115"></a>00115   <span class="stringliteral">&quot;NFSv3_access&quot;</span>, <span class="stringliteral">&quot;NFSv3_readlink&quot;</span>, <span class="stringliteral">&quot;NFSv3_read&quot;</span>, <span class="stringliteral">&quot;NFSv3_write&quot;</span>,
<a name="l00116"></a>00116   <span class="stringliteral">&quot;NFSv3_create&quot;</span>, <span class="stringliteral">&quot;NFSv3_mkdir&quot;</span>, <span class="stringliteral">&quot;NFSv3_symlink&quot;</span>, <span class="stringliteral">&quot;NFSv3_mknod&quot;</span>,
<a name="l00117"></a>00117   <span class="stringliteral">&quot;NFSv3_remove&quot;</span>, <span class="stringliteral">&quot;NFSv3_rmdir&quot;</span>, <span class="stringliteral">&quot;NFSv3_rename&quot;</span>, <span class="stringliteral">&quot;NFSv3_link&quot;</span>,
<a name="l00118"></a>00118   <span class="stringliteral">&quot;NFSv3_readdir&quot;</span>, <span class="stringliteral">&quot;NFSv3_readdirplus&quot;</span>, <span class="stringliteral">&quot;NFSv3_fsstat&quot;</span>,
<a name="l00119"></a>00119   <span class="stringliteral">&quot;NFSv3_fsinfo&quot;</span>, <span class="stringliteral">&quot;NFSv3_pathconf&quot;</span>, <span class="stringliteral">&quot;NFSv3_commit&quot;</span>
<a name="l00120"></a>00120 };
<a name="l00121"></a>00121 
<a name="l00122"></a><a class="code" href="nfs__proto__tools_8c.html#a0a33ded2ba7f2b400463b0586181902c">00122</a> <span class="keywordtype">char</span> *<a class="code" href="nfs__stat_8h.html#a0a33ded2ba7f2b400463b0586181902c">nfsv4_function_names</a>[] = {
<a name="l00123"></a>00123   <span class="stringliteral">&quot;NFSv4_null&quot;</span>, <span class="stringliteral">&quot;NFSv4_compound&quot;</span>
<a name="l00124"></a>00124 };
<a name="l00125"></a>00125 
<a name="l00126"></a><a class="code" href="nfs__proto__tools_8c.html#aa893efd3113e98abf7b50f400d665b30">00126</a> <span class="keywordtype">char</span> *<a class="code" href="nfs__stat_8h.html#aa893efd3113e98abf7b50f400d665b30">mnt_function_names</a>[] = {
<a name="l00127"></a>00127   <span class="stringliteral">&quot;MNT_null&quot;</span>, <span class="stringliteral">&quot;MNT_mount&quot;</span>, <span class="stringliteral">&quot;MNT_dump&quot;</span>, <span class="stringliteral">&quot;MNT_umount&quot;</span>, <span class="stringliteral">&quot;MNT_umountall&quot;</span>, <span class="stringliteral">&quot;MNT_export&quot;</span>
<a name="l00128"></a>00128 };
<a name="l00129"></a>00129 
<a name="l00130"></a><a class="code" href="nfs__proto__tools_8c.html#af123b6537a8fa1b697bb6613c40f687b">00130</a> <span class="keywordtype">char</span> *<a class="code" href="nfs__stat_8h.html#af123b6537a8fa1b697bb6613c40f687b">rquota_functions_names</a>[] = {
<a name="l00131"></a>00131   <span class="stringliteral">&quot;rquota_Null&quot;</span>, <span class="stringliteral">&quot;rquota_getquota&quot;</span>, <span class="stringliteral">&quot;rquota_getquotaspecific&quot;</span>, <span class="stringliteral">&quot;rquota_setquota&quot;</span>,
<a name="l00132"></a>00132   <span class="stringliteral">&quot;rquota_setquotaspecific&quot;</span>
<a name="l00133"></a>00133 };
<a name="l00134"></a>00134 
<a name="l00148"></a><a class="code" href="nfs__proto__tools_8c.html#af8a0cfaf3ea5c49ec0ea0f157a7b90ab">00148</a> <span class="keywordtype">void</span> <a class="code" href="nfs__proto__tools_8h.html#af8a0cfaf3ea5c49ec0ea0f157a7b90ab">nfs_FhandleToStr</a>(u_long     rq_vers,
<a name="l00149"></a>00149                       <a class="code" href="nfs23_8h.html#a4122a54677d2f66ef8a8f564b6076db2">fhandle2</a>  *pfh2,
<a name="l00150"></a>00150                       <a class="code" href="structnfs__fh3.html">nfs_fh3</a>   *pfh3,
<a name="l00151"></a>00151                       <a class="code" href="structnfs__fh4.html">nfs_fh4</a>   *pfh4,
<a name="l00152"></a>00152                       <span class="keywordtype">char</span>      *str)
<a name="l00153"></a>00153 {
<a name="l00154"></a>00154 
<a name="l00155"></a>00155   <span class="keywordflow">switch</span> (rq_vers)
<a name="l00156"></a>00156     {
<a name="l00157"></a>00157     <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a38cfe5720671dbafe5d1b278f6fe9dec">NFS_V4</a>:
<a name="l00158"></a>00158       <a class="code" href="nfs__file__handle_8h.html#af7cf44dc64d6f08c15f6874adcbdd8de">sprint_fhandle4</a>(str, pfh4);
<a name="l00159"></a>00159       <span class="keywordflow">break</span>;
<a name="l00160"></a>00160 
<a name="l00161"></a>00161     <span class="keywordflow">case</span> <a class="code" href="nfs23_8h.html#ad0f0a57c0aacb6093af91d085b807cbd">NFS_V3</a>:
<a name="l00162"></a>00162       <a class="code" href="nfs__file__handle_8h.html#aacf77e57e01373c6e5bc261be964bb6e">sprint_fhandle3</a>(str, pfh3);
<a name="l00163"></a>00163       <span class="keywordflow">break</span>;
<a name="l00164"></a>00164 
<a name="l00165"></a>00165     <span class="keywordflow">case</span> <a class="code" href="nfs23_8h.html#ab7bf618affb552e91b562c195b52b6a7">NFS_V2</a>:
<a name="l00166"></a>00166       <a class="code" href="nfs__file__handle_8h.html#a3a9c85d9f52b8bbdc1102925bcb320c1">sprint_fhandle2</a>(str, pfh2);
<a name="l00167"></a>00167       <span class="keywordflow">break</span>;
<a name="l00168"></a>00168     }
<a name="l00169"></a>00169 }                               <span class="comment">/* nfs_FhandleToStr */</span>
<a name="l00170"></a>00170 
<a name="l00194"></a><a class="code" href="nfs__proto__tools_8c.html#a8228cc616abf625c61190a8e50769fc1">00194</a> <a class="code" href="structcache__entry__t.html" title="Represents a cached inode.">cache_entry_t</a> *<a class="code" href="nfs__proto__tools_8h.html#a8228cc616abf625c61190a8e50769fc1">nfs_FhandleToCache</a>(u_long rq_vers,
<a name="l00195"></a>00195                                   <a class="code" href="nfs23_8h.html#a4122a54677d2f66ef8a8f564b6076db2">fhandle2</a> * pfh2,
<a name="l00196"></a>00196                                   <a class="code" href="structnfs__fh3.html">nfs_fh3</a> * pfh3,
<a name="l00197"></a>00197                                   <a class="code" href="structnfs__fh4.html">nfs_fh4</a> * pfh4,
<a name="l00198"></a>00198                                   <a class="code" href="nfs23_8h.html#a7aa4ec59cb08c181dab1f366d0c06778">nfsstat2</a> * pstatus2,
<a name="l00199"></a>00199                                   <a class="code" href="nfs23_8h.html#a1721ade9b8e43c719c5834eaaf60aac5">nfsstat3</a> * pstatus3,
<a name="l00200"></a>00200                                   <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0a">nfsstat4</a> * pstatus4,
<a name="l00201"></a>00201                                   <a class="code" href="structfsal__attrib__list____.html">fsal_attrib_list_t</a> * pattr,
<a name="l00202"></a>00202                                   <a class="code" href="structfsal__op__context____.html">fsal_op_context_t</a> * pcontext,
<a name="l00203"></a>00203                                   <span class="keywordtype">int</span> *prc)
<a name="l00204"></a>00204 {
<a name="l00205"></a>00205   <a class="code" href="structcache__inode__fsal__data____.html">cache_inode_fsal_data_t</a> fsal_data;
<a name="l00206"></a>00206   <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2">cache_inode_status_t</a> cache_status;
<a name="l00207"></a>00207   <a class="code" href="structcache__entry__t.html" title="Represents a cached inode.">cache_entry_t</a> *pentry = <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00208"></a>00208   <a class="code" href="structfsal__attrib__list____.html">fsal_attrib_list_t</a> attr;
<a name="l00209"></a>00209   <a class="code" href="structexportlist____.html">exportlist_t</a> *pexport = <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00210"></a>00210   <span class="keywordtype">short</span> exportid = 0;
<a name="l00211"></a>00211 
<a name="l00212"></a>00212   <span class="comment">/* Default behaviour */</span>
<a name="l00213"></a>00213   *prc = <a class="code" href="group__NFSprocs.html#ga2c5937c697db19bb296a6393191d5600">NFS_REQ_OK</a>;
<a name="l00214"></a>00214 
<a name="l00215"></a>00215   memset(&amp;fsal_data, 0, <span class="keyword">sizeof</span>(fsal_data));
<a name="l00216"></a>00216   <span class="keywordflow">switch</span> (rq_vers)
<a name="l00217"></a>00217     {
<a name="l00218"></a>00218     <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a38cfe5720671dbafe5d1b278f6fe9dec">NFS_V4</a>:
<a name="l00219"></a>00219       <span class="keywordflow">if</span>(!<a class="code" href="nfs__file__handle_8h.html#a7c04885ca0eec5af44ad719daaf0622f">nfs4_FhandleToFSAL</a>(pfh4, &amp;fsal_data.<a class="code" href="structcache__inode__fsal__data____.html#a4bb6eae804842b06f773ddeb873fb5b5">fh_desc</a>, pcontext))
<a name="l00220"></a>00220         {
<a name="l00221"></a>00221           *prc = <a class="code" href="group__NFSprocs.html#gad48913a4e6ea3bdaca974a4c4fccd6c2">NFS_REQ_DROP</a>;
<a name="l00222"></a>00222           *pstatus4 = <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aad8e75713659423bc53b60934e6b2698f">NFS4ERR_BADHANDLE</a>;
<a name="l00223"></a>00223           <span class="keywordflow">return</span> <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00224"></a>00224         }
<a name="l00225"></a>00225       exportid = <a class="code" href="nfs__file__handle_8h.html#abd252dd5f6d20c1b81760f8b2185e35d">nfs4_FhandleToExportId</a>(pfh4);
<a name="l00226"></a>00226       <span class="keywordflow">break</span>;
<a name="l00227"></a>00227 
<a name="l00228"></a>00228     <span class="keywordflow">case</span> <a class="code" href="nfs23_8h.html#ad0f0a57c0aacb6093af91d085b807cbd">NFS_V3</a>:
<a name="l00229"></a>00229       <span class="keywordflow">if</span>(!<a class="code" href="nfs__file__handle_8h.html#ac4b3303a5e40600c415dab544800c996">nfs3_FhandleToFSAL</a>(pfh3, &amp;fsal_data.<a class="code" href="structcache__inode__fsal__data____.html#a4bb6eae804842b06f773ddeb873fb5b5">fh_desc</a>, pcontext))
<a name="l00230"></a>00230         {
<a name="l00231"></a>00231           *prc = <a class="code" href="group__NFSprocs.html#gad48913a4e6ea3bdaca974a4c4fccd6c2">NFS_REQ_DROP</a>;
<a name="l00232"></a>00232           *pstatus3 = <a class="code" href="nfs23_8h.html#a1721ade9b8e43c719c5834eaaf60aac5af51a2547c160e07a7eac20c8150a1ae1">NFS3ERR_BADHANDLE</a>;
<a name="l00233"></a>00233           <span class="keywordflow">return</span> <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00234"></a>00234         }
<a name="l00235"></a>00235       exportid = <a class="code" href="nfs__file__handle_8h.html#a8453425f543449aa0b989e06731395f3">nfs3_FhandleToExportId</a>(pfh3);
<a name="l00236"></a>00236       <span class="keywordflow">break</span>;
<a name="l00237"></a>00237 
<a name="l00238"></a>00238     <span class="keywordflow">case</span> <a class="code" href="nfs23_8h.html#ab7bf618affb552e91b562c195b52b6a7">NFS_V2</a>:
<a name="l00239"></a>00239       <span class="keywordflow">if</span>(!<a class="code" href="nfs__file__handle_8h.html#a86930f1fe49ff73de746cff184a31b05">nfs2_FhandleToFSAL</a>(pfh2, &amp;fsal_data.<a class="code" href="structcache__inode__fsal__data____.html#a4bb6eae804842b06f773ddeb873fb5b5">fh_desc</a>, pcontext))
<a name="l00240"></a>00240         {
<a name="l00241"></a>00241           *prc = <a class="code" href="group__NFSprocs.html#gad48913a4e6ea3bdaca974a4c4fccd6c2">NFS_REQ_DROP</a>;
<a name="l00242"></a>00242           *pstatus2 = <a class="code" href="nfs23_8h.html#a7aa4ec59cb08c181dab1f366d0c06778aa647fadfd33f10bfa26008dc3f91bfc4">NFSERR_STALE</a>;
<a name="l00243"></a>00243           <span class="keywordflow">return</span> <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00244"></a>00244         }
<a name="l00245"></a>00245       exportid = <a class="code" href="nfs__file__handle_8h.html#a4e15ee51a5126d013954cb8ddf34b62b">nfs2_FhandleToExportId</a>(pfh2);
<a name="l00246"></a>00246       <span class="keywordflow">break</span>;
<a name="l00247"></a>00247     }
<a name="l00248"></a>00248 
<a name="l00249"></a>00249   <a class="code" href="nfs__file__handle_8h.html#a3d381aeccd1e8570ce7e216bc912d2ea">print_buff</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556afb05059e688b5317f3861f11bff44505">COMPONENT_FILEHANDLE</a>,
<a name="l00250"></a>00250              fsal_data.<a class="code" href="structcache__inode__fsal__data____.html#a4bb6eae804842b06f773ddeb873fb5b5">fh_desc</a>.<a class="code" href="structfsal__handle__desc.html#abd5b9bc086e7fdd84b0411bbbd8f266a">start</a>,
<a name="l00251"></a>00251              fsal_data.<a class="code" href="structcache__inode__fsal__data____.html#a4bb6eae804842b06f773ddeb873fb5b5">fh_desc</a>.<a class="code" href="structfsal__handle__desc.html#ac26d3f3266e78ecaffc1e39e937923f8">len</a>);
<a name="l00252"></a>00252 
<a name="l00253"></a>00253   <span class="keywordflow">if</span>((pexport = <a class="code" href="nfs__exports_8h.html#a7ccd248588595588755f71322288a8df">nfs_Get_export_by_id</a>(<a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#ac8fc09bcd317cc133cd1f8b6b3478aa3">pexportlist</a>, exportid)) == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00254"></a>00254     {
<a name="l00255"></a>00255       <span class="comment">/* invalid handle */</span>
<a name="l00256"></a>00256       <span class="keywordflow">switch</span> (rq_vers)
<a name="l00257"></a>00257         {
<a name="l00258"></a>00258         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a38cfe5720671dbafe5d1b278f6fe9dec">NFS_V4</a>:
<a name="l00259"></a>00259           *pstatus4 = <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aae6e007575347505f02ae672942df2ede">NFS4ERR_STALE</a>;
<a name="l00260"></a>00260           <span class="keywordflow">break</span>;
<a name="l00261"></a>00261 
<a name="l00262"></a>00262         <span class="keywordflow">case</span> <a class="code" href="nfs23_8h.html#ad0f0a57c0aacb6093af91d085b807cbd">NFS_V3</a>:
<a name="l00263"></a>00263           *pstatus3 = <a class="code" href="nfs23_8h.html#a1721ade9b8e43c719c5834eaaf60aac5a8b5bc86220f037a887e03c06f3698729">NFS3ERR_STALE</a>;
<a name="l00264"></a>00264           <span class="keywordflow">break</span>;
<a name="l00265"></a>00265 
<a name="l00266"></a>00266         <span class="keywordflow">case</span> <a class="code" href="nfs23_8h.html#ab7bf618affb552e91b562c195b52b6a7">NFS_V2</a>:
<a name="l00267"></a>00267           *pstatus2 = <a class="code" href="nfs23_8h.html#a7aa4ec59cb08c181dab1f366d0c06778aa647fadfd33f10bfa26008dc3f91bfc4">NFSERR_STALE</a>;
<a name="l00268"></a>00268           <span class="keywordflow">break</span>;
<a name="l00269"></a>00269         }
<a name="l00270"></a>00270       *prc = <a class="code" href="group__NFSprocs.html#gad48913a4e6ea3bdaca974a4c4fccd6c2">NFS_REQ_DROP</a>;
<a name="l00271"></a>00271 
<a name="l00272"></a>00272       <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556af6e90cb9d43106e13df4e83652c94f27">COMPONENT_NFSPROTO</a>,
<a name="l00273"></a>00273                    <span class="stringliteral">&quot;Invalid file handle passed to nfsFhandleToCache &quot;</span>);
<a name="l00274"></a>00274       <span class="keywordflow">return</span> <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00275"></a>00275     }
<a name="l00276"></a>00276 
<a name="l00277"></a>00277   <span class="keywordflow">if</span>((pentry = <a class="code" href="cache__inode__get_8c.html#af93e3320581ae2ea6e5633598d5a2c77" title="Gets an entry by using its fsdata as a key and caches it if needed.">cache_inode_get</a>(&amp;fsal_data, &amp;attr, pcontext,
<a name="l00278"></a>00278                                <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, &amp;cache_status)) == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00279"></a>00279     {
<a name="l00280"></a>00280       <span class="keywordflow">switch</span> (rq_vers)
<a name="l00281"></a>00281         {
<a name="l00282"></a>00282         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a38cfe5720671dbafe5d1b278f6fe9dec">NFS_V4</a>:
<a name="l00283"></a>00283           *pstatus4 = <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aae6e007575347505f02ae672942df2ede">NFS4ERR_STALE</a>;
<a name="l00284"></a>00284           <span class="keywordflow">break</span>;
<a name="l00285"></a>00285 
<a name="l00286"></a>00286         <span class="keywordflow">case</span> <a class="code" href="nfs23_8h.html#ad0f0a57c0aacb6093af91d085b807cbd">NFS_V3</a>:
<a name="l00287"></a>00287           *pstatus3 = <a class="code" href="nfs23_8h.html#a1721ade9b8e43c719c5834eaaf60aac5a8b5bc86220f037a887e03c06f3698729">NFS3ERR_STALE</a>;
<a name="l00288"></a>00288           <span class="keywordflow">break</span>;
<a name="l00289"></a>00289 
<a name="l00290"></a>00290         <span class="keywordflow">case</span> <a class="code" href="nfs23_8h.html#ab7bf618affb552e91b562c195b52b6a7">NFS_V2</a>:
<a name="l00291"></a>00291           *pstatus2 = <a class="code" href="nfs23_8h.html#a7aa4ec59cb08c181dab1f366d0c06778aa647fadfd33f10bfa26008dc3f91bfc4">NFSERR_STALE</a>;
<a name="l00292"></a>00292           <span class="keywordflow">break</span>;
<a name="l00293"></a>00293         }
<a name="l00294"></a>00294       *prc = <a class="code" href="group__NFSprocs.html#ga2c5937c697db19bb296a6393191d5600">NFS_REQ_OK</a>;
<a name="l00295"></a>00295       <span class="keywordflow">return</span> <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00296"></a>00296     }
<a name="l00297"></a>00297 
<a name="l00298"></a>00298   <span class="keywordflow">if</span>(pattr != <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00299"></a>00299     *pattr = attr;
<a name="l00300"></a>00300 
<a name="l00301"></a>00301   <span class="keywordflow">return</span> pentry;
<a name="l00302"></a>00302 }                               <span class="comment">/* nfs_FhandleToCache */</span>
<a name="l00303"></a>00303 
<a name="l00315"></a><a class="code" href="nfs__proto__tools_8c.html#a2c06fec5fb15635d2e89a2d552b4459f">00315</a> <span class="keywordtype">int</span> <a class="code" href="nfs__proto__tools_8h.html#a2c06fec5fb15635d2e89a2d552b4459f">nfs_SetPostOpAttr</a>(<a class="code" href="structexportlist____.html">exportlist_t</a> *pexport,
<a name="l00316"></a>00316                       <span class="keyword">const</span> <a class="code" href="structfsal__attrib__list____.html">fsal_attrib_list_t</a> *pfsal_attr,
<a name="l00317"></a>00317                       <a class="code" href="structpost__op__attr.html">post_op_attr</a> *presult)
<a name="l00318"></a>00318 {
<a name="l00319"></a>00319   <span class="keywordflow">if</span>(pfsal_attr == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00320"></a>00320     {
<a name="l00321"></a>00321       presult-&gt;<a class="code" href="structpost__op__attr.html#a7eed0c4cb54b1759439f7b9d69e3f818">attributes_follow</a>
<a name="l00322"></a>00322            = <a class="code" href="group__NFSprocs.html#ga134d926570de1b1bd6fcc5be03a78a51">nfs3_FSALattr_To_Fattr</a>(pexport,
<a name="l00323"></a>00323                                     pfsal_attr,
<a name="l00324"></a>00324                                     &amp;(presult-&gt;<a class="code" href="structpost__op__attr.html#abc6a2ba00641a7cfc4cb6820ec9d1a65">post_op_attr_u</a>.<a class="code" href="structpost__op__attr.html#a2f531f07da6ccee97f0bd006cf91a248">attributes</a>));
<a name="l00325"></a>00325     }
<a name="l00326"></a>00326 
<a name="l00327"></a>00327   <span class="keywordflow">if</span>(<a class="code" href="group__NFSprocs.html#ga134d926570de1b1bd6fcc5be03a78a51">nfs3_FSALattr_To_Fattr</a>(pexport,
<a name="l00328"></a>00328                             pfsal_attr,
<a name="l00329"></a>00329                             &amp;(presult-&gt;<a class="code" href="structpost__op__attr.html#abc6a2ba00641a7cfc4cb6820ec9d1a65">post_op_attr_u</a>.<a class="code" href="structpost__op__attr.html#a2f531f07da6ccee97f0bd006cf91a248">attributes</a>))
<a name="l00330"></a>00330      == 0)
<a name="l00331"></a>00331     presult-&gt;<a class="code" href="structpost__op__attr.html#a7eed0c4cb54b1759439f7b9d69e3f818">attributes_follow</a> = <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00332"></a>00332   <span class="keywordflow">else</span>
<a name="l00333"></a>00333     presult-&gt;<a class="code" href="structpost__op__attr.html#a7eed0c4cb54b1759439f7b9d69e3f818">attributes_follow</a> = <a class="code" href="HashTable_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00334"></a>00334 
<a name="l00335"></a>00335   <span class="keywordflow">return</span> 0;
<a name="l00336"></a>00336 } <span class="comment">/* nfs_SetPostOpAttr */</span>
<a name="l00337"></a>00337 
<a name="l00350"></a><a class="code" href="nfs__proto__tools_8c.html#a1af0b19592ea464c9a7aadd563a42e92">00350</a> <span class="keywordtype">void</span> <a class="code" href="nfs__proto__tools_8h.html#a1af0b19592ea464c9a7aadd563a42e92">nfs_SetPreOpAttr</a>(<a class="code" href="structfsal__attrib__list____.html">fsal_attrib_list_t</a> * pfsal_attr, <a class="code" href="structpre__op__attr.html">pre_op_attr</a> * pattr)
<a name="l00351"></a>00351 {
<a name="l00352"></a>00352   <span class="keywordflow">if</span>(pfsal_attr == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00353"></a>00353     {
<a name="l00354"></a>00354       pattr-&gt;<a class="code" href="structpre__op__attr.html#a1f5d71767f1e6b76ec35f5fc34859a57">attributes_follow</a> = <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00355"></a>00355     }
<a name="l00356"></a>00356   <span class="keywordflow">else</span>
<a name="l00357"></a>00357     {
<a name="l00358"></a>00358       pattr-&gt;<a class="code" href="structpre__op__attr.html#ae00e06d3376aaacd42b7a89a0f3878ef">pre_op_attr_u</a>.<a class="code" href="structpre__op__attr.html#aad31dce15a8670cc5744b89dd2da265b">attributes</a>.<a class="code" href="structwcc__attr.html#ab9b1a271d60b32f67d41b0f2cb59b6f0">size</a> = pfsal_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a0105c962cf3b7c8d11e2e2d1c5acff31">filesize</a>;
<a name="l00359"></a>00359       pattr-&gt;<a class="code" href="structpre__op__attr.html#ae00e06d3376aaacd42b7a89a0f3878ef">pre_op_attr_u</a>.<a class="code" href="structpre__op__attr.html#aad31dce15a8670cc5744b89dd2da265b">attributes</a>.<a class="code" href="structwcc__attr.html#aa90fb6afd5a3824894919701ccdc9713">mtime</a>.<a class="code" href="structnfstime3.html#a6765f76aef63ace5fb0ce3dc904f14c3">seconds</a> = pfsal_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a441daefe7cc86152355f895d81bc2936">mtime</a>.<a class="code" href="structfsal__time____.html#add92ec6180384f0ba10dd2a79b659548">seconds</a>;
<a name="l00360"></a>00360       pattr-&gt;<a class="code" href="structpre__op__attr.html#ae00e06d3376aaacd42b7a89a0f3878ef">pre_op_attr_u</a>.<a class="code" href="structpre__op__attr.html#aad31dce15a8670cc5744b89dd2da265b">attributes</a>.<a class="code" href="structwcc__attr.html#aa90fb6afd5a3824894919701ccdc9713">mtime</a>.<a class="code" href="structnfstime3.html#aad0965ff90c90abd7d7c4c431e7e41a1">nseconds</a> = 0 ;
<a name="l00361"></a>00361 
<a name="l00362"></a>00362       pattr-&gt;<a class="code" href="structpre__op__attr.html#ae00e06d3376aaacd42b7a89a0f3878ef">pre_op_attr_u</a>.<a class="code" href="structpre__op__attr.html#aad31dce15a8670cc5744b89dd2da265b">attributes</a>.<a class="code" href="structwcc__attr.html#ad5d9b31c95d7c615e3552e86c5c0fa14">ctime</a>.<a class="code" href="structnfstime3.html#a6765f76aef63ace5fb0ce3dc904f14c3">seconds</a> = pfsal_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7087852b901550fbbc6ba2aed12c96ef">ctime</a>.<a class="code" href="structfsal__time____.html#add92ec6180384f0ba10dd2a79b659548">seconds</a>;
<a name="l00363"></a>00363       pattr-&gt;<a class="code" href="structpre__op__attr.html#ae00e06d3376aaacd42b7a89a0f3878ef">pre_op_attr_u</a>.<a class="code" href="structpre__op__attr.html#aad31dce15a8670cc5744b89dd2da265b">attributes</a>.<a class="code" href="structwcc__attr.html#ad5d9b31c95d7c615e3552e86c5c0fa14">ctime</a>.<a class="code" href="structnfstime3.html#aad0965ff90c90abd7d7c4c431e7e41a1">nseconds</a> = 0; 
<a name="l00364"></a>00364 
<a name="l00365"></a>00365       pattr-&gt;<a class="code" href="structpre__op__attr.html#a1f5d71767f1e6b76ec35f5fc34859a57">attributes_follow</a> = <a class="code" href="HashTable_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00366"></a>00366     }
<a name="l00367"></a>00367 }                               <span class="comment">/* nfs_SetPreOpAttr */</span>
<a name="l00368"></a>00368 
<a name="l00384"></a><a class="code" href="nfs__proto__tools_8c.html#a18db142ba79833f20e2705ada8a3bf16">00384</a> <span class="keywordtype">void</span> <a class="code" href="nfs__proto__tools_8h.html#a18db142ba79833f20e2705ada8a3bf16">nfs_SetWccData</a>(<a class="code" href="structexportlist____.html">exportlist_t</a> * pexport,
<a name="l00385"></a>00385                     <a class="code" href="structfsal__attrib__list____.html">fsal_attrib_list_t</a> * pbefore_attr,
<a name="l00386"></a>00386                     <a class="code" href="structfsal__attrib__list____.html">fsal_attrib_list_t</a> * pafter_attr, <a class="code" href="structwcc__data.html">wcc_data</a> * pwcc_data)
<a name="l00387"></a>00387 {
<a name="l00388"></a>00388   <span class="comment">/* Build directory pre operation attributes */</span>
<a name="l00389"></a>00389   <a class="code" href="nfs__proto__tools_8h.html#a1af0b19592ea464c9a7aadd563a42e92">nfs_SetPreOpAttr</a>(pbefore_attr, &amp;(pwcc_data-&gt;<a class="code" href="structwcc__data.html#a5a59ba86fd24d197a6deae0b676a50ca">before</a>));
<a name="l00390"></a>00390 
<a name="l00391"></a>00391   <span class="comment">/* Build directory post operation attributes */</span>
<a name="l00392"></a>00392   <a class="code" href="nfs__proto__tools_8h.html#a2c06fec5fb15635d2e89a2d552b4459f">nfs_SetPostOpAttr</a>(pexport, pafter_attr, &amp;(pwcc_data-&gt;<a class="code" href="structwcc__data.html#a2b29caacf2c5a44c0ef3c5cddbd92902">after</a>));
<a name="l00393"></a>00393 }                               <span class="comment">/* nfs_SetWccData */</span>
<a name="l00394"></a>00394 
<a name="l00408"></a><a class="code" href="nfs__proto__tools_8c.html#a42b9be27d5c5fd939c1eeb7e8b9e96df">00408</a> <span class="keywordtype">int</span> <a class="code" href="nfs__proto__tools_8h.html#a42b9be27d5c5fd939c1eeb7e8b9e96df">nfs_RetryableError</a>(<a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2">cache_inode_status_t</a> cache_status)
<a name="l00409"></a>00409 {
<a name="l00410"></a>00410   <span class="keywordflow">switch</span> (cache_status)
<a name="l00411"></a>00411     {
<a name="l00412"></a>00412     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2acc50439e4e107ce5487e79adfdbf4dc0">CACHE_INODE_IO_ERROR</a>:
<a name="l00413"></a>00413       <span class="keywordflow">if</span>(<a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#aeef2995e9b54747311db1972d158fd41">core_param</a>.<a class="code" href="structnfs__core__param____.html#a5bcea5af9eb65c6c4b86f84ea931d351">drop_io_errors</a>)
<a name="l00414"></a>00414         {
<a name="l00415"></a>00415           <span class="comment">/* Drop the request */</span>
<a name="l00416"></a>00416           <span class="keywordflow">return</span> <a class="code" href="HashTable_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00417"></a>00417         }
<a name="l00418"></a>00418       <span class="keywordflow">else</span>
<a name="l00419"></a>00419         {
<a name="l00420"></a>00420           <span class="comment">/* Propagate error to the client */</span>
<a name="l00421"></a>00421           <span class="keywordflow">return</span> <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00422"></a>00422         }
<a name="l00423"></a>00423       <span class="keywordflow">break</span>;
<a name="l00424"></a>00424 
<a name="l00425"></a>00425     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a07fdf53f0646a04f877c108ed99c293b">CACHE_INODE_INVALID_ARGUMENT</a>:
<a name="l00426"></a>00426       <span class="keywordflow">if</span>(<a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#aeef2995e9b54747311db1972d158fd41">core_param</a>.<a class="code" href="structnfs__core__param____.html#ad53850a96a7505953b0fcf654679031c">drop_inval_errors</a>)
<a name="l00427"></a>00427         {
<a name="l00428"></a>00428           <span class="comment">/* Drop the request */</span>
<a name="l00429"></a>00429           <span class="keywordflow">return</span> <a class="code" href="HashTable_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00430"></a>00430         }
<a name="l00431"></a>00431       <span class="keywordflow">else</span>
<a name="l00432"></a>00432         {
<a name="l00433"></a>00433           <span class="comment">/* Propagate error to the client */</span>
<a name="l00434"></a>00434           <span class="keywordflow">return</span> <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00435"></a>00435         }
<a name="l00436"></a>00436       <span class="keywordflow">break</span>;
<a name="l00437"></a>00437 
<a name="l00438"></a>00438     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a682d21c0f90702d383c9b658e169f534">CACHE_INODE_DELAY</a>:
<a name="l00439"></a>00439       <span class="keywordflow">if</span>(<a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#aeef2995e9b54747311db1972d158fd41">core_param</a>.<a class="code" href="structnfs__core__param____.html#a5057124e2ec18a656729078748a6b8c2">drop_delay_errors</a>)
<a name="l00440"></a>00440         {
<a name="l00441"></a>00441           <span class="comment">/* Drop the request */</span>
<a name="l00442"></a>00442           <span class="keywordflow">return</span> <a class="code" href="HashTable_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00443"></a>00443         }
<a name="l00444"></a>00444       <span class="keywordflow">else</span>
<a name="l00445"></a>00445         {
<a name="l00446"></a>00446           <span class="comment">/* Propagate error to the client */</span>
<a name="l00447"></a>00447           <span class="keywordflow">return</span> <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00448"></a>00448         }
<a name="l00449"></a>00449       <span class="keywordflow">break</span>;
<a name="l00450"></a>00450 
<a name="l00451"></a>00451     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a3fdbbb2367268ae84ac11d7b189643d8">CACHE_INODE_SUCCESS</a>:
<a name="l00452"></a>00452       <a class="code" href="test__findlog_8c.html#adfd9432c5478fa14c7d678edb301feed">LogCrit</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556af6e90cb9d43106e13df4e83652c94f27">COMPONENT_NFSPROTO</a>,
<a name="l00453"></a>00453               <span class="stringliteral">&quot;Possible implementation error: CACHE_INODE_SUCCESS managed as an error&quot;</span>);
<a name="l00454"></a>00454       <span class="keywordflow">return</span> <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00455"></a>00455       <span class="keywordflow">break</span>;
<a name="l00456"></a>00456 
<a name="l00457"></a>00457     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a1915843665e061f9b874510cc6382bc9">CACHE_INODE_MALLOC_ERROR</a>:
<a name="l00458"></a>00458     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a9cf5e7e7d9af15c56de98d2e3a8528ce">CACHE_INODE_POOL_MUTEX_INIT_ERROR</a>:
<a name="l00459"></a>00459     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a7fce719c38bc7c5184590549d6d659d1">CACHE_INODE_GET_NEW_LRU_ENTRY</a>:
<a name="l00460"></a>00460     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a1fb3e5d693699c6142279757810ae6c3">CACHE_INODE_UNAPPROPRIATED_KEY</a>:
<a name="l00461"></a>00461     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a86613bc3a05ba135756f102393944133">CACHE_INODE_INIT_ENTRY_FAILED</a>:
<a name="l00462"></a>00462     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2aa3de98320a1cba72aeeefd31e124712a">CACHE_INODE_FSAL_ERROR</a>:
<a name="l00463"></a>00463     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a076de8b129f67057d1294bedf7094aed">CACHE_INODE_LRU_ERROR</a>:
<a name="l00464"></a>00464     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2ac1838632304273d612cd61d2ab31a1ce">CACHE_INODE_HASH_SET_ERROR</a>:
<a name="l00465"></a>00465     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a3b4d85140a3d8f501b3e318c82f0d13a">CACHE_INODE_INCONSISTENT_ENTRY</a>:
<a name="l00466"></a>00466     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a37c51c9a4e1098130f3d50e15af58635">CACHE_INODE_HASH_TABLE_ERROR</a>:
<a name="l00467"></a>00467     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2af9495df7ccc04c50609ceaf8f81e9c9b">CACHE_INODE_INSERT_ERROR</a>:
<a name="l00468"></a>00468       <span class="comment">/* Internal error, should be dropped and retryed */</span>
<a name="l00469"></a>00469       <span class="keywordflow">return</span> <a class="code" href="HashTable_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00470"></a>00470       <span class="keywordflow">break</span>;
<a name="l00471"></a>00471 
<a name="l00472"></a>00472     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a31102fd54b8481b29ee40b6a7f692e75">CACHE_INODE_NOT_A_DIRECTORY</a>:
<a name="l00473"></a>00473     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a461c7aae0d7d8861bc61ee7031bf79a9">CACHE_INODE_BAD_TYPE</a>:
<a name="l00474"></a>00474     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2ae81d3dfa51b14e0e0a26bb33b2f46490">CACHE_INODE_ENTRY_EXISTS</a>:
<a name="l00475"></a>00475     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2aa13bf3166511315448442f01b9909bfa">CACHE_INODE_DIR_NOT_EMPTY</a>:
<a name="l00476"></a>00476     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a49bfbcb4177d74986dd63a1c8aaaadfc">CACHE_INODE_NOT_FOUND</a>:
<a name="l00477"></a>00477     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2afa6e4cda579bf50a4cc7efddccab904b">CACHE_INODE_FSAL_EACCESS</a>:
<a name="l00478"></a>00478     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a3c0860cc76f604bcfc7bc09779d3d06c">CACHE_INODE_IS_A_DIRECTORY</a>:
<a name="l00479"></a>00479     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2aaf42a5520c80584c436e6577c848fbed">CACHE_INODE_FSAL_EPERM</a>:
<a name="l00480"></a>00480     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a0b3b3a0e6a65c9f375c366e6d0349852">CACHE_INODE_NO_SPACE_LEFT</a>:
<a name="l00481"></a>00481     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a6ea3d914d4fb4de66c7d13f31245a5ac">CACHE_INODE_CACHE_CONTENT_ERROR</a>:
<a name="l00482"></a>00482     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2ab5b3592038c0b37022a99a7b0c87aa17">CACHE_INODE_CACHE_CONTENT_EXISTS</a>:
<a name="l00483"></a>00483     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2ad76de37772e149413ed754160f118752">CACHE_INODE_CACHE_CONTENT_EMPTY</a>:
<a name="l00484"></a>00484     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a2735653dbb65fcae621e042fe40316e3">CACHE_INODE_READ_ONLY_FS</a>:
<a name="l00485"></a>00485     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2ac101705a0ba258752096d3b209a6c588">CACHE_INODE_KILLED</a>:
<a name="l00486"></a>00486     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a753b5e42145f8290242d1990792dbb0d">CACHE_INODE_FSAL_ESTALE</a>:
<a name="l00487"></a>00487     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2acdd7ce7a12331e8bd87270730d23b298">CACHE_INODE_FSAL_ERR_SEC</a>:
<a name="l00488"></a>00488     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2af5c6f8a87057aebc9e59154de348d56a">CACHE_INODE_QUOTA_EXCEEDED</a>:
<a name="l00489"></a>00489     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a58fc37d01af497af261b2ee8ce65f137">CACHE_INODE_NOT_SUPPORTED</a>:
<a name="l00490"></a>00490     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2aca5633ef3c1b4ca3d7b6c757b33e6cad">CACHE_INODE_NAME_TOO_LONG</a>:
<a name="l00491"></a>00491     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2ad34d88bf1ed87798b4c684a4fa5ac940">CACHE_INODE_STATE_CONFLICT</a>:
<a name="l00492"></a>00492     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2ac52f764b2c5c664df1cf11d8751965fb">CACHE_INODE_DEAD_ENTRY</a>:
<a name="l00493"></a>00493     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a216876f1f0ed1ec8c7e61969e9e6cbfb">CACHE_INODE_ASYNC_POST_ERROR</a>:
<a name="l00494"></a>00494     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a30d77d9ece8c0b24f90e6839eba76906">CACHE_INODE_STATE_ERROR</a>:
<a name="l00495"></a>00495     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2aab32538c7951dae2ab8e045c141cb348">CACHE_INODE_BAD_COOKIE</a>:
<a name="l00496"></a>00496     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a7aa1c02604a27429b69ae2acf7914c37">CACHE_INODE_FILE_BIG</a>:
<a name="l00497"></a>00497     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a913f825d5ec21974a3c12eb143b6f5de">CACHE_INODE_FILE_OPEN</a>:
<a name="l00498"></a>00498       <span class="comment">/* Non retryable error, return error to client */</span>
<a name="l00499"></a>00499       <span class="keywordflow">return</span> <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00500"></a>00500       <span class="keywordflow">break</span>;
<a name="l00501"></a>00501     }
<a name="l00502"></a>00502 
<a name="l00503"></a>00503   <span class="comment">/* Should never reach this */</span>
<a name="l00504"></a>00504   <a class="code" href="log_8h.html#aa7aee8ec65b5baafb430f8d2a7588d53">LogDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556af6e90cb9d43106e13df4e83652c94f27">COMPONENT_NFSPROTO</a>,
<a name="l00505"></a>00505            <span class="stringliteral">&quot;cache_inode_status=%u not managed properly in nfs_RetryableError, line %u should never be reached&quot;</span>,
<a name="l00506"></a>00506            cache_status, __LINE__);
<a name="l00507"></a>00507   <span class="keywordflow">return</span> <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00508"></a>00508 }
<a name="l00509"></a>00509 
<a name="l00510"></a><a class="code" href="nfs__proto__tools_8c.html#ac2de99fb1ffdf13ba2047ff934da0956">00510</a> <span class="keywordtype">void</span> <a class="code" href="nfs__proto__tools_8h.html#ac2de99fb1ffdf13ba2047ff934da0956">nfs_SetFailedStatus</a>(<a class="code" href="structfsal__op__context____.html">fsal_op_context_t</a> * pcontext,
<a name="l00511"></a>00511                          <a class="code" href="structexportlist____.html">exportlist_t</a> * pexport,
<a name="l00512"></a>00512                          <span class="keywordtype">int</span> version,
<a name="l00513"></a>00513                          <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2">cache_inode_status_t</a> status,
<a name="l00514"></a>00514                          <a class="code" href="nfs23_8h.html#a7aa4ec59cb08c181dab1f366d0c06778">nfsstat2</a> * pstatus2,
<a name="l00515"></a>00515                          <a class="code" href="nfs23_8h.html#a1721ade9b8e43c719c5834eaaf60aac5">nfsstat3</a> * pstatus3,
<a name="l00516"></a>00516                          <a class="code" href="structcache__entry__t.html" title="Represents a cached inode.">cache_entry_t</a> * pentry0,
<a name="l00517"></a>00517                          <a class="code" href="structpost__op__attr.html">post_op_attr</a> * ppost_op_attr,
<a name="l00518"></a>00518                          <a class="code" href="structcache__entry__t.html" title="Represents a cached inode.">cache_entry_t</a> * pentry1,
<a name="l00519"></a>00519                          <a class="code" href="structfsal__attrib__list____.html">fsal_attrib_list_t</a> * ppre_vattr1,
<a name="l00520"></a>00520                          <a class="code" href="structwcc__data.html">wcc_data</a> * pwcc_data1,
<a name="l00521"></a>00521                          <a class="code" href="structcache__entry__t.html" title="Represents a cached inode.">cache_entry_t</a> * pentry2,
<a name="l00522"></a>00522                          <a class="code" href="structfsal__attrib__list____.html">fsal_attrib_list_t</a> * ppre_vattr2, <a class="code" href="structwcc__data.html">wcc_data</a> * pwcc_data2)
<a name="l00523"></a>00523 {
<a name="l00524"></a>00524   <span class="keywordflow">switch</span> (version)
<a name="l00525"></a>00525     {
<a name="l00526"></a>00526     <span class="keywordflow">case</span> <a class="code" href="nfs23_8h.html#ab7bf618affb552e91b562c195b52b6a7">NFS_V2</a>:
<a name="l00527"></a>00527       <span class="keywordflow">if</span>(status != <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a3fdbbb2367268ae84ac11d7b189643d8">CACHE_INODE_SUCCESS</a>) <span class="comment">/* Should not use success to address a failed status */</span>
<a name="l00528"></a>00528         *pstatus2 = <a class="code" href="group__NFSprocs.html#ga90fe1b6090478dd005254a847ecb287e">nfs2_Errno</a>(status);
<a name="l00529"></a>00529       <span class="keywordflow">break</span>;
<a name="l00530"></a>00530 
<a name="l00531"></a>00531     <span class="keywordflow">case</span> <a class="code" href="nfs23_8h.html#ad0f0a57c0aacb6093af91d085b807cbd">NFS_V3</a>:
<a name="l00532"></a>00532       <span class="keywordflow">if</span>(status != <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a3fdbbb2367268ae84ac11d7b189643d8">CACHE_INODE_SUCCESS</a>) <span class="comment">/* Should not use success to address a failed status */</span>
<a name="l00533"></a>00533         *pstatus3 = <a class="code" href="group__NFSprocs.html#gaa4f9710cdfa7157d9b730110d4cb0621">nfs3_Errno</a>(status);
<a name="l00534"></a>00534 
<a name="l00535"></a>00535       <span class="keywordflow">if</span>(ppost_op_attr != <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00536"></a>00536         <a class="code" href="nfs__proto__tools_8h.html#a2c06fec5fb15635d2e89a2d552b4459f">nfs_SetPostOpAttr</a>(pexport, <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, ppost_op_attr);
<a name="l00537"></a>00537 
<a name="l00538"></a>00538       <span class="keywordflow">if</span>(pwcc_data1 != <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00539"></a>00539         <a class="code" href="nfs__proto__tools_8h.html#a18db142ba79833f20e2705ada8a3bf16">nfs_SetWccData</a>(pexport, ppre_vattr1, <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, pwcc_data1);
<a name="l00540"></a>00540 
<a name="l00541"></a>00541       <span class="keywordflow">if</span>(pwcc_data2 != <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00542"></a>00542         <a class="code" href="nfs__proto__tools_8h.html#a18db142ba79833f20e2705ada8a3bf16">nfs_SetWccData</a>(pexport, ppre_vattr2, <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, pwcc_data2);
<a name="l00543"></a>00543       <span class="keywordflow">break</span>;
<a name="l00544"></a>00544 
<a name="l00545"></a>00545     }
<a name="l00546"></a>00546 }
<a name="l00547"></a>00547 
<a name="l00548"></a>00548 <span class="preprocessor">#ifdef _USE_NFS4_ACL</span>
<a name="l00549"></a>00549 <span class="preprocessor"></span><span class="comment">/* Following idmapper function conventions, return 1 if successful, 0 otherwise. */</span>
<a name="l00550"></a>00550 <span class="keyword">static</span> <span class="keywordtype">int</span> nfs4_encode_acl_special_user(<span class="keywordtype">int</span> who, <span class="keywordtype">char</span> *attrvalsBuffer,
<a name="l00551"></a>00551                                         u_int *LastOffset)
<a name="l00552"></a>00552 {
<a name="l00553"></a>00553   <span class="keywordtype">int</span> rc = 0;
<a name="l00554"></a>00554   <span class="keywordtype">int</span> i;
<a name="l00555"></a>00555   u_int utf8len = 0;
<a name="l00556"></a>00556   u_int deltalen = 0;
<a name="l00557"></a>00557 
<a name="l00558"></a>00558   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="fsal__types_8h.html#ada7433a3ebd1a7ce34085b5ae9ddb894">FSAL_ACE_SPECIAL_EVERYONE</a>; i++)
<a name="l00559"></a>00559     {
<a name="l00560"></a>00560       <span class="keywordflow">if</span> (whostr_2_type_map[i].type == who)
<a name="l00561"></a>00561         {
<a name="l00562"></a>00562           <span class="keywordflow">if</span>(whostr_2_type_map[i].stringlen % 4 == 0)
<a name="l00563"></a>00563             deltalen = 0;
<a name="l00564"></a>00564           <span class="keywordflow">else</span>
<a name="l00565"></a>00565             deltalen = 4 - whostr_2_type_map[i].stringlen % 4;
<a name="l00566"></a>00566 
<a name="l00567"></a>00567           utf8len = htonl(whostr_2_type_map[i].stringlen + deltalen);
<a name="l00568"></a>00568           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + *LastOffset), &amp;utf8len, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00569"></a>00569           *LastOffset += <span class="keyword">sizeof</span>(int);
<a name="l00570"></a>00570 
<a name="l00571"></a>00571           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + *LastOffset), whostr_2_type_map[i].<span class="keywordtype">string</span>,
<a name="l00572"></a>00572                  whostr_2_type_map[i].stringlen);
<a name="l00573"></a>00573           *LastOffset += whostr_2_type_map[i].stringlen;
<a name="l00574"></a>00574 
<a name="l00575"></a>00575           <span class="comment">/* Pad with zero to keep xdr alignement */</span>
<a name="l00576"></a>00576           <span class="keywordflow">if</span>(deltalen != 0)
<a name="l00577"></a>00577             memset((<span class="keywordtype">char</span> *)(attrvalsBuffer + *LastOffset), 0, deltalen);
<a name="l00578"></a>00578           *LastOffset += deltalen;
<a name="l00579"></a>00579 
<a name="l00580"></a>00580           <span class="comment">/* Found a matched one. */</span>
<a name="l00581"></a>00581           rc = 1;
<a name="l00582"></a>00582           <span class="keywordflow">break</span>;
<a name="l00583"></a>00583         }
<a name="l00584"></a>00584     }
<a name="l00585"></a>00585 
<a name="l00586"></a>00586   <span class="keywordflow">return</span> rc;
<a name="l00587"></a>00587 }
<a name="l00588"></a>00588 
<a name="l00589"></a>00589 <span class="comment">/* Following idmapper function conventions, return 1 if successful, 0 otherwise. */</span>
<a name="l00590"></a>00590 <span class="keyword">static</span> <span class="keywordtype">int</span> nfs4_encode_acl_group_name(<a class="code" href="fsal__types_8h.html#a4d2c32f9b66b1c7270ff547c5c7f8622">fsal_gid_t</a> gid, <span class="keywordtype">char</span> *attrvalsBuffer,
<a name="l00591"></a>00591                                       u_int *LastOffset)
<a name="l00592"></a>00592 {
<a name="l00593"></a>00593   <span class="keywordtype">int</span> rc = 0;
<a name="l00594"></a>00594   <span class="keywordtype">char</span> <a class="code" href="mount_8h.html#a2946c588fc7fa2fa5b43ac54b7872725">name</a>[MAXNAMLEN];
<a name="l00595"></a>00595   u_int utf8len = 0;
<a name="l00596"></a>00596   u_int stringlen = 0;
<a name="l00597"></a>00597   u_int deltalen = 0;
<a name="l00598"></a>00598 
<a name="l00599"></a>00599   rc = <a class="code" href="group__NFSprocs.html#ga9cf8dba7d685e7fa13ff358293dbe727">gid2name</a>(name, &amp;gid);
<a name="l00600"></a>00600   <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>,
<a name="l00601"></a>00601                <span class="stringliteral">&quot;encode gid2name = %s, strlen = %llu&quot;</span>,
<a name="l00602"></a>00602                name, (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)strlen(name));
<a name="l00603"></a>00603   <span class="keywordflow">if</span>(rc == 0)  <span class="comment">/* Failure. */</span>
<a name="l00604"></a>00604     {
<a name="l00605"></a>00605       <span class="comment">/* Encode gid itself without @. */</span>
<a name="l00606"></a>00606       sprintf(name, <span class="stringliteral">&quot;%u&quot;</span>, gid);
<a name="l00607"></a>00607     }
<a name="l00608"></a>00608 
<a name="l00609"></a>00609   stringlen = strlen(name);
<a name="l00610"></a>00610   <span class="keywordflow">if</span>(stringlen % 4 == 0)
<a name="l00611"></a>00611     deltalen = 0;
<a name="l00612"></a>00612   <span class="keywordflow">else</span>
<a name="l00613"></a>00613     deltalen = 4 - (stringlen % 4);
<a name="l00614"></a>00614 
<a name="l00615"></a>00615   utf8len = htonl(stringlen + deltalen);
<a name="l00616"></a>00616   memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + *LastOffset), &amp;utf8len, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00617"></a>00617   *LastOffset += <span class="keyword">sizeof</span>(int);
<a name="l00618"></a>00618 
<a name="l00619"></a>00619   memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + *LastOffset), name, stringlen);
<a name="l00620"></a>00620   *LastOffset += stringlen;
<a name="l00621"></a>00621 
<a name="l00622"></a>00622   <span class="comment">/* Pad with zero to keep xdr alignement */</span>
<a name="l00623"></a>00623   <span class="keywordflow">if</span>(deltalen != 0)
<a name="l00624"></a>00624     memset((<span class="keywordtype">char</span> *)(attrvalsBuffer + *LastOffset), 0, deltalen);
<a name="l00625"></a>00625   *LastOffset += deltalen;
<a name="l00626"></a>00626 
<a name="l00627"></a>00627   <span class="keywordflow">return</span> rc;
<a name="l00628"></a>00628 }
<a name="l00629"></a>00629 
<a name="l00630"></a>00630 <span class="comment">/* Following idmapper function conventions, return 1 if successful, 0 otherwise. */</span>
<a name="l00631"></a>00631 <span class="keyword">static</span> <span class="keywordtype">int</span> nfs4_encode_acl_user_name(<span class="keywordtype">int</span> whotype, <a class="code" href="fsal__types_8h.html#a3730c39a36a19b5a7ab3b6685a7652d2">fsal_uid_t</a> uid,
<a name="l00632"></a>00632                                      <span class="keywordtype">char</span> *attrvalsBuffer, u_int *LastOffset)
<a name="l00633"></a>00633 {
<a name="l00634"></a>00634   <span class="keywordtype">int</span> rc = 0;
<a name="l00635"></a>00635   <span class="keywordtype">char</span> name[MAXNAMLEN];
<a name="l00636"></a>00636   u_int utf8len = 0;
<a name="l00637"></a>00637   u_int stringlen = 0;
<a name="l00638"></a>00638   u_int deltalen = 0;
<a name="l00639"></a>00639 
<a name="l00640"></a>00640   <span class="comment">/* Encode special user first. */</span>
<a name="l00641"></a>00641   <span class="keywordflow">if</span> (whotype != <a class="code" href="fsal__types_8h.html#ad6c30c0276260f96834d8d41d634779d">FSAL_ACE_NORMAL_WHO</a>)
<a name="l00642"></a>00642     {
<a name="l00643"></a>00643       rc = nfs4_encode_acl_special_user(uid, attrvalsBuffer, LastOffset);
<a name="l00644"></a>00644       <span class="keywordflow">if</span>(rc == 1)  <span class="comment">/* Success. */</span>
<a name="l00645"></a>00645         <span class="keywordflow">return</span> rc;
<a name="l00646"></a>00646     }
<a name="l00647"></a>00647 
<a name="l00648"></a>00648   <span class="comment">/* Encode normal user or previous user we failed to encode as special user. */</span>
<a name="l00649"></a>00649   rc = <a class="code" href="group__NFSprocs.html#gac3ed7e1576f0f3b397437d2947993fd9">uid2name</a>(name, &amp;uid);
<a name="l00650"></a>00650   <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>,
<a name="l00651"></a>00651                <span class="stringliteral">&quot;econde uid2name = %s, strlen = %llu&quot;</span>,
<a name="l00652"></a>00652                name, (<span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)strlen(name));
<a name="l00653"></a>00653   <span class="keywordflow">if</span>(rc == 0)  <span class="comment">/* Failure. */</span>
<a name="l00654"></a>00654     {
<a name="l00655"></a>00655       <span class="comment">/* Encode uid itself without @. */</span>
<a name="l00656"></a>00656       sprintf(name, <span class="stringliteral">&quot;%u&quot;</span>, uid);
<a name="l00657"></a>00657     }
<a name="l00658"></a>00658 
<a name="l00659"></a>00659   stringlen = strlen(name);
<a name="l00660"></a>00660   <span class="keywordflow">if</span>(stringlen % 4 == 0)
<a name="l00661"></a>00661     deltalen = 0;
<a name="l00662"></a>00662   <span class="keywordflow">else</span>
<a name="l00663"></a>00663     deltalen = 4 - (stringlen % 4);
<a name="l00664"></a>00664 
<a name="l00665"></a>00665   utf8len = htonl(stringlen + deltalen);
<a name="l00666"></a>00666   memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + *LastOffset), &amp;utf8len, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00667"></a>00667   *LastOffset += <span class="keyword">sizeof</span>(int);
<a name="l00668"></a>00668 
<a name="l00669"></a>00669   memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + *LastOffset), name, stringlen);
<a name="l00670"></a>00670   *LastOffset += stringlen;
<a name="l00671"></a>00671 
<a name="l00672"></a>00672   <span class="comment">/* Pad with zero to keep xdr alignement */</span>
<a name="l00673"></a>00673   <span class="keywordflow">if</span>(deltalen != 0)
<a name="l00674"></a>00674     memset((<span class="keywordtype">char</span> *)(attrvalsBuffer + *LastOffset), 0, deltalen);
<a name="l00675"></a>00675   *LastOffset += deltalen;
<a name="l00676"></a>00676 
<a name="l00677"></a>00677   <span class="keywordflow">return</span> rc;
<a name="l00678"></a>00678 }
<a name="l00679"></a>00679 
<a name="l00680"></a>00680 <span class="comment">/* Following idmapper function conventions, return 1 if successful, 0 otherwise. */</span>
<a name="l00681"></a>00681 <span class="keyword">static</span> <span class="keywordtype">int</span> nfs4_encode_acl(<a class="code" href="structfsal__attrib__list____.html">fsal_attrib_list_t</a> * pattr, <span class="keywordtype">char</span> *attrvalsBuffer, u_int *LastOffset)
<a name="l00682"></a>00682 {
<a name="l00683"></a>00683   <span class="keywordtype">int</span> rc = 0;
<a name="l00684"></a>00684   <a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> naces, type, flag, access_mask, whotype;
<a name="l00685"></a>00685   <a class="code" href="structfsal__ace____.html">fsal_ace_t</a> *pace;
<a name="l00686"></a>00686 
<a name="l00687"></a>00687   <span class="keywordflow">if</span>(pattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a8dafc43a881e3c759511afdf3fac06fe">acl</a>)
<a name="l00688"></a>00688     {
<a name="l00689"></a>00689       <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>,
<a name="l00690"></a>00690                    <span class="stringliteral">&quot;GATTR: Number of ACEs = %u&quot;</span>,
<a name="l00691"></a>00691                    pattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a8dafc43a881e3c759511afdf3fac06fe">acl</a>-&gt;<a class="code" href="structfsal__acl____.html#a6452174b32fa4b6e331e4b3cde4e9d89">naces</a>);
<a name="l00692"></a>00692 
<a name="l00693"></a>00693       <span class="comment">/* Encode number of ACEs. */</span>
<a name="l00694"></a>00694       naces = htonl(pattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a8dafc43a881e3c759511afdf3fac06fe">acl</a>-&gt;<a class="code" href="structfsal__acl____.html#a6452174b32fa4b6e331e4b3cde4e9d89">naces</a>);
<a name="l00695"></a>00695       memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + *LastOffset), &amp;naces, <span class="keyword">sizeof</span>(<a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>));
<a name="l00696"></a>00696       *LastOffset += <span class="keyword">sizeof</span>(<a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>);
<a name="l00697"></a>00697 
<a name="l00698"></a>00698       <span class="comment">/* Encode ACEs. */</span>
<a name="l00699"></a>00699       <span class="keywordflow">for</span>(pace = pattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a8dafc43a881e3c759511afdf3fac06fe">acl</a>-&gt;<a class="code" href="structfsal__acl____.html#a36415cc69cd6e4575dc28749d86374de">aces</a>; pace &lt; pattr-&gt;acl-&gt;aces + pattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a8dafc43a881e3c759511afdf3fac06fe">acl</a>-&gt;<a class="code" href="structfsal__acl____.html#a6452174b32fa4b6e331e4b3cde4e9d89">naces</a>; pace++)
<a name="l00700"></a>00700         {
<a name="l00701"></a>00701           <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>,
<a name="l00702"></a>00702                        <span class="stringliteral">&quot;GATTR: type=0X%x, flag=0X%x, perm=0X%x&quot;</span>,
<a name="l00703"></a>00703                        pace-&gt;<a class="code" href="structfsal__ace____.html#aa15f2ec133a148fa3f32046ea509cad7">type</a>, pace-&gt;<a class="code" href="structfsal__ace____.html#aff909b18f41ea63a20ec15720122a038">flag</a>, pace-&gt;<a class="code" href="structfsal__ace____.html#a214faed3b4151f275400602c0c88df7b">perm</a>);
<a name="l00704"></a>00704 
<a name="l00705"></a>00705           type = htonl(pace-&gt;<a class="code" href="structfsal__ace____.html#aa15f2ec133a148fa3f32046ea509cad7">type</a>);
<a name="l00706"></a>00706           flag = htonl(pace-&gt;<a class="code" href="structfsal__ace____.html#aff909b18f41ea63a20ec15720122a038">flag</a>);
<a name="l00707"></a>00707           access_mask = htonl(pace-&gt;<a class="code" href="structfsal__ace____.html#a214faed3b4151f275400602c0c88df7b">perm</a>);
<a name="l00708"></a>00708 
<a name="l00709"></a>00709           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + *LastOffset), &amp;type, <span class="keyword">sizeof</span>(<a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>));
<a name="l00710"></a>00710           *LastOffset += <span class="keyword">sizeof</span>(<a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>);
<a name="l00711"></a>00711 
<a name="l00712"></a>00712           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + *LastOffset), &amp;flag, <span class="keyword">sizeof</span>(<a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>));
<a name="l00713"></a>00713           *LastOffset += <span class="keyword">sizeof</span>(<a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>);
<a name="l00714"></a>00714 
<a name="l00715"></a>00715           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + *LastOffset), &amp;access_mask, <span class="keyword">sizeof</span>(<a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>));
<a name="l00716"></a>00716           *LastOffset += <span class="keyword">sizeof</span>(<a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>);
<a name="l00717"></a>00717 
<a name="l00718"></a>00718           <span class="keywordflow">if</span>(<a class="code" href="fsal__types_8h.html#af39ff12390504bccc4984c535000341a">IS_FSAL_ACE_GROUP_ID</a>(*pace))  <span class="comment">/* Encode group name. */</span>
<a name="l00719"></a>00719             {
<a name="l00720"></a>00720               rc = nfs4_encode_acl_group_name(pace-&gt;<a class="code" href="structfsal__ace____.html#a0f2e247c5c3a952c25dc982acd129a99">who</a>.<a class="code" href="structfsal__ace____.html#aba3e1644d9a0302a283f9c307f3ac4e3">gid</a>, attrvalsBuffer, LastOffset);
<a name="l00721"></a>00721             }
<a name="l00722"></a>00722           <span class="keywordflow">else</span>
<a name="l00723"></a>00723             {
<a name="l00724"></a>00724               <span class="keywordflow">if</span>(!<a class="code" href="fsal__types_8h.html#a43336944eb715b467e12d4174f2e1acf">IS_FSAL_ACE_SPECIAL_ID</a>(*pace))
<a name="l00725"></a>00725                 {
<a name="l00726"></a>00726                   whotype = <a class="code" href="fsal__types_8h.html#ad6c30c0276260f96834d8d41d634779d">FSAL_ACE_NORMAL_WHO</a>;
<a name="l00727"></a>00727                 }
<a name="l00728"></a>00728               <span class="keywordflow">else</span>
<a name="l00729"></a>00729                 whotype = pace-&gt;<a class="code" href="structfsal__ace____.html#a0f2e247c5c3a952c25dc982acd129a99">who</a>.<a class="code" href="structfsal__ace____.html#a6cf8f375a8a3d3dcbdb4bfd6d6eedc95">uid</a>;
<a name="l00730"></a>00730 
<a name="l00731"></a>00731               <span class="comment">/* Encode special or normal user name. */</span>
<a name="l00732"></a>00732               rc = nfs4_encode_acl_user_name(whotype, pace-&gt;<a class="code" href="structfsal__ace____.html#a0f2e247c5c3a952c25dc982acd129a99">who</a>.<a class="code" href="structfsal__ace____.html#a6cf8f375a8a3d3dcbdb4bfd6d6eedc95">uid</a>, attrvalsBuffer, LastOffset);
<a name="l00733"></a>00733             }
<a name="l00734"></a>00734 
<a name="l00735"></a>00735           <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>,
<a name="l00736"></a>00736                        <span class="stringliteral">&quot;GATTR: special = %u, %s = %u&quot;</span>,
<a name="l00737"></a>00737                        <a class="code" href="fsal__types_8h.html#a43336944eb715b467e12d4174f2e1acf">IS_FSAL_ACE_SPECIAL_ID</a>(*pace),
<a name="l00738"></a>00738                        <a class="code" href="fsal__types_8h.html#af39ff12390504bccc4984c535000341a">IS_FSAL_ACE_GROUP_ID</a>(*pace) ? <span class="stringliteral">&quot;gid&quot;</span> : <span class="stringliteral">&quot;uid&quot;</span>,
<a name="l00739"></a>00739                        <a class="code" href="fsal__types_8h.html#af39ff12390504bccc4984c535000341a">IS_FSAL_ACE_GROUP_ID</a>(*pace) ? pace-&gt;<a class="code" href="structfsal__ace____.html#a0f2e247c5c3a952c25dc982acd129a99">who</a>.<a class="code" href="structfsal__ace____.html#aba3e1644d9a0302a283f9c307f3ac4e3">gid</a> : pace-&gt;<a class="code" href="structfsal__ace____.html#a0f2e247c5c3a952c25dc982acd129a99">who</a>.<a class="code" href="structfsal__ace____.html#a6cf8f375a8a3d3dcbdb4bfd6d6eedc95">uid</a>);
<a name="l00740"></a>00740 
<a name="l00741"></a>00741         }
<a name="l00742"></a>00742     }
<a name="l00743"></a>00743   <span class="keywordflow">else</span>
<a name="l00744"></a>00744     {
<a name="l00745"></a>00745       <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>,
<a name="l00746"></a>00746                    <span class="stringliteral">&quot;nfs4_encode_acl: no acl available&quot;</span>);
<a name="l00747"></a>00747 
<a name="l00748"></a>00748       <a class="code" href="structfattr4__acl.html">fattr4_acl</a> acl;
<a name="l00749"></a>00749       acl.<a class="code" href="structfattr4__acl.html#a80d25b542b983806f9a2e2a96f573c0e">fattr4_acl_len</a> = htonl(0);
<a name="l00750"></a>00750       memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + *LastOffset), &amp;acl, <span class="keyword">sizeof</span>(<a class="code" href="structfattr4__acl.html">fattr4_acl</a>));
<a name="l00751"></a>00751       *LastOffset += fattr4tab[<a class="code" href="nfsv40_8h.html#a6d36bb670468c89070ab7f9c08ec940d">FATTR4_ACL</a>].size_fattr4;
<a name="l00752"></a>00752     }
<a name="l00753"></a>00753 
<a name="l00754"></a>00754   <span class="keywordflow">return</span> rc;
<a name="l00755"></a>00755 }
<a name="l00756"></a>00756 <span class="preprocessor">#endif                          </span><span class="comment">/* _USE_NFS4_ACL */</span>
<a name="l00757"></a>00757 
<a name="l00758"></a>00758 <span class="keyword">static</span> <a class="code" href="extended__types_8h.html#a12a1e9b3ce141648783a82445d02b58d">uint_t</a>
<a name="l00759"></a>00759 nfs_tools_xdr_utf8(<a class="code" href="structutf8string.html">utf8str_mixed</a> *utf8, <span class="keywordtype">char</span> *attrvalsBuffer)
<a name="l00760"></a>00760 {
<a name="l00761"></a>00761   u_int utf8len = 0;
<a name="l00762"></a>00762   u_int deltalen = utf8-&gt;<a class="code" href="structutf8string.html#ab651a802af8217014ea648e43ac79b6f">utf8string_len</a> % 4;
<a name="l00763"></a>00763   u_int LastOffset = 0;
<a name="l00764"></a>00764 
<a name="l00765"></a>00765   utf8len = htonl(utf8-&gt;<a class="code" href="structutf8string.html#ab651a802af8217014ea648e43ac79b6f">utf8string_len</a>);
<a name="l00766"></a>00766   memcpy(attrvalsBuffer, &amp;utf8len, <span class="keyword">sizeof</span>(u_int));
<a name="l00767"></a>00767   LastOffset += <span class="keyword">sizeof</span>(u_int);
<a name="l00768"></a>00768 
<a name="l00769"></a>00769   memcpy(attrvalsBuffer + LastOffset,
<a name="l00770"></a>00770          utf8-&gt;<a class="code" href="structutf8string.html#a72e3ba7aecf5547219953542a1c32271">utf8string_val</a>, utf8-&gt;<a class="code" href="structutf8string.html#ab651a802af8217014ea648e43ac79b6f">utf8string_len</a>);
<a name="l00771"></a>00771   LastOffset += utf8-&gt;<a class="code" href="structutf8string.html#ab651a802af8217014ea648e43ac79b6f">utf8string_len</a>;
<a name="l00772"></a>00772 
<a name="l00773"></a>00773   <span class="comment">/* Free what was allocated by uid2utf8 */</span>
<a name="l00774"></a>00774   gsh_free(utf8-&gt;<a class="code" href="structutf8string.html#a72e3ba7aecf5547219953542a1c32271">utf8string_val</a>);
<a name="l00775"></a>00775 
<a name="l00776"></a>00776   <span class="comment">/* Pad with zero to keep xdr alignement */</span>
<a name="l00777"></a>00777   <span class="keywordflow">if</span>(deltalen)
<a name="l00778"></a>00778     {
<a name="l00779"></a>00779       deltalen = 4 - deltalen;
<a name="l00780"></a>00780       memset(attrvalsBuffer + LastOffset, 0, deltalen);
<a name="l00781"></a>00781       LastOffset += deltalen;
<a name="l00782"></a>00782     }
<a name="l00783"></a>00783   <span class="keywordflow">return</span> LastOffset;
<a name="l00784"></a>00784 }
<a name="l00785"></a>00785 
<a name="l00786"></a><a class="code" href="nfs__proto__tools_8c.html#ac1c94a98abb28625947f4b4a8ba8b83b">00786</a> <span class="keywordtype">void</span> <a class="code" href="nfs__proto__tools_8h.html#ac1c94a98abb28625947f4b4a8ba8b83b">nfs4_Fattr_Free</a>(<a class="code" href="structfattr4.html">fattr4</a> *fattr)
<a name="l00787"></a>00787 {
<a name="l00788"></a>00788   <span class="keywordflow">if</span>(fattr-&gt;<a class="code" href="structfattr4.html#ad00a59e5833c61e864df84d690d4a148">attrmask</a>.<a class="code" href="structbitmap4.html#a6b68a1ee274affc9d8cd0a810a6a0164">bitmap4_val</a> != <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00789"></a>00789     {
<a name="l00790"></a>00790       gsh_free(fattr-&gt;<a class="code" href="structfattr4.html#ad00a59e5833c61e864df84d690d4a148">attrmask</a>.<a class="code" href="structbitmap4.html#a6b68a1ee274affc9d8cd0a810a6a0164">bitmap4_val</a>);
<a name="l00791"></a>00791       fattr-&gt;<a class="code" href="structfattr4.html#ad00a59e5833c61e864df84d690d4a148">attrmask</a>.<a class="code" href="structbitmap4.html#a6b68a1ee274affc9d8cd0a810a6a0164">bitmap4_val</a> = <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00792"></a>00792     }
<a name="l00793"></a>00793 
<a name="l00794"></a>00794   <span class="keywordflow">if</span>(fattr-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a> != <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00795"></a>00795     {
<a name="l00796"></a>00796       gsh_free(fattr-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a>);
<a name="l00797"></a>00797       fattr-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a> = <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00798"></a>00798     }
<a name="l00799"></a>00799 }
<a name="l00800"></a>00800 
<a name="l00801"></a>00801 <span class="keyword">static</span> <span class="keywordtype">int</span> fsal_time_to_settime4(<span class="keyword">const</span> <a class="code" href="structfsal__time____.html">fsal_time_t</a> *ts, <span class="keywordtype">char</span> *attrval)
<a name="l00802"></a>00802 {
<a name="l00803"></a>00803   <a class="code" href="nfsv40_8h.html#ab808b19df55720ecc217af4329db7ea6">time_how4</a> how = htonl(<a class="code" href="nfsv40_8h.html#ab808b19df55720ecc217af4329db7ea6a52a4f50c2acbc674aba2d072593eadae">SET_TO_CLIENT_TIME4</a>);
<a name="l00804"></a>00804   <a class="code" href="extended__types_8h.html#a20c5e9a94aaa5a66a9f0165f027a8581">int64_t</a> sec = <a class="code" href="group__NFSprocs.html#gab52fdbc875109ccb84900a657877a23b">nfs_htonl64</a>((<a class="code" href="extended__types_8h.html#a20c5e9a94aaa5a66a9f0165f027a8581">int64_t</a>)ts-&gt;<a class="code" href="structfsal__time____.html#add92ec6180384f0ba10dd2a79b659548">seconds</a>);
<a name="l00805"></a>00805   <a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> nsec = htonl(ts-&gt;<a class="code" href="structfsal__time____.html#a9c41918d2f2ea4627205dd4c2e347373">nseconds</a>);
<a name="l00806"></a>00806   <span class="keywordtype">int</span> LastOffset = 0;
<a name="l00807"></a>00807 
<a name="l00808"></a>00808   memcpy(attrval + LastOffset, &amp;how, <span class="keyword">sizeof</span>(how));
<a name="l00809"></a>00809   LastOffset += <span class="keyword">sizeof</span>(how);
<a name="l00810"></a>00810   memcpy(attrval + LastOffset, &amp;sec, <span class="keyword">sizeof</span>(sec));
<a name="l00811"></a>00811   LastOffset += <span class="keyword">sizeof</span>(sec);
<a name="l00812"></a>00812   memcpy(attrval + LastOffset, &amp;nsec, <span class="keyword">sizeof</span>(nsec));
<a name="l00813"></a>00813   LastOffset += <span class="keyword">sizeof</span>(<a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>);
<a name="l00814"></a>00814 
<a name="l00815"></a>00815   <span class="keywordflow">return</span> LastOffset;
<a name="l00816"></a>00816 }
<a name="l00817"></a>00817 
<a name="l00818"></a><a class="code" href="group__NFSprocs.html#gabfcce8a2830b3bf95455a1a08c32bae8">00818</a> <span class="keywordtype">int</span> <a class="code" href="group__NFSprocs.html#gabfcce8a2830b3bf95455a1a08c32bae8">nfs4_supported_attrs_to_fattr</a>(<span class="keywordtype">char</span> *attrvalsBuffer)
<a name="l00819"></a>00819 {
<a name="l00820"></a>00820 <span class="preprocessor">#ifdef _USE_NFS4_1</span>
<a name="l00821"></a>00821 <span class="preprocessor"></span>  <span class="keywordtype">int</span> lastbit = <a class="code" href="nfsv41_8h.html#a62ba6055240092585b0d600502b5031b">FATTR4_FS_CHARSET_CAP</a>;
<a name="l00822"></a>00822   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> attrvalslist_supported[<a class="code" href="nfsv41_8h.html#a62ba6055240092585b0d600502b5031b">FATTR4_FS_CHARSET_CAP</a>];
<a name="l00823"></a>00823   <a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> bitmap_val[3];
<a name="l00824"></a>00824 <span class="preprocessor">#else</span>
<a name="l00825"></a>00825 <span class="preprocessor"></span>  <span class="keywordtype">int</span> lastbit = <a class="code" href="nfsv40_8h.html#aee5e5c06f383e00c90378fabc96deaee">FATTR4_MOUNTED_ON_FILEID</a>;
<a name="l00826"></a>00826   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> attrvalslist_supported[<a class="code" href="nfsv40_8h.html#aee5e5c06f383e00c90378fabc96deaee">FATTR4_MOUNTED_ON_FILEID</a>];
<a name="l00827"></a>00827   <a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> bitmap_val[2];
<a name="l00828"></a>00828 <span class="preprocessor">#endif</span>
<a name="l00829"></a>00829 <span class="preprocessor"></span>  <span class="keywordtype">int</span> LastOffset = 0;
<a name="l00830"></a>00830   <a class="code" href="structbitmap4.html">fattr4_supported_attrs</a> supported_attrs;
<a name="l00831"></a>00831   <a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> supported_attrs_len;
<a name="l00832"></a>00832   <a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> supported_attrs_val;
<a name="l00833"></a>00833 
<a name="l00834"></a>00834   <span class="comment">/* The supported attributes have field &#39;,supported&#39; set in tab fattr4tab, I will proceed in 2 pass </span>
<a name="l00835"></a>00835 <span class="comment">   * 1st: compute the number of supported attributes</span>
<a name="l00836"></a>00836 <span class="comment">   * 2nd: allocate the replyed bitmap and fill it</span>
<a name="l00837"></a>00837 <span class="comment">   *</span>
<a name="l00838"></a>00838 <span class="comment">   * I do not set a #define to keep the number of supported attributes because I want this parameter</span>
<a name="l00839"></a>00839 <span class="comment">   * to be a consequence of fattr4tab and avoid incoherency */</span>
<a name="l00840"></a>00840 
<a name="l00841"></a>00841   <span class="comment">/* How many supported attributes ? Compute the result in variable named c */</span>
<a name="l00842"></a>00842   <span class="keywordtype">int</span> k, c = 0;
<a name="l00843"></a>00843   <span class="keywordflow">for</span>(k = <a class="code" href="nfsv40_8h.html#a0b40c74ec5d17a87e0e368b0517fe587">FATTR4_SUPPORTED_ATTRS</a>; k &lt;= lastbit; k++)
<a name="l00844"></a>00844     {
<a name="l00845"></a>00845       <span class="keywordflow">if</span>(fattr4tab[k].supported)
<a name="l00846"></a>00846         attrvalslist_supported[c++] = k;
<a name="l00847"></a>00847     }
<a name="l00848"></a>00848 
<a name="l00849"></a>00849   supported_attrs.<a class="code" href="structbitmap4.html#a6b68a1ee274affc9d8cd0a810a6a0164">bitmap4_val</a> = bitmap_val;
<a name="l00850"></a>00850   supported_attrs.<a class="code" href="structbitmap4.html#afd18333034a15d0d8427f6c58f2e110a">bitmap4_len</a> = <span class="keyword">sizeof</span>(bitmap_val)/<span class="keyword">sizeof</span>(bitmap_val[0]);
<a name="l00851"></a>00851   <a class="code" href="group__NFSprocs.html#gac769402d81db054a2484ef4214c0f902">nfs4_list_to_bitmap4</a>(&amp;supported_attrs, c, attrvalslist_supported);
<a name="l00852"></a>00852 
<a name="l00853"></a>00853   <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>,
<a name="l00854"></a>00854                <span class="stringliteral">&quot;Fattr (regular) supported_attrs(len)=%u -&gt; %u|%u&quot;</span>,
<a name="l00855"></a>00855                supported_attrs.<a class="code" href="structbitmap4.html#afd18333034a15d0d8427f6c58f2e110a">bitmap4_len</a>, supported_attrs.<a class="code" href="structbitmap4.html#a6b68a1ee274affc9d8cd0a810a6a0164">bitmap4_val</a>[0],
<a name="l00856"></a>00856                supported_attrs.<a class="code" href="structbitmap4.html#a6b68a1ee274affc9d8cd0a810a6a0164">bitmap4_val</a>[1]);
<a name="l00857"></a>00857 
<a name="l00858"></a>00858   <span class="comment">/* we store the index */</span>
<a name="l00859"></a>00859   supported_attrs_len = htonl(supported_attrs.<a class="code" href="structbitmap4.html#afd18333034a15d0d8427f6c58f2e110a">bitmap4_len</a>);
<a name="l00860"></a>00860   memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;supported_attrs_len,
<a name="l00861"></a>00861          <span class="keyword">sizeof</span>(<a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>));
<a name="l00862"></a>00862   LastOffset += <span class="keyword">sizeof</span>(<a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>);
<a name="l00863"></a>00863 
<a name="l00864"></a>00864   <span class="comment">/* And then the data */</span>
<a name="l00865"></a>00865   <span class="keywordflow">for</span>(k = 0; k &lt; supported_attrs.<a class="code" href="structbitmap4.html#afd18333034a15d0d8427f6c58f2e110a">bitmap4_len</a>; k++)
<a name="l00866"></a>00866     {
<a name="l00867"></a>00867       supported_attrs_val = htonl(supported_attrs.<a class="code" href="structbitmap4.html#a6b68a1ee274affc9d8cd0a810a6a0164">bitmap4_val</a>[k]);
<a name="l00868"></a>00868       memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;supported_attrs_val,
<a name="l00869"></a>00869              <span class="keyword">sizeof</span>(<a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>));
<a name="l00870"></a>00870       LastOffset += <span class="keyword">sizeof</span>(<a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>);
<a name="l00871"></a>00871     }
<a name="l00872"></a>00872 
<a name="l00873"></a>00873   <span class="keywordflow">return</span> LastOffset;
<a name="l00874"></a>00874 }
<a name="l00875"></a>00875 
<a name="l00876"></a><a class="code" href="group__NFSprocs.html#ga03c63cf888bb6b4839155d46dd50c79f">00876</a> <span class="keywordtype">int</span> <a class="code" href="group__NFSprocs.html#ga03c63cf888bb6b4839155d46dd50c79f">nfs4_Fattr_Fill</a>(<a class="code" href="structfattr4.html">fattr4</a> *Fattr, <span class="keywordtype">int</span> cnt, <a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> *attrvalslist,
<a name="l00877"></a>00877                     <span class="keywordtype">int</span> LastOffset, <span class="keywordtype">char</span> *attrvalsBuffer)
<a name="l00878"></a>00878 {
<a name="l00879"></a>00879   <span class="comment">/* Set the bitmap for result */</span>
<a name="l00880"></a>00880   memset(Fattr, 0, <span class="keyword">sizeof</span>(*Fattr));
<a name="l00881"></a>00881   <span class="keywordflow">if</span>((Fattr-&gt;<a class="code" href="structfattr4.html#ad00a59e5833c61e864df84d690d4a148">attrmask</a>.<a class="code" href="structbitmap4.html#a6b68a1ee274affc9d8cd0a810a6a0164">bitmap4_val</a> = gsh_calloc(3, <span class="keyword">sizeof</span>(<a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>))) == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00882"></a>00882     <span class="keywordflow">return</span> -1;
<a name="l00883"></a>00883   Fattr-&gt;<a class="code" href="structfattr4.html#ad00a59e5833c61e864df84d690d4a148">attrmask</a>.<a class="code" href="structbitmap4.html#afd18333034a15d0d8427f6c58f2e110a">bitmap4_len</a> = 3;
<a name="l00884"></a>00884   <a class="code" href="group__NFSprocs.html#gac769402d81db054a2484ef4214c0f902">nfs4_list_to_bitmap4</a>(&amp;(Fattr-&gt;<a class="code" href="structfattr4.html#ad00a59e5833c61e864df84d690d4a148">attrmask</a>), cnt, attrvalslist);
<a name="l00885"></a>00885 
<a name="l00886"></a>00886   <span class="comment">/* Set the attrlist4 */</span>
<a name="l00887"></a>00887   <span class="comment">/* LastOffset contains the length of the attrvalsBuffer usefull data */</span>
<a name="l00888"></a>00888   Fattr-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#ad931f11e5a1224bb94fa4eaac78cfa13">attrlist4_len</a> = LastOffset;
<a name="l00889"></a>00889   <span class="keywordflow">if</span>(LastOffset != 0)           <span class="comment">/* No need to allocate an empty buffer */</span>
<a name="l00890"></a>00890     {
<a name="l00891"></a>00891       Fattr-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a> = gsh_malloc(LastOffset);
<a name="l00892"></a>00892       <span class="keywordflow">if</span>(Fattr-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a> == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00893"></a>00893         {
<a name="l00894"></a>00894           gsh_free(Fattr-&gt;<a class="code" href="structfattr4.html#ad00a59e5833c61e864df84d690d4a148">attrmask</a>.<a class="code" href="structbitmap4.html#a6b68a1ee274affc9d8cd0a810a6a0164">bitmap4_val</a>);
<a name="l00895"></a>00895           <span class="keywordflow">return</span> -1;
<a name="l00896"></a>00896         }
<a name="l00897"></a>00897       memcpy(Fattr-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a>, attrvalsBuffer,
<a name="l00898"></a>00898              Fattr-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#ad931f11e5a1224bb94fa4eaac78cfa13">attrlist4_len</a>);
<a name="l00899"></a>00899     }
<a name="l00900"></a>00900   <span class="keywordflow">return</span> 0;
<a name="l00901"></a>00901 }
<a name="l00922"></a><a class="code" href="group__NFSprocs.html#ga9e8f27b3fcc6c910f3d30f3aeaf29c9f">00922</a> <span class="keywordtype">int</span> <a class="code" href="group__NFSprocs.html#ga9e8f27b3fcc6c910f3d30f3aeaf29c9f">nfs4_FSALattr_To_Fattr</a>(<a class="code" href="structexportlist____.html">exportlist_t</a> *pexport,
<a name="l00923"></a>00923                            <a class="code" href="structfsal__attrib__list____.html">fsal_attrib_list_t</a> *pattr,
<a name="l00924"></a>00924                            <a class="code" href="structfattr4.html">fattr4</a> *Fattr,
<a name="l00925"></a>00925                            <a class="code" href="structcompoud__data.html" title="Compound data.">compound_data_t</a> *data,
<a name="l00926"></a>00926                            <a class="code" href="structnfs__fh4.html">nfs_fh4</a> *objFH,
<a name="l00927"></a>00927                            <a class="code" href="structbitmap4.html">bitmap4</a> *Bitmap)
<a name="l00928"></a>00928 {
<a name="l00929"></a>00929   <a class="code" href="nfsv40_8h.html#a3a7fa6581b5a2a9e178e185038cf3040">fattr4_type</a> file_type = 0;
<a name="l00930"></a>00930   <a class="code" href="nfsv40_8h.html#a70669df1ecb560c16276cf2be7677c43">fattr4_link_support</a> link_support;
<a name="l00931"></a>00931   <a class="code" href="nfsv40_8h.html#a2571d69ab47ae4f77715615eba6a08cc">fattr4_symlink_support</a> symlink_support;
<a name="l00932"></a>00932   <a class="code" href="nfsv40_8h.html#adff8a2989ac38c0d03880f57ba9303bc">fattr4_fh_expire_type</a> expire_type;
<a name="l00933"></a>00933   <a class="code" href="nfsv40_8h.html#a0caec3e1ed5926c96ef1ec1eee6235e8">fattr4_named_attr</a> named_attr;
<a name="l00934"></a>00934   <a class="code" href="nfsv40_8h.html#aa1e7e5291e1d6051d5c66bd1b1354430">fattr4_unique_handles</a> unique_handles;
<a name="l00935"></a>00935   <a class="code" href="nfsv40_8h.html#aa035fbdb57ad14ee5a53df3529e7c9da">fattr4_archive</a> archive;
<a name="l00936"></a>00936   <a class="code" href="nfsv40_8h.html#a5f1739eb4ec7b12be513c56ca8b70c66">fattr4_cansettime</a> cansettime;
<a name="l00937"></a>00937   <a class="code" href="nfsv40_8h.html#ac268d448d82099af657dacbc99dbc905">fattr4_case_insensitive</a> case_insensitive;
<a name="l00938"></a>00938   <a class="code" href="nfsv40_8h.html#aec0f2426d6bae8755ab1930bf5102658">fattr4_case_preserving</a> case_preserving;
<a name="l00939"></a>00939   <a class="code" href="nfsv40_8h.html#a116b6ba06a0d8cca6b57b7b7d9aa3349">fattr4_chown_restricted</a> chown_restricted;
<a name="l00940"></a>00940   <a class="code" href="nfsv40_8h.html#a8120e5f8df361c3ebeb1916c165078bc">fattr4_hidden</a> hidden;
<a name="l00941"></a>00941   <a class="code" href="nfsv40_8h.html#a2e828d4ef9dbc26b02c1d7bdd134f75a">fattr4_mode</a> file_mode;
<a name="l00942"></a>00942   <a class="code" href="nfsv40_8h.html#abe8fba0236debb7f0eab5c0253e2202b">fattr4_no_trunc</a> no_trunc;
<a name="l00943"></a>00943   <a class="code" href="nfsv40_8h.html#a5dcff0ef8b51f21c45fff7847ebb9458">fattr4_numlinks</a> file_numlinks;
<a name="l00944"></a>00944   <a class="code" href="structspecdata4.html">fattr4_rawdev</a> rawdev;
<a name="l00945"></a>00945   <a class="code" href="nfsv40_8h.html#a971609879b3ba95b8624e15ac8c583f5">fattr4_system</a> system;
<a name="l00946"></a>00946   <a class="code" href="nfsv40_8h.html#ae000375dc5e2bf5948e198baef0f6060">fattr4_size</a> file_size;
<a name="l00947"></a>00947   <a class="code" href="nfsv40_8h.html#ae058190bc78422118c9fe20cb0b2872d">fattr4_space_used</a> file_space_used;
<a name="l00948"></a>00948   <a class="code" href="structfsid4.html">fattr4_fsid</a> fsid;
<a name="l00949"></a>00949   <a class="code" href="structnfstime4.html">fattr4_time_access</a> time_access;
<a name="l00950"></a>00950   <a class="code" href="structnfstime4.html">fattr4_time_modify</a> time_modify;
<a name="l00951"></a>00951   <a class="code" href="structnfstime4.html">fattr4_time_metadata</a> time_metadata;
<a name="l00952"></a>00952   <a class="code" href="structnfstime4.html">fattr4_time_delta</a> time_delta;
<a name="l00953"></a>00953   <a class="code" href="nfsv40_8h.html#a71ffc916e5afbba5e732c8ebfd0f93f1">fattr4_change</a> file_change;
<a name="l00954"></a>00954   <a class="code" href="nfsv40_8h.html#a439aa2213ecdeca95541878dbac665ce">fattr4_fileid</a> file_id;
<a name="l00955"></a>00955   <a class="code" href="structutf8string.html">fattr4_owner</a> file_owner;
<a name="l00956"></a>00956   <a class="code" href="structutf8string.html">fattr4_owner_group</a> file_owner_group;
<a name="l00957"></a>00957   <a class="code" href="nfsv40_8h.html#af43e37c36a94d243a287d9ae382ea2c1">fattr4_space_avail</a> space_avail;
<a name="l00958"></a>00958   <a class="code" href="nfsv40_8h.html#aa1b93cee6fd181d4e37c78b60c36c7c0">fattr4_space_free</a> space_free;
<a name="l00959"></a>00959   <a class="code" href="nfsv40_8h.html#a8222d546e768d600afe234bdab099b68">fattr4_space_total</a> space_total;
<a name="l00960"></a>00960   <a class="code" href="nfsv40_8h.html#a2df3c0c622dbce1e4c73db0096b70213">fattr4_files_avail</a> files_avail;
<a name="l00961"></a>00961   <a class="code" href="nfsv40_8h.html#ae7ad78fb448db95b5545894156f9b996">fattr4_files_free</a> files_free;
<a name="l00962"></a>00962   <a class="code" href="nfsv40_8h.html#a8216d12a43183daaa6f924c45b1c5efd">fattr4_files_total</a> files_total;
<a name="l00963"></a>00963   <a class="code" href="nfsv40_8h.html#af8c7252d498e365e082a16fa6125353f">fattr4_lease_time</a> lease_time;
<a name="l00964"></a>00964   <a class="code" href="structnfstime4.html">fattr4_time_create</a> time_create;
<a name="l00965"></a>00965   <a class="code" href="nfsv40_8h.html#a2f6b48cb1e1cb28f755ae82ae55a0091">fattr4_maxfilesize</a> max_filesize;
<a name="l00966"></a>00966   <a class="code" href="nfsv40_8h.html#a7b945f194e331ff1de1a1b504acd8653">fattr4_maxread</a> maxread;
<a name="l00967"></a>00967   <a class="code" href="nfsv40_8h.html#a97511d36675af4dccb1b13491ee7548f">fattr4_maxwrite</a> maxwrite;
<a name="l00968"></a>00968   <a class="code" href="nfsv40_8h.html#a670e98120e5313fcf9137bc1f8650572">fattr4_maxname</a> maxname;
<a name="l00969"></a>00969   <a class="code" href="nfsv40_8h.html#a53f35021913624dbc01dff3374d67534">fattr4_maxlink</a> maxlink;
<a name="l00970"></a>00970   <a class="code" href="nfsv40_8h.html#af62163d32be592400ddca7a03de92a12">fattr4_homogeneous</a> homogeneous;
<a name="l00971"></a>00971   <a class="code" href="nfsv40_8h.html#a0c54ef8ddd13f9b3d9ffa0128c687075">fattr4_aclsupport</a> aclsupport;
<a name="l00972"></a>00972 <span class="preprocessor">#ifndef _USE_NFS4_ACL</span>
<a name="l00973"></a>00973 <span class="preprocessor"></span>  <a class="code" href="structfattr4__acl.html">fattr4_acl</a> acl;
<a name="l00974"></a>00974 <span class="preprocessor">#endif</span>
<a name="l00975"></a>00975 <span class="preprocessor"></span>  <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0a">fattr4_rdattr_error</a> rdattr_error;
<a name="l00976"></a>00976   <a class="code" href="nfsv40_8h.html#a3dc776327cdd947498a5b212f98269e7">fattr4_quota_avail_hard</a> quota_avail_hard;
<a name="l00977"></a>00977   <a class="code" href="nfsv40_8h.html#a05b31a0c0394721c59d731a4acc62b18">fattr4_quota_avail_soft</a> quota_avail_soft;
<a name="l00978"></a>00978   <a class="code" href="nfsv40_8h.html#af6c58c71fcfa900ceb25e27197cdf646">fattr4_quota_used</a> quota_used;
<a name="l00979"></a>00979 <span class="preprocessor">#ifdef _PNFS_MDS</span>
<a name="l00980"></a>00980 <span class="preprocessor"></span>  <a class="code" href="nfsv41_8h.html#a44500afd03ed69b5249a3c5c54e2266b">fattr4_layout_blksize</a> layout_blksize;
<a name="l00981"></a>00981 <span class="preprocessor">#endif </span><span class="comment">/* _PNFS_MDS */</span>
<a name="l00982"></a>00982 
<a name="l00983"></a>00983   u_int tmp_int;
<a name="l00984"></a>00984   <span class="keywordtype">char</span> tmp_buff[1024];
<a name="l00985"></a>00985 
<a name="l00986"></a>00986   <a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> attribute_to_set = 0;
<a name="l00987"></a>00987 
<a name="l00988"></a>00988   u_int fhandle_len = 0;
<a name="l00989"></a>00989   u_int LastOffset;
<a name="l00990"></a>00990   u_int len = 0, off = 0;       <span class="comment">/* Use for XDR alignment */</span>
<a name="l00991"></a>00991   <span class="keywordtype">int</span> op_attr_success = 0;
<a name="l00992"></a>00992 
<a name="l00993"></a>00993 <span class="preprocessor">#ifdef _USE_NFS4_1</span>
<a name="l00994"></a>00994 <span class="preprocessor"></span>  <a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> attrmasklist[<a class="code" href="nfsv41_8h.html#a62ba6055240092585b0d600502b5031b">FATTR4_FS_CHARSET_CAP</a>]; <span class="comment">/* List cannot be longer than FATTR4_FS_CHARSET_CAP */</span>
<a name="l00995"></a>00995   <a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> attrvalslist[<a class="code" href="nfsv41_8h.html#a62ba6055240092585b0d600502b5031b">FATTR4_FS_CHARSET_CAP</a>]; <span class="comment">/* List cannot be longer than FATTR4_FS_CHARSET_CAP */</span>
<a name="l00996"></a>00996 <span class="preprocessor">#else</span>
<a name="l00997"></a>00997 <span class="preprocessor"></span>  <a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> attrmasklist[<a class="code" href="nfsv40_8h.html#aee5e5c06f383e00c90378fabc96deaee">FATTR4_MOUNTED_ON_FILEID</a>];      <span class="comment">/* List cannot be longer than FATTR4_MOUNTED_ON_FILEID */</span>
<a name="l00998"></a>00998   <a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> attrvalslist[<a class="code" href="nfsv40_8h.html#aee5e5c06f383e00c90378fabc96deaee">FATTR4_MOUNTED_ON_FILEID</a>];      <span class="comment">/* List cannot be longer than FATTR4_MOUNTED_ON_FILEID */</span>
<a name="l00999"></a>00999 <span class="preprocessor">#endif</span>
<a name="l01000"></a>01000 <span class="preprocessor"></span>  <a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> attrmasklen = 0;
<a name="l01001"></a>01001   <span class="keywordtype">char</span> attrvalsBuffer[<a class="code" href="nfs__tools_8h.html#af43b31f46bb53819fcd39ae77c8fe9d1">ATTRVALS_BUFFLEN</a>];
<a name="l01002"></a>01002 
<a name="l01003"></a>01003   <a class="code" href="extended__types_8h.html#a12a1e9b3ce141648783a82445d02b58d">uint_t</a> i = 0;
<a name="l01004"></a>01004   <a class="code" href="extended__types_8h.html#a12a1e9b3ce141648783a82445d02b58d">uint_t</a> j = 0;
<a name="l01005"></a>01005 
<a name="l01006"></a>01006   <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2">cache_inode_status_t</a> cache_status;
<a name="l01007"></a>01007 
<a name="l01008"></a>01008   <span class="keywordtype">int</span> statfscalled = 0;
<a name="l01009"></a>01009   <a class="code" href="structfsal__staticfsinfo__t.html">fsal_staticfsinfo_t</a> * pstaticinfo = <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> ;
<a name="l01010"></a>01010   <a class="code" href="structfsal__dynamicfsinfo____.html">fsal_dynamicfsinfo_t</a> dynamicinfo;
<a name="l01011"></a>01011 
<a name="l01012"></a>01012   <span class="keywordflow">if</span>( data != <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> )
<a name="l01013"></a>01013     pstaticinfo = data-&gt;<a class="code" href="structcompoud__data.html#a7e30266eb1770e922a88cb7b11ac7f01">pcontext</a>-&gt;<a class="code" href="structfsal__op__context____.html#ac482a39c83ca2b5a26e42cb61cb3e312">export_context</a>-&gt;<a class="code" href="structfsal__export__context____.html#a70839eaa0e8abf7bb73887260a349f24">fe_static_fs_info</a>;
<a name="l01014"></a>01014 
<a name="l01015"></a>01015 <span class="preprocessor">#ifdef _USE_NFS4_ACL</span>
<a name="l01016"></a>01016 <span class="preprocessor"></span>  <span class="keywordtype">int</span> rc;
<a name="l01017"></a>01017 <span class="preprocessor">#endif</span>
<a name="l01018"></a>01018 <span class="preprocessor"></span>
<a name="l01019"></a>01019   <span class="comment">/* basic init */</span>
<a name="l01020"></a>01020   memset(attrvalsBuffer, 0, <a class="code" href="nfs__proto__functions_8h.html#ac4b92be64dea477ba31b26b2714e0ae4">NFS4_ATTRVALS_BUFFLEN</a>);
<a name="l01021"></a>01021 <span class="preprocessor">#ifdef _USE_NFS4_1</span>
<a name="l01022"></a>01022 <span class="preprocessor"></span>  memset((<a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> *) attrmasklist, 0, <a class="code" href="nfsv41_8h.html#a62ba6055240092585b0d600502b5031b">FATTR4_FS_CHARSET_CAP</a> * <span class="keyword">sizeof</span>(<a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>));
<a name="l01023"></a>01023   memset((<a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> *) attrvalslist, 0, <a class="code" href="nfsv41_8h.html#a62ba6055240092585b0d600502b5031b">FATTR4_FS_CHARSET_CAP</a> * <span class="keyword">sizeof</span>(<a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>));
<a name="l01024"></a>01024 <span class="preprocessor">#else</span>
<a name="l01025"></a>01025 <span class="preprocessor"></span>  memset((<a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> *) attrmasklist, 0, <a class="code" href="nfsv40_8h.html#aee5e5c06f383e00c90378fabc96deaee">FATTR4_MOUNTED_ON_FILEID</a> * <span class="keyword">sizeof</span>(<a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>));
<a name="l01026"></a>01026   memset((<a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> *) attrvalslist, 0, <a class="code" href="nfsv40_8h.html#aee5e5c06f383e00c90378fabc96deaee">FATTR4_MOUNTED_ON_FILEID</a> * <span class="keyword">sizeof</span>(<a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>));
<a name="l01027"></a>01027 <span class="preprocessor">#endif</span>
<a name="l01028"></a>01028 <span class="preprocessor"></span>
<a name="l01029"></a>01029   <span class="comment">/* Convert the attribute bitmap to an attribute list */</span>
<a name="l01030"></a>01030   <a class="code" href="group__NFSprocs.html#gabd872db7513463c6ddadeec986c69051">nfs4_bitmap4_to_list</a>(Bitmap, &amp;attrmasklen, attrmasklist);
<a name="l01031"></a>01031 
<a name="l01032"></a>01032   <span class="comment">/* Once the bitmap has been converted to a list of attribute, manage each attribute */</span>
<a name="l01033"></a>01033   LastOffset = 0;
<a name="l01034"></a>01034   j = 0;
<a name="l01035"></a>01035 
<a name="l01036"></a>01036   <span class="keywordflow">for</span>(i = 0; i &lt; attrmasklen; i++)
<a name="l01037"></a>01037     {
<a name="l01038"></a>01038       attribute_to_set = attrmasklist[i];
<a name="l01039"></a>01039 
<a name="l01040"></a>01040 <span class="preprocessor">#ifdef _USE_NFS4_1</span>
<a name="l01041"></a>01041 <span class="preprocessor"></span>      <span class="keywordflow">if</span>(attrmasklist[i] &gt; <a class="code" href="nfsv41_8h.html#a62ba6055240092585b0d600502b5031b">FATTR4_FS_CHARSET_CAP</a>)
<a name="l01042"></a>01042 <span class="preprocessor">#else</span>
<a name="l01043"></a>01043 <span class="preprocessor"></span>      <span class="keywordflow">if</span>(attrmasklist[i] &gt; <a class="code" href="nfsv40_8h.html#aee5e5c06f383e00c90378fabc96deaee">FATTR4_MOUNTED_ON_FILEID</a>)
<a name="l01044"></a>01044 <span class="preprocessor">#endif</span>
<a name="l01045"></a>01045 <span class="preprocessor"></span>        {
<a name="l01046"></a>01046           <span class="comment">/* Erroneous value... skip */</span>
<a name="l01047"></a>01047           <span class="keywordflow">continue</span>;
<a name="l01048"></a>01048         }
<a name="l01049"></a>01049       <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>,
<a name="l01050"></a>01050                    <span class="stringliteral">&quot;Flag for Operation (Regular) = %d|%d is ON,  name  = %s  reply_size = %d&quot;</span>,
<a name="l01051"></a>01051                    attrmasklist[i],
<a name="l01052"></a>01052                    fattr4tab[attribute_to_set].val,
<a name="l01053"></a>01053                    fattr4tab[attribute_to_set].name,
<a name="l01054"></a>01054                    fattr4tab[attribute_to_set].size_fattr4);
<a name="l01055"></a>01055 
<a name="l01056"></a>01056       op_attr_success = 0;
<a name="l01057"></a>01057 
<a name="l01058"></a>01058       <span class="comment">/* compute the new size for the fattr4 reply */</span>
<a name="l01059"></a>01059       <span class="comment">/* This space is to be filled below in the big switch/case statement */</span>
<a name="l01060"></a>01060       <span class="keywordflow">switch</span> (attribute_to_set)
<a name="l01061"></a>01061         {
<a name="l01062"></a>01062         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a0b40c74ec5d17a87e0e368b0517fe587">FATTR4_SUPPORTED_ATTRS</a>:
<a name="l01063"></a>01063           LastOffset += <a class="code" href="group__NFSprocs.html#gabfcce8a2830b3bf95455a1a08c32bae8">nfs4_supported_attrs_to_fattr</a>(attrvalsBuffer + LastOffset);
<a name="l01064"></a>01064 
<a name="l01065"></a>01065           <span class="comment">/* This kind of operation is always a success */</span>
<a name="l01066"></a>01066           op_attr_success = 1;
<a name="l01067"></a>01067           <span class="keywordflow">break</span>;
<a name="l01068"></a>01068 
<a name="l01069"></a>01069         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#abb174f647b2425ed9d75aca5067395b8">FATTR4_TYPE</a>:
<a name="l01070"></a>01070           <span class="keywordflow">switch</span> (pattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a03249aca39ba1b16b4712079d93b025e">type</a>)
<a name="l01071"></a>01071             {
<a name="l01072"></a>01072             <span class="keywordflow">case</span> <a class="code" href="fsal__types_8h.html#a368aa63441663f9326d0201857bfcea3afb0cf0224b4c4d6adaec28b1f3d65400">FSAL_TYPE_FILE</a>:
<a name="l01073"></a>01073             <span class="keywordflow">case</span> <a class="code" href="fsal__types_8h.html#a368aa63441663f9326d0201857bfcea3a78dd372e91da8c77e7b203ad063d836d">FSAL_TYPE_XATTR</a>:
<a name="l01074"></a>01074               file_type = htonl(<a class="code" href="nfsv40_8h.html#a3a7fa6581b5a2a9e178e185038cf3040a239da84394e28d87d64fe16c4e741434">NF4REG</a>);        <span class="comment">/* Regular file */</span>
<a name="l01075"></a>01075               <span class="keywordflow">break</span>;
<a name="l01076"></a>01076 
<a name="l01077"></a>01077             <span class="keywordflow">case</span> <a class="code" href="fsal__types_8h.html#a368aa63441663f9326d0201857bfcea3a302bac21d091a1f3fc1ef5adb50661c3">FSAL_TYPE_DIR</a>:
<a name="l01078"></a>01078               file_type = htonl(<a class="code" href="nfsv40_8h.html#a3a7fa6581b5a2a9e178e185038cf3040abe9a491648d379ed4349c4e14d05d861">NF4DIR</a>);        <span class="comment">/* Directory */</span>
<a name="l01079"></a>01079               <span class="keywordflow">break</span>;
<a name="l01080"></a>01080 
<a name="l01081"></a>01081             <span class="keywordflow">case</span> <a class="code" href="fsal__types_8h.html#a368aa63441663f9326d0201857bfcea3a4889072a63eda04f5c8d92a5a5bc04cd">FSAL_TYPE_BLK</a>:
<a name="l01082"></a>01082               file_type = htonl(<a class="code" href="nfsv40_8h.html#a3a7fa6581b5a2a9e178e185038cf3040a0e92ad6f7172abbf39e3d99ef8258194">NF4BLK</a>);        <span class="comment">/* Special File - block device */</span>
<a name="l01083"></a>01083               <span class="keywordflow">break</span>;
<a name="l01084"></a>01084 
<a name="l01085"></a>01085             <span class="keywordflow">case</span> <a class="code" href="fsal__types_8h.html#a368aa63441663f9326d0201857bfcea3ab2cc09e4ad4298e2b0238df7ebc18adc">FSAL_TYPE_CHR</a>:
<a name="l01086"></a>01086               file_type = htonl(<a class="code" href="nfsv40_8h.html#a3a7fa6581b5a2a9e178e185038cf3040a52df39a7dc886e01f1ba2e7c99d3f338">NF4CHR</a>);        <span class="comment">/* Special File - character device */</span>
<a name="l01087"></a>01087               <span class="keywordflow">break</span>;
<a name="l01088"></a>01088 
<a name="l01089"></a>01089             <span class="keywordflow">case</span> <a class="code" href="fsal__types_8h.html#a368aa63441663f9326d0201857bfcea3adca35a94946e3fba05a201e70f98c3a8">FSAL_TYPE_LNK</a>:
<a name="l01090"></a>01090               file_type = htonl(<a class="code" href="nfsv40_8h.html#a3a7fa6581b5a2a9e178e185038cf3040ad1f9845817c5d9550779312950d1ac67">NF4LNK</a>);        <span class="comment">/* Symbolic Link */</span>
<a name="l01091"></a>01091               <span class="keywordflow">break</span>;
<a name="l01092"></a>01092 
<a name="l01093"></a>01093             <span class="keywordflow">case</span> <a class="code" href="fsal__types_8h.html#a368aa63441663f9326d0201857bfcea3a832898ed571b62a052b344b6c3460b44">FSAL_TYPE_SOCK</a>:
<a name="l01094"></a>01094               file_type = htonl(<a class="code" href="nfsv40_8h.html#a3a7fa6581b5a2a9e178e185038cf3040ae57442409563dc4eaeda9b850095bccc">NF4SOCK</a>);       <span class="comment">/* Special File - socket */</span>
<a name="l01095"></a>01095               <span class="keywordflow">break</span>;
<a name="l01096"></a>01096 
<a name="l01097"></a>01097             <span class="keywordflow">case</span> <a class="code" href="fsal__types_8h.html#a368aa63441663f9326d0201857bfcea3a162623715e400bfeb41be0a079f9856e">FSAL_TYPE_FIFO</a>:
<a name="l01098"></a>01098               file_type = htonl(<a class="code" href="nfsv40_8h.html#a3a7fa6581b5a2a9e178e185038cf3040a461211a15e43a30ad62f3d28ab9c1c87">NF4FIFO</a>);       <span class="comment">/* Special File - fifo */</span>
<a name="l01099"></a>01099               <span class="keywordflow">break</span>;
<a name="l01100"></a>01100 
<a name="l01101"></a>01101             <span class="keywordflow">case</span> <a class="code" href="fsal__types_8h.html#a368aa63441663f9326d0201857bfcea3aae4de2f92f57e58a73baef29fef0663b">FSAL_TYPE_JUNCTION</a>:
<a name="l01102"></a>01102               <span class="comment">/* For wanting of a better solution */</span>
<a name="l01103"></a>01103               file_type = 0;
<a name="l01104"></a>01104               op_attr_success = 0;      <span class="comment">/* This was no success */</span>
<a name="l01105"></a>01105               <span class="keywordflow">break</span>;
<a name="l01106"></a>01106             }                   <span class="comment">/* switch( pattr-&gt;type ) */</span>
<a name="l01107"></a>01107 
<a name="l01108"></a>01108           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;file_type, <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#a3a7fa6581b5a2a9e178e185038cf3040">fattr4_type</a>));
<a name="l01109"></a>01109           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01110"></a>01110           op_attr_success = 1;
<a name="l01111"></a>01111           <span class="keywordflow">break</span>;
<a name="l01112"></a>01112 
<a name="l01113"></a>01113         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a5ed19d3fb209db5890e88447460f285f">FATTR4_FH_EXPIRE_TYPE</a>:
<a name="l01114"></a>01114           <span class="comment">/* For the moment, we handle only the persistent filehandle */</span>
<a name="l01115"></a>01115           <span class="keywordflow">if</span>(<a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#aa230a949a9346563ed093e442cc1abad">nfsv4_param</a>.<a class="code" href="structnfs__version4__parameter____.html#ab4fc8f64e6866beb660cbe3dbcceee60">fh_expire</a> == <a class="code" href="HashTable_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>)
<a name="l01116"></a>01116             expire_type = htonl(<a class="code" href="nfsv40_8h.html#a14489e6d96505422ead649ac2a06dbb1">FH4_VOLATILE_ANY</a>);
<a name="l01117"></a>01117           <span class="keywordflow">else</span>
<a name="l01118"></a>01118             expire_type = htonl(<a class="code" href="nfsv40_8h.html#a8ca903d8fd4b74e4bb0d543292cec50a">FH4_PERSISTENT</a>);
<a name="l01119"></a>01119           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;expire_type,
<a name="l01120"></a>01120                  <span class="keyword">sizeof</span>(expire_type));
<a name="l01121"></a>01121           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01122"></a>01122           op_attr_success = 1;
<a name="l01123"></a>01123           <span class="keywordflow">break</span>;
<a name="l01124"></a>01124 
<a name="l01125"></a>01125         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a8691d62fc300ed27650afc28f7b3da15">FATTR4_CHANGE</a>:
<a name="l01126"></a>01126           <span class="comment">/* a value that change when the object change. I use the file&#39;s mtime */</span>
<a name="l01127"></a>01127           memset(&amp;file_change, 0, <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#a188972b4ccdd37df707acf964b3ef6c9">changeid4</a>));
<a name="l01128"></a>01128           file_change = <a class="code" href="group__NFSprocs.html#gab52fdbc875109ccb84900a657877a23b">nfs_htonl64</a>((<a class="code" href="nfsv40_8h.html#a188972b4ccdd37df707acf964b3ef6c9">changeid4</a>) pattr-&gt;<a class="code" href="structfsal__attrib__list____.html#abc5d6b31965022a13adbd1e85b3faf67">change</a>);
<a name="l01129"></a>01129 
<a name="l01130"></a>01130           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;file_change,
<a name="l01131"></a>01131                  <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#a71ffc916e5afbba5e732c8ebfd0f93f1">fattr4_change</a>));
<a name="l01132"></a>01132           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01133"></a>01133           op_attr_success = 1;
<a name="l01134"></a>01134           <span class="keywordflow">break</span>;
<a name="l01135"></a>01135 
<a name="l01136"></a>01136         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a08162b3359ba8b437d89090e76f9f079">FATTR4_SIZE</a>:
<a name="l01137"></a>01137           file_size = <a class="code" href="group__NFSprocs.html#gab52fdbc875109ccb84900a657877a23b">nfs_htonl64</a>((<a class="code" href="nfsv40_8h.html#ae000375dc5e2bf5948e198baef0f6060">fattr4_size</a>) pattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a0105c962cf3b7c8d11e2e2d1c5acff31">filesize</a>);
<a name="l01138"></a>01138           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;file_size, <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#ae000375dc5e2bf5948e198baef0f6060">fattr4_size</a>));
<a name="l01139"></a>01139           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01140"></a>01140           op_attr_success = 1;
<a name="l01141"></a>01141           <span class="keywordflow">break</span>;
<a name="l01142"></a>01142 
<a name="l01143"></a>01143         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#aec89ffab45626439fefb1e2651e48e63">FATTR4_LINK_SUPPORT</a>:
<a name="l01144"></a>01144           <span class="comment">/* HPSS NameSpace support hard link */</span>
<a name="l01145"></a>01145           link_support = htonl(<a class="code" href="HashTable_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l01146"></a>01146           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;link_support,
<a name="l01147"></a>01147                  <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#a70669df1ecb560c16276cf2be7677c43">fattr4_link_support</a>));
<a name="l01148"></a>01148           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01149"></a>01149           op_attr_success = 1;
<a name="l01150"></a>01150           <span class="keywordflow">break</span>;
<a name="l01151"></a>01151 
<a name="l01152"></a>01152         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a16e679badc58a66f4737098ca720539f">FATTR4_SYMLINK_SUPPORT</a>:
<a name="l01153"></a>01153           <span class="comment">/* HPSS NameSpace support symbolic link */</span>
<a name="l01154"></a>01154           symlink_support = htonl(<a class="code" href="HashTable_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l01155"></a>01155           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;symlink_support,
<a name="l01156"></a>01156                  <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#a2571d69ab47ae4f77715615eba6a08cc">fattr4_symlink_support</a>));
<a name="l01157"></a>01157           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01158"></a>01158           op_attr_success = 1;
<a name="l01159"></a>01159           <span class="keywordflow">break</span>;
<a name="l01160"></a>01160 
<a name="l01161"></a>01161         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#affe2dfbefc8ff527b79a989860638c11">FATTR4_NAMED_ATTR</a>:
<a name="l01162"></a>01162           <span class="comment">/* For this version of the binary, named attributes is not supported */</span>
<a name="l01163"></a>01163           named_attr = htonl(<a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l01164"></a>01164           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;named_attr,
<a name="l01165"></a>01165                  <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#a0caec3e1ed5926c96ef1ec1eee6235e8">fattr4_named_attr</a>));
<a name="l01166"></a>01166           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01167"></a>01167           op_attr_success = 1;
<a name="l01168"></a>01168           <span class="keywordflow">break</span>;
<a name="l01169"></a>01169 
<a name="l01170"></a>01170         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a8aafd7594d6a927a537b9d61e7cb2cb6">FATTR4_FSID</a>:
<a name="l01171"></a>01171           <span class="comment">/* The file system id (taken from the configuration file) */</span>
<a name="l01172"></a>01172           fsid.<a class="code" href="structfsid4.html#a0f882261ff714aef7afd1345b7599a38">major</a> = <a class="code" href="group__NFSprocs.html#gab52fdbc875109ccb84900a657877a23b">nfs_htonl64</a>((<a class="code" href="extended__types_8h.html#ad27ed092432b64ff558d2254c278720f">uint64_t</a>) pexport-&gt;<a class="code" href="structexportlist____.html#a0f81c1008714a0ce0039397cd3fab832">filesystem_id</a>.<a class="code" href="structfsal__fsid____.html#a86fa6b41da5905b04e531bd530c1573c">major</a>);
<a name="l01173"></a>01173           fsid.<a class="code" href="structfsid4.html#a4d9ea90821395ccf80051508df943161">minor</a> = <a class="code" href="group__NFSprocs.html#gab52fdbc875109ccb84900a657877a23b">nfs_htonl64</a>((<a class="code" href="extended__types_8h.html#ad27ed092432b64ff558d2254c278720f">uint64_t</a>) pexport-&gt;<a class="code" href="structexportlist____.html#a0f81c1008714a0ce0039397cd3fab832">filesystem_id</a>.<a class="code" href="structfsal__fsid____.html#a4af3ec4bf793f168471987221d477130">minor</a>);
<a name="l01174"></a>01174 
<a name="l01175"></a>01175           <span class="comment">/* If object is a directory attached to a referral, then a different fsid is to be returned</span>
<a name="l01176"></a>01176 <span class="comment">           * to tell the client that a different fs is being crossed */</span>
<a name="l01177"></a>01177           <span class="keywordflow">if</span>(<a class="code" href="nfs__file__handle_8h.html#a9c76d0dc9e953967d9ea5946495623eb">nfs4_Is_Fh_Referral</a>(objFH))
<a name="l01178"></a>01178             {
<a name="l01179"></a>01179               fsid.<a class="code" href="structfsid4.html#a0f882261ff714aef7afd1345b7599a38">major</a> = ~(<a class="code" href="group__NFSprocs.html#gab52fdbc875109ccb84900a657877a23b">nfs_htonl64</a>((<a class="code" href="extended__types_8h.html#ad27ed092432b64ff558d2254c278720f">uint64_t</a>) pexport-&gt;<a class="code" href="structexportlist____.html#a0f81c1008714a0ce0039397cd3fab832">filesystem_id</a>.<a class="code" href="structfsal__fsid____.html#a86fa6b41da5905b04e531bd530c1573c">major</a>));
<a name="l01180"></a>01180               fsid.<a class="code" href="structfsid4.html#a4d9ea90821395ccf80051508df943161">minor</a> = ~(<a class="code" href="group__NFSprocs.html#gab52fdbc875109ccb84900a657877a23b">nfs_htonl64</a>((<a class="code" href="extended__types_8h.html#ad27ed092432b64ff558d2254c278720f">uint64_t</a>) pexport-&gt;<a class="code" href="structexportlist____.html#a0f81c1008714a0ce0039397cd3fab832">filesystem_id</a>.<a class="code" href="structfsal__fsid____.html#a4af3ec4bf793f168471987221d477130">minor</a>));
<a name="l01181"></a>01181             }
<a name="l01182"></a>01182 
<a name="l01183"></a>01183           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;fsid, <span class="keyword">sizeof</span>(<a class="code" href="structfsid4.html">fattr4_fsid</a>));
<a name="l01184"></a>01184           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01185"></a>01185           op_attr_success = 1;
<a name="l01186"></a>01186           <span class="keywordflow">break</span>;
<a name="l01187"></a>01187 
<a name="l01188"></a>01188         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a4e770e15e93db6e2f74e2449b22e7024">FATTR4_UNIQUE_HANDLES</a>:
<a name="l01189"></a>01189           <span class="comment">/* Filehandles are unique */</span>
<a name="l01190"></a>01190           unique_handles = htonl(<a class="code" href="HashTable_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l01191"></a>01191           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;unique_handles,
<a name="l01192"></a>01192                  <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#aa1e7e5291e1d6051d5c66bd1b1354430">fattr4_unique_handles</a>));
<a name="l01193"></a>01193           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01194"></a>01194           op_attr_success = 1;
<a name="l01195"></a>01195           <span class="keywordflow">break</span>;
<a name="l01196"></a>01196 
<a name="l01197"></a>01197         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a27b8037bffddb4a7be7f389a174789a8">FATTR4_LEASE_TIME</a>:
<a name="l01198"></a>01198           <span class="comment">/* lease_time = htonl( (fattr4_lease_time)pstaticinfo-&gt;lease_time.seconds ) ; */</span>
<a name="l01199"></a>01199           lease_time = htonl(<a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#aa230a949a9346563ed093e442cc1abad">nfsv4_param</a>.<a class="code" href="structnfs__version4__parameter____.html#a46d8cf96d383c3f7425e811c1cf80fbd">lease_lifetime</a>);
<a name="l01200"></a>01200           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;lease_time,
<a name="l01201"></a>01201                  <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#af8c7252d498e365e082a16fa6125353f">fattr4_lease_time</a>));
<a name="l01202"></a>01202           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01203"></a>01203           op_attr_success = 1;
<a name="l01204"></a>01204           <span class="keywordflow">break</span>;
<a name="l01205"></a>01205 
<a name="l01206"></a>01206         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a8bd8eefcde07a750a41d0fe967427619">FATTR4_RDATTR_ERROR</a>:
<a name="l01207"></a>01207           rdattr_error = htonl(<a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aacaca462c793854dd61337cf0b54fc166">NFS4_OK</a>);        <span class="comment">/* By default, READDIR call may use a different value */</span>
<a name="l01208"></a>01208           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;rdattr_error,
<a name="l01209"></a>01209                  <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0a">fattr4_rdattr_error</a>));
<a name="l01210"></a>01210           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01211"></a>01211           op_attr_success = 1;
<a name="l01212"></a>01212           <span class="keywordflow">break</span>;
<a name="l01213"></a>01213 
<a name="l01214"></a>01214         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a6d36bb670468c89070ab7f9c08ec940d">FATTR4_ACL</a>:
<a name="l01215"></a>01215 <span class="preprocessor">#ifdef _USE_NFS4_ACL</span>
<a name="l01216"></a>01216 <span class="preprocessor"></span>          rc = nfs4_encode_acl(pattr, attrvalsBuffer, &amp;LastOffset);
<a name="l01217"></a>01217           <span class="keywordflow">if</span>(rc == 0)  <span class="comment">/* uid/gid mapping to a string failure */</span>
<a name="l01218"></a>01218             <a class="code" href="log_8h.html#a014a663a4d20c38e82ab3f35298667e8">LogEvent</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>, <span class="stringliteral">&quot;Failed to map uid/gid to a string.&quot;</span>);
<a name="l01219"></a>01219 <span class="preprocessor">#else</span>
<a name="l01220"></a>01220 <span class="preprocessor"></span>          memset(&amp;acl, 0, <span class="keyword">sizeof</span>(acl));
<a name="l01221"></a>01221           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;acl, <span class="keyword">sizeof</span>(<a class="code" href="structfattr4__acl.html">fattr4_acl</a>));
<a name="l01222"></a>01222           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01223"></a>01223 <span class="preprocessor">#endif</span>
<a name="l01224"></a>01224 <span class="preprocessor"></span>          op_attr_success = 1;
<a name="l01225"></a>01225           <span class="keywordflow">break</span>;
<a name="l01226"></a>01226 
<a name="l01227"></a>01227         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#acccdc7c8c20ea3eb28e277616b1304f2">FATTR4_ACLSUPPORT</a>:
<a name="l01228"></a>01228 <span class="preprocessor">#ifdef _USE_NFS4_ACL</span>
<a name="l01229"></a>01229 <span class="preprocessor"></span>          aclsupport = htonl(<a class="code" href="nfsv40_8h.html#a096f9e6d3a0866edebeb2a11a332030e">ACL4_SUPPORT_ALLOW_ACL</a> | <a class="code" href="nfsv40_8h.html#a5ef48fc2224f621b9766fabb1b23f69f">ACL4_SUPPORT_DENY_ACL</a>);
<a name="l01230"></a>01230 <span class="preprocessor">#else</span>
<a name="l01231"></a>01231 <span class="preprocessor"></span>          aclsupport = htonl(0);
<a name="l01232"></a>01232 <span class="preprocessor">#endif</span>
<a name="l01233"></a>01233 <span class="preprocessor"></span>          memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;aclsupport,
<a name="l01234"></a>01234                  <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#a0c54ef8ddd13f9b3d9ffa0128c687075">fattr4_aclsupport</a>));
<a name="l01235"></a>01235           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01236"></a>01236           op_attr_success = 1;
<a name="l01237"></a>01237           <span class="keywordflow">break</span>;
<a name="l01238"></a>01238 
<a name="l01239"></a>01239         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a8b3c56a49215fe985cf7c9a4df761709">FATTR4_ARCHIVE</a>:
<a name="l01240"></a>01240           <span class="comment">/* Archive flag is not supported */</span>
<a name="l01241"></a>01241           archive = htonl(<a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l01242"></a>01242           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;archive, <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#aa035fbdb57ad14ee5a53df3529e7c9da">fattr4_archive</a>));
<a name="l01243"></a>01243           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01244"></a>01244           op_attr_success = 1;
<a name="l01245"></a>01245           <span class="keywordflow">break</span>;
<a name="l01246"></a>01246 
<a name="l01247"></a>01247         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a0b6b2c64419dac1453c982d1e8af6398">FATTR4_CANSETTIME</a>:
<a name="l01248"></a>01248           <span class="comment">/* The time can be set on files */</span>
<a name="l01249"></a>01249           cansettime = htonl(<a class="code" href="HashTable_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l01250"></a>01250           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;cansettime,
<a name="l01251"></a>01251                  <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#a5f1739eb4ec7b12be513c56ca8b70c66">fattr4_cansettime</a>));
<a name="l01252"></a>01252           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01253"></a>01253           op_attr_success = 1;
<a name="l01254"></a>01254           <span class="keywordflow">break</span>;
<a name="l01255"></a>01255 
<a name="l01256"></a>01256         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a67d7fd4f682db8a9cfca18db5b6781d6">FATTR4_CASE_INSENSITIVE</a>:
<a name="l01257"></a>01257           case_insensitive = htonl(pstaticinfo-&gt;<a class="code" href="structfsal__staticfsinfo__t.html#a173745ec75c9481844d62d8252d26c96">case_insensitive</a>);
<a name="l01258"></a>01258           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;case_insensitive,
<a name="l01259"></a>01259                  <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#ac268d448d82099af657dacbc99dbc905">fattr4_case_insensitive</a>));
<a name="l01260"></a>01260           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01261"></a>01261           op_attr_success = 1;
<a name="l01262"></a>01262           <span class="keywordflow">break</span>;
<a name="l01263"></a>01263 
<a name="l01264"></a>01264         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a5b36d50d9150e9d231d3864ef4b5bcc6">FATTR4_CASE_PRESERVING</a>:
<a name="l01265"></a>01265           case_preserving = htonl(pstaticinfo-&gt;<a class="code" href="structfsal__staticfsinfo__t.html#a3126c8b52577f686771fc328cdaddbda">case_preserving</a>);
<a name="l01266"></a>01266           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;case_preserving,
<a name="l01267"></a>01267                  <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#aec0f2426d6bae8755ab1930bf5102658">fattr4_case_preserving</a>));
<a name="l01268"></a>01268           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01269"></a>01269           op_attr_success = 1;
<a name="l01270"></a>01270           <span class="keywordflow">break</span>;
<a name="l01271"></a>01271 
<a name="l01272"></a>01272         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#ae9b99e276288b6673639d91bdf73e55e">FATTR4_CHOWN_RESTRICTED</a>:
<a name="l01273"></a>01273           <span class="comment">/* chown is restricted to root */</span>
<a name="l01274"></a>01274           chown_restricted = htonl(pstaticinfo-&gt;<a class="code" href="structfsal__staticfsinfo__t.html#a93b5cc11652f2a68c58d32752938b43d">chown_restricted</a>);
<a name="l01275"></a>01275           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;chown_restricted,
<a name="l01276"></a>01276                  <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#a116b6ba06a0d8cca6b57b7b7d9aa3349">fattr4_chown_restricted</a>));
<a name="l01277"></a>01277           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01278"></a>01278           op_attr_success = 1;
<a name="l01279"></a>01279           <span class="keywordflow">break</span>;
<a name="l01280"></a>01280 
<a name="l01281"></a>01281         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a1e31fb57ae65cd90ba2b2bd203a81c08">FATTR4_FILEHANDLE</a>:
<a name="l01282"></a>01282           <span class="comment">/* Return the file handle */</span>
<a name="l01283"></a>01283           fhandle_len = htonl(objFH-&gt;<a class="code" href="structnfs__fh4.html#a16f1d8d3eb38d12060bef0045f062f16">nfs_fh4_len</a>);
<a name="l01284"></a>01284           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;fhandle_len, <span class="keyword">sizeof</span>(u_int));
<a name="l01285"></a>01285           LastOffset += <span class="keyword">sizeof</span>(u_int);
<a name="l01286"></a>01286 
<a name="l01287"></a>01287           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset),
<a name="l01288"></a>01288                  objFH-&gt;<a class="code" href="structnfs__fh4.html#a1bac9f2eb01597339d8c037776010a09">nfs_fh4_val</a>, objFH-&gt;<a class="code" href="structnfs__fh4.html#a16f1d8d3eb38d12060bef0045f062f16">nfs_fh4_len</a>);
<a name="l01289"></a>01289           LastOffset += objFH-&gt;<a class="code" href="structnfs__fh4.html#a16f1d8d3eb38d12060bef0045f062f16">nfs_fh4_len</a>;
<a name="l01290"></a>01290 
<a name="l01291"></a>01291           <span class="comment">/* XDR&#39;s special stuff for 32-bit alignment */</span>
<a name="l01292"></a>01292           len = objFH-&gt;<a class="code" href="structnfs__fh4.html#a16f1d8d3eb38d12060bef0045f062f16">nfs_fh4_len</a>;
<a name="l01293"></a>01293           off = 0;
<a name="l01294"></a>01294           <span class="keywordflow">while</span>((len + off) % 4 != 0)
<a name="l01295"></a>01295             {
<a name="l01296"></a>01296               <span class="keywordtype">char</span> c = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l01297"></a>01297 
<a name="l01298"></a>01298               off += 1;
<a name="l01299"></a>01299               memset((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), (<span class="keywordtype">int</span>)c, 1);
<a name="l01300"></a>01300               LastOffset += 1;
<a name="l01301"></a>01301             }
<a name="l01302"></a>01302 
<a name="l01303"></a>01303           op_attr_success = 1;
<a name="l01304"></a>01304           <span class="keywordflow">break</span>;
<a name="l01305"></a>01305 
<a name="l01306"></a>01306         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a12bda16e66cebbcd45fab2cae6b42667">FATTR4_FILEID</a>:
<a name="l01307"></a>01307           <span class="comment">/* The analog to the inode number. RFC3530 says &quot;a number uniquely identifying the file within the filesystem&quot; </span>
<a name="l01308"></a>01308 <span class="comment">           * I use hpss_GetObjId to extract this information from the Name Server&#39;s handle */</span>
<a name="l01309"></a>01309           file_id = <a class="code" href="group__NFSprocs.html#gab52fdbc875109ccb84900a657877a23b">nfs_htonl64</a>(pattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a657a3efbc26891ced4b16f48791452c3">fileid</a>);
<a name="l01310"></a>01310           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;file_id, <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#a439aa2213ecdeca95541878dbac665ce">fattr4_fileid</a>));
<a name="l01311"></a>01311           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01312"></a>01312           op_attr_success = 1;
<a name="l01313"></a>01313           <span class="keywordflow">break</span>;
<a name="l01314"></a>01314 
<a name="l01315"></a>01315         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#ad8f9f2cd5ae0847bb982010e5c3e3b29">FATTR4_FILES_AVAIL</a>:
<a name="l01316"></a>01316           <span class="keywordflow">if</span>(!statfscalled)
<a name="l01317"></a>01317             {
<a name="l01318"></a>01318               <span class="keywordflow">if</span>((cache_status = <a class="code" href="cache__inode__statfs_8c.html#af75281ba04ae34842f1228bbc0544b09">cache_inode_statfs</a>(data-&gt;<a class="code" href="structcompoud__data.html#a68044da90b24d713271740a42f88838a">current_entry</a>,
<a name="l01319"></a>01319                                                     &amp;dynamicinfo,
<a name="l01320"></a>01320                                                     data-&gt;<a class="code" href="structcompoud__data.html#a7e30266eb1770e922a88cb7b11ac7f01">pcontext</a>,
<a name="l01321"></a>01321                                                     &amp;cache_status)) !=
<a name="l01322"></a>01322                  <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a3fdbbb2367268ae84ac11d7b189643d8">CACHE_INODE_SUCCESS</a>)
<a name="l01323"></a>01323                 {
<a name="l01324"></a>01324                   op_attr_success = 0;
<a name="l01325"></a>01325                   <span class="keywordflow">break</span>;
<a name="l01326"></a>01326                 }
<a name="l01327"></a>01327               <span class="keywordflow">else</span>
<a name="l01328"></a>01328                 statfscalled = 1;
<a name="l01329"></a>01329             }
<a name="l01330"></a>01330           files_avail = <a class="code" href="group__NFSprocs.html#gab52fdbc875109ccb84900a657877a23b">nfs_htonl64</a>((<a class="code" href="nfsv40_8h.html#a2df3c0c622dbce1e4c73db0096b70213">fattr4_files_avail</a>) dynamicinfo.<a class="code" href="structfsal__dynamicfsinfo____.html#a95dda6a595f78c32b9b9553c13e10c6a">avail_files</a>);
<a name="l01331"></a>01331           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;files_avail,
<a name="l01332"></a>01332                  <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#a2df3c0c622dbce1e4c73db0096b70213">fattr4_files_avail</a>));
<a name="l01333"></a>01333           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01334"></a>01334           op_attr_success = 1;
<a name="l01335"></a>01335           <span class="keywordflow">break</span>;
<a name="l01336"></a>01336 
<a name="l01337"></a>01337         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a7d5bb307c7d80c15ebd3308ce6ae1ad0">FATTR4_FILES_FREE</a>:
<a name="l01338"></a>01338           <span class="keywordflow">if</span>(!statfscalled)
<a name="l01339"></a>01339             {
<a name="l01340"></a>01340               <span class="keywordflow">if</span>((cache_status = <a class="code" href="cache__inode__statfs_8c.html#af75281ba04ae34842f1228bbc0544b09">cache_inode_statfs</a>(data-&gt;<a class="code" href="structcompoud__data.html#a68044da90b24d713271740a42f88838a">current_entry</a>,
<a name="l01341"></a>01341                                                     &amp;dynamicinfo,
<a name="l01342"></a>01342                                                     data-&gt;<a class="code" href="structcompoud__data.html#a7e30266eb1770e922a88cb7b11ac7f01">pcontext</a>,
<a name="l01343"></a>01343                                                     &amp;cache_status)) !=
<a name="l01344"></a>01344                  <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a3fdbbb2367268ae84ac11d7b189643d8">CACHE_INODE_SUCCESS</a>)
<a name="l01345"></a>01345                 {
<a name="l01346"></a>01346                   op_attr_success = 0;
<a name="l01347"></a>01347                   <span class="keywordflow">break</span>;
<a name="l01348"></a>01348                 }
<a name="l01349"></a>01349               <span class="keywordflow">else</span>
<a name="l01350"></a>01350                 statfscalled = 1;
<a name="l01351"></a>01351             }
<a name="l01352"></a>01352           files_free = <a class="code" href="group__NFSprocs.html#gab52fdbc875109ccb84900a657877a23b">nfs_htonl64</a>((<a class="code" href="nfsv40_8h.html#a2df3c0c622dbce1e4c73db0096b70213">fattr4_files_avail</a>) dynamicinfo.<a class="code" href="structfsal__dynamicfsinfo____.html#a2985d74cf52c062a53064425caf0c8d4">free_files</a>);
<a name="l01353"></a>01353           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;files_free,
<a name="l01354"></a>01354                  <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#ae7ad78fb448db95b5545894156f9b996">fattr4_files_free</a>));
<a name="l01355"></a>01355           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01356"></a>01356           op_attr_success = 1;
<a name="l01357"></a>01357           <span class="keywordflow">break</span>;
<a name="l01358"></a>01358 
<a name="l01359"></a>01359         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a60aa97a14a44928103710908dfcdb6f4">FATTR4_FILES_TOTAL</a>:
<a name="l01360"></a>01360           <span class="keywordflow">if</span>(!statfscalled)
<a name="l01361"></a>01361             {
<a name="l01362"></a>01362               <span class="keywordflow">if</span>((cache_status = <a class="code" href="cache__inode__statfs_8c.html#af75281ba04ae34842f1228bbc0544b09">cache_inode_statfs</a>(data-&gt;<a class="code" href="structcompoud__data.html#a68044da90b24d713271740a42f88838a">current_entry</a>,
<a name="l01363"></a>01363                                                     &amp;dynamicinfo,
<a name="l01364"></a>01364                                                     data-&gt;<a class="code" href="structcompoud__data.html#a7e30266eb1770e922a88cb7b11ac7f01">pcontext</a>,
<a name="l01365"></a>01365                                                     &amp;cache_status)) !=
<a name="l01366"></a>01366                  <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a3fdbbb2367268ae84ac11d7b189643d8">CACHE_INODE_SUCCESS</a>)
<a name="l01367"></a>01367                 {
<a name="l01368"></a>01368                   op_attr_success = 0;
<a name="l01369"></a>01369                   <span class="keywordflow">break</span>;
<a name="l01370"></a>01370                 }
<a name="l01371"></a>01371               <span class="keywordflow">else</span>
<a name="l01372"></a>01372                 statfscalled = 1;
<a name="l01373"></a>01373             }
<a name="l01374"></a>01374           files_total = <a class="code" href="group__NFSprocs.html#gab52fdbc875109ccb84900a657877a23b">nfs_htonl64</a>((<a class="code" href="nfsv40_8h.html#a2df3c0c622dbce1e4c73db0096b70213">fattr4_files_avail</a>) dynamicinfo.<a class="code" href="structfsal__dynamicfsinfo____.html#ab4ef60cdd188fa8ad965b3575ef8248f">total_files</a>);
<a name="l01375"></a>01375           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;files_total,
<a name="l01376"></a>01376                  <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#a8216d12a43183daaa6f924c45b1c5efd">fattr4_files_total</a>));
<a name="l01377"></a>01377           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01378"></a>01378           op_attr_success = 1;
<a name="l01379"></a>01379           <span class="keywordflow">break</span>;
<a name="l01380"></a>01380 
<a name="l01381"></a>01381         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a3fd8a1bc152a73ba56daad1eed452e33">FATTR4_FS_LOCATIONS</a>:
<a name="l01382"></a>01382           <span class="keywordflow">if</span>(data-&gt;<a class="code" href="structcompoud__data.html#a68044da90b24d713271740a42f88838a">current_entry</a>-&gt;<a class="code" href="structcache__entry__t.html#afa60c075430da0dbe9d5f4160f336294">type</a> != <a class="code" href="cache__inode_8h.html#a2aee8d2ff73574138b75922c7652162fa9d09f58160b1161920aad19080f568cc">DIRECTORY</a>)
<a name="l01383"></a>01383             {
<a name="l01384"></a>01384               op_attr_success = 0;
<a name="l01385"></a>01385               <span class="keywordflow">break</span>;
<a name="l01386"></a>01386             }
<a name="l01387"></a>01387 
<a name="l01388"></a>01388           <span class="keywordflow">if</span>(!<a class="code" href="group__NFSprocs.html#ga49cb81b85949210dd4d47e905d822f90">nfs4_referral_str_To_Fattr_fs_location</a>
<a name="l01389"></a>01389              (data-&gt;<a class="code" href="structcompoud__data.html#a68044da90b24d713271740a42f88838a">current_entry</a>-&gt;<a class="code" href="structcache__entry__t.html#a0767b2a90515593d88a51fe20dbcc55e">object</a>.<a class="code" href="unioncache__entry__t_1_1cache__inode__fsobj____.html#a2ed64c64f5a63c623efd5eef8e8b1859">dir</a>.referral, tmp_buff, &amp;tmp_int))
<a name="l01390"></a>01390             {
<a name="l01391"></a>01391               op_attr_success = 0;
<a name="l01392"></a>01392               <span class="keywordflow">break</span>;
<a name="l01393"></a>01393             }
<a name="l01394"></a>01394 
<a name="l01395"></a>01395           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), tmp_buff, tmp_int);
<a name="l01396"></a>01396           LastOffset += tmp_int;
<a name="l01397"></a>01397           op_attr_success = 1;
<a name="l01398"></a>01398           <span class="keywordflow">break</span>;
<a name="l01399"></a>01399 
<a name="l01400"></a>01400         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#aff8c11d90ab70e33fd064a98b0259a51">FATTR4_HIDDEN</a>:
<a name="l01401"></a>01401           <span class="comment">/* There are no hidden file in HPSS */</span>
<a name="l01402"></a>01402           hidden = htonl(<a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l01403"></a>01403           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;hidden, <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#a8120e5f8df361c3ebeb1916c165078bc">fattr4_hidden</a>));
<a name="l01404"></a>01404           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01405"></a>01405           op_attr_success = 1;
<a name="l01406"></a>01406           <span class="keywordflow">break</span>;
<a name="l01407"></a>01407 
<a name="l01408"></a>01408         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a3be8247bb6bf1239fe59f2b060497f8e">FATTR4_HOMOGENEOUS</a>:
<a name="l01409"></a>01409           <span class="comment">/* Unix semantic is homogeneous (all objects have the same kind of attributes) */</span>
<a name="l01410"></a>01410           homogeneous = htonl(<a class="code" href="HashTable_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l01411"></a>01411           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;homogeneous,
<a name="l01412"></a>01412                  <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#af62163d32be592400ddca7a03de92a12">fattr4_homogeneous</a>));
<a name="l01413"></a>01413           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01414"></a>01414           op_attr_success = 1;
<a name="l01415"></a>01415           <span class="keywordflow">break</span>;
<a name="l01416"></a>01416 
<a name="l01417"></a>01417         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a8d77c1fa475fe6e4f59d67f5b16b0f49">FATTR4_MAXFILESIZE</a>:
<a name="l01418"></a>01418           max_filesize = <a class="code" href="group__NFSprocs.html#gab52fdbc875109ccb84900a657877a23b">nfs_htonl64</a>((<a class="code" href="nfsv40_8h.html#a2f6b48cb1e1cb28f755ae82ae55a0091">fattr4_maxfilesize</a>) <a class="code" href="group__NFSprocs.html#ga4306ad45e3e66dda5ec5e9611d8bdd21">FSINFO_MAX_FILESIZE</a>);
<a name="l01419"></a>01419           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;max_filesize,
<a name="l01420"></a>01420                  <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#a2f6b48cb1e1cb28f755ae82ae55a0091">fattr4_maxfilesize</a>));
<a name="l01421"></a>01421           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01422"></a>01422           op_attr_success = 1;
<a name="l01423"></a>01423           <span class="keywordflow">break</span>;
<a name="l01424"></a>01424 
<a name="l01425"></a>01425         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a152d29ee332cd4908f35a2397af1a80c">FATTR4_MAXLINK</a>:
<a name="l01426"></a>01426           maxlink = htonl(pstaticinfo-&gt;<a class="code" href="structfsal__staticfsinfo__t.html#a2546d0af15553203d7c43986917806da">maxlink</a>);
<a name="l01427"></a>01427           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;maxlink, <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#a53f35021913624dbc01dff3374d67534">fattr4_maxlink</a>));
<a name="l01428"></a>01428           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01429"></a>01429           op_attr_success = 1;
<a name="l01430"></a>01430           <span class="keywordflow">break</span>;
<a name="l01431"></a>01431 
<a name="l01432"></a>01432         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#ac08ff6c8bf52d8c743c845df01cda82f">FATTR4_MAXNAME</a>:
<a name="l01433"></a>01433           maxname = htonl((<a class="code" href="nfsv40_8h.html#a670e98120e5313fcf9137bc1f8650572">fattr4_maxname</a>) pstaticinfo-&gt;<a class="code" href="structfsal__staticfsinfo__t.html#a4c96968fb70ef80de84a677e01ded50d">maxnamelen</a>);
<a name="l01434"></a>01434           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;maxname, <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#a670e98120e5313fcf9137bc1f8650572">fattr4_maxname</a>));
<a name="l01435"></a>01435           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01436"></a>01436           op_attr_success = 1;
<a name="l01437"></a>01437           <span class="keywordflow">break</span>;
<a name="l01438"></a>01438 
<a name="l01439"></a>01439         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#ad5baf95761d8da57bd659663839f78b9">FATTR4_MAXREAD</a>:
<a name="l01440"></a>01440           <span class="comment">/* The exports.c MAXREAD-MAXWRITE code establishes these semantics: </span>
<a name="l01441"></a>01441 <span class="comment">           *  a. If you set the MaxWrite and MaxRead defaults in an export file</span>
<a name="l01442"></a>01442 <span class="comment">           *  they apply. </span>
<a name="l01443"></a>01443 <span class="comment">           *  b. If you set the MaxWrite and MaxRead defaults in the main.conf</span>
<a name="l01444"></a>01444 <span class="comment">           *  file they apply unless overwritten by an export file setting. </span>
<a name="l01445"></a>01445 <span class="comment">           *  c. If no settings are present in the export file or the main.conf</span>
<a name="l01446"></a>01446 <span class="comment">           *  file then the defaults values in the FSAL apply. </span>
<a name="l01447"></a>01447 <span class="comment">           */</span>
<a name="l01448"></a>01448 
<a name="l01449"></a>01449           maxread = <a class="code" href="group__NFSprocs.html#gab52fdbc875109ccb84900a657877a23b">nfs_htonl64</a>((<a class="code" href="nfsv40_8h.html#a7b945f194e331ff1de1a1b504acd8653">fattr4_maxread</a>) pexport-&gt;<a class="code" href="structexportlist____.html#aca0d2005712efda897d6c995a7678307">MaxRead</a> );
<a name="l01450"></a>01450           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;maxread, <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#a7b945f194e331ff1de1a1b504acd8653">fattr4_maxread</a>));
<a name="l01451"></a>01451           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01452"></a>01452           op_attr_success = 1;
<a name="l01453"></a>01453           <span class="keywordflow">break</span>;
<a name="l01454"></a>01454 
<a name="l01455"></a>01455         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a279790f50a79f2e3d6c748dbebd0f566">FATTR4_MAXWRITE</a>:
<a name="l01456"></a>01456           maxwrite = <a class="code" href="group__NFSprocs.html#gab52fdbc875109ccb84900a657877a23b">nfs_htonl64</a>((<a class="code" href="nfsv40_8h.html#a97511d36675af4dccb1b13491ee7548f">fattr4_maxwrite</a>) pexport-&gt;<a class="code" href="structexportlist____.html#a9e18adbe1c9935d1c91782c74817a02c">MaxWrite</a> );
<a name="l01457"></a>01457           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;maxwrite,
<a name="l01458"></a>01458                  <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#a97511d36675af4dccb1b13491ee7548f">fattr4_maxwrite</a>));
<a name="l01459"></a>01459           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01460"></a>01460           op_attr_success = 1;
<a name="l01461"></a>01461           <span class="keywordflow">break</span>;
<a name="l01462"></a>01462 
<a name="l01463"></a>01463         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a4b941a38952bb3bc3e256aa9a5dca23f">FATTR4_MIMETYPE</a>:
<a name="l01464"></a>01464           memset((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), 0,
<a name="l01465"></a>01465                  <span class="keyword">sizeof</span>(<a class="code" href="structutf8string.html">fattr4_mimetype</a>));
<a name="l01466"></a>01466           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01467"></a>01467           op_attr_success = 0;  <span class="comment">/* No supported for the moment */</span>
<a name="l01468"></a>01468           <span class="keywordflow">break</span>;
<a name="l01469"></a>01469 
<a name="l01470"></a>01470         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a0ba8d7c6edcd31a2eb08bc084550e31c">FATTR4_MODE</a>:
<a name="l01471"></a>01471           <span class="comment">/* file_mode = (fattr4_mode) htonl(fsal2unix_mode(pattr-&gt;mode)) ; */</span>
<a name="l01472"></a>01472           file_mode = htonl((<a class="code" href="nfsv40_8h.html#a2e828d4ef9dbc26b02c1d7bdd134f75a">fattr4_mode</a>) <a class="code" href="FSAL_2FSAL__CEPH_2fsal__convert_8h.html#ad39aceba2aa5bbef96f35a802e463222">fsal2unix_mode</a>(pattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a6611fe8fc39ff41d2c21d194213322e7">mode</a>));
<a name="l01473"></a>01473           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;file_mode, <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#a2e828d4ef9dbc26b02c1d7bdd134f75a">fattr4_mode</a>));
<a name="l01474"></a>01474           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01475"></a>01475           op_attr_success = 1;
<a name="l01476"></a>01476           <span class="keywordflow">break</span>;
<a name="l01477"></a>01477 
<a name="l01478"></a>01478         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#ad3f4dd873fc24cc72a4bd5ea4186984e">FATTR4_NO_TRUNC</a>:
<a name="l01479"></a>01479           <span class="comment">/* File&#39;s names are not truncated, an error is returned is name is too long */</span>
<a name="l01480"></a>01480           no_trunc = htonl(pstaticinfo-&gt;<a class="code" href="structfsal__staticfsinfo__t.html#a5fbd3819a2becc46ca2ce7875e084d71">no_trunc</a>);
<a name="l01481"></a>01481           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;no_trunc,
<a name="l01482"></a>01482                  <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#abe8fba0236debb7f0eab5c0253e2202b">fattr4_no_trunc</a>));
<a name="l01483"></a>01483           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01484"></a>01484           op_attr_success = 1;
<a name="l01485"></a>01485           <span class="keywordflow">break</span>;
<a name="l01486"></a>01486 
<a name="l01487"></a>01487         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#afa964dbe7c4a85d4fa8801059fa83bdc">FATTR4_NUMLINKS</a>:
<a name="l01488"></a>01488           <span class="comment">/* Reply the number of links found in vattr structure */</span>
<a name="l01489"></a>01489           file_numlinks = htonl((<a class="code" href="nfsv40_8h.html#a5dcff0ef8b51f21c45fff7847ebb9458">fattr4_numlinks</a>) pattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a3ed4337021700c7a893c23668d6c0f33">numlinks</a>);
<a name="l01490"></a>01490           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;file_numlinks,
<a name="l01491"></a>01491                  <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#a5dcff0ef8b51f21c45fff7847ebb9458">fattr4_numlinks</a>));
<a name="l01492"></a>01492           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01493"></a>01493           op_attr_success = 1;
<a name="l01494"></a>01494           <span class="keywordflow">break</span>;
<a name="l01495"></a>01495 
<a name="l01496"></a>01496         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a1b417fc85e29777886744df6709723ef">FATTR4_OWNER</a>:
<a name="l01497"></a>01497           <span class="comment">/* Return the uid as a human readable utf8 string */</span>
<a name="l01498"></a>01498           <span class="keywordflow">if</span>(<a class="code" href="group__NFSprocs.html#ga86b8d548095cb2b07ab6ee49d0f56b94">uid2utf8</a>(pattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a89670e3e52193381c240c0b7d93d6aa6">owner</a>, &amp;file_owner) == 0)
<a name="l01499"></a>01499             {
<a name="l01500"></a>01500               LastOffset += nfs_tools_xdr_utf8(&amp;file_owner,
<a name="l01501"></a>01501                                                (<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset));
<a name="l01502"></a>01502               op_attr_success = 1;
<a name="l01503"></a>01503             }
<a name="l01504"></a>01504           <span class="keywordflow">else</span>
<a name="l01505"></a>01505             op_attr_success = 0;
<a name="l01506"></a>01506           <span class="keywordflow">break</span>;
<a name="l01507"></a>01507 
<a name="l01508"></a>01508         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#ab2edd15bdc0df70213cb86ac63ca80d3">FATTR4_OWNER_GROUP</a>:
<a name="l01509"></a>01509           <span class="comment">/* Return the gid as a human-readable utf8 string */</span>
<a name="l01510"></a>01510           <span class="keywordflow">if</span>(<a class="code" href="group__NFSprocs.html#ga64205dca7faae60fdcd79f168eb7e5ed">gid2utf8</a>(pattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e4622af711f91b5f598fce5e0bee9fa">group</a>, &amp;file_owner_group) == 0)
<a name="l01511"></a>01511             {
<a name="l01512"></a>01512               LastOffset += nfs_tools_xdr_utf8(&amp;file_owner_group,
<a name="l01513"></a>01513                                                (<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset));
<a name="l01514"></a>01514               op_attr_success = 1;
<a name="l01515"></a>01515             }
<a name="l01516"></a>01516           <span class="keywordflow">else</span>
<a name="l01517"></a>01517             op_attr_success = 0;
<a name="l01518"></a>01518           <span class="keywordflow">break</span>;
<a name="l01519"></a>01519 
<a name="l01520"></a>01520         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a25dad080fab7d195a71a7d664587af22">FATTR4_QUOTA_AVAIL_HARD</a>:
<a name="l01521"></a>01521           quota_avail_hard = <a class="code" href="group__NFSprocs.html#gab52fdbc875109ccb84900a657877a23b">nfs_htonl64</a>((<a class="code" href="nfsv40_8h.html#a3dc776327cdd947498a5b212f98269e7">fattr4_quota_avail_hard</a>) <a class="code" href="nfs__core_8h.html#a8320ff8e228f7b7fb0dce29638676358">NFS_V4_MAX_QUOTA_HARD</a>);    
<a name="l01522"></a>01522           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;quota_avail_hard,
<a name="l01523"></a>01523                  <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#a3dc776327cdd947498a5b212f98269e7">fattr4_quota_avail_hard</a>));
<a name="l01524"></a>01524           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01525"></a>01525           op_attr_success = 0;
<a name="l01526"></a>01526           <span class="keywordflow">break</span>;
<a name="l01527"></a>01527 
<a name="l01528"></a>01528         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a36b7f38832d1dfbd61c9dde55e67f092">FATTR4_QUOTA_AVAIL_SOFT</a>:
<a name="l01529"></a>01529           quota_avail_soft = <a class="code" href="group__NFSprocs.html#gab52fdbc875109ccb84900a657877a23b">nfs_htonl64</a>((<a class="code" href="nfsv40_8h.html#a05b31a0c0394721c59d731a4acc62b18">fattr4_quota_avail_soft</a>) <a class="code" href="nfs__core_8h.html#a5de1d652d7791273d995655b654d3809">NFS_V4_MAX_QUOTA_SOFT</a>);    
<a name="l01530"></a>01530           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;quota_avail_soft,
<a name="l01531"></a>01531                  <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#a05b31a0c0394721c59d731a4acc62b18">fattr4_quota_avail_soft</a>));
<a name="l01532"></a>01532           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01533"></a>01533           op_attr_success = 0;
<a name="l01534"></a>01534           <span class="keywordflow">break</span>;
<a name="l01535"></a>01535 
<a name="l01536"></a>01536         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a6b4447e650b20373b01f7fce2167a333">FATTR4_QUOTA_USED</a>:
<a name="l01537"></a>01537           quota_used = <a class="code" href="group__NFSprocs.html#gab52fdbc875109ccb84900a657877a23b">nfs_htonl64</a>((<a class="code" href="nfsv40_8h.html#af6c58c71fcfa900ceb25e27197cdf646">fattr4_quota_used</a>) pattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a0105c962cf3b7c8d11e2e2d1c5acff31">filesize</a>);
<a name="l01538"></a>01538           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;quota_used,
<a name="l01539"></a>01539                  <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#af6c58c71fcfa900ceb25e27197cdf646">fattr4_quota_used</a>));
<a name="l01540"></a>01540           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01541"></a>01541           op_attr_success = 0;
<a name="l01542"></a>01542           <span class="keywordflow">break</span>;
<a name="l01543"></a>01543 
<a name="l01544"></a>01544         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a89b12b6e52be105460ff2922ed361595">FATTR4_RAWDEV</a>:
<a name="l01545"></a>01545           rawdev.<a class="code" href="structspecdata4.html#a293b8dcf62d8deb71f9fde80558237db">specdata1</a> = htonl(pattr-&gt;<a class="code" href="structfsal__attrib__list____.html#ae500abbe897ddad0af25160793468ae1">rawdev</a>.<a class="code" href="structfsal__dev____.html#af03e5fde9bbeec4835a2dbdbcdbad11b">major</a>);
<a name="l01546"></a>01546           rawdev.<a class="code" href="structspecdata4.html#a976f1631a7af968dbc574868918294d0">specdata2</a> = htonl(pattr-&gt;<a class="code" href="structfsal__attrib__list____.html#ae500abbe897ddad0af25160793468ae1">rawdev</a>.<a class="code" href="structfsal__dev____.html#a922b8f1c6709b21a6f6af2bdeb8f0dd5">minor</a>);
<a name="l01547"></a>01547           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;rawdev, <span class="keyword">sizeof</span>(<a class="code" href="structspecdata4.html">fattr4_rawdev</a>));
<a name="l01548"></a>01548           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01549"></a>01549           op_attr_success = 1;
<a name="l01550"></a>01550           <span class="keywordflow">break</span>;
<a name="l01551"></a>01551 
<a name="l01552"></a>01552         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#af38700c788d488d1274949e56fcf3b2d">FATTR4_SPACE_AVAIL</a>:
<a name="l01553"></a>01553           <span class="keywordflow">if</span>(!statfscalled)
<a name="l01554"></a>01554             {
<a name="l01555"></a>01555               <span class="keywordflow">if</span>((cache_status = <a class="code" href="cache__inode__statfs_8c.html#af75281ba04ae34842f1228bbc0544b09">cache_inode_statfs</a>(data-&gt;<a class="code" href="structcompoud__data.html#a68044da90b24d713271740a42f88838a">current_entry</a>,
<a name="l01556"></a>01556                                                     &amp;dynamicinfo,
<a name="l01557"></a>01557                                                     data-&gt;<a class="code" href="structcompoud__data.html#a7e30266eb1770e922a88cb7b11ac7f01">pcontext</a>,
<a name="l01558"></a>01558                                                     &amp;cache_status)) !=
<a name="l01559"></a>01559                  <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a3fdbbb2367268ae84ac11d7b189643d8">CACHE_INODE_SUCCESS</a>)
<a name="l01560"></a>01560                 {
<a name="l01561"></a>01561                   op_attr_success = 0;
<a name="l01562"></a>01562                   <span class="keywordflow">break</span>;
<a name="l01563"></a>01563                 }
<a name="l01564"></a>01564               <span class="keywordflow">else</span>
<a name="l01565"></a>01565                 statfscalled = 1;
<a name="l01566"></a>01566             }
<a name="l01567"></a>01567           space_avail = <a class="code" href="group__NFSprocs.html#gab52fdbc875109ccb84900a657877a23b">nfs_htonl64</a>((<a class="code" href="nfsv40_8h.html#af43e37c36a94d243a287d9ae382ea2c1">fattr4_space_avail</a>) dynamicinfo.<a class="code" href="structfsal__dynamicfsinfo____.html#ae85b65001752f8c16bafe078f8cb6bad">avail_bytes</a>);
<a name="l01568"></a>01568           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;space_avail,
<a name="l01569"></a>01569                  <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#af43e37c36a94d243a287d9ae382ea2c1">fattr4_space_avail</a>));
<a name="l01570"></a>01570           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01571"></a>01571           op_attr_success = 1;
<a name="l01572"></a>01572           <span class="keywordflow">break</span>;
<a name="l01573"></a>01573 
<a name="l01574"></a>01574         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a26d8cd485c39a59250e3f039df6a8867">FATTR4_SPACE_FREE</a>:
<a name="l01575"></a>01575           <span class="keywordflow">if</span>(!statfscalled)
<a name="l01576"></a>01576             {
<a name="l01577"></a>01577               <span class="keywordflow">if</span>((cache_status = <a class="code" href="cache__inode__statfs_8c.html#af75281ba04ae34842f1228bbc0544b09">cache_inode_statfs</a>(data-&gt;<a class="code" href="structcompoud__data.html#a68044da90b24d713271740a42f88838a">current_entry</a>,
<a name="l01578"></a>01578                                                     &amp;dynamicinfo,
<a name="l01579"></a>01579                                                     data-&gt;<a class="code" href="structcompoud__data.html#a7e30266eb1770e922a88cb7b11ac7f01">pcontext</a>,
<a name="l01580"></a>01580                                                     &amp;cache_status)) !=
<a name="l01581"></a>01581                  <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a3fdbbb2367268ae84ac11d7b189643d8">CACHE_INODE_SUCCESS</a>)
<a name="l01582"></a>01582                 {
<a name="l01583"></a>01583                   op_attr_success = 0;
<a name="l01584"></a>01584                   <span class="keywordflow">break</span>;
<a name="l01585"></a>01585                 }
<a name="l01586"></a>01586               <span class="keywordflow">else</span>
<a name="l01587"></a>01587                 statfscalled = 1;
<a name="l01588"></a>01588             }
<a name="l01589"></a>01589           space_free = <a class="code" href="group__NFSprocs.html#gab52fdbc875109ccb84900a657877a23b">nfs_htonl64</a>((<a class="code" href="nfsv40_8h.html#aa1b93cee6fd181d4e37c78b60c36c7c0">fattr4_space_free</a>) dynamicinfo.<a class="code" href="structfsal__dynamicfsinfo____.html#a1ab991537cff4949e944ba2a4141a8c7">free_bytes</a>);
<a name="l01590"></a>01590           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;space_free,
<a name="l01591"></a>01591                  <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#aa1b93cee6fd181d4e37c78b60c36c7c0">fattr4_space_free</a>));
<a name="l01592"></a>01592           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01593"></a>01593           op_attr_success = 1;
<a name="l01594"></a>01594           <span class="keywordflow">break</span>;
<a name="l01595"></a>01595 
<a name="l01596"></a>01596         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a5bed496cfda6933474ac3c18e93bc47f">FATTR4_SPACE_TOTAL</a>:
<a name="l01597"></a>01597           <span class="keywordflow">if</span>(!statfscalled)
<a name="l01598"></a>01598             {
<a name="l01599"></a>01599               <span class="keywordflow">if</span>((cache_status = <a class="code" href="cache__inode__statfs_8c.html#af75281ba04ae34842f1228bbc0544b09">cache_inode_statfs</a>(data-&gt;<a class="code" href="structcompoud__data.html#a68044da90b24d713271740a42f88838a">current_entry</a>,
<a name="l01600"></a>01600                                                     &amp;dynamicinfo,
<a name="l01601"></a>01601                                                     data-&gt;<a class="code" href="structcompoud__data.html#a7e30266eb1770e922a88cb7b11ac7f01">pcontext</a>,
<a name="l01602"></a>01602                                                     &amp;cache_status)) !=
<a name="l01603"></a>01603                  <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a3fdbbb2367268ae84ac11d7b189643d8">CACHE_INODE_SUCCESS</a>)
<a name="l01604"></a>01604                 {
<a name="l01605"></a>01605                   op_attr_success = 0;
<a name="l01606"></a>01606                   <span class="keywordflow">break</span>;
<a name="l01607"></a>01607                 }
<a name="l01608"></a>01608               <span class="keywordflow">else</span>
<a name="l01609"></a>01609                 statfscalled = 1;
<a name="l01610"></a>01610             }
<a name="l01611"></a>01611           space_total = <a class="code" href="group__NFSprocs.html#gab52fdbc875109ccb84900a657877a23b">nfs_htonl64</a>((<a class="code" href="nfsv40_8h.html#a8222d546e768d600afe234bdab099b68">fattr4_space_total</a>) dynamicinfo.<a class="code" href="structfsal__dynamicfsinfo____.html#af7a57342d217028a068e44735360cf24">total_bytes</a>);
<a name="l01612"></a>01612           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;space_total,
<a name="l01613"></a>01613                  <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#a8222d546e768d600afe234bdab099b68">fattr4_space_total</a>));
<a name="l01614"></a>01614           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01615"></a>01615           op_attr_success = 1;
<a name="l01616"></a>01616           <span class="keywordflow">break</span>;
<a name="l01617"></a>01617 
<a name="l01618"></a>01618         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#ab9058684dd550c9561b6928d58f00026">FATTR4_SPACE_USED</a>:
<a name="l01619"></a>01619           <span class="comment">/* the number of bytes on the filesystem used by the object, which is slightly different </span>
<a name="l01620"></a>01620 <span class="comment">           * from the file&#39;s size (there can be hole in the file) */</span>
<a name="l01621"></a>01621           file_space_used = <a class="code" href="group__NFSprocs.html#gab52fdbc875109ccb84900a657877a23b">nfs_htonl64</a>((<a class="code" href="nfsv40_8h.html#ae058190bc78422118c9fe20cb0b2872d">fattr4_space_used</a>) pattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a98bcdb72020b255bbe3355f9fc4c6a74">spaceused</a>);
<a name="l01622"></a>01622           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;file_space_used,
<a name="l01623"></a>01623                  <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#ae058190bc78422118c9fe20cb0b2872d">fattr4_space_used</a>));
<a name="l01624"></a>01624           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01625"></a>01625           op_attr_success = 1;
<a name="l01626"></a>01626           <span class="keywordflow">break</span>;
<a name="l01627"></a>01627 
<a name="l01628"></a>01628         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#ae07709aa5268f86bcdce2863188aea8f">FATTR4_SYSTEM</a>:
<a name="l01629"></a>01629           <span class="comment">/* This is not a windows system File-System with respect to the regarding API */</span>
<a name="l01630"></a>01630           system = htonl(<a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l01631"></a>01631           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;system, <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#a971609879b3ba95b8624e15ac8c583f5">fattr4_system</a>));
<a name="l01632"></a>01632           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01633"></a>01633           op_attr_success = 1;
<a name="l01634"></a>01634           <span class="keywordflow">break</span>;
<a name="l01635"></a>01635 
<a name="l01636"></a>01636         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#ad74f48a420926a335bc6bb75e431ddb4">FATTR4_TIME_ACCESS</a>:
<a name="l01637"></a>01637           <span class="comment">/* This will contain the object&#39;s time os last access, the &#39;atime&#39; in the Unix semantic */</span>
<a name="l01638"></a>01638           memset(&amp;(time_access.<a class="code" href="structnfstime4.html#ad46cdfc1412964d638b98aff64812200">seconds</a>), 0, <span class="keyword">sizeof</span>(<a class="code" href="extended__types_8h.html#a20c5e9a94aaa5a66a9f0165f027a8581">int64_t</a>));
<a name="l01639"></a>01639           time_access.<a class="code" href="structnfstime4.html#ad46cdfc1412964d638b98aff64812200">seconds</a> = <a class="code" href="group__NFSprocs.html#gab52fdbc875109ccb84900a657877a23b">nfs_htonl64</a>((<a class="code" href="extended__types_8h.html#a20c5e9a94aaa5a66a9f0165f027a8581">int64_t</a>) pattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a48293ea65b5bb7282d4421ad079f056f">atime</a>.<a class="code" href="structfsal__time____.html#add92ec6180384f0ba10dd2a79b659548">seconds</a>);
<a name="l01640"></a>01640           time_access.<a class="code" href="structnfstime4.html#abf33417561dc5d91b5ed6a671936ecda">nseconds</a> = htonl((<a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>) pattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a48293ea65b5bb7282d4421ad079f056f">atime</a>.<a class="code" href="structfsal__time____.html#a9c41918d2f2ea4627205dd4c2e347373">nseconds</a>);
<a name="l01641"></a>01641           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;time_access,
<a name="l01642"></a>01642                  fattr4tab[attribute_to_set].size_fattr4);
<a name="l01643"></a>01643           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01644"></a>01644           op_attr_success = 1;
<a name="l01645"></a>01645           <span class="keywordflow">break</span>;
<a name="l01646"></a>01646 
<a name="l01647"></a>01647         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a402863c5613762a8d4971acaa7a9d991">FATTR4_TIME_ACCESS_SET</a>:
<a name="l01648"></a>01648           LastOffset += fsal_time_to_settime4(&amp;pattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a48293ea65b5bb7282d4421ad079f056f">atime</a>,
<a name="l01649"></a>01649                                               attrvalsBuffer + LastOffset);
<a name="l01650"></a>01650           op_attr_success = 1;
<a name="l01651"></a>01651           <span class="keywordflow">break</span>;
<a name="l01652"></a>01652 
<a name="l01653"></a>01653         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#adadf5f190b82cffdfcfd0508bfe44931">FATTR4_TIME_BACKUP</a>:
<a name="l01654"></a>01654           <span class="comment">/* No time backup, return unix&#39;s beginning of time */</span>
<a name="l01655"></a>01655         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a59b428c6296b4086d51c8575c0da9216">FATTR4_TIME_CREATE</a>:
<a name="l01656"></a>01656           <span class="comment">/* No time create, return unix&#39;s beginning of time */</span>
<a name="l01657"></a>01657           time_create.<a class="code" href="structnfstime4.html#ad46cdfc1412964d638b98aff64812200">seconds</a> = <a class="code" href="group__NFSprocs.html#gab52fdbc875109ccb84900a657877a23b">nfs_htonl64</a>(0LL);
<a name="l01658"></a>01658           time_create.<a class="code" href="structnfstime4.html#abf33417561dc5d91b5ed6a671936ecda">nseconds</a> = htonl(0);
<a name="l01659"></a>01659           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;time_create,
<a name="l01660"></a>01660                  fattr4tab[attribute_to_set].size_fattr4);
<a name="l01661"></a>01661           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01662"></a>01662           op_attr_success = 1;
<a name="l01663"></a>01663           <span class="keywordflow">break</span>;
<a name="l01664"></a>01664 
<a name="l01665"></a>01665         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a1256030125455df517cb22c3b98bf022">FATTR4_TIME_DELTA</a>:
<a name="l01666"></a>01666           <span class="comment">/* According to RFC3530, this is &quot;the smallest usefull server time granularity&quot;, I set this to 1s */</span>
<a name="l01667"></a>01667           time_delta.<a class="code" href="structnfstime4.html#ad46cdfc1412964d638b98aff64812200">seconds</a> = <a class="code" href="group__NFSprocs.html#gab52fdbc875109ccb84900a657877a23b">nfs_htonl64</a>(1LL);
<a name="l01668"></a>01668           time_delta.<a class="code" href="structnfstime4.html#abf33417561dc5d91b5ed6a671936ecda">nseconds</a> = htonl(0);
<a name="l01669"></a>01669           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;time_delta,
<a name="l01670"></a>01670                  fattr4tab[attribute_to_set].size_fattr4);
<a name="l01671"></a>01671           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01672"></a>01672           op_attr_success = 1;
<a name="l01673"></a>01673           <span class="keywordflow">break</span>;
<a name="l01674"></a>01674 
<a name="l01675"></a>01675         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a13c0c2b7994641285fe8cc9e130c91f3">FATTR4_TIME_METADATA</a>:
<a name="l01676"></a>01676           <span class="comment">/* The time for the last metadata operation, the ctime in the unix&#39;s semantic */</span>
<a name="l01677"></a>01677           memset(&amp;(time_metadata.<a class="code" href="structnfstime4.html#ad46cdfc1412964d638b98aff64812200">seconds</a>), 0, <span class="keyword">sizeof</span>(<a class="code" href="extended__types_8h.html#a20c5e9a94aaa5a66a9f0165f027a8581">int64_t</a>));
<a name="l01678"></a>01678           time_metadata.<a class="code" href="structnfstime4.html#ad46cdfc1412964d638b98aff64812200">seconds</a> = <a class="code" href="group__NFSprocs.html#gab52fdbc875109ccb84900a657877a23b">nfs_htonl64</a>((<a class="code" href="extended__types_8h.html#a20c5e9a94aaa5a66a9f0165f027a8581">int64_t</a>) pattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7087852b901550fbbc6ba2aed12c96ef">ctime</a>.<a class="code" href="structfsal__time____.html#add92ec6180384f0ba10dd2a79b659548">seconds</a>);
<a name="l01679"></a>01679           time_metadata.<a class="code" href="structnfstime4.html#abf33417561dc5d91b5ed6a671936ecda">nseconds</a> = htonl(pattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7087852b901550fbbc6ba2aed12c96ef">ctime</a>.<a class="code" href="structfsal__time____.html#a9c41918d2f2ea4627205dd4c2e347373">nseconds</a>);
<a name="l01680"></a>01680           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;time_metadata,
<a name="l01681"></a>01681                  fattr4tab[attribute_to_set].size_fattr4);
<a name="l01682"></a>01682           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01683"></a>01683           op_attr_success = 1;
<a name="l01684"></a>01684           <span class="keywordflow">break</span>;
<a name="l01685"></a>01685 
<a name="l01686"></a>01686         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#aca636cf87f02044b79a6911207579f7d">FATTR4_TIME_MODIFY</a>:
<a name="l01687"></a>01687           <span class="comment">/* The time for the last modify operation, the mtime in the unix&#39;s semantic */</span>
<a name="l01688"></a>01688           memset(&amp;(time_modify.<a class="code" href="structnfstime4.html#ad46cdfc1412964d638b98aff64812200">seconds</a>), 0, <span class="keyword">sizeof</span>(<a class="code" href="extended__types_8h.html#a20c5e9a94aaa5a66a9f0165f027a8581">int64_t</a>));
<a name="l01689"></a>01689           time_modify.<a class="code" href="structnfstime4.html#ad46cdfc1412964d638b98aff64812200">seconds</a> = <a class="code" href="group__NFSprocs.html#gab52fdbc875109ccb84900a657877a23b">nfs_htonl64</a>((<a class="code" href="extended__types_8h.html#a20c5e9a94aaa5a66a9f0165f027a8581">int64_t</a>) pattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a441daefe7cc86152355f895d81bc2936">mtime</a>.<a class="code" href="structfsal__time____.html#add92ec6180384f0ba10dd2a79b659548">seconds</a>);
<a name="l01690"></a>01690           time_modify.<a class="code" href="structnfstime4.html#abf33417561dc5d91b5ed6a671936ecda">nseconds</a> = htonl(pattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a441daefe7cc86152355f895d81bc2936">mtime</a>.<a class="code" href="structfsal__time____.html#a9c41918d2f2ea4627205dd4c2e347373">nseconds</a>);
<a name="l01691"></a>01691 
<a name="l01692"></a>01692           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;time_modify,
<a name="l01693"></a>01693                  fattr4tab[attribute_to_set].size_fattr4);
<a name="l01694"></a>01694           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01695"></a>01695           op_attr_success = 1;
<a name="l01696"></a>01696           <span class="keywordflow">break</span>;
<a name="l01697"></a>01697 
<a name="l01698"></a>01698         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a9d41d38182a69e76e8a51f3e99d4a232">FATTR4_TIME_MODIFY_SET</a>:
<a name="l01699"></a>01699           LastOffset += fsal_time_to_settime4(&amp;pattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a441daefe7cc86152355f895d81bc2936">mtime</a>,
<a name="l01700"></a>01700                                               attrvalsBuffer + LastOffset);
<a name="l01701"></a>01701           op_attr_success = 1;
<a name="l01702"></a>01702           <span class="keywordflow">break</span>;
<a name="l01703"></a>01703 
<a name="l01704"></a>01704         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#aee5e5c06f383e00c90378fabc96deaee">FATTR4_MOUNTED_ON_FILEID</a>:
<a name="l01705"></a>01705           file_id = <a class="code" href="group__NFSprocs.html#gab52fdbc875109ccb84900a657877a23b">nfs_htonl64</a>(pattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a657a3efbc26891ced4b16f48791452c3">fileid</a>);
<a name="l01706"></a>01706           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset), &amp;file_id, <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#a439aa2213ecdeca95541878dbac665ce">fattr4_fileid</a>));
<a name="l01707"></a>01707           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01708"></a>01708           op_attr_success = 1;
<a name="l01709"></a>01709           <span class="keywordflow">break</span>;
<a name="l01710"></a>01710 
<a name="l01711"></a>01711 <span class="preprocessor">#ifdef _USE_NFS4_1</span>
<a name="l01712"></a>01712 <span class="preprocessor"></span>        <span class="keywordflow">case</span> <a class="code" href="nfsv41_8h.html#a7644b092d6915894c2c725d152666964">FATTR4_FS_LAYOUT_TYPES</a>:
<a name="l01713"></a>01713 <span class="preprocessor">#ifdef _PNFS_MDS</span>
<a name="l01714"></a>01714 <span class="preprocessor"></span>          *((<a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>*)(attrvalsBuffer+LastOffset))
<a name="l01715"></a>01715             = htonl(pstaticinfo-&gt;fs_layout_types
<a name="l01716"></a>01716                     .fattr4_fs_layout_types_len);
<a name="l01717"></a>01717 
<a name="l01718"></a>01718           LastOffset += <span class="keyword">sizeof</span>(<a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>);
<a name="l01719"></a>01719           <span class="keywordflow">for</span> (k = 0; k &lt; (pstaticinfo-&gt;fs_layout_types
<a name="l01720"></a>01720                            .fattr4_fs_layout_types_len); k++)
<a name="l01721"></a>01721             {
<a name="l01722"></a>01722               *((<a class="code" href="nfsv41_8h.html#a71637e9b8b94ee85c82b10578b1f6f2d">layouttype4</a>*)(attrvalsBuffer+LastOffset))
<a name="l01723"></a>01723                 = htonl((pstaticinfo-&gt;fs_layout_types
<a name="l01724"></a>01724                          .fattr4_fs_layout_types_val[k]));
<a name="l01725"></a>01725               LastOffset += <span class="keyword">sizeof</span>(<a class="code" href="nfsv41_8h.html#a71637e9b8b94ee85c82b10578b1f6f2d">layouttype4</a>);
<a name="l01726"></a>01726             }
<a name="l01727"></a>01727 
<a name="l01728"></a>01728           op_attr_success = 1;
<a name="l01729"></a>01729           <span class="keywordflow">break</span>;
<a name="l01730"></a>01730 <span class="preprocessor">#endif </span><span class="comment">/* _PNFS_MDS */</span>
<a name="l01731"></a>01731 
<a name="l01732"></a>01732 <span class="preprocessor">#ifdef _PNFS_MDS</span>
<a name="l01733"></a>01733 <span class="preprocessor"></span>        <span class="keywordflow">case</span> <a class="code" href="nfsv41_8h.html#aeb1c3728d42e75e71907b24aa207407a">FATTR4_LAYOUT_BLKSIZE</a>:
<a name="l01734"></a>01734           layout_blksize
<a name="l01735"></a>01735             = htonl((<a class="code" href="nfsv41_8h.html#a44500afd03ed69b5249a3c5c54e2266b">fattr4_layout_blksize</a>) pstaticinfo-&gt;layout_blksize);
<a name="l01736"></a>01736           memcpy((<span class="keywordtype">char</span> *)(attrvalsBuffer + LastOffset),
<a name="l01737"></a>01737                  &amp;layout_blksize, <span class="keyword">sizeof</span>(<a class="code" href="nfsv41_8h.html#a44500afd03ed69b5249a3c5c54e2266b">fattr4_layout_blksize</a>));
<a name="l01738"></a>01738           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l01739"></a>01739 
<a name="l01740"></a>01740           op_attr_success = 1;
<a name="l01741"></a>01741           <span class="keywordflow">break</span>;
<a name="l01742"></a>01742 <span class="preprocessor">#endif </span><span class="comment">/* _PNFS_MDS */</span>
<a name="l01743"></a>01743 <span class="preprocessor">#endif </span><span class="comment">/* _USE_NFS4_1 */</span>
<a name="l01744"></a>01744 
<a name="l01745"></a>01745         <span class="keywordflow">default</span>:
<a name="l01746"></a>01746           <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>,
<a name="l01747"></a>01747                        <span class="stringliteral">&quot; unsupported value for attributes bitmap = %u&quot;</span>, attribute_to_set);
<a name="l01748"></a>01748 
<a name="l01749"></a>01749           op_attr_success = 0;
<a name="l01750"></a>01750           <span class="keywordflow">break</span>;
<a name="l01751"></a>01751         }                       <span class="comment">/* switch( attribute_to_set ) */</span>
<a name="l01752"></a>01752 
<a name="l01753"></a>01753       <span class="comment">/* Increase the Offset for the next operation if this was a success */</span>
<a name="l01754"></a>01754       <span class="keywordflow">if</span>(op_attr_success)
<a name="l01755"></a>01755         {
<a name="l01756"></a>01756           <span class="comment">/* Set the returned bitmask */</span>
<a name="l01757"></a>01757           attrvalslist[j] = attribute_to_set;
<a name="l01758"></a>01758           j += 1;
<a name="l01759"></a>01759 
<a name="l01760"></a>01760           <span class="comment">/* Be carefull not to get out of attrvalsBuffer */</span>
<a name="l01761"></a>01761           <span class="keywordflow">if</span>(LastOffset &gt; <a class="code" href="nfs__tools_8h.html#af43b31f46bb53819fcd39ae77c8fe9d1">ATTRVALS_BUFFLEN</a>)
<a name="l01762"></a>01762             <span class="keywordflow">return</span> -1;
<a name="l01763"></a>01763         }
<a name="l01764"></a>01764 
<a name="l01765"></a>01765     }                           <span class="comment">/* for i */</span>
<a name="l01766"></a>01766 
<a name="l01767"></a>01767   <span class="keywordflow">return</span> <a class="code" href="group__NFSprocs.html#ga03c63cf888bb6b4839155d46dd50c79f">nfs4_Fattr_Fill</a>(Fattr, j, attrvalslist, LastOffset, attrvalsBuffer);
<a name="l01768"></a>01768 }                               <span class="comment">/* nfs4_FSALattr_To_Fattr */</span>
<a name="l01769"></a>01769 
<a name="l01782"></a><a class="code" href="group__NFSprocs.html#ga06363b756897e31c8d12e8c8299aa28a">01782</a> <span class="keywordtype">int</span> <a class="code" href="group__NFSprocs.html#ga06363b756897e31c8d12e8c8299aa28a">nfs3_Sattr_To_FSALattr</a>(<a class="code" href="structfsal__attrib__list____.html">fsal_attrib_list_t</a> * pFSAL_attr,     <span class="comment">/* Out: file attributes */</span>
<a name="l01783"></a>01783                            <a class="code" href="structsattr3.html">sattr3</a> * psattr)     <span class="comment">/* In: file attributes  */</span>
<a name="l01784"></a>01784 {
<a name="l01785"></a>01785   <span class="keyword">struct </span>timeval t;
<a name="l01786"></a>01786 
<a name="l01787"></a>01787   <span class="keywordflow">if</span>(pFSAL_attr == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || psattr == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01788"></a>01788     <span class="keywordflow">return</span> 0;
<a name="l01789"></a>01789 
<a name="l01790"></a>01790   pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a> = 0;
<a name="l01791"></a>01791 
<a name="l01792"></a>01792   <span class="keywordflow">if</span>(psattr-&gt;<a class="code" href="structsattr3.html#ae5f122a52221ffb59b52d4249b420bd4">mode</a>.<a class="code" href="structset__mode3.html#ab7e46eb18ff0938f2d09b31679b8c57e">set_it</a> == <a class="code" href="HashTable_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>)
<a name="l01793"></a>01793     {
<a name="l01794"></a>01794       <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556af6e90cb9d43106e13df4e83652c94f27">COMPONENT_NFSPROTO</a>,
<a name="l01795"></a>01795                    <span class="stringliteral">&quot;nfs3_Sattr_To_FSALattr: mode = %o&quot;</span>,
<a name="l01796"></a>01796                    psattr-&gt;<a class="code" href="structsattr3.html#ae5f122a52221ffb59b52d4249b420bd4">mode</a>.<a class="code" href="structset__mode3.html#a4e525e34a21a413bce7afc2f6980b6b0">set_mode3_u</a>.<a class="code" href="structset__mode3.html#a2083c98c567384edef30c8ea27e16a2f">mode</a>);
<a name="l01797"></a>01797       pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a6611fe8fc39ff41d2c21d194213322e7">mode</a> = <a class="code" href="FSAL_2FSAL__CEPH_2fsal__convert_8h.html#aaf1ff789aff0ed7114b8e525e01e268c">unix2fsal_mode</a>(psattr-&gt;<a class="code" href="structsattr3.html#ae5f122a52221ffb59b52d4249b420bd4">mode</a>.<a class="code" href="structset__mode3.html#a4e525e34a21a413bce7afc2f6980b6b0">set_mode3_u</a>.<a class="code" href="structset__mode3.html#a2083c98c567384edef30c8ea27e16a2f">mode</a>);
<a name="l01798"></a>01798       pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a> |= <a class="code" href="fsal__types_8h.html#aa94f1053d0de1f0e5a0706d640cf300e">FSAL_ATTR_MODE</a>;
<a name="l01799"></a>01799     }
<a name="l01800"></a>01800 
<a name="l01801"></a>01801   <span class="keywordflow">if</span>(psattr-&gt;<a class="code" href="structsattr3.html#a2205406f677c77b7d01e47b4e98209b3">uid</a>.<a class="code" href="structset__uid3.html#a94f2d6b71a0406e411a764fb2586eddf">set_it</a> == <a class="code" href="HashTable_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>)
<a name="l01802"></a>01802     {
<a name="l01803"></a>01803       <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556af6e90cb9d43106e13df4e83652c94f27">COMPONENT_NFSPROTO</a>,
<a name="l01804"></a>01804                    <span class="stringliteral">&quot;nfs3_Sattr_To_FSALattr: uid = %d&quot;</span>,
<a name="l01805"></a>01805                    psattr-&gt;<a class="code" href="structsattr3.html#a2205406f677c77b7d01e47b4e98209b3">uid</a>.<a class="code" href="structset__uid3.html#a533b247369f78a07b6241bf12a677b34">set_uid3_u</a>.<a class="code" href="structset__uid3.html#a3148a571209e81db001cad0766935263">uid</a>);
<a name="l01806"></a>01806       pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a89670e3e52193381c240c0b7d93d6aa6">owner</a> = psattr-&gt;<a class="code" href="structsattr3.html#a2205406f677c77b7d01e47b4e98209b3">uid</a>.<a class="code" href="structset__uid3.html#a533b247369f78a07b6241bf12a677b34">set_uid3_u</a>.<a class="code" href="structset__uid3.html#a3148a571209e81db001cad0766935263">uid</a>;
<a name="l01807"></a>01807       pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a> |= <a class="code" href="fsal__types_8h.html#ac8af49f265b9c157cf8d27e156086e07">FSAL_ATTR_OWNER</a>;
<a name="l01808"></a>01808     }
<a name="l01809"></a>01809 
<a name="l01810"></a>01810   <span class="keywordflow">if</span>(psattr-&gt;<a class="code" href="structsattr3.html#a938c50f1a8857c94172d54841b68dc95">gid</a>.<a class="code" href="structset__gid3.html#acd223c5e2203b25dab1f7cd34141be32">set_it</a> == <a class="code" href="HashTable_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>)
<a name="l01811"></a>01811     {
<a name="l01812"></a>01812       <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556af6e90cb9d43106e13df4e83652c94f27">COMPONENT_NFSPROTO</a>,
<a name="l01813"></a>01813                    <span class="stringliteral">&quot;nfs3_Sattr_To_FSALattr: gid = %d&quot;</span>,
<a name="l01814"></a>01814                    psattr-&gt;<a class="code" href="structsattr3.html#a938c50f1a8857c94172d54841b68dc95">gid</a>.<a class="code" href="structset__gid3.html#a335d2009819ba6f78464e18e34d49a16">set_gid3_u</a>.<a class="code" href="structset__gid3.html#ab9ef45fe43665bbec4af0a85003a1261">gid</a>);
<a name="l01815"></a>01815       pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e4622af711f91b5f598fce5e0bee9fa">group</a> = psattr-&gt;<a class="code" href="structsattr3.html#a938c50f1a8857c94172d54841b68dc95">gid</a>.<a class="code" href="structset__gid3.html#a335d2009819ba6f78464e18e34d49a16">set_gid3_u</a>.<a class="code" href="structset__gid3.html#ab9ef45fe43665bbec4af0a85003a1261">gid</a>;
<a name="l01816"></a>01816       pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a> |= <a class="code" href="fsal__types_8h.html#a36d30893495819b31377203edbcb91cf">FSAL_ATTR_GROUP</a>;
<a name="l01817"></a>01817     }
<a name="l01818"></a>01818 
<a name="l01819"></a>01819   <span class="keywordflow">if</span>(psattr-&gt;<a class="code" href="structsattr3.html#a886cfc818959b6f92d3866f4d57437b3">size</a>.<a class="code" href="structset__size3.html#ab72402f645cc743fc8ecece6dd089316">set_it</a> == <a class="code" href="HashTable_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>)
<a name="l01820"></a>01820     {
<a name="l01821"></a>01821       <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556af6e90cb9d43106e13df4e83652c94f27">COMPONENT_NFSPROTO</a>,
<a name="l01822"></a>01822                    <span class="stringliteral">&quot;nfs3_Sattr_To_FSALattr: size = %lld&quot;</span>,
<a name="l01823"></a>01823                    psattr-&gt;<a class="code" href="structsattr3.html#a886cfc818959b6f92d3866f4d57437b3">size</a>.<a class="code" href="structset__size3.html#a04b586b728e6822a74377e720bdc9480">set_size3_u</a>.<a class="code" href="structset__size3.html#a5c7d5c0f2996573871d9e85d9327e5de">size</a>);
<a name="l01824"></a>01824       pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a0105c962cf3b7c8d11e2e2d1c5acff31">filesize</a> = (<a class="code" href="fsal__types_8h.html#a30fc893739650c71e910bc834eb401df">fsal_size_t</a>) psattr-&gt;<a class="code" href="structsattr3.html#a886cfc818959b6f92d3866f4d57437b3">size</a>.<a class="code" href="structset__size3.html#a04b586b728e6822a74377e720bdc9480">set_size3_u</a>.<a class="code" href="structset__size3.html#a5c7d5c0f2996573871d9e85d9327e5de">size</a>;
<a name="l01825"></a>01825       pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a98bcdb72020b255bbe3355f9fc4c6a74">spaceused</a> = (<a class="code" href="fsal__types_8h.html#a30fc893739650c71e910bc834eb401df">fsal_size_t</a>) psattr-&gt;<a class="code" href="structsattr3.html#a886cfc818959b6f92d3866f4d57437b3">size</a>.<a class="code" href="structset__size3.html#a04b586b728e6822a74377e720bdc9480">set_size3_u</a>.<a class="code" href="structset__size3.html#a5c7d5c0f2996573871d9e85d9327e5de">size</a>;
<a name="l01826"></a>01826       <span class="comment">/* Both FSAL_ATTR_SIZE and FSAL_ATTR_SPACEUSED are to be managed */</span>
<a name="l01827"></a>01827       pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a> |= <a class="code" href="fsal__types_8h.html#a5859dca54adcb7dfed89e82ec0e265b6">FSAL_ATTR_SIZE</a>;
<a name="l01828"></a>01828       pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a> |= <a class="code" href="fsal__types_8h.html#a00384f412d9747624a5eb9caf5ac38cd">FSAL_ATTR_SPACEUSED</a>;
<a name="l01829"></a>01829     }
<a name="l01830"></a>01830 
<a name="l01831"></a>01831   <span class="keywordflow">if</span>(psattr-&gt;<a class="code" href="structsattr3.html#a269e3316454fcb091c99bc93d3f4e26f">atime</a>.<a class="code" href="structset__atime.html#ab021c13de00e3c3391248fe689bfb125">set_it</a> != <a class="code" href="nfs23_8h.html#a073a77f0e47a0652458d490f531e0c6da0112ffba4da19444de62dd0ec75654c6">DONT_CHANGE</a>)
<a name="l01832"></a>01832     {
<a name="l01833"></a>01833       <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556af6e90cb9d43106e13df4e83652c94f27">COMPONENT_NFSPROTO</a>,
<a name="l01834"></a>01834                    <span class="stringliteral">&quot;nfs3_Sattr_To_FSALattr: set=%d atime = %d,%d&quot;</span>,
<a name="l01835"></a>01835                    psattr-&gt;<a class="code" href="structsattr3.html#a269e3316454fcb091c99bc93d3f4e26f">atime</a>.<a class="code" href="structset__atime.html#ab021c13de00e3c3391248fe689bfb125">set_it</a>, psattr-&gt;<a class="code" href="structsattr3.html#a269e3316454fcb091c99bc93d3f4e26f">atime</a>.<a class="code" href="structset__atime.html#a3ccfd263a9c49f37eccb4c90702592b2">set_atime_u</a>.<a class="code" href="structset__atime.html#acdde5424dbb165bda14ff4d45be699cd">atime</a>.<a class="code" href="structnfstime3.html#a6765f76aef63ace5fb0ce3dc904f14c3">seconds</a>,
<a name="l01836"></a>01836                    psattr-&gt;<a class="code" href="structsattr3.html#a269e3316454fcb091c99bc93d3f4e26f">atime</a>.<a class="code" href="structset__atime.html#a3ccfd263a9c49f37eccb4c90702592b2">set_atime_u</a>.<a class="code" href="structset__atime.html#acdde5424dbb165bda14ff4d45be699cd">atime</a>.<a class="code" href="structnfstime3.html#aad0965ff90c90abd7d7c4c431e7e41a1">nseconds</a>);
<a name="l01837"></a>01837       <span class="keywordflow">if</span>(psattr-&gt;<a class="code" href="structsattr3.html#a269e3316454fcb091c99bc93d3f4e26f">atime</a>.<a class="code" href="structset__atime.html#ab021c13de00e3c3391248fe689bfb125">set_it</a> == <a class="code" href="nfs23_8h.html#a073a77f0e47a0652458d490f531e0c6daaa081929e588b58ae26675e4309e2546">SET_TO_CLIENT_TIME</a>)
<a name="l01838"></a>01838         {
<a name="l01839"></a>01839           pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a48293ea65b5bb7282d4421ad079f056f">atime</a>.<a class="code" href="structfsal__time____.html#add92ec6180384f0ba10dd2a79b659548">seconds</a> = psattr-&gt;<a class="code" href="structsattr3.html#a269e3316454fcb091c99bc93d3f4e26f">atime</a>.<a class="code" href="structset__atime.html#a3ccfd263a9c49f37eccb4c90702592b2">set_atime_u</a>.<a class="code" href="structset__atime.html#acdde5424dbb165bda14ff4d45be699cd">atime</a>.<a class="code" href="structnfstime3.html#a6765f76aef63ace5fb0ce3dc904f14c3">seconds</a>;
<a name="l01840"></a>01840           pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a48293ea65b5bb7282d4421ad079f056f">atime</a>.<a class="code" href="structfsal__time____.html#a9c41918d2f2ea4627205dd4c2e347373">nseconds</a> = 0;
<a name="l01841"></a>01841         }
<a name="l01842"></a>01842       <span class="keywordflow">else</span>
<a name="l01843"></a>01843         {
<a name="l01844"></a>01844           <span class="comment">/* Use the server&#39;s current time */</span>
<a name="l01845"></a>01845           gettimeofday(&amp;t, <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01846"></a>01846 
<a name="l01847"></a>01847           pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a48293ea65b5bb7282d4421ad079f056f">atime</a>.<a class="code" href="structfsal__time____.html#add92ec6180384f0ba10dd2a79b659548">seconds</a> = t.tv_sec;
<a name="l01848"></a>01848           pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a48293ea65b5bb7282d4421ad079f056f">atime</a>.<a class="code" href="structfsal__time____.html#a9c41918d2f2ea4627205dd4c2e347373">nseconds</a> = 0;
<a name="l01849"></a>01849         }
<a name="l01850"></a>01850       pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a> |= <a class="code" href="fsal__types_8h.html#aa809a24aeeb4b580487163fea39856a1">FSAL_ATTR_ATIME</a>;
<a name="l01851"></a>01851     }
<a name="l01852"></a>01852 
<a name="l01853"></a>01853   <span class="keywordflow">if</span>(psattr-&gt;<a class="code" href="structsattr3.html#a2f2ea20841da581dbb8f58263c7f1c87">mtime</a>.<a class="code" href="structset__mtime.html#a934156de50276d5a7e877197a5c4a6c0">set_it</a> != <a class="code" href="nfs23_8h.html#a073a77f0e47a0652458d490f531e0c6da0112ffba4da19444de62dd0ec75654c6">DONT_CHANGE</a>)
<a name="l01854"></a>01854     {
<a name="l01855"></a>01855       <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556af6e90cb9d43106e13df4e83652c94f27">COMPONENT_NFSPROTO</a>,
<a name="l01856"></a>01856                    <span class="stringliteral">&quot;nfs3_Sattr_To_FSALattr: set=%d mtime = %d&quot;</span>,
<a name="l01857"></a>01857                    psattr-&gt;<a class="code" href="structsattr3.html#a269e3316454fcb091c99bc93d3f4e26f">atime</a>.<a class="code" href="structset__atime.html#ab021c13de00e3c3391248fe689bfb125">set_it</a>, psattr-&gt;<a class="code" href="structsattr3.html#a2f2ea20841da581dbb8f58263c7f1c87">mtime</a>.<a class="code" href="structset__mtime.html#af375135f06dae42a4a4f29bc50362998">set_mtime_u</a>.<a class="code" href="structset__mtime.html#a97833387cd3ad2b61b11da7409950771">mtime</a>.<a class="code" href="structnfstime3.html#a6765f76aef63ace5fb0ce3dc904f14c3">seconds</a> ) ;
<a name="l01858"></a>01858       <span class="keywordflow">if</span>(psattr-&gt;<a class="code" href="structsattr3.html#a2f2ea20841da581dbb8f58263c7f1c87">mtime</a>.<a class="code" href="structset__mtime.html#a934156de50276d5a7e877197a5c4a6c0">set_it</a> == <a class="code" href="nfs23_8h.html#a073a77f0e47a0652458d490f531e0c6daaa081929e588b58ae26675e4309e2546">SET_TO_CLIENT_TIME</a>)
<a name="l01859"></a>01859         {
<a name="l01860"></a>01860           pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a441daefe7cc86152355f895d81bc2936">mtime</a>.<a class="code" href="structfsal__time____.html#add92ec6180384f0ba10dd2a79b659548">seconds</a> = psattr-&gt;<a class="code" href="structsattr3.html#a2f2ea20841da581dbb8f58263c7f1c87">mtime</a>.<a class="code" href="structset__mtime.html#af375135f06dae42a4a4f29bc50362998">set_mtime_u</a>.<a class="code" href="structset__mtime.html#a97833387cd3ad2b61b11da7409950771">mtime</a>.<a class="code" href="structnfstime3.html#a6765f76aef63ace5fb0ce3dc904f14c3">seconds</a>;
<a name="l01861"></a>01861           pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a441daefe7cc86152355f895d81bc2936">mtime</a>.<a class="code" href="structfsal__time____.html#a9c41918d2f2ea4627205dd4c2e347373">nseconds</a> = 0 ;
<a name="l01862"></a>01862         }
<a name="l01863"></a>01863       <span class="keywordflow">else</span>
<a name="l01864"></a>01864         {
<a name="l01865"></a>01865           <span class="comment">/* Use the server&#39;s current time */</span>
<a name="l01866"></a>01866           gettimeofday(&amp;t, <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01867"></a>01867           pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a441daefe7cc86152355f895d81bc2936">mtime</a>.<a class="code" href="structfsal__time____.html#add92ec6180384f0ba10dd2a79b659548">seconds</a> = t.tv_sec;
<a name="l01868"></a>01868           pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a441daefe7cc86152355f895d81bc2936">mtime</a>.<a class="code" href="structfsal__time____.html#a9c41918d2f2ea4627205dd4c2e347373">nseconds</a> = 0 ;
<a name="l01869"></a>01869         }
<a name="l01870"></a>01870       pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a> |= <a class="code" href="fsal__types_8h.html#a9831a00094624d8747ecbf71c1560e8d">FSAL_ATTR_MTIME</a>;
<a name="l01871"></a>01871     }
<a name="l01872"></a>01872 
<a name="l01873"></a>01873   <span class="keywordflow">return</span> 1;
<a name="l01874"></a>01874 }                               <span class="comment">/* nfs3_Sattr_To_FSALattr */</span>
<a name="l01875"></a>01875 
<a name="l01889"></a><a class="code" href="group__NFSprocs.html#gac4a0005c73ef75953f6980cd4566aac4">01889</a> <span class="keywordtype">int</span> <a class="code" href="group__NFSprocs.html#gac4a0005c73ef75953f6980cd4566aac4">nfs2_FSALattr_To_Fattr</a>(<a class="code" href="structexportlist____.html">exportlist_t</a> * pexport,      <span class="comment">/* In: the related export entry */</span>
<a name="l01890"></a>01890                            <a class="code" href="structfsal__attrib__list____.html">fsal_attrib_list_t</a> * pFSAL_attr,     <span class="comment">/* In: file attributes  */</span>
<a name="l01891"></a>01891                            <a class="code" href="structfattr2.html">fattr2</a> * pFattr)     <span class="comment">/* Out: file attributes */</span>
<a name="l01892"></a>01892 {
<a name="l01893"></a>01893   <span class="comment">/* Badly formed arguments */</span>
<a name="l01894"></a>01894   <span class="keywordflow">if</span>(pFSAL_attr == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || pFattr == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01895"></a>01895     <span class="keywordflow">return</span> 0;
<a name="l01896"></a>01896 
<a name="l01897"></a>01897   <span class="comment">/* @todo BUGAZOMEU: sanity check on attribute mask (does the FSAL support the attributes required to support NFSv2 ? */</span>
<a name="l01898"></a>01898 
<a name="l01899"></a>01899   <span class="comment">/* initialize mode */</span>
<a name="l01900"></a>01900   pFattr-&gt;<a class="code" href="structfattr2.html#a13e1098d503868bff038e70e9ac96d72">mode</a> = 0;
<a name="l01901"></a>01901 
<a name="l01902"></a>01902   <span class="keywordflow">switch</span> (pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a03249aca39ba1b16b4712079d93b025e">type</a>)
<a name="l01903"></a>01903     {
<a name="l01904"></a>01904     <span class="keywordflow">case</span> <a class="code" href="fsal__types_8h.html#a368aa63441663f9326d0201857bfcea3afb0cf0224b4c4d6adaec28b1f3d65400">FSAL_TYPE_FILE</a>:
<a name="l01905"></a>01905       pFattr-&gt;<a class="code" href="structfattr2.html#a0ba0a7d7f07a99ada917d40132312360">type</a> = <a class="code" href="nfs23_8h.html#a7e56f6b0be4a9774f81263b13e20514ba918ce77c1d78df7450d1b7b5fa5b579a">NFREG</a>;
<a name="l01906"></a>01906       pFattr-&gt;<a class="code" href="structfattr2.html#a13e1098d503868bff038e70e9ac96d72">mode</a> = <a class="code" href="nfs__proto__tools_8h.html#aea75bf97385ac138852873b39f5bb786">NFS2_MODE_NFREG</a>;
<a name="l01907"></a>01907       <span class="keywordflow">break</span>;
<a name="l01908"></a>01908 
<a name="l01909"></a>01909     <span class="keywordflow">case</span> <a class="code" href="fsal__types_8h.html#a368aa63441663f9326d0201857bfcea3a302bac21d091a1f3fc1ef5adb50661c3">FSAL_TYPE_DIR</a>:
<a name="l01910"></a>01910       pFattr-&gt;<a class="code" href="structfattr2.html#a0ba0a7d7f07a99ada917d40132312360">type</a> = <a class="code" href="nfs23_8h.html#a7e56f6b0be4a9774f81263b13e20514baf55db12d4c4f03e7dcc3739ae2c07553">NFDIR</a>;
<a name="l01911"></a>01911       pFattr-&gt;<a class="code" href="structfattr2.html#a13e1098d503868bff038e70e9ac96d72">mode</a> = <a class="code" href="nfs__proto__tools_8h.html#ae0433342ccf496557982c9067a5c356f">NFS2_MODE_NFDIR</a>;
<a name="l01912"></a>01912       <span class="keywordflow">break</span>;
<a name="l01913"></a>01913 
<a name="l01914"></a>01914     <span class="keywordflow">case</span> <a class="code" href="fsal__types_8h.html#a368aa63441663f9326d0201857bfcea3a4889072a63eda04f5c8d92a5a5bc04cd">FSAL_TYPE_BLK</a>:
<a name="l01915"></a>01915       pFattr-&gt;<a class="code" href="structfattr2.html#a0ba0a7d7f07a99ada917d40132312360">type</a> = <a class="code" href="nfs23_8h.html#a7e56f6b0be4a9774f81263b13e20514babd018a3d65f9301f9da4cbe442627f14">NFBLK</a>;
<a name="l01916"></a>01916       pFattr-&gt;<a class="code" href="structfattr2.html#a13e1098d503868bff038e70e9ac96d72">mode</a> = <a class="code" href="nfs__proto__tools_8h.html#a4ab92ccbe2478024429f6239e183e6d6">NFS2_MODE_NFBLK</a>;
<a name="l01917"></a>01917       <span class="keywordflow">break</span>;
<a name="l01918"></a>01918 
<a name="l01919"></a>01919     <span class="keywordflow">case</span> <a class="code" href="fsal__types_8h.html#a368aa63441663f9326d0201857bfcea3ab2cc09e4ad4298e2b0238df7ebc18adc">FSAL_TYPE_CHR</a>:
<a name="l01920"></a>01920       pFattr-&gt;<a class="code" href="structfattr2.html#a0ba0a7d7f07a99ada917d40132312360">type</a> = <a class="code" href="nfs23_8h.html#a7e56f6b0be4a9774f81263b13e20514ba8fd1d0a2730b4d9500df36220fb93bd3">NFCHR</a>;
<a name="l01921"></a>01921       pFattr-&gt;<a class="code" href="structfattr2.html#a13e1098d503868bff038e70e9ac96d72">mode</a> = <a class="code" href="nfs__proto__tools_8h.html#a21d63595114229c921d8b7fd5db066c2">NFS2_MODE_NFCHR</a>;
<a name="l01922"></a>01922       <span class="keywordflow">break</span>;
<a name="l01923"></a>01923 
<a name="l01924"></a>01924     <span class="keywordflow">case</span> <a class="code" href="fsal__types_8h.html#a368aa63441663f9326d0201857bfcea3a162623715e400bfeb41be0a079f9856e">FSAL_TYPE_FIFO</a>:
<a name="l01925"></a>01925       pFattr-&gt;<a class="code" href="structfattr2.html#a0ba0a7d7f07a99ada917d40132312360">type</a> = <a class="code" href="nfs23_8h.html#a7e56f6b0be4a9774f81263b13e20514baea23649982488eccdea8b82f2b52df1c">NFFIFO</a>;
<a name="l01927"></a>01927       <span class="keywordflow">break</span>;
<a name="l01928"></a>01928 
<a name="l01929"></a>01929     <span class="keywordflow">case</span> <a class="code" href="fsal__types_8h.html#a368aa63441663f9326d0201857bfcea3adca35a94946e3fba05a201e70f98c3a8">FSAL_TYPE_LNK</a>:
<a name="l01930"></a>01930       pFattr-&gt;<a class="code" href="structfattr2.html#a0ba0a7d7f07a99ada917d40132312360">type</a> = <a class="code" href="nfs23_8h.html#a7e56f6b0be4a9774f81263b13e20514bacc12fa993371cade4ba9731094020456">NFLNK</a>;
<a name="l01931"></a>01931       pFattr-&gt;<a class="code" href="structfattr2.html#a13e1098d503868bff038e70e9ac96d72">mode</a> = <a class="code" href="nfs__proto__tools_8h.html#a367fffa95ff14c104ef39854b7abc3a3">NFS2_MODE_NFLNK</a>;
<a name="l01932"></a>01932       <span class="keywordflow">break</span>;
<a name="l01933"></a>01933 
<a name="l01934"></a>01934     <span class="keywordflow">case</span> <a class="code" href="fsal__types_8h.html#a368aa63441663f9326d0201857bfcea3a832898ed571b62a052b344b6c3460b44">FSAL_TYPE_SOCK</a>:
<a name="l01935"></a>01935       pFattr-&gt;<a class="code" href="structfattr2.html#a0ba0a7d7f07a99ada917d40132312360">type</a> = <a class="code" href="nfs23_8h.html#a7e56f6b0be4a9774f81263b13e20514ba5c0ce21f5878a9ad118262817bea2720">NFSOCK</a>;
<a name="l01937"></a>01937       <span class="keywordflow">break</span>;
<a name="l01938"></a>01938 
<a name="l01939"></a>01939     <span class="keywordflow">case</span> <a class="code" href="fsal__types_8h.html#a368aa63441663f9326d0201857bfcea3a78dd372e91da8c77e7b203ad063d836d">FSAL_TYPE_XATTR</a>:
<a name="l01940"></a>01940     <span class="keywordflow">case</span> <a class="code" href="fsal__types_8h.html#a368aa63441663f9326d0201857bfcea3aae4de2f92f57e58a73baef29fef0663b">FSAL_TYPE_JUNCTION</a>:
<a name="l01941"></a>01941       pFattr-&gt;<a class="code" href="structfattr2.html#a0ba0a7d7f07a99ada917d40132312360">type</a> = <a class="code" href="nfs23_8h.html#a7e56f6b0be4a9774f81263b13e20514bae995e4037f55372fd616d0d5427e74a9">NFBAD</a>;
<a name="l01942"></a>01942     }
<a name="l01943"></a>01943 
<a name="l01944"></a>01944   pFattr-&gt;<a class="code" href="structfattr2.html#a13e1098d503868bff038e70e9ac96d72">mode</a> |= <a class="code" href="FSAL_2FSAL__CEPH_2fsal__convert_8h.html#ad39aceba2aa5bbef96f35a802e463222">fsal2unix_mode</a>(pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a6611fe8fc39ff41d2c21d194213322e7">mode</a>);
<a name="l01945"></a>01945   pFattr-&gt;<a class="code" href="structfattr2.html#a70adf9cfd444a570e6fe1af990e228db">nlink</a> = pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a3ed4337021700c7a893c23668d6c0f33">numlinks</a>;
<a name="l01946"></a>01946   pFattr-&gt;<a class="code" href="structfattr2.html#a9f7c0a909f3c26f7f1e60b6fa12adfa0">uid</a> = pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a89670e3e52193381c240c0b7d93d6aa6">owner</a>;
<a name="l01947"></a>01947   pFattr-&gt;<a class="code" href="structfattr2.html#a7bf5ad8c527e242ecda06b5d184dab76">gid</a> = pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e4622af711f91b5f598fce5e0bee9fa">group</a>;
<a name="l01948"></a>01948 
<a name="l01949"></a>01949   <span class="comment">/* in NFSv2, it only keeps fsid.major, casted into an into an int32 */</span>
<a name="l01950"></a>01950   pFattr-&gt;<a class="code" href="structfattr2.html#a621ff1fbbdf1401fd230e4f9cd712545">fsid</a> = (u_int) (pexport-&gt;<a class="code" href="structexportlist____.html#a0f81c1008714a0ce0039397cd3fab832">filesystem_id</a>.<a class="code" href="structfsal__fsid____.html#a86fa6b41da5905b04e531bd530c1573c">major</a> &amp; 0xFFFFFFFFLL);
<a name="l01951"></a>01951 
<a name="l01952"></a>01952   <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556af6e90cb9d43106e13df4e83652c94f27">COMPONENT_NFSPROTO</a>,
<a name="l01953"></a>01953                <span class="stringliteral">&quot;nfs2_FSALattr_To_Fattr: fsid.major = %#llX (%llu), fsid.minor = %#llX (%llu), nfs2_fsid = %#X (%u)&quot;</span>,
<a name="l01954"></a>01954                pexport-&gt;<a class="code" href="structexportlist____.html#a0f81c1008714a0ce0039397cd3fab832">filesystem_id</a>.<a class="code" href="structfsal__fsid____.html#a86fa6b41da5905b04e531bd530c1573c">major</a>, pexport-&gt;<a class="code" href="structexportlist____.html#a0f81c1008714a0ce0039397cd3fab832">filesystem_id</a>.<a class="code" href="structfsal__fsid____.html#a86fa6b41da5905b04e531bd530c1573c">major</a>,
<a name="l01955"></a>01955                pexport-&gt;<a class="code" href="structexportlist____.html#a0f81c1008714a0ce0039397cd3fab832">filesystem_id</a>.<a class="code" href="structfsal__fsid____.html#a4af3ec4bf793f168471987221d477130">minor</a>, pexport-&gt;<a class="code" href="structexportlist____.html#a0f81c1008714a0ce0039397cd3fab832">filesystem_id</a>.<a class="code" href="structfsal__fsid____.html#a4af3ec4bf793f168471987221d477130">minor</a>, pFattr-&gt;<a class="code" href="structfattr2.html#a621ff1fbbdf1401fd230e4f9cd712545">fsid</a>,
<a name="l01956"></a>01956                pFattr-&gt;<a class="code" href="structfattr2.html#a621ff1fbbdf1401fd230e4f9cd712545">fsid</a>);
<a name="l01957"></a>01957 
<a name="l01958"></a>01958   <span class="keywordflow">if</span>(pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a0105c962cf3b7c8d11e2e2d1c5acff31">filesize</a> &gt; <a class="code" href="nfs23_8h.html#a1f9e48ccd090a53678387e82614bda7a">NFS2_MAX_FILESIZE</a>)
<a name="l01959"></a>01959     pFattr-&gt;<a class="code" href="structfattr2.html#a3731145df992668c56411b8a874f33ea">size</a> = <a class="code" href="nfs23_8h.html#a1f9e48ccd090a53678387e82614bda7a">NFS2_MAX_FILESIZE</a>;
<a name="l01960"></a>01960   <span class="keywordflow">else</span>
<a name="l01961"></a>01961     pFattr-&gt;<a class="code" href="structfattr2.html#a3731145df992668c56411b8a874f33ea">size</a> = pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a0105c962cf3b7c8d11e2e2d1c5acff31">filesize</a>;
<a name="l01962"></a>01962 
<a name="l01963"></a>01963   pFattr-&gt;<a class="code" href="structfattr2.html#a19dffd82452858fa35e1471900e83c3f">blocksize</a> = DEV_BSIZE;
<a name="l01964"></a>01964 
<a name="l01965"></a>01965   pFattr-&gt;<a class="code" href="structfattr2.html#a1318ea9e13e704ff456bca95f1708ec2">blocks</a> = pFattr-&gt;<a class="code" href="structfattr2.html#a3731145df992668c56411b8a874f33ea">size</a> &gt;&gt; 9;   <span class="comment">/* dividing by 512 */</span>
<a name="l01966"></a>01966   <span class="keywordflow">if</span>(pFattr-&gt;<a class="code" href="structfattr2.html#a3731145df992668c56411b8a874f33ea">size</a> % DEV_BSIZE != 0)
<a name="l01967"></a>01967     pFattr-&gt;<a class="code" href="structfattr2.html#a1318ea9e13e704ff456bca95f1708ec2">blocks</a> += 1;
<a name="l01968"></a>01968 
<a name="l01969"></a>01969   <span class="keywordflow">if</span>(pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a03249aca39ba1b16b4712079d93b025e">type</a> == <a class="code" href="fsal__types_8h.html#a368aa63441663f9326d0201857bfcea3ab2cc09e4ad4298e2b0238df7ebc18adc">FSAL_TYPE_CHR</a> || pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a03249aca39ba1b16b4712079d93b025e">type</a> == <a class="code" href="fsal__types_8h.html#a368aa63441663f9326d0201857bfcea3a4889072a63eda04f5c8d92a5a5bc04cd">FSAL_TYPE_BLK</a>)
<a name="l01970"></a>01970     pFattr-&gt;<a class="code" href="structfattr2.html#a453f24d6106c23ba7c777bbe20c78715">rdev</a> = pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#ae500abbe897ddad0af25160793468ae1">rawdev</a>.<a class="code" href="structfsal__dev____.html#af03e5fde9bbeec4835a2dbdbcdbad11b">major</a>;
<a name="l01971"></a>01971   <span class="keywordflow">else</span>
<a name="l01972"></a>01972     pFattr-&gt;<a class="code" href="structfattr2.html#a453f24d6106c23ba7c777bbe20c78715">rdev</a> = 0;
<a name="l01973"></a>01973 
<a name="l01974"></a>01974   pFattr-&gt;<a class="code" href="structfattr2.html#ab481943e3280f2ab1baea21090fb6beb">atime</a>.<a class="code" href="structnfstime2.html#a31317a2746da0753ebad22071c3b388c">seconds</a> = pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a48293ea65b5bb7282d4421ad079f056f">atime</a>.<a class="code" href="structfsal__time____.html#add92ec6180384f0ba10dd2a79b659548">seconds</a>;
<a name="l01975"></a>01975   pFattr-&gt;<a class="code" href="structfattr2.html#ab481943e3280f2ab1baea21090fb6beb">atime</a>.<a class="code" href="structnfstime2.html#a05324f8647614dd6b3428ce41c670846">useconds</a> = pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a48293ea65b5bb7282d4421ad079f056f">atime</a>.<a class="code" href="structfsal__time____.html#a9c41918d2f2ea4627205dd4c2e347373">nseconds</a> / 1000;
<a name="l01976"></a>01976   pFattr-&gt;<a class="code" href="structfattr2.html#adab8c94f23ce25de7a9aac39e9b6edeb">mtime</a>.<a class="code" href="structnfstime2.html#a31317a2746da0753ebad22071c3b388c">seconds</a> = pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a441daefe7cc86152355f895d81bc2936">mtime</a>.<a class="code" href="structfsal__time____.html#add92ec6180384f0ba10dd2a79b659548">seconds</a>;
<a name="l01977"></a>01977   pFattr-&gt;<a class="code" href="structfattr2.html#adab8c94f23ce25de7a9aac39e9b6edeb">mtime</a>.<a class="code" href="structnfstime2.html#a05324f8647614dd6b3428ce41c670846">useconds</a> = pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a441daefe7cc86152355f895d81bc2936">mtime</a>.<a class="code" href="structfsal__time____.html#a9c41918d2f2ea4627205dd4c2e347373">nseconds</a> / 1000;
<a name="l01978"></a>01978   pFattr-&gt;<a class="code" href="structfattr2.html#ac0f70cf184f9ba521887997367d8d19d">ctime</a>.<a class="code" href="structnfstime2.html#a31317a2746da0753ebad22071c3b388c">seconds</a> = pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7087852b901550fbbc6ba2aed12c96ef">ctime</a>.<a class="code" href="structfsal__time____.html#add92ec6180384f0ba10dd2a79b659548">seconds</a>;
<a name="l01979"></a>01979   pFattr-&gt;<a class="code" href="structfattr2.html#ac0f70cf184f9ba521887997367d8d19d">ctime</a>.<a class="code" href="structnfstime2.html#a05324f8647614dd6b3428ce41c670846">useconds</a> = pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7087852b901550fbbc6ba2aed12c96ef">ctime</a>.<a class="code" href="structfsal__time____.html#a9c41918d2f2ea4627205dd4c2e347373">nseconds</a> / 1000;
<a name="l01980"></a>01980   pFattr-&gt;<a class="code" href="structfattr2.html#a95d6c001cea7584c5ffa10369f0cf73a">fileid</a> = pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a657a3efbc26891ced4b16f48791452c3">fileid</a>;
<a name="l01981"></a>01981 
<a name="l01982"></a>01982   <span class="keywordflow">return</span> 1;
<a name="l01983"></a>01983 }                               <span class="comment">/*  nfs2_FSALattr_To_Fattr */</span>
<a name="l01984"></a>01984 
<a name="l01997"></a><a class="code" href="group__NFSprocs.html#ga10fae48fe98b321c91a8332850977ab1">01997</a> <span class="keywordtype">int</span> <a class="code" href="group__NFSprocs.html#ga10fae48fe98b321c91a8332850977ab1">nfs4_SetCompoundExport</a>(<a class="code" href="structcompoud__data.html" title="Compound data.">compound_data_t</a> * data)
<a name="l01998"></a>01998 {
<a name="l01999"></a>01999   <span class="keywordtype">short</span> exportid;
<a name="l02000"></a>02000 
<a name="l02001"></a>02001   <span class="comment">/* This routine is not related to pseudo fs file handle, do not handle them */</span>
<a name="l02002"></a>02002   <span class="keywordflow">if</span>(<a class="code" href="nfs__file__handle_8h.html#a517dfc86532641b32ac7c178aeb30c46">nfs4_Is_Fh_Pseudo</a>(&amp;(data-&gt;<a class="code" href="structcompoud__data.html#ab678a4d34551041e9b4ac9d2dfae4801">currentFH</a>)))
<a name="l02003"></a>02003     <span class="keywordflow">return</span> <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aacaca462c793854dd61337cf0b54fc166">NFS4_OK</a>;
<a name="l02004"></a>02004 
<a name="l02005"></a>02005   <span class="comment">/* Get the export id */</span>
<a name="l02006"></a>02006   <span class="keywordflow">if</span>((exportid = <a class="code" href="nfs__file__handle_8h.html#abd252dd5f6d20c1b81760f8b2185e35d">nfs4_FhandleToExportId</a>(&amp;(data-&gt;<a class="code" href="structcompoud__data.html#ab678a4d34551041e9b4ac9d2dfae4801">currentFH</a>))) == 0)
<a name="l02007"></a>02007     <span class="keywordflow">return</span> <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aad8e75713659423bc53b60934e6b2698f">NFS4ERR_BADHANDLE</a>;
<a name="l02008"></a>02008 
<a name="l02009"></a>02009   <span class="keywordflow">if</span>((data-&gt;<a class="code" href="structcompoud__data.html#aa44e02b685a675a6beb59faac8c9dc78">pexport</a> = <a class="code" href="nfs__exports_8h.html#a7ccd248588595588755f71322288a8df">nfs_Get_export_by_id</a>(data-&gt;<a class="code" href="structcompoud__data.html#a7985a18affb9c3f433f16dc74123b8f9">pfullexportlist</a>, exportid)) == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02010"></a>02010     <span class="keywordflow">return</span> <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aad8e75713659423bc53b60934e6b2698f">NFS4ERR_BADHANDLE</a>;
<a name="l02011"></a>02011 
<a name="l02012"></a>02012   <span class="keywordflow">if</span>((data-&gt;<a class="code" href="structcompoud__data.html#aa44e02b685a675a6beb59faac8c9dc78">pexport</a>-&gt;<a class="code" href="structexportlist____.html#a47d40937207a0fd8e67e191415ffef60">options</a> &amp; <a class="code" href="nfs__exports_8h.html#a37a8e57ee68142c3e38240156723a2d6">EXPORT_OPTION_NFSV4</a>) == 0)
<a name="l02013"></a>02013     <span class="keywordflow">return</span> <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aa7d900635e440025ed74a83e8ab8b595c">NFS4ERR_ACCESS</a>;
<a name="l02014"></a>02014 
<a name="l02015"></a>02015   <span class="keywordflow">if</span>(<a class="code" href="group__NFSprocs.html#gac5009440881d6a4d6789eff4c3609224">nfs4_MakeCred</a>(data) != <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aacaca462c793854dd61337cf0b54fc166">NFS4_OK</a>)
<a name="l02016"></a>02016     <span class="keywordflow">return</span> <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aa8a11c499d44e49a1e4f207f456b6b898">NFS4ERR_WRONGSEC</a>;
<a name="l02017"></a>02017 
<a name="l02018"></a>02018   <span class="keywordflow">return</span> <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aacaca462c793854dd61337cf0b54fc166">NFS4_OK</a>;
<a name="l02019"></a>02019 }                               <span class="comment">/* nfs4_SetCompoundExport */</span>
<a name="l02020"></a>02020 
<a name="l02033"></a><a class="code" href="nfs__proto__tools_8c.html#a992c1d741c7335ee2f5870c131190f29">02033</a> <span class="keywordtype">int</span> <a class="code" href="nfs__proto__tools_8c.html#a992c1d741c7335ee2f5870c131190f29">nfs4_FhandleToExId</a>(<a class="code" href="structnfs__fh4.html">nfs_fh4</a> * fh4p, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *ExIdp)
<a name="l02034"></a>02034 {
<a name="l02035"></a>02035   <a class="code" href="structfile__handle__v4.html">file_handle_v4_t</a> *pfhandle4;
<a name="l02036"></a>02036 
<a name="l02037"></a>02037   <span class="comment">/* Map the filehandle to the correct structure */</span>
<a name="l02038"></a>02038   pfhandle4 = (<a class="code" href="structfile__handle__v4.html">file_handle_v4_t</a> *) (fh4p-&gt;<a class="code" href="structnfs__fh4.html#a1bac9f2eb01597339d8c037776010a09">nfs_fh4_val</a>);
<a name="l02039"></a>02039 
<a name="l02040"></a>02040   <span class="comment">/* The function should not be used on a pseudo fhandle */</span>
<a name="l02041"></a>02041   <span class="keywordflow">if</span>(pfhandle4-&gt;<a class="code" href="structfile__handle__v4.html#a582649bffee8d511ddc746c141ff5681">pseudofs_flag</a> == <a class="code" href="HashTable_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>)
<a name="l02042"></a>02042     <span class="keywordflow">return</span> <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02043"></a>02043 
<a name="l02044"></a>02044   *ExIdp = pfhandle4-&gt;<a class="code" href="structfile__handle__v4.html#ada08d7a937cf136824188f37bb679af5">exportid</a>;
<a name="l02045"></a>02045   <span class="keywordflow">return</span> <a class="code" href="HashTable_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l02046"></a>02046 }                               <span class="comment">/* nfs4_FhandleToExId */</span>
<a name="l02047"></a>02047 
<a name="l02048"></a>02048 <span class="comment">/**** Glue related functions ****/</span>
<a name="l02049"></a>02049 
<a name="l02063"></a><a class="code" href="group__NFSprocs.html#gac22b02db820e76d8c29039a8590b3bf0">02063</a> <span class="keywordtype">void</span> <a class="code" href="group__NFSprocs.html#gac22b02db820e76d8c29039a8590b3bf0">nfs4_stringid_split</a>(<span class="keywordtype">char</span> *buff, <span class="keywordtype">char</span> *uidname, <span class="keywordtype">char</span> *domainname)
<a name="l02064"></a>02064 {
<a name="l02065"></a>02065   <span class="keywordtype">char</span> *c = <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02066"></a>02066   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0;
<a name="l02067"></a>02067 
<a name="l02068"></a>02068   <span class="keywordflow">for</span>(c = buff, i = 0; *c != <span class="charliteral">&#39;\0&#39;</span>; c++, i++)
<a name="l02069"></a>02069     <span class="keywordflow">if</span>(*c == <span class="charliteral">&#39;@&#39;</span>)
<a name="l02070"></a>02070       <span class="keywordflow">break</span>;
<a name="l02071"></a>02071 
<a name="l02072"></a>02072   strncpy(uidname, buff, i);
<a name="l02073"></a>02073   uidname[i] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l02074"></a>02074   strcpy(domainname, c);
<a name="l02075"></a>02075 
<a name="l02076"></a>02076   <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>,
<a name="l02077"></a>02077                <span class="stringliteral">&quot;buff = #%s#    uid = #%s#   domain = #%s#&quot;</span>,
<a name="l02078"></a>02078                buff, uidname, domainname);
<a name="l02079"></a>02079 }                               <span class="comment">/* nfs4_stringid_split */</span>
<a name="l02080"></a>02080 
<a name="l02088"></a><a class="code" href="group__NFSprocs.html#gab4a389b79a1873b86a6b4a9d3859e5f9">02088</a> <span class="keywordtype">void</span> <a class="code" href="group__NFSprocs.html#gab4a389b79a1873b86a6b4a9d3859e5f9">free_utf8</a>(<a class="code" href="structutf8string.html">utf8string</a> * utf8str)
<a name="l02089"></a>02089 {
<a name="l02090"></a>02090   <span class="keywordflow">if</span>(utf8str != <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02091"></a>02091     {
<a name="l02092"></a>02092       <span class="keywordflow">if</span>(utf8str-&gt;<a class="code" href="structutf8string.html#a72e3ba7aecf5547219953542a1c32271">utf8string_val</a> != <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02093"></a>02093         gsh_free(utf8str-&gt;<a class="code" href="structutf8string.html#a72e3ba7aecf5547219953542a1c32271">utf8string_val</a>);
<a name="l02094"></a>02094       utf8str-&gt;<a class="code" href="structutf8string.html#a72e3ba7aecf5547219953542a1c32271">utf8string_val</a> = 0;
<a name="l02095"></a>02095       utf8str-&gt;<a class="code" href="structutf8string.html#ab651a802af8217014ea648e43ac79b6f">utf8string_len</a> = 0;
<a name="l02096"></a>02096     }
<a name="l02097"></a>02097 }
<a name="l02098"></a>02098 
<a name="l02109"></a><a class="code" href="group__NFSprocs.html#gaf9216cb54e45baa251995dcb23d7caa9">02109</a> <span class="keywordtype">int</span> <a class="code" href="group__NFSprocs.html#gaf9216cb54e45baa251995dcb23d7caa9">utf8dup</a>(<a class="code" href="structutf8string.html">utf8string</a> * newstr, <a class="code" href="structutf8string.html">utf8string</a> * oldstr)
<a name="l02110"></a>02110 {
<a name="l02111"></a>02111   <span class="keywordflow">if</span>(newstr == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02112"></a>02112     <span class="keywordflow">return</span> -1;
<a name="l02113"></a>02113 
<a name="l02114"></a>02114   newstr-&gt;<a class="code" href="structutf8string.html#ab651a802af8217014ea648e43ac79b6f">utf8string_len</a> = oldstr-&gt;<a class="code" href="structutf8string.html#ab651a802af8217014ea648e43ac79b6f">utf8string_len</a>;
<a name="l02115"></a>02115   newstr-&gt;<a class="code" href="structutf8string.html#a72e3ba7aecf5547219953542a1c32271">utf8string_val</a> = <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l02116"></a>02116 
<a name="l02117"></a>02117   <span class="keywordflow">if</span>(oldstr-&gt;<a class="code" href="structutf8string.html#ab651a802af8217014ea648e43ac79b6f">utf8string_len</a> == 0 || oldstr-&gt;<a class="code" href="structutf8string.html#a72e3ba7aecf5547219953542a1c32271">utf8string_val</a> == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02118"></a>02118     <span class="keywordflow">return</span> 0;
<a name="l02119"></a>02119 
<a name="l02120"></a>02120   newstr-&gt;<a class="code" href="structutf8string.html#a72e3ba7aecf5547219953542a1c32271">utf8string_val</a> = gsh_malloc(oldstr-&gt;<a class="code" href="structutf8string.html#ab651a802af8217014ea648e43ac79b6f">utf8string_len</a>);
<a name="l02121"></a>02121   <span class="keywordflow">if</span>(newstr-&gt;<a class="code" href="structutf8string.html#a72e3ba7aecf5547219953542a1c32271">utf8string_val</a> == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02122"></a>02122     <span class="keywordflow">return</span> -1;
<a name="l02123"></a>02123 
<a name="l02124"></a>02124   strncpy(newstr-&gt;<a class="code" href="structutf8string.html#a72e3ba7aecf5547219953542a1c32271">utf8string_val</a>, oldstr-&gt;<a class="code" href="structutf8string.html#a72e3ba7aecf5547219953542a1c32271">utf8string_val</a>, oldstr-&gt;<a class="code" href="structutf8string.html#ab651a802af8217014ea648e43ac79b6f">utf8string_len</a>);
<a name="l02125"></a>02125 
<a name="l02126"></a>02126   <span class="keywordflow">return</span> 0;
<a name="l02127"></a>02127 }                               <span class="comment">/* uft82str */</span>
<a name="l02128"></a>02128 
<a name="l02141"></a><a class="code" href="group__NFSprocs.html#ga70018dcc6a707fd605a56100468242c8">02141</a> <span class="keywordtype">int</span> <a class="code" href="group__NFSprocs.html#ga70018dcc6a707fd605a56100468242c8">utf82str</a>(<span class="keywordtype">char</span> *str, <span class="keywordtype">int</span> size, <a class="code" href="structutf8string.html">utf8string</a> * utf8str)
<a name="l02142"></a>02142 {
<a name="l02143"></a>02143   <span class="keywordtype">int</span> copy;
<a name="l02144"></a>02144 
<a name="l02145"></a>02145   <span class="keywordflow">if</span>(str == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02146"></a>02146     <span class="keywordflow">return</span> -1;
<a name="l02147"></a>02147 
<a name="l02148"></a>02148   <span class="keywordflow">if</span>(utf8str == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || utf8str-&gt;<a class="code" href="structutf8string.html#ab651a802af8217014ea648e43ac79b6f">utf8string_len</a> == 0)
<a name="l02149"></a>02149     {
<a name="l02150"></a>02150       str[0] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l02151"></a>02151       <span class="keywordflow">return</span> -1;
<a name="l02152"></a>02152     }
<a name="l02153"></a>02153 
<a name="l02154"></a>02154   <span class="keywordflow">if</span>(utf8str-&gt;<a class="code" href="structutf8string.html#ab651a802af8217014ea648e43ac79b6f">utf8string_len</a> &gt;= size)
<a name="l02155"></a>02155     copy = size - 1;
<a name="l02156"></a>02156   <span class="keywordflow">else</span>
<a name="l02157"></a>02157     copy = utf8str-&gt;<a class="code" href="structutf8string.html#ab651a802af8217014ea648e43ac79b6f">utf8string_len</a>;
<a name="l02158"></a>02158 
<a name="l02159"></a>02159   strncpy(str, utf8str-&gt;<a class="code" href="structutf8string.html#a72e3ba7aecf5547219953542a1c32271">utf8string_val</a>, copy);
<a name="l02160"></a>02160   str[copy] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l02161"></a>02161 
<a name="l02162"></a>02162   <span class="keywordflow">if</span>(copy &lt; utf8str-&gt;utf8string_len)
<a name="l02163"></a>02163     <span class="keywordflow">return</span> -1;
<a name="l02164"></a>02164 
<a name="l02165"></a>02165   <span class="keywordflow">return</span> 0;
<a name="l02166"></a>02166 }                               <span class="comment">/* uft82str */</span>
<a name="l02167"></a>02167 
<a name="l02180"></a><a class="code" href="group__NFSprocs.html#ga1113f595b919b5c955131797fcf8715f">02180</a> <span class="keywordtype">int</span> <a class="code" href="group__NFSprocs.html#ga1113f595b919b5c955131797fcf8715f">str2utf8</a>(<span class="keywordtype">char</span> *str, <a class="code" href="structutf8string.html">utf8string</a> * utf8str)
<a name="l02181"></a>02181 {
<a name="l02182"></a>02182   <a class="code" href="extended__types_8h.html#a12a1e9b3ce141648783a82445d02b58d">uint_t</a> len;
<a name="l02183"></a>02183   <span class="keywordtype">char</span> buff[MAXNAMLEN];
<a name="l02184"></a>02184 
<a name="l02185"></a>02185   <span class="comment">/* The uft8 will probably be sent over XDR, for this reason, its size MUST be a multiple of 32 bits = 4 bytes */</span>
<a name="l02186"></a>02186   strcpy(buff, str);
<a name="l02187"></a>02187   len = strlen(buff);
<a name="l02188"></a>02188 
<a name="l02189"></a>02189   <span class="comment">/* BUGAZOMEU: TO BE DONE: use STUFF ALLOCATOR here */</span>
<a name="l02190"></a>02190   <span class="keywordflow">if</span>(utf8str-&gt;<a class="code" href="structutf8string.html#a72e3ba7aecf5547219953542a1c32271">utf8string_val</a> == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02191"></a>02191     <span class="keywordflow">return</span> -1;
<a name="l02192"></a>02192 
<a name="l02193"></a>02193   utf8str-&gt;<a class="code" href="structutf8string.html#ab651a802af8217014ea648e43ac79b6f">utf8string_len</a> = len;
<a name="l02194"></a>02194   memcpy(utf8str-&gt;<a class="code" href="structutf8string.html#a72e3ba7aecf5547219953542a1c32271">utf8string_val</a>, buff, utf8str-&gt;<a class="code" href="structutf8string.html#ab651a802af8217014ea648e43ac79b6f">utf8string_len</a>);
<a name="l02195"></a>02195   <span class="keywordflow">return</span> 0;
<a name="l02196"></a>02196 }                               <span class="comment">/* str2utf8 */</span>
<a name="l02197"></a>02197 
<a name="l02210"></a><a class="code" href="group__NFSprocs.html#gac572290aea3c97830aab4602d4ebd6e3">02210</a> <a class="code" href="nfsv40_8h.html#a6999f26d4cefa483a2d43e4f5afe07a0">seqid4</a> <a class="code" href="group__NFSprocs.html#gac572290aea3c97830aab4602d4ebd6e3">nfs4_NextSeqId</a>(<a class="code" href="nfsv40_8h.html#a6999f26d4cefa483a2d43e4f5afe07a0">seqid4</a> seqid)
<a name="l02211"></a>02211 {
<a name="l02212"></a>02212   <span class="keywordflow">return</span> ((seqid + 1) % 0xFFFFFFFF);
<a name="l02213"></a>02213 }                               <span class="comment">/* nfs4_NextSeqId */</span>
<a name="l02214"></a>02214 
<a name="l02229"></a>02229 <span class="comment">/*</span>
<a name="l02230"></a>02230 <span class="comment"> * bitmap is usually 2 x uint32_t which makes a uint64_t</span>
<a name="l02231"></a>02231 <span class="comment"> *</span>
<a name="l02232"></a>02232 <span class="comment"> * Structure of the bitmap is as follow</span>
<a name="l02233"></a>02233 <span class="comment"> *</span>
<a name="l02234"></a>02234 <span class="comment"> *                  0         1</span>
<a name="l02235"></a>02235 <span class="comment"> *    +-------+---------+----------+-</span>
<a name="l02236"></a>02236 <span class="comment"> *    | count | 31 .. 0 | 63 .. 32 |</span>
<a name="l02237"></a>02237 <span class="comment"> *    +-------+---------+----------+-</span>
<a name="l02238"></a>02238 <span class="comment"> *</span>
<a name="l02239"></a>02239 <span class="comment"> * One bit is set for every possible attributes. The bits are packed together in a uint32_T (XDR alignment reason probably)</span>
<a name="l02240"></a>02240 <span class="comment"> * As said in the RFC3530, the n-th bit is with the uint32_t #(n/32), and its position with the uint32_t is n % 32</span>
<a name="l02241"></a>02241 <span class="comment"> * Example</span>
<a name="l02242"></a>02242 <span class="comment"> *     1st bit = FATTR4_TYPE            = 1</span>
<a name="l02243"></a>02243 <span class="comment"> *     2nd bit = FATTR4_LINK_SUPPORT    = 5</span>
<a name="l02244"></a>02244 <span class="comment"> *     3rd bit = FATTR4_SYMLINK_SUPPORT = 6</span>
<a name="l02245"></a>02245 <span class="comment"> *</span>
<a name="l02246"></a>02246 <span class="comment"> *     Juste one uint32_t is necessay: 2**1 + 2**5 + 2**6 = 2 + 32 + 64 = 98</span>
<a name="l02247"></a>02247 <span class="comment"> *   +---+----+</span>
<a name="l02248"></a>02248 <span class="comment"> *   | 1 | 98 |</span>
<a name="l02249"></a>02249 <span class="comment"> *   +---+----+</span>
<a name="l02250"></a>02250 <span class="comment"> *</span>
<a name="l02251"></a>02251 <span class="comment"> * Other Example</span>
<a name="l02252"></a>02252 <span class="comment"> *</span>
<a name="l02253"></a>02253 <span class="comment"> *     1st bit = FATTR4_LINK_SUPPORT    = 5</span>
<a name="l02254"></a>02254 <span class="comment"> *     2nd bit = FATTR4_SYMLINK_SUPPORT = 6</span>
<a name="l02255"></a>02255 <span class="comment"> *     3rd bit = FATTR4_MODE            = 33</span>
<a name="l02256"></a>02256 <span class="comment"> *     4th bit = FATTR4_OWNER           = 36</span>
<a name="l02257"></a>02257 <span class="comment"> *</span>
<a name="l02258"></a>02258 <span class="comment"> *     Two uint32_t will be necessary there:</span>
<a name="l02259"></a>02259 <span class="comment"> *            #1 = 2**5 + 2**6 = 32 + 64 = 96</span>
<a name="l02260"></a>02260 <span class="comment"> #            #2 = 2**(33-32) + 2**(36-32) = 2**1 + 2**4 = 2 + 16 = 18 </span>
<a name="l02261"></a>02261 <span class="comment"> *   +---+----+----+</span>
<a name="l02262"></a>02262 <span class="comment"> *   | 2 | 98 | 18 |</span>
<a name="l02263"></a>02263 <span class="comment"> *   +---+----+----+</span>
<a name="l02264"></a>02264 <span class="comment"> *</span>
<a name="l02265"></a>02265 <span class="comment"> */</span>
<a name="l02266"></a>02266 
<a name="l02267"></a><a class="code" href="group__NFSprocs.html#gabd872db7513463c6ddadeec986c69051">02267</a> <span class="keywordtype">void</span> <a class="code" href="group__NFSprocs.html#gabd872db7513463c6ddadeec986c69051">nfs4_bitmap4_to_list</a>(<a class="code" href="structbitmap4.html">bitmap4</a> * b, <a class="code" href="extended__types_8h.html#a12a1e9b3ce141648783a82445d02b58d">uint_t</a> * plen, <a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> * pval)
<a name="l02268"></a>02268 {
<a name="l02269"></a>02269   <a class="code" href="extended__types_8h.html#a12a1e9b3ce141648783a82445d02b58d">uint_t</a> i = 0;
<a name="l02270"></a>02270   <a class="code" href="extended__types_8h.html#a12a1e9b3ce141648783a82445d02b58d">uint_t</a> val = 0;
<a name="l02271"></a>02271   <a class="code" href="extended__types_8h.html#a12a1e9b3ce141648783a82445d02b58d">uint_t</a> index = 0;
<a name="l02272"></a>02272   <a class="code" href="extended__types_8h.html#a12a1e9b3ce141648783a82445d02b58d">uint_t</a> offset = 0;
<a name="l02273"></a>02273   <a class="code" href="extended__types_8h.html#a12a1e9b3ce141648783a82445d02b58d">uint_t</a> fattr4tabidx=0;
<a name="l02274"></a>02274   <span class="keywordflow">if</span>(b-&gt;<a class="code" href="structbitmap4.html#afd18333034a15d0d8427f6c58f2e110a">bitmap4_len</a> &gt; 0)
<a name="l02275"></a>02275     <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>, <span class="stringliteral">&quot;Bitmap: Len = %u Val = %u|%u&quot;</span>,
<a name="l02276"></a>02276                  b-&gt;<a class="code" href="structbitmap4.html#afd18333034a15d0d8427f6c58f2e110a">bitmap4_len</a>, b-&gt;<a class="code" href="structbitmap4.html#a6b68a1ee274affc9d8cd0a810a6a0164">bitmap4_val</a>[0], b-&gt;<a class="code" href="structbitmap4.html#a6b68a1ee274affc9d8cd0a810a6a0164">bitmap4_val</a>[1]);
<a name="l02277"></a>02277   <span class="keywordflow">else</span>
<a name="l02278"></a>02278     <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>, <span class="stringliteral">&quot;Bitmap: Len = %u ... &quot;</span>, b-&gt;<a class="code" href="structbitmap4.html#afd18333034a15d0d8427f6c58f2e110a">bitmap4_len</a>);
<a name="l02279"></a>02279 
<a name="l02280"></a>02280   <span class="keywordflow">for</span>(offset = 0; offset &lt; b-&gt;<a class="code" href="structbitmap4.html#afd18333034a15d0d8427f6c58f2e110a">bitmap4_len</a>; offset++)
<a name="l02281"></a>02281     {
<a name="l02282"></a>02282       <span class="keywordflow">for</span>(i = 0; i &lt; 32; i++)
<a name="l02283"></a>02283         {
<a name="l02284"></a>02284           fattr4tabidx = i+32*offset;
<a name="l02285"></a>02285 <span class="preprocessor">#ifdef _USE_NFS4_1</span>
<a name="l02286"></a>02286 <span class="preprocessor"></span>          <span class="keywordflow">if</span> (fattr4tabidx &gt; <a class="code" href="nfsv41_8h.html#a62ba6055240092585b0d600502b5031b">FATTR4_FS_CHARSET_CAP</a>)
<a name="l02287"></a>02287 <span class="preprocessor">#else</span>
<a name="l02288"></a>02288 <span class="preprocessor"></span>          <span class="keywordflow">if</span> (fattr4tabidx &gt; <a class="code" href="nfsv40_8h.html#aee5e5c06f383e00c90378fabc96deaee">FATTR4_MOUNTED_ON_FILEID</a>)
<a name="l02289"></a>02289 <span class="preprocessor">#endif</span>
<a name="l02290"></a>02290 <span class="preprocessor"></span>             <span class="keywordflow">goto</span> exit;
<a name="l02291"></a>02291 
<a name="l02292"></a>02292           val = 1 &lt;&lt; i;         <span class="comment">/* Compute 2**i */</span>
<a name="l02293"></a>02293           <span class="keywordflow">if</span>(b-&gt;<a class="code" href="structbitmap4.html#a6b68a1ee274affc9d8cd0a810a6a0164">bitmap4_val</a>[offset] &amp; val)
<a name="l02294"></a>02294             pval[index++] = fattr4tabidx;
<a name="l02295"></a>02295         }
<a name="l02296"></a>02296     }
<a name="l02297"></a>02297 exit:
<a name="l02298"></a>02298   *plen = index;
<a name="l02299"></a>02299 
<a name="l02300"></a>02300 }                               <span class="comment">/* nfs4_bitmap4_to_list */</span>
<a name="l02301"></a>02301 
<a name="l02316"></a>02316 <span class="comment">/* bitmap is usually 2 x uint32_t which makes a uint64_t </span>
<a name="l02317"></a>02317 <span class="comment"> * bitmap4_len is the number of uint32_t required to keep the bitmap value </span>
<a name="l02318"></a>02318 <span class="comment"> *</span>
<a name="l02319"></a>02319 <span class="comment"> * Structure of the bitmap is as follow</span>
<a name="l02320"></a>02320 <span class="comment"> *</span>
<a name="l02321"></a>02321 <span class="comment"> *                  0         1</span>
<a name="l02322"></a>02322 <span class="comment"> *    +-------+---------+----------+-</span>
<a name="l02323"></a>02323 <span class="comment"> *    | count | 31 .. 0 | 63 .. 32 | </span>
<a name="l02324"></a>02324 <span class="comment"> *    +-------+---------+----------+-</span>
<a name="l02325"></a>02325 <span class="comment"> *</span>
<a name="l02326"></a>02326 <span class="comment"> * One bit is set for every possible attributes. The bits are packed together in a uint32_T (XDR alignment reason probably)</span>
<a name="l02327"></a>02327 <span class="comment"> * As said in the RFC3530, the n-th bit is with the uint32_t #(n/32), and its position with the uint32_t is n % 32</span>
<a name="l02328"></a>02328 <span class="comment"> * Example</span>
<a name="l02329"></a>02329 <span class="comment"> *     1st bit = FATTR4_TYPE            = 1</span>
<a name="l02330"></a>02330 <span class="comment"> *     2nd bit = FATTR4_LINK_SUPPORT    = 5</span>
<a name="l02331"></a>02331 <span class="comment"> *     3rd bit = FATTR4_SYMLINK_SUPPORT = 6</span>
<a name="l02332"></a>02332 <span class="comment"> *</span>
<a name="l02333"></a>02333 <span class="comment"> *     Juste one uint32_t is necessay: 2**1 + 2**5 + 2**6 = 2 + 32 + 64 = 98</span>
<a name="l02334"></a>02334 <span class="comment"> *   +---+----+</span>
<a name="l02335"></a>02335 <span class="comment"> *   | 1 | 98 |</span>
<a name="l02336"></a>02336 <span class="comment"> *   +---+----+</span>
<a name="l02337"></a>02337 <span class="comment"> *</span>
<a name="l02338"></a>02338 <span class="comment"> * Other Example</span>
<a name="l02339"></a>02339 <span class="comment"> *</span>
<a name="l02340"></a>02340 <span class="comment"> *     1st bit = FATTR4_LINK_SUPPORT    = 5</span>
<a name="l02341"></a>02341 <span class="comment"> *     2nd bit = FATTR4_SYMLINK_SUPPORT = 6</span>
<a name="l02342"></a>02342 <span class="comment"> *     3rd bit = FATTR4_MODE            = 33</span>
<a name="l02343"></a>02343 <span class="comment"> *     4th bit = FATTR4_OWNER           = 36</span>
<a name="l02344"></a>02344 <span class="comment"> *</span>
<a name="l02345"></a>02345 <span class="comment"> *     Two uint32_t will be necessary there:</span>
<a name="l02346"></a>02346 <span class="comment"> *            #1 = 2**5 + 2**6 = 32 + 64 = 96</span>
<a name="l02347"></a>02347 <span class="comment"> #            #2 = 2**(33-32) + 2**(36-32) = 2**1 + 2**4 = 2 + 16 = 18 </span>
<a name="l02348"></a>02348 <span class="comment"> *   +---+----+----+</span>
<a name="l02349"></a>02349 <span class="comment"> *   | 2 | 98 | 18 |</span>
<a name="l02350"></a>02350 <span class="comment"> *   +---+----+----+</span>
<a name="l02351"></a>02351 <span class="comment"> *</span>
<a name="l02352"></a>02352 <span class="comment"> */</span>
<a name="l02353"></a>02353 
<a name="l02354"></a>02354 <span class="comment">/* This function converts a list of attributes to a bitmap4 structure */</span>
<a name="l02355"></a><a class="code" href="group__NFSprocs.html#gac769402d81db054a2484ef4214c0f902">02355</a> <span class="keywordtype">void</span> <a class="code" href="group__NFSprocs.html#gac769402d81db054a2484ef4214c0f902">nfs4_list_to_bitmap4</a>(<a class="code" href="structbitmap4.html">bitmap4</a> * b, <a class="code" href="extended__types_8h.html#a12a1e9b3ce141648783a82445d02b58d">uint_t</a> plen, <a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> * pval)
<a name="l02356"></a>02356 {
<a name="l02357"></a>02357   <a class="code" href="extended__types_8h.html#a12a1e9b3ce141648783a82445d02b58d">uint_t</a> i;
<a name="l02358"></a>02358   <span class="keywordtype">int</span> maxpos =  -1;
<a name="l02359"></a>02359 
<a name="l02360"></a>02360   memset(b-&gt;<a class="code" href="structbitmap4.html#a6b68a1ee274affc9d8cd0a810a6a0164">bitmap4_val</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>)*b-&gt;<a class="code" href="structbitmap4.html#afd18333034a15d0d8427f6c58f2e110a">bitmap4_len</a>);
<a name="l02361"></a>02361 
<a name="l02362"></a>02362   <span class="keywordflow">for</span>(i = 0; i &lt; plen; i++)
<a name="l02363"></a>02363     {
<a name="l02364"></a>02364       <span class="keywordtype">int</span> intpos = pval[i] / 32;
<a name="l02365"></a>02365       <span class="keywordtype">int</span> bitpos = pval[i] % 32;
<a name="l02366"></a>02366 
<a name="l02367"></a>02367       <span class="keywordflow">if</span>(intpos &gt;= b-&gt;<a class="code" href="structbitmap4.html#afd18333034a15d0d8427f6c58f2e110a">bitmap4_len</a>)
<a name="l02368"></a>02368         {
<a name="l02369"></a>02369           <a class="code" href="test__findlog_8c.html#adfd9432c5478fa14c7d678edb301feed">LogCrit</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>,
<a name="l02370"></a>02370                   <span class="stringliteral">&quot;Mismatch between bitmap len and the list: &quot;</span>
<a name="l02371"></a>02371                   <span class="stringliteral">&quot;got %d, need %d to accomodate attribute %d&quot;</span>,
<a name="l02372"></a>02372                   b-&gt;<a class="code" href="structbitmap4.html#afd18333034a15d0d8427f6c58f2e110a">bitmap4_len</a>, intpos+1, pval[i]);
<a name="l02373"></a>02373           <span class="keywordflow">continue</span>;
<a name="l02374"></a>02374         }
<a name="l02375"></a>02375       b-&gt;<a class="code" href="structbitmap4.html#a6b68a1ee274affc9d8cd0a810a6a0164">bitmap4_val</a>[intpos] |= (1U &lt;&lt; bitpos);
<a name="l02376"></a>02376       <span class="keywordflow">if</span>(intpos &gt; maxpos)
<a name="l02377"></a>02377         maxpos = intpos;
<a name="l02378"></a>02378     }
<a name="l02379"></a>02379 
<a name="l02380"></a>02380   b-&gt;<a class="code" href="structbitmap4.html#afd18333034a15d0d8427f6c58f2e110a">bitmap4_len</a> = maxpos + 1;
<a name="l02381"></a>02381   <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>, <span class="stringliteral">&quot;Bitmap: Len = %u   Val = %u|%u|%u&quot;</span>,
<a name="l02382"></a>02382                b-&gt;<a class="code" href="structbitmap4.html#afd18333034a15d0d8427f6c58f2e110a">bitmap4_len</a>,
<a name="l02383"></a>02383                b-&gt;<a class="code" href="structbitmap4.html#afd18333034a15d0d8427f6c58f2e110a">bitmap4_len</a> &gt;= 1 ? b-&gt;<a class="code" href="structbitmap4.html#a6b68a1ee274affc9d8cd0a810a6a0164">bitmap4_val</a>[0] : 0,
<a name="l02384"></a>02384                b-&gt;<a class="code" href="structbitmap4.html#afd18333034a15d0d8427f6c58f2e110a">bitmap4_len</a> &gt;= 2 ? b-&gt;<a class="code" href="structbitmap4.html#a6b68a1ee274affc9d8cd0a810a6a0164">bitmap4_val</a>[1] : 0,
<a name="l02385"></a>02385                b-&gt;<a class="code" href="structbitmap4.html#afd18333034a15d0d8427f6c58f2e110a">bitmap4_len</a> &gt;= 3 ? b-&gt;<a class="code" href="structbitmap4.html#a6b68a1ee274affc9d8cd0a810a6a0164">bitmap4_val</a>[2] : 0);
<a name="l02386"></a>02386 }                               <span class="comment">/* nfs4_list_to_bitmap4 */</span>
<a name="l02387"></a>02387 
<a name="l02388"></a>02388 <span class="comment">/*</span>
<a name="l02389"></a>02389 <span class="comment"> * Conversion of attributes</span>
<a name="l02390"></a>02390 <span class="comment"> */</span>
<a name="l02391"></a>02391 
<a name="l02407"></a>02407 <span class="keywordtype">int</span> 
<a name="l02408"></a><a class="code" href="group__NFSprocs.html#ga0b7347bd74a189a6c5380f58e73eda31">02408</a> <a class="code" href="group__NFSprocs.html#ga0b7347bd74a189a6c5380f58e73eda31">nfs3_FSALattr_To_PartialFattr</a>(<span class="keyword">const</span> <a class="code" href="structfsal__attrib__list____.html">fsal_attrib_list_t</a> * FSAL_attr,
<a name="l02409"></a>02409                               <a class="code" href="fsal__types_8h.html#a3cf899c676941b1d5f789b2b22af8821">fsal_attrib_mask_t</a> want,
<a name="l02410"></a>02410                               <a class="code" href="structfattr3.html">fattr3</a> * Fattr)
<a name="l02411"></a>02411 {
<a name="l02412"></a>02412   <span class="keywordflow">if</span>(FSAL_attr == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || Fattr == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02413"></a>02413     {
<a name="l02414"></a>02414       <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556af6e90cb9d43106e13df4e83652c94f27">COMPONENT_NFSPROTO</a>,
<a name="l02415"></a>02415                    <span class="stringliteral">&quot;%s: FSAL_attr=%p, Fattr=%p&quot;</span>,
<a name="l02416"></a>02416                    __func__, FSAL_attr, Fattr);
<a name="l02417"></a>02417       <span class="keywordflow">return</span> 0;
<a name="l02418"></a>02418     }
<a name="l02419"></a>02419 
<a name="l02420"></a>02420   <span class="keywordflow">if</span>((FSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a> &amp; want) != want)
<a name="l02421"></a>02421     {
<a name="l02422"></a>02422       <a class="code" href="log_8h.html#a014a663a4d20c38e82ab3f35298667e8">LogEvent</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556af6e90cb9d43106e13df4e83652c94f27">COMPONENT_NFSPROTO</a>,
<a name="l02423"></a>02423                    <span class="stringliteral">&quot;%s: Caller wants 0x%llx, we only have 0x%llx - missing 0x%llx&quot;</span>,
<a name="l02424"></a>02424                    __func__, want, FSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a>, 
<a name="l02425"></a>02425                    (FSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a> &amp; want) ^ want);
<a name="l02426"></a>02426       <span class="keywordflow">return</span> 0;
<a name="l02427"></a>02427     }
<a name="l02428"></a>02428 
<a name="l02429"></a>02429   <span class="keywordflow">if</span>(FSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a> &amp; <a class="code" href="fsal__types_8h.html#aa8043bacec09f83fc424e2cbc638a896">FSAL_ATTR_TYPE</a>)
<a name="l02430"></a>02430     {
<a name="l02431"></a>02431       <span class="keywordflow">switch</span> (FSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a03249aca39ba1b16b4712079d93b025e">type</a>)
<a name="l02432"></a>02432         {
<a name="l02433"></a>02433         <span class="keywordflow">case</span> <a class="code" href="fsal__types_8h.html#a368aa63441663f9326d0201857bfcea3a162623715e400bfeb41be0a079f9856e">FSAL_TYPE_FIFO</a>:
<a name="l02434"></a>02434           Fattr-&gt;<a class="code" href="structfattr3.html#a2d335c76165aa75adf83514976aa2112">type</a> = <a class="code" href="nfs23_8h.html#a270ed8f2f29f617162aa69c5078ec79da6d59d7a9ae38a38e063d710aea4640fc">NF3FIFO</a>;
<a name="l02435"></a>02435           <span class="keywordflow">break</span>;
<a name="l02436"></a>02436 
<a name="l02437"></a>02437         <span class="keywordflow">case</span> <a class="code" href="fsal__types_8h.html#a368aa63441663f9326d0201857bfcea3ab2cc09e4ad4298e2b0238df7ebc18adc">FSAL_TYPE_CHR</a>:
<a name="l02438"></a>02438           Fattr-&gt;<a class="code" href="structfattr3.html#a2d335c76165aa75adf83514976aa2112">type</a> = <a class="code" href="nfs23_8h.html#a270ed8f2f29f617162aa69c5078ec79dac8a57c1da573e86b559062c0b942202f">NF3CHR</a>;
<a name="l02439"></a>02439           <span class="keywordflow">break</span>;
<a name="l02440"></a>02440 
<a name="l02441"></a>02441         <span class="keywordflow">case</span> <a class="code" href="fsal__types_8h.html#a368aa63441663f9326d0201857bfcea3a302bac21d091a1f3fc1ef5adb50661c3">FSAL_TYPE_DIR</a>:
<a name="l02442"></a>02442           Fattr-&gt;<a class="code" href="structfattr3.html#a2d335c76165aa75adf83514976aa2112">type</a> = <a class="code" href="nfs23_8h.html#a270ed8f2f29f617162aa69c5078ec79da56ad1836713cef2ce7d2f006bede56de">NF3DIR</a>;
<a name="l02443"></a>02443           <span class="keywordflow">break</span>;
<a name="l02444"></a>02444 
<a name="l02445"></a>02445         <span class="keywordflow">case</span> <a class="code" href="fsal__types_8h.html#a368aa63441663f9326d0201857bfcea3a4889072a63eda04f5c8d92a5a5bc04cd">FSAL_TYPE_BLK</a>:
<a name="l02446"></a>02446           Fattr-&gt;<a class="code" href="structfattr3.html#a2d335c76165aa75adf83514976aa2112">type</a> = <a class="code" href="nfs23_8h.html#a270ed8f2f29f617162aa69c5078ec79daff7e7574b93b900472155b1e02fae50c">NF3BLK</a>;
<a name="l02447"></a>02447           <span class="keywordflow">break</span>;
<a name="l02448"></a>02448 
<a name="l02449"></a>02449         <span class="keywordflow">case</span> <a class="code" href="fsal__types_8h.html#a368aa63441663f9326d0201857bfcea3afb0cf0224b4c4d6adaec28b1f3d65400">FSAL_TYPE_FILE</a>:
<a name="l02450"></a>02450         <span class="keywordflow">case</span> <a class="code" href="fsal__types_8h.html#a368aa63441663f9326d0201857bfcea3a78dd372e91da8c77e7b203ad063d836d">FSAL_TYPE_XATTR</a>:
<a name="l02451"></a>02451           Fattr-&gt;<a class="code" href="structfattr3.html#a2d335c76165aa75adf83514976aa2112">type</a> = <a class="code" href="nfs23_8h.html#a270ed8f2f29f617162aa69c5078ec79dabf16e3df467ea6ba6bf1159f81671d30">NF3REG</a>;
<a name="l02452"></a>02452           <span class="keywordflow">break</span>;
<a name="l02453"></a>02453 
<a name="l02454"></a>02454         <span class="keywordflow">case</span> <a class="code" href="fsal__types_8h.html#a368aa63441663f9326d0201857bfcea3adca35a94946e3fba05a201e70f98c3a8">FSAL_TYPE_LNK</a>:
<a name="l02455"></a>02455           Fattr-&gt;<a class="code" href="structfattr3.html#a2d335c76165aa75adf83514976aa2112">type</a> = <a class="code" href="nfs23_8h.html#a270ed8f2f29f617162aa69c5078ec79da15b3431cae84c4a4a03c1b73363182d4">NF3LNK</a>;
<a name="l02456"></a>02456           <span class="keywordflow">break</span>;
<a name="l02457"></a>02457 
<a name="l02458"></a>02458         <span class="keywordflow">case</span> <a class="code" href="fsal__types_8h.html#a368aa63441663f9326d0201857bfcea3a832898ed571b62a052b344b6c3460b44">FSAL_TYPE_SOCK</a>:
<a name="l02459"></a>02459           Fattr-&gt;<a class="code" href="structfattr3.html#a2d335c76165aa75adf83514976aa2112">type</a> = <a class="code" href="nfs23_8h.html#a270ed8f2f29f617162aa69c5078ec79da6d7cada19804d7dd8d6ec507d497bfbc">NF3SOCK</a>;
<a name="l02460"></a>02460           <span class="keywordflow">break</span>;
<a name="l02461"></a>02461 
<a name="l02462"></a>02462         <span class="keywordflow">case</span> <a class="code" href="fsal__types_8h.html#a368aa63441663f9326d0201857bfcea3aae4de2f92f57e58a73baef29fef0663b">FSAL_TYPE_JUNCTION</a>:
<a name="l02463"></a>02463           <span class="comment">/* Should not occur */</span>
<a name="l02464"></a>02464           <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556af6e90cb9d43106e13df4e83652c94f27">COMPONENT_NFSPROTO</a>,
<a name="l02465"></a>02465                        <span class="stringliteral">&quot;nfs3_FSALattr_To_Fattr: FSAL_attr-&gt;type = %d&quot;</span>,
<a name="l02466"></a>02466                        FSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a03249aca39ba1b16b4712079d93b025e">type</a>);
<a name="l02467"></a>02467           Fattr-&gt;<a class="code" href="structfattr3.html#a2d335c76165aa75adf83514976aa2112">type</a> = 0;
<a name="l02468"></a>02468           <span class="keywordflow">return</span> 0;
<a name="l02469"></a>02469 
<a name="l02470"></a>02470         <span class="keywordflow">default</span>:
<a name="l02471"></a>02471           <a class="code" href="log_8h.html#a014a663a4d20c38e82ab3f35298667e8">LogEvent</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556af6e90cb9d43106e13df4e83652c94f27">COMPONENT_NFSPROTO</a>,
<a name="l02472"></a>02472                        <span class="stringliteral">&quot;nfs3_FSALattr_To_Fattr: Bogus type = %d&quot;</span>,
<a name="l02473"></a>02473                        FSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a03249aca39ba1b16b4712079d93b025e">type</a>);
<a name="l02474"></a>02474           <span class="keywordflow">return</span> 0;
<a name="l02475"></a>02475         }
<a name="l02476"></a>02476     }
<a name="l02477"></a>02477 
<a name="l02478"></a>02478   <span class="keywordflow">if</span>(FSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a> &amp; <a class="code" href="fsal__types_8h.html#aa94f1053d0de1f0e5a0706d640cf300e">FSAL_ATTR_MODE</a>)
<a name="l02479"></a>02479     Fattr-&gt;<a class="code" href="structfattr3.html#aee0d62992319bbbeef0d8887ac9bcb2f">mode</a> = <a class="code" href="FSAL_2FSAL__CEPH_2fsal__convert_8h.html#ad39aceba2aa5bbef96f35a802e463222">fsal2unix_mode</a>(FSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a6611fe8fc39ff41d2c21d194213322e7">mode</a>);
<a name="l02480"></a>02480   <span class="keywordflow">if</span>(FSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a> &amp; <a class="code" href="fsal__types_8h.html#adc202dcb83bbb21a80346a73bcdde62a">FSAL_ATTR_NUMLINKS</a>)
<a name="l02481"></a>02481     Fattr-&gt;<a class="code" href="structfattr3.html#a44bf30bfbd6985ad468e5bf247db693f">nlink</a> = FSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a3ed4337021700c7a893c23668d6c0f33">numlinks</a>;
<a name="l02482"></a>02482   <span class="keywordflow">if</span>(FSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a> &amp; <a class="code" href="fsal__types_8h.html#ac8af49f265b9c157cf8d27e156086e07">FSAL_ATTR_OWNER</a>)
<a name="l02483"></a>02483     Fattr-&gt;<a class="code" href="structfattr3.html#a3655231cbb17ab96c9a02aa2fb4cb135">uid</a> = FSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a89670e3e52193381c240c0b7d93d6aa6">owner</a>;
<a name="l02484"></a>02484   <span class="keywordflow">if</span>(FSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a> &amp; <a class="code" href="fsal__types_8h.html#a36d30893495819b31377203edbcb91cf">FSAL_ATTR_GROUP</a>)
<a name="l02485"></a>02485     Fattr-&gt;<a class="code" href="structfattr3.html#ad06aaedf675b11afb16d26d90e4db785">gid</a> = FSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e4622af711f91b5f598fce5e0bee9fa">group</a>;
<a name="l02486"></a>02486   <span class="keywordflow">if</span>(FSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a> &amp; <a class="code" href="fsal__types_8h.html#a5859dca54adcb7dfed89e82ec0e265b6">FSAL_ATTR_SIZE</a>)
<a name="l02487"></a>02487     Fattr-&gt;<a class="code" href="structfattr3.html#a9f6a7cea85ad19307b72f22f0048ffbe">size</a> = FSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a0105c962cf3b7c8d11e2e2d1c5acff31">filesize</a>;
<a name="l02488"></a>02488   <span class="keywordflow">if</span>(FSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a> &amp; <a class="code" href="fsal__types_8h.html#a00384f412d9747624a5eb9caf5ac38cd">FSAL_ATTR_SPACEUSED</a>)
<a name="l02489"></a>02489     Fattr-&gt;<a class="code" href="structfattr3.html#a8bc9c0cd4d60d4f67b6549792db76962">used</a> = FSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a98bcdb72020b255bbe3355f9fc4c6a74">spaceused</a>;
<a name="l02490"></a>02490   <span class="keywordflow">if</span>(FSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a> &amp; <a class="code" href="fsal__types_8h.html#a40289b986531e7ab8635d1ba52244dee">FSAL_ATTR_RAWDEV</a>)
<a name="l02491"></a>02491     {
<a name="l02492"></a>02492       Fattr-&gt;<a class="code" href="structfattr3.html#aeacbc8524e827ae15df2e1ccc67e6952">rdev</a>.<a class="code" href="structspecdata3.html#a8dd187b4d8448de2723cf38cfc2bb4c1">specdata1</a> = FSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#ae500abbe897ddad0af25160793468ae1">rawdev</a>.<a class="code" href="structfsal__dev____.html#af03e5fde9bbeec4835a2dbdbcdbad11b">major</a>;
<a name="l02493"></a>02493       Fattr-&gt;<a class="code" href="structfattr3.html#aeacbc8524e827ae15df2e1ccc67e6952">rdev</a>.<a class="code" href="structspecdata3.html#a4ebcb5f3b478735ecee13556e4197d6e">specdata2</a> = FSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#ae500abbe897ddad0af25160793468ae1">rawdev</a>.<a class="code" href="structfsal__dev____.html#a922b8f1c6709b21a6f6af2bdeb8f0dd5">minor</a>;
<a name="l02494"></a>02494     }
<a name="l02495"></a>02495   <span class="keywordflow">if</span>(FSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a> &amp; <a class="code" href="fsal__types_8h.html#a2bccbc89b989f052b1778db8081831f2">FSAL_ATTR_FILEID</a>)
<a name="l02496"></a>02496     Fattr-&gt;<a class="code" href="structfattr3.html#a3bb2e40248c202b8095bf86375ac2fb6">fileid</a> = FSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a657a3efbc26891ced4b16f48791452c3">fileid</a>;
<a name="l02497"></a>02497   <span class="keywordflow">if</span>(FSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a> &amp; <a class="code" href="fsal__types_8h.html#aa809a24aeeb4b580487163fea39856a1">FSAL_ATTR_ATIME</a>)
<a name="l02498"></a>02498     {
<a name="l02499"></a>02499       Fattr-&gt;<a class="code" href="structfattr3.html#aac52b3ecb1cdc7ef643be10801c76a67">atime</a>.<a class="code" href="structnfstime3.html#a6765f76aef63ace5fb0ce3dc904f14c3">seconds</a> = FSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a48293ea65b5bb7282d4421ad079f056f">atime</a>.<a class="code" href="structfsal__time____.html#add92ec6180384f0ba10dd2a79b659548">seconds</a>;
<a name="l02500"></a>02500       Fattr-&gt;<a class="code" href="structfattr3.html#aac52b3ecb1cdc7ef643be10801c76a67">atime</a>.<a class="code" href="structnfstime3.html#aad0965ff90c90abd7d7c4c431e7e41a1">nseconds</a> = FSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a48293ea65b5bb7282d4421ad079f056f">atime</a>.<a class="code" href="structfsal__time____.html#a9c41918d2f2ea4627205dd4c2e347373">nseconds</a>;
<a name="l02501"></a>02501     }
<a name="l02502"></a>02502   <span class="keywordflow">if</span>(FSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a> &amp; <a class="code" href="fsal__types_8h.html#a9831a00094624d8747ecbf71c1560e8d">FSAL_ATTR_MTIME</a>)
<a name="l02503"></a>02503     {
<a name="l02504"></a>02504       Fattr-&gt;<a class="code" href="structfattr3.html#ac129137a6a257bd46e1ea4c526733de9">mtime</a>.<a class="code" href="structnfstime3.html#a6765f76aef63ace5fb0ce3dc904f14c3">seconds</a> = FSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a441daefe7cc86152355f895d81bc2936">mtime</a>.<a class="code" href="structfsal__time____.html#add92ec6180384f0ba10dd2a79b659548">seconds</a>;
<a name="l02505"></a>02505       Fattr-&gt;<a class="code" href="structfattr3.html#ac129137a6a257bd46e1ea4c526733de9">mtime</a>.<a class="code" href="structnfstime3.html#aad0965ff90c90abd7d7c4c431e7e41a1">nseconds</a> = FSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a441daefe7cc86152355f895d81bc2936">mtime</a>.<a class="code" href="structfsal__time____.html#a9c41918d2f2ea4627205dd4c2e347373">nseconds</a>;
<a name="l02506"></a>02506     }
<a name="l02507"></a>02507   <span class="keywordflow">if</span>(FSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a> &amp; <a class="code" href="fsal__types_8h.html#a12ba97e931b1f15cd91ff6d1fd88b3c7">FSAL_ATTR_CTIME</a>)
<a name="l02508"></a>02508     {
<a name="l02509"></a>02509       Fattr-&gt;<a class="code" href="structfattr3.html#a645fed869a8d1a7593124c82b4fa3d7e">ctime</a>.<a class="code" href="structnfstime3.html#a6765f76aef63ace5fb0ce3dc904f14c3">seconds</a> = FSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7087852b901550fbbc6ba2aed12c96ef">ctime</a>.<a class="code" href="structfsal__time____.html#add92ec6180384f0ba10dd2a79b659548">seconds</a>;
<a name="l02510"></a>02510       Fattr-&gt;<a class="code" href="structfattr3.html#a645fed869a8d1a7593124c82b4fa3d7e">ctime</a>.<a class="code" href="structnfstime3.html#aad0965ff90c90abd7d7c4c431e7e41a1">nseconds</a> = FSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7087852b901550fbbc6ba2aed12c96ef">ctime</a>.<a class="code" href="structfsal__time____.html#a9c41918d2f2ea4627205dd4c2e347373">nseconds</a>;
<a name="l02511"></a>02511     }
<a name="l02512"></a>02512 
<a name="l02513"></a>02513   <span class="keywordflow">return</span> 1;
<a name="l02514"></a>02514 }                         <span class="comment">/* nfs3_FSALattr_To_PartialFattr */</span>
<a name="l02515"></a>02515 
<a name="l02531"></a><a class="code" href="group__NFSprocs.html#ga134d926570de1b1bd6fcc5be03a78a51">02531</a> <span class="keywordtype">int</span> <a class="code" href="group__NFSprocs.html#ga134d926570de1b1bd6fcc5be03a78a51">nfs3_FSALattr_To_Fattr</a>(<a class="code" href="structexportlist____.html">exportlist_t</a> * pexport,      <span class="comment">/* In: the related export entry */</span>
<a name="l02532"></a>02532                            <span class="keyword">const</span> <a class="code" href="structfsal__attrib__list____.html">fsal_attrib_list_t</a> * FSAL_attr,      <span class="comment">/* In: file attributes */</span>
<a name="l02533"></a>02533                            <a class="code" href="structfattr3.html">fattr3</a> * Fattr)      <span class="comment">/* Out: file attributes */</span>
<a name="l02534"></a>02534 {
<a name="l02535"></a>02535   <span class="keywordflow">if</span>(FSAL_attr == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || Fattr == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02536"></a>02536     {
<a name="l02537"></a>02537       <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556af6e90cb9d43106e13df4e83652c94f27">COMPONENT_NFSPROTO</a>,
<a name="l02538"></a>02538                    <span class="stringliteral">&quot;nfs3_FSALattr_To_Fattr: FSAL_attr=%p, Fattr=%p&quot;</span>,
<a name="l02539"></a>02539                    FSAL_attr, Fattr);
<a name="l02540"></a>02540       <span class="keywordflow">return</span> 0;
<a name="l02541"></a>02541     }
<a name="l02542"></a>02542 
<a name="l02543"></a>02543   <span class="keywordflow">if</span>(!<a class="code" href="group__NFSprocs.html#ga0b7347bd74a189a6c5380f58e73eda31">nfs3_FSALattr_To_PartialFattr</a>(FSAL_attr, 
<a name="l02544"></a>02544                                     <a class="code" href="fsal__types_8h.html#aa8043bacec09f83fc424e2cbc638a896">FSAL_ATTR_TYPE</a>| <a class="code" href="fsal__types_8h.html#aa94f1053d0de1f0e5a0706d640cf300e">FSAL_ATTR_MODE</a> | <a class="code" href="fsal__types_8h.html#adc202dcb83bbb21a80346a73bcdde62a">FSAL_ATTR_NUMLINKS</a> |
<a name="l02545"></a>02545                                     <a class="code" href="fsal__types_8h.html#ac8af49f265b9c157cf8d27e156086e07">FSAL_ATTR_OWNER</a> | <a class="code" href="fsal__types_8h.html#a36d30893495819b31377203edbcb91cf">FSAL_ATTR_GROUP</a> | <a class="code" href="fsal__types_8h.html#a5859dca54adcb7dfed89e82ec0e265b6">FSAL_ATTR_SIZE</a> |
<a name="l02546"></a>02546                                     <a class="code" href="fsal__types_8h.html#a00384f412d9747624a5eb9caf5ac38cd">FSAL_ATTR_SPACEUSED</a> | <a class="code" href="fsal__types_8h.html#a40289b986531e7ab8635d1ba52244dee">FSAL_ATTR_RAWDEV</a> |
<a name="l02547"></a>02547                                     <a class="code" href="fsal__types_8h.html#aa809a24aeeb4b580487163fea39856a1">FSAL_ATTR_ATIME</a> | <a class="code" href="fsal__types_8h.html#a9831a00094624d8747ecbf71c1560e8d">FSAL_ATTR_MTIME</a> | <a class="code" href="fsal__types_8h.html#a12ba97e931b1f15cd91ff6d1fd88b3c7">FSAL_ATTR_CTIME</a>,
<a name="l02548"></a>02548                                     Fattr))
<a name="l02549"></a>02549     <span class="keywordflow">return</span> 0;
<a name="l02550"></a>02550 
<a name="l02551"></a>02551   <span class="comment">/* in NFSv3, we only keeps fsid.major, casted into an nfs_uint64 */</span>
<a name="l02552"></a>02552   Fattr-&gt;<a class="code" href="structfattr3.html#a79e94bca8e16a8f5c794e40bf049c57a">fsid</a> = (<a class="code" href="nfs23_8h.html#a9033680e1f3b4e7d6b5b64eb7c0803d5">nfs3_uint64</a>) pexport-&gt;<a class="code" href="structexportlist____.html#a0f81c1008714a0ce0039397cd3fab832">filesystem_id</a>.<a class="code" href="structfsal__fsid____.html#a86fa6b41da5905b04e531bd530c1573c">major</a>;
<a name="l02553"></a>02553   <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556af6e90cb9d43106e13df4e83652c94f27">COMPONENT_NFSPROTO</a>,
<a name="l02554"></a>02554                <span class="stringliteral">&quot;%s: fsid.major = %#llX (%llu), fsid.minor = %#llX (%llu), nfs3_fsid = %#llX (%llu)&quot;</span>,
<a name="l02555"></a>02555                __func__,
<a name="l02556"></a>02556                pexport-&gt;<a class="code" href="structexportlist____.html#a0f81c1008714a0ce0039397cd3fab832">filesystem_id</a>.<a class="code" href="structfsal__fsid____.html#a86fa6b41da5905b04e531bd530c1573c">major</a>, pexport-&gt;<a class="code" href="structexportlist____.html#a0f81c1008714a0ce0039397cd3fab832">filesystem_id</a>.<a class="code" href="structfsal__fsid____.html#a86fa6b41da5905b04e531bd530c1573c">major</a>,
<a name="l02557"></a>02557                pexport-&gt;<a class="code" href="structexportlist____.html#a0f81c1008714a0ce0039397cd3fab832">filesystem_id</a>.<a class="code" href="structfsal__fsid____.html#a4af3ec4bf793f168471987221d477130">minor</a>, pexport-&gt;<a class="code" href="structexportlist____.html#a0f81c1008714a0ce0039397cd3fab832">filesystem_id</a>.<a class="code" href="structfsal__fsid____.html#a4af3ec4bf793f168471987221d477130">minor</a>, Fattr-&gt;<a class="code" href="structfattr3.html#a79e94bca8e16a8f5c794e40bf049c57a">fsid</a>,
<a name="l02558"></a>02558                Fattr-&gt;<a class="code" href="structfattr3.html#a79e94bca8e16a8f5c794e40bf049c57a">fsid</a>);
<a name="l02559"></a>02559   <span class="keywordflow">return</span> 1;
<a name="l02560"></a>02560 }
<a name="l02561"></a>02561 
<a name="l02574"></a><a class="code" href="group__NFSprocs.html#gae7e5d569310535476c9ef6e0e9ca8731">02574</a> <span class="keywordtype">int</span> <a class="code" href="group__NFSprocs.html#gae7e5d569310535476c9ef6e0e9ca8731">nfs2_Sattr_To_FSALattr</a>(<a class="code" href="structfsal__attrib__list____.html">fsal_attrib_list_t</a> * pFSAL_attr,     <span class="comment">/* Out: file attributes */</span>
<a name="l02575"></a>02575                            <a class="code" href="structsattr2.html">sattr2</a> * Fattr)      <span class="comment">/* In: file attributes */</span>
<a name="l02576"></a>02576 {
<a name="l02577"></a>02577   <span class="keyword">struct </span>timeval t;
<a name="l02578"></a>02578 
<a name="l02579"></a>02579   <a class="code" href="fsal_8h.html#a76caf50ec9c57d3d0555a3e539fd307a">FSAL_CLEAR_MASK</a>(pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a>);
<a name="l02580"></a>02580 
<a name="l02581"></a>02581   <span class="keywordflow">if</span>(Fattr-&gt;<a class="code" href="structsattr2.html#adb52724853bbde621876cca1cb95d25a">mode</a> != (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)-1)
<a name="l02582"></a>02582     {
<a name="l02583"></a>02583       pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a6611fe8fc39ff41d2c21d194213322e7">mode</a> = <a class="code" href="FSAL_2FSAL__CEPH_2fsal__convert_8h.html#aaf1ff789aff0ed7114b8e525e01e268c">unix2fsal_mode</a>(Fattr-&gt;<a class="code" href="structsattr2.html#adb52724853bbde621876cca1cb95d25a">mode</a>);
<a name="l02584"></a>02584       <a class="code" href="fsal_8h.html#a7c3c020a7319c8d6d2fdf0aaf0ea5313">FSAL_SET_MASK</a>(pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a>, <a class="code" href="fsal__types_8h.html#aa94f1053d0de1f0e5a0706d640cf300e">FSAL_ATTR_MODE</a>);
<a name="l02585"></a>02585     }
<a name="l02586"></a>02586 
<a name="l02587"></a>02587   <span class="keywordflow">if</span>(Fattr-&gt;<a class="code" href="structsattr2.html#a062a82ca989d349519aa9d9b50b5e374">uid</a> != (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)-1)
<a name="l02588"></a>02588     {
<a name="l02589"></a>02589       pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a89670e3e52193381c240c0b7d93d6aa6">owner</a> = Fattr-&gt;<a class="code" href="structsattr2.html#a062a82ca989d349519aa9d9b50b5e374">uid</a>;
<a name="l02590"></a>02590       <a class="code" href="fsal_8h.html#a7c3c020a7319c8d6d2fdf0aaf0ea5313">FSAL_SET_MASK</a>(pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a>, <a class="code" href="fsal__types_8h.html#ac8af49f265b9c157cf8d27e156086e07">FSAL_ATTR_OWNER</a>);
<a name="l02591"></a>02591     }
<a name="l02592"></a>02592 
<a name="l02593"></a>02593   <span class="keywordflow">if</span>(Fattr-&gt;<a class="code" href="structsattr2.html#a328f8a6a03dc44b9ff51b69537526418">gid</a> != (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)-1)
<a name="l02594"></a>02594     {
<a name="l02595"></a>02595       pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e4622af711f91b5f598fce5e0bee9fa">group</a> = Fattr-&gt;<a class="code" href="structsattr2.html#a328f8a6a03dc44b9ff51b69537526418">gid</a>;
<a name="l02596"></a>02596       <a class="code" href="fsal_8h.html#a7c3c020a7319c8d6d2fdf0aaf0ea5313">FSAL_SET_MASK</a>(pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a>, <a class="code" href="fsal__types_8h.html#a36d30893495819b31377203edbcb91cf">FSAL_ATTR_GROUP</a>);
<a name="l02597"></a>02597     }
<a name="l02598"></a>02598 
<a name="l02599"></a>02599   <span class="keywordflow">if</span>(Fattr-&gt;<a class="code" href="structsattr2.html#af3311a906e9803943707c885dda9320c">size</a> != (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)-1)
<a name="l02600"></a>02600     {
<a name="l02601"></a>02601       <span class="comment">/* Both FSAL_ATTR_SIZE and FSAL_ATTR_SPACEUSED are to be managed */</span>
<a name="l02602"></a>02602       pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a0105c962cf3b7c8d11e2e2d1c5acff31">filesize</a> = (<a class="code" href="fsal__types_8h.html#a30fc893739650c71e910bc834eb401df">fsal_size_t</a>) Fattr-&gt;<a class="code" href="structsattr2.html#af3311a906e9803943707c885dda9320c">size</a>;
<a name="l02603"></a>02603       pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a98bcdb72020b255bbe3355f9fc4c6a74">spaceused</a> = (<a class="code" href="fsal__types_8h.html#a30fc893739650c71e910bc834eb401df">fsal_size_t</a>) Fattr-&gt;<a class="code" href="structsattr2.html#af3311a906e9803943707c885dda9320c">size</a>;
<a name="l02604"></a>02604       <a class="code" href="fsal_8h.html#a7c3c020a7319c8d6d2fdf0aaf0ea5313">FSAL_SET_MASK</a>(pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a>, <a class="code" href="fsal__types_8h.html#a5859dca54adcb7dfed89e82ec0e265b6">FSAL_ATTR_SIZE</a>);
<a name="l02605"></a>02605       <a class="code" href="fsal_8h.html#a7c3c020a7319c8d6d2fdf0aaf0ea5313">FSAL_SET_MASK</a>(pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a>, <a class="code" href="fsal__types_8h.html#a00384f412d9747624a5eb9caf5ac38cd">FSAL_ATTR_SPACEUSED</a>);
<a name="l02606"></a>02606     }
<a name="l02607"></a>02607 
<a name="l02608"></a>02608   <span class="comment">/* if mtime.useconds == 1 millions,</span>
<a name="l02609"></a>02609 <span class="comment">   * this means we must set atime and mtime</span>
<a name="l02610"></a>02610 <span class="comment">   * to server time (NFS Illustrated p. 98)</span>
<a name="l02611"></a>02611 <span class="comment">   */</span>
<a name="l02612"></a>02612   <span class="keywordflow">if</span>(Fattr-&gt;<a class="code" href="structsattr2.html#a237a24fb9141d2b452b317ee7b9d1188">mtime</a>.<a class="code" href="structnfstime2.html#a05324f8647614dd6b3428ce41c670846">useconds</a> == 1000000)
<a name="l02613"></a>02613     {
<a name="l02614"></a>02614       gettimeofday(&amp;t, <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l02615"></a>02615 
<a name="l02616"></a>02616       pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a48293ea65b5bb7282d4421ad079f056f">atime</a>.<a class="code" href="structfsal__time____.html#add92ec6180384f0ba10dd2a79b659548">seconds</a> = pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a441daefe7cc86152355f895d81bc2936">mtime</a>.<a class="code" href="structfsal__time____.html#add92ec6180384f0ba10dd2a79b659548">seconds</a> = t.tv_sec;
<a name="l02617"></a>02617       pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a48293ea65b5bb7282d4421ad079f056f">atime</a>.<a class="code" href="structfsal__time____.html#a9c41918d2f2ea4627205dd4c2e347373">nseconds</a> = pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a441daefe7cc86152355f895d81bc2936">mtime</a>.<a class="code" href="structfsal__time____.html#a9c41918d2f2ea4627205dd4c2e347373">nseconds</a> = 0 ;
<a name="l02618"></a>02618       <a class="code" href="fsal_8h.html#a7c3c020a7319c8d6d2fdf0aaf0ea5313">FSAL_SET_MASK</a>(pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a>, <a class="code" href="fsal__types_8h.html#aa809a24aeeb4b580487163fea39856a1">FSAL_ATTR_ATIME</a>);
<a name="l02619"></a>02619       <a class="code" href="fsal_8h.html#a7c3c020a7319c8d6d2fdf0aaf0ea5313">FSAL_SET_MASK</a>(pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a>, <a class="code" href="fsal__types_8h.html#a9831a00094624d8747ecbf71c1560e8d">FSAL_ATTR_MTIME</a>);
<a name="l02620"></a>02620     }
<a name="l02621"></a>02621   <span class="keywordflow">else</span>
<a name="l02622"></a>02622     {
<a name="l02623"></a>02623       <span class="comment">/* set atime to client */</span>
<a name="l02624"></a>02624 
<a name="l02625"></a>02625       <span class="keywordflow">if</span>(Fattr-&gt;<a class="code" href="structsattr2.html#a52dd4d219af2e7082878820c0b719ff1">atime</a>.<a class="code" href="structnfstime2.html#a31317a2746da0753ebad22071c3b388c">seconds</a> != (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)-1)
<a name="l02626"></a>02626         {
<a name="l02627"></a>02627           pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a48293ea65b5bb7282d4421ad079f056f">atime</a>.<a class="code" href="structfsal__time____.html#add92ec6180384f0ba10dd2a79b659548">seconds</a> = Fattr-&gt;<a class="code" href="structsattr2.html#a52dd4d219af2e7082878820c0b719ff1">atime</a>.<a class="code" href="structnfstime2.html#a31317a2746da0753ebad22071c3b388c">seconds</a>;
<a name="l02628"></a>02628 
<a name="l02629"></a>02629           <span class="keywordflow">if</span>(Fattr-&gt;<a class="code" href="structsattr2.html#a52dd4d219af2e7082878820c0b719ff1">atime</a>.<a class="code" href="structnfstime2.html#a31317a2746da0753ebad22071c3b388c">seconds</a> != (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)-1)
<a name="l02630"></a>02630             pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a48293ea65b5bb7282d4421ad079f056f">atime</a>.<a class="code" href="structfsal__time____.html#a9c41918d2f2ea4627205dd4c2e347373">nseconds</a> = Fattr-&gt;<a class="code" href="structsattr2.html#a52dd4d219af2e7082878820c0b719ff1">atime</a>.<a class="code" href="structnfstime2.html#a05324f8647614dd6b3428ce41c670846">useconds</a> * 1000;
<a name="l02631"></a>02631           <span class="keywordflow">else</span>
<a name="l02632"></a>02632             pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a48293ea65b5bb7282d4421ad079f056f">atime</a>.<a class="code" href="structfsal__time____.html#a9c41918d2f2ea4627205dd4c2e347373">nseconds</a> = 0;     <span class="comment">/* ignored */</span>
<a name="l02633"></a>02633 
<a name="l02634"></a>02634           <a class="code" href="fsal_8h.html#a7c3c020a7319c8d6d2fdf0aaf0ea5313">FSAL_SET_MASK</a>(pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a>, <a class="code" href="fsal__types_8h.html#aa809a24aeeb4b580487163fea39856a1">FSAL_ATTR_ATIME</a>);
<a name="l02635"></a>02635         }
<a name="l02636"></a>02636 
<a name="l02637"></a>02637       <span class="comment">/* set mtime to client */</span>
<a name="l02638"></a>02638 
<a name="l02639"></a>02639       <span class="keywordflow">if</span>(Fattr-&gt;<a class="code" href="structsattr2.html#a237a24fb9141d2b452b317ee7b9d1188">mtime</a>.<a class="code" href="structnfstime2.html#a31317a2746da0753ebad22071c3b388c">seconds</a> != (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)-1)
<a name="l02640"></a>02640         {
<a name="l02641"></a>02641           pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a441daefe7cc86152355f895d81bc2936">mtime</a>.<a class="code" href="structfsal__time____.html#add92ec6180384f0ba10dd2a79b659548">seconds</a> = Fattr-&gt;<a class="code" href="structsattr2.html#a237a24fb9141d2b452b317ee7b9d1188">mtime</a>.<a class="code" href="structnfstime2.html#a31317a2746da0753ebad22071c3b388c">seconds</a>;
<a name="l02642"></a>02642 
<a name="l02643"></a>02643           <span class="keywordflow">if</span>(Fattr-&gt;<a class="code" href="structsattr2.html#a237a24fb9141d2b452b317ee7b9d1188">mtime</a>.<a class="code" href="structnfstime2.html#a31317a2746da0753ebad22071c3b388c">seconds</a> != (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)-1)
<a name="l02644"></a>02644             pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a441daefe7cc86152355f895d81bc2936">mtime</a>.<a class="code" href="structfsal__time____.html#a9c41918d2f2ea4627205dd4c2e347373">nseconds</a> = Fattr-&gt;<a class="code" href="structsattr2.html#a237a24fb9141d2b452b317ee7b9d1188">mtime</a>.<a class="code" href="structnfstime2.html#a05324f8647614dd6b3428ce41c670846">useconds</a> * 1000;
<a name="l02645"></a>02645           <span class="keywordflow">else</span>
<a name="l02646"></a>02646             pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a441daefe7cc86152355f895d81bc2936">mtime</a>.<a class="code" href="structfsal__time____.html#a9c41918d2f2ea4627205dd4c2e347373">nseconds</a> = 0;     <span class="comment">/* ignored */</span>
<a name="l02647"></a>02647 
<a name="l02648"></a>02648           <a class="code" href="fsal_8h.html#a7c3c020a7319c8d6d2fdf0aaf0ea5313">FSAL_SET_MASK</a>(pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a>, <a class="code" href="fsal__types_8h.html#a9831a00094624d8747ecbf71c1560e8d">FSAL_ATTR_MTIME</a>);
<a name="l02649"></a>02649         }
<a name="l02650"></a>02650     }
<a name="l02651"></a>02651 
<a name="l02652"></a>02652   <span class="keywordflow">return</span> 1;
<a name="l02653"></a>02653 }                               <span class="comment">/* nfs2_Sattr_To_FSALattr */</span>
<a name="l02654"></a>02654 
<a name="l02668"></a><a class="code" href="group__NFSprocs.html#gab6df9722693803a2f08f7c8b161999ee">02668</a> <span class="keywordtype">int</span> <a class="code" href="group__NFSprocs.html#gab6df9722693803a2f08f7c8b161999ee">nfs4_Fattr_Check_Access</a>(<a class="code" href="structfattr4.html">fattr4</a> * Fattr, <span class="keywordtype">int</span> access)
<a name="l02669"></a>02669 {
<a name="l02670"></a>02670   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0;
<a name="l02671"></a>02671 
<a name="l02672"></a>02672   <a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> attrmasklist[<a class="code" href="nfsv40_8h.html#aee5e5c06f383e00c90378fabc96deaee">FATTR4_MOUNTED_ON_FILEID</a>];      <span class="comment">/* List cannot be longer than FATTR4_MOUNTED_ON_FILEID */</span>
<a name="l02673"></a>02673   <a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> attrmasklen = 0;
<a name="l02674"></a>02674 
<a name="l02675"></a>02675   <span class="comment">/* Parameter sanity check */</span>
<a name="l02676"></a>02676   <span class="keywordflow">if</span>(Fattr == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02677"></a>02677     <span class="keywordflow">return</span> 0;
<a name="l02678"></a>02678 
<a name="l02679"></a>02679   <span class="keywordflow">if</span>(access != <a class="code" href="group__NFSprocs.html#gae8ec85675a053c06aebacf637a994173">FATTR4_ATTR_READ</a> &amp;&amp; access != <a class="code" href="group__NFSprocs.html#gaa96fc0be826a495b84c20b402055c241">FATTR4_ATTR_WRITE</a>)
<a name="l02680"></a>02680     <span class="keywordflow">return</span> 0;
<a name="l02681"></a>02681 
<a name="l02682"></a>02682   <span class="comment">/* Convert the attribute bitmap to an attribute list */</span>
<a name="l02683"></a>02683   <a class="code" href="group__NFSprocs.html#gabd872db7513463c6ddadeec986c69051">nfs4_bitmap4_to_list</a>(&amp;(Fattr-&gt;<a class="code" href="structfattr4.html#ad00a59e5833c61e864df84d690d4a148">attrmask</a>), &amp;attrmasklen, attrmasklist);
<a name="l02684"></a>02684 
<a name="l02685"></a>02685   <span class="keywordflow">for</span>(i = 0; i &lt; attrmasklen; i++)
<a name="l02686"></a>02686     {
<a name="l02687"></a>02687 <span class="preprocessor">#ifdef _USE_NFS4_1</span>
<a name="l02688"></a>02688 <span class="preprocessor"></span>      <span class="keywordflow">if</span>(attrmasklist[i] &gt; <a class="code" href="nfsv41_8h.html#a62ba6055240092585b0d600502b5031b">FATTR4_FS_CHARSET_CAP</a>)
<a name="l02689"></a>02689 <span class="preprocessor">#else</span>
<a name="l02690"></a>02690 <span class="preprocessor"></span>      <span class="keywordflow">if</span>(attrmasklist[i] &gt; <a class="code" href="nfsv40_8h.html#aee5e5c06f383e00c90378fabc96deaee">FATTR4_MOUNTED_ON_FILEID</a>)
<a name="l02691"></a>02691 <span class="preprocessor">#endif</span>
<a name="l02692"></a>02692 <span class="preprocessor"></span>        {
<a name="l02693"></a>02693           <span class="comment">/* Erroneous value... skip */</span>
<a name="l02694"></a>02694           <span class="keywordflow">continue</span>;
<a name="l02695"></a>02695         }
<a name="l02696"></a>02696 
<a name="l02697"></a>02697       <span class="keywordflow">if</span>(((<span class="keywordtype">int</span>)fattr4tab[attrmasklist[i]].access &amp; access) != access)
<a name="l02698"></a>02698         <span class="keywordflow">return</span> 0;
<a name="l02699"></a>02699     }
<a name="l02700"></a>02700 
<a name="l02701"></a>02701   <span class="keywordflow">return</span> 1;
<a name="l02702"></a>02702 }                               <span class="comment">/* nfs4_Fattr_Check_Access */</span>
<a name="l02703"></a>02703 
<a name="l02717"></a><a class="code" href="group__NFSprocs.html#ga1b540b58ace7db01da59ffae1c434b7d">02717</a> <span class="keywordtype">int</span> <a class="code" href="group__NFSprocs.html#ga1b540b58ace7db01da59ffae1c434b7d">nfs4_Fattr_Check_Access_Bitmap</a>(<a class="code" href="structbitmap4.html">bitmap4</a> * pbitmap, <span class="keywordtype">int</span> access)
<a name="l02718"></a>02718 {
<a name="l02719"></a>02719   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0;
<a name="l02720"></a>02720 <span class="preprocessor">#ifdef _USE_NFS4_1</span>
<a name="l02721"></a>02721 <span class="preprocessor"></span><span class="preprocessor">#define MAXATTR FATTR4_FS_CHARSET_CAP</span>
<a name="l02722"></a>02722 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l02723"></a>02723 <span class="preprocessor"></span><span class="preprocessor">#define MAXATTR FATTR4_MOUNTED_ON_FILEID</span>
<a name="l02724"></a>02724 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l02725"></a>02725 <span class="preprocessor"></span>  <a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> attrmasklist[<a class="code" href="nfs__proto__tools_8c.html#a31ef56f164b9b1d48de809d39fd6ba87">MAXATTR</a>];
<a name="l02726"></a>02726   <a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> attrmasklen = 0;
<a name="l02727"></a>02727 
<a name="l02728"></a>02728   <span class="comment">/* Parameter sanity check */</span>
<a name="l02729"></a>02729   <span class="keywordflow">if</span>(pbitmap == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02730"></a>02730     <span class="keywordflow">return</span> 0;
<a name="l02731"></a>02731 
<a name="l02732"></a>02732   <span class="keywordflow">if</span>(access != <a class="code" href="group__NFSprocs.html#gae8ec85675a053c06aebacf637a994173">FATTR4_ATTR_READ</a> &amp;&amp; access != <a class="code" href="group__NFSprocs.html#gaa96fc0be826a495b84c20b402055c241">FATTR4_ATTR_WRITE</a>)
<a name="l02733"></a>02733     <span class="keywordflow">return</span> 0;
<a name="l02734"></a>02734 
<a name="l02735"></a>02735   <span class="comment">/* Convert the attribute bitmap to an attribute list */</span>
<a name="l02736"></a>02736   <a class="code" href="group__NFSprocs.html#gabd872db7513463c6ddadeec986c69051">nfs4_bitmap4_to_list</a>(pbitmap, &amp;attrmasklen, attrmasklist);
<a name="l02737"></a>02737 
<a name="l02738"></a>02738   <span class="keywordflow">for</span>(i = 0; i &lt; attrmasklen; i++)
<a name="l02739"></a>02739     {
<a name="l02740"></a>02740       <span class="keywordflow">if</span>(attrmasklist[i] &gt; <a class="code" href="nfs__proto__tools_8c.html#a31ef56f164b9b1d48de809d39fd6ba87">MAXATTR</a>)
<a name="l02741"></a>02741         {
<a name="l02742"></a>02742           <span class="comment">/* Erroneous value... skip */</span>
<a name="l02743"></a>02743           <span class="keywordflow">continue</span>;
<a name="l02744"></a>02744         }
<a name="l02745"></a>02745 
<a name="l02746"></a>02746       <span class="keywordflow">if</span>(((<span class="keywordtype">int</span>)fattr4tab[attrmasklist[i]].access &amp; access) != access)
<a name="l02747"></a>02747         <span class="keywordflow">return</span> 0;
<a name="l02748"></a>02748     }
<a name="l02749"></a>02749 
<a name="l02750"></a>02750   <span class="keywordflow">return</span> 1;
<a name="l02751"></a>02751 }                               <span class="comment">/* nfs4_Fattr_Check_Access */</span>
<a name="l02752"></a>02752 
<a name="l02764"></a><a class="code" href="group__NFSprocs.html#gaa74d224ce935989bbc8b1cc6895b8454">02764</a> <span class="keywordtype">int</span> <a class="code" href="group__NFSprocs.html#gaa74d224ce935989bbc8b1cc6895b8454">nfs4_bitmap4_Remove_Unsupported</a>(<a class="code" href="structbitmap4.html">bitmap4</a> * pbitmap )
<a name="l02765"></a>02765 {
<a name="l02766"></a>02766   <a class="code" href="extended__types_8h.html#a12a1e9b3ce141648783a82445d02b58d">uint_t</a> i = 0;
<a name="l02767"></a>02767   <a class="code" href="extended__types_8h.html#a12a1e9b3ce141648783a82445d02b58d">uint_t</a> val = 0;
<a name="l02768"></a>02768   <a class="code" href="extended__types_8h.html#a12a1e9b3ce141648783a82445d02b58d">uint_t</a> offset = 0;
<a name="l02769"></a>02769   uint fattr4tabidx = 0;
<a name="l02770"></a>02770 
<a name="l02771"></a>02771   <a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> bitmap_val[3] ;
<a name="l02772"></a>02772   <a class="code" href="structbitmap4.html">bitmap4</a> bout ;
<a name="l02773"></a>02773   <span class="keywordtype">int</span> allsupp = 1;
<a name="l02774"></a>02774 
<a name="l02775"></a>02775   memset(bitmap_val, 0, 3 * <span class="keyword">sizeof</span>(<a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>));
<a name="l02776"></a>02776 
<a name="l02777"></a>02777   bout.<a class="code" href="structbitmap4.html#a6b68a1ee274affc9d8cd0a810a6a0164">bitmap4_val</a> = bitmap_val ;
<a name="l02778"></a>02778   bout.<a class="code" href="structbitmap4.html#afd18333034a15d0d8427f6c58f2e110a">bitmap4_len</a> = pbitmap-&gt;<a class="code" href="structbitmap4.html#afd18333034a15d0d8427f6c58f2e110a">bitmap4_len</a>  ;
<a name="l02779"></a>02779 
<a name="l02780"></a>02780   <span class="keywordflow">if</span>(pbitmap-&gt;<a class="code" href="structbitmap4.html#afd18333034a15d0d8427f6c58f2e110a">bitmap4_len</a> &gt; 0)
<a name="l02781"></a>02781     <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>, <span class="stringliteral">&quot;Bitmap: Len = %u Val = %u|%u&quot;</span>,
<a name="l02782"></a>02782                  pbitmap-&gt;<a class="code" href="structbitmap4.html#afd18333034a15d0d8427f6c58f2e110a">bitmap4_len</a>, pbitmap-&gt;<a class="code" href="structbitmap4.html#a6b68a1ee274affc9d8cd0a810a6a0164">bitmap4_val</a>[0],
<a name="l02783"></a>02783                  pbitmap-&gt;<a class="code" href="structbitmap4.html#a6b68a1ee274affc9d8cd0a810a6a0164">bitmap4_val</a>[1]);
<a name="l02784"></a>02784   <span class="keywordflow">else</span>
<a name="l02785"></a>02785     <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>, <span class="stringliteral">&quot;Bitmap: Len = %u ... &quot;</span>,
<a name="l02786"></a>02786                  pbitmap-&gt;<a class="code" href="structbitmap4.html#afd18333034a15d0d8427f6c58f2e110a">bitmap4_len</a>);
<a name="l02787"></a>02787 
<a name="l02788"></a>02788   <span class="keywordflow">for</span>(offset = 0; offset &lt; pbitmap-&gt;<a class="code" href="structbitmap4.html#afd18333034a15d0d8427f6c58f2e110a">bitmap4_len</a>; offset++)
<a name="l02789"></a>02789     {
<a name="l02790"></a>02790       <span class="keywordflow">for</span>(i = 0; i &lt; 32; i++)
<a name="l02791"></a>02791         {
<a name="l02792"></a>02792           fattr4tabidx = i+32*offset;
<a name="l02793"></a>02793 <span class="preprocessor">#ifdef _USE_NFS4_1</span>
<a name="l02794"></a>02794 <span class="preprocessor"></span>          <span class="keywordflow">if</span> (fattr4tabidx &gt; <a class="code" href="nfsv41_8h.html#a62ba6055240092585b0d600502b5031b">FATTR4_FS_CHARSET_CAP</a>)
<a name="l02795"></a>02795 <span class="preprocessor">#else</span>
<a name="l02796"></a>02796 <span class="preprocessor"></span>          <span class="keywordflow">if</span> (fattr4tabidx &gt; <a class="code" href="nfsv40_8h.html#aee5e5c06f383e00c90378fabc96deaee">FATTR4_MOUNTED_ON_FILEID</a>)
<a name="l02797"></a>02797 <span class="preprocessor">#endif</span>
<a name="l02798"></a>02798 <span class="preprocessor"></span>             <span class="keywordflow">goto</span> exit;
<a name="l02799"></a>02799 
<a name="l02800"></a>02800           val = 1 &lt;&lt; i;         <span class="comment">/* Compute 2**i */</span>
<a name="l02801"></a>02801           <span class="keywordflow">if</span>(pbitmap-&gt;<a class="code" href="structbitmap4.html#a6b68a1ee274affc9d8cd0a810a6a0164">bitmap4_val</a>[offset] &amp; val)
<a name="l02802"></a>02802            {
<a name="l02803"></a>02803              <span class="keywordflow">if</span>( fattr4tab[fattr4tabidx].supported ) <span class="comment">/* keep only supported stuff */</span>
<a name="l02804"></a>02804                bout.<a class="code" href="structbitmap4.html#a6b68a1ee274affc9d8cd0a810a6a0164">bitmap4_val</a>[offset] |= val ;
<a name="l02805"></a>02805            }
<a name="l02806"></a>02806         }
<a name="l02807"></a>02807     }
<a name="l02808"></a>02808 
<a name="l02809"></a>02809 exit:
<a name="l02810"></a>02810   memcpy(pbitmap-&gt;<a class="code" href="structbitmap4.html#a6b68a1ee274affc9d8cd0a810a6a0164">bitmap4_val</a>, bout.<a class="code" href="structbitmap4.html#a6b68a1ee274affc9d8cd0a810a6a0164">bitmap4_val</a>,
<a name="l02811"></a>02811          bout.<a class="code" href="structbitmap4.html#afd18333034a15d0d8427f6c58f2e110a">bitmap4_len</a> * <span class="keyword">sizeof</span>(<a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>));
<a name="l02812"></a>02812 
<a name="l02813"></a>02813   <span class="keywordflow">return</span> allsupp;
<a name="l02814"></a>02814 }                               <span class="comment">/* nfs4_Fattr_Bitmap_Remove_Unsupported */</span>
<a name="l02815"></a>02815 
<a name="l02816"></a>02816 
<a name="l02829"></a><a class="code" href="group__NFSprocs.html#gaddc36314c9324c0075e3cc510f3fa3d3">02829</a> <span class="keywordtype">int</span> <a class="code" href="group__NFSprocs.html#gaddc36314c9324c0075e3cc510f3fa3d3">nfs4_Fattr_Supported</a>(<a class="code" href="structfattr4.html">fattr4</a> * Fattr)
<a name="l02830"></a>02830 {
<a name="l02831"></a>02831   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0;
<a name="l02832"></a>02832 
<a name="l02833"></a>02833   <a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> attrmasklist[<a class="code" href="nfsv40_8h.html#aee5e5c06f383e00c90378fabc96deaee">FATTR4_MOUNTED_ON_FILEID</a>];      <span class="comment">/* List cannot be longer than FATTR4_MOUNTED_ON_FILEID */</span>
<a name="l02834"></a>02834   <a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> attrmasklen = 0;
<a name="l02835"></a>02835 
<a name="l02836"></a>02836   <span class="comment">/* Parameter sanity check */</span>
<a name="l02837"></a>02837   <span class="keywordflow">if</span>(Fattr == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02838"></a>02838     <span class="keywordflow">return</span> 0;
<a name="l02839"></a>02839 
<a name="l02840"></a>02840   <span class="comment">/* Convert the attribute bitmap to an attribute list */</span>
<a name="l02841"></a>02841   <a class="code" href="group__NFSprocs.html#gabd872db7513463c6ddadeec986c69051">nfs4_bitmap4_to_list</a>(&amp;(Fattr-&gt;<a class="code" href="structfattr4.html#ad00a59e5833c61e864df84d690d4a148">attrmask</a>), &amp;attrmasklen, attrmasklist);
<a name="l02842"></a>02842 
<a name="l02843"></a>02843   <span class="keywordflow">for</span>(i = 0; i &lt; attrmasklen; i++)
<a name="l02844"></a>02844     {
<a name="l02845"></a>02845 
<a name="l02846"></a>02846 <span class="preprocessor">#ifndef _USE_NFS4_1</span>
<a name="l02847"></a>02847 <span class="preprocessor"></span>      <span class="keywordflow">if</span>(attrmasklist[i] &gt; <a class="code" href="nfsv40_8h.html#aee5e5c06f383e00c90378fabc96deaee">FATTR4_MOUNTED_ON_FILEID</a>)
<a name="l02848"></a>02848         {
<a name="l02849"></a>02849           <span class="comment">/* Erroneous value... skip */</span>
<a name="l02850"></a>02850           <span class="keywordflow">continue</span>;
<a name="l02851"></a>02851         }
<a name="l02852"></a>02852 <span class="preprocessor">#endif</span>
<a name="l02853"></a>02853 <span class="preprocessor"></span>
<a name="l02854"></a>02854       <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>,
<a name="l02855"></a>02855                    <span class="stringliteral">&quot;nfs4_Fattr_Supported  ==============&gt; %s supported flag=%u | &quot;</span>,
<a name="l02856"></a>02856                    fattr4tab[attrmasklist[i]].name, fattr4tab[attrmasklist[i]].supported);
<a name="l02857"></a>02857 
<a name="l02858"></a>02858       <span class="keywordflow">if</span>(!fattr4tab[attrmasklist[i]].supported)
<a name="l02859"></a>02859         <span class="keywordflow">return</span> 0;
<a name="l02860"></a>02860     }
<a name="l02861"></a>02861 
<a name="l02862"></a>02862   <span class="keywordflow">return</span> 1;
<a name="l02863"></a>02863 }                               <span class="comment">/* nfs4_Fattr_Supported */</span>
<a name="l02864"></a>02864 
<a name="l02877"></a><a class="code" href="group__NFSprocs.html#ga777415bca67416b566197f41ae273435">02877</a> <span class="keywordtype">int</span> <a class="code" href="group__NFSprocs.html#ga777415bca67416b566197f41ae273435">nfs4_Fattr_Supported_Bitmap</a>(<a class="code" href="structbitmap4.html">bitmap4</a> * pbitmap)
<a name="l02878"></a>02878 {
<a name="l02879"></a>02879   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0;
<a name="l02880"></a>02880 
<a name="l02881"></a>02881   <a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> attrmasklist[<a class="code" href="nfsv40_8h.html#aee5e5c06f383e00c90378fabc96deaee">FATTR4_MOUNTED_ON_FILEID</a>];      <span class="comment">/* List cannot be longer than FATTR4_MOUNTED_ON_FILEID */</span>
<a name="l02882"></a>02882   <a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> attrmasklen = 0;
<a name="l02883"></a>02883 
<a name="l02884"></a>02884   <span class="comment">/* Parameter sanity check */</span>
<a name="l02885"></a>02885   <span class="keywordflow">if</span>(pbitmap == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02886"></a>02886     <span class="keywordflow">return</span> 0;
<a name="l02887"></a>02887 
<a name="l02888"></a>02888   <span class="comment">/* Convert the attribute bitmap to an attribute list */</span>
<a name="l02889"></a>02889   <a class="code" href="group__NFSprocs.html#gabd872db7513463c6ddadeec986c69051">nfs4_bitmap4_to_list</a>(pbitmap, &amp;attrmasklen, attrmasklist);
<a name="l02890"></a>02890 
<a name="l02891"></a>02891   <span class="keywordflow">for</span>(i = 0; i &lt; attrmasklen; i++)
<a name="l02892"></a>02892     {
<a name="l02893"></a>02893 
<a name="l02894"></a>02894 <span class="preprocessor">#ifndef _USE_NFS4_1</span>
<a name="l02895"></a>02895 <span class="preprocessor"></span>      <span class="keywordflow">if</span>(attrmasklist[i] &gt; <a class="code" href="nfsv40_8h.html#aee5e5c06f383e00c90378fabc96deaee">FATTR4_MOUNTED_ON_FILEID</a>)
<a name="l02896"></a>02896         {
<a name="l02897"></a>02897           <span class="comment">/* Erroneous value... skip */</span>
<a name="l02898"></a>02898           <span class="keywordflow">continue</span>;
<a name="l02899"></a>02899         }
<a name="l02900"></a>02900 <span class="preprocessor">#endif</span>
<a name="l02901"></a>02901 <span class="preprocessor"></span>      
<a name="l02902"></a>02902       <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>,
<a name="l02903"></a>02903                    <span class="stringliteral">&quot;nfs4_Fattr_Supported  ==============&gt; %s supported flag=%u&quot;</span>,
<a name="l02904"></a>02904                    fattr4tab[attrmasklist[i]].name,
<a name="l02905"></a>02905                    fattr4tab[attrmasklist[i]].supported);
<a name="l02906"></a>02906       <span class="keywordflow">if</span>(!fattr4tab[attrmasklist[i]].supported)
<a name="l02907"></a>02907         <span class="keywordflow">return</span> 0;
<a name="l02908"></a>02908     }
<a name="l02909"></a>02909 
<a name="l02910"></a>02910   <span class="keywordflow">return</span> 1;
<a name="l02911"></a>02911 }                               <span class="comment">/* nfs4_Fattr_Supported */</span>
<a name="l02912"></a>02912 
<a name="l02925"></a><a class="code" href="group__NFSprocs.html#gad200b7297f523e28015b9da6df084f0d">02925</a> <span class="keywordtype">int</span> <a class="code" href="group__NFSprocs.html#gad200b7297f523e28015b9da6df084f0d">nfs4_Fattr_cmp</a>(<a class="code" href="structfattr4.html">fattr4</a> * Fattr1, <a class="code" href="structfattr4.html">fattr4</a> * Fattr2)
<a name="l02926"></a>02926 {
<a name="l02927"></a>02927   <a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> attrmasklist1[<a class="code" href="nfsv40_8h.html#aee5e5c06f383e00c90378fabc96deaee">FATTR4_MOUNTED_ON_FILEID</a>];     <span class="comment">/* List cannot be longer than FATTR4_MOUNTED_ON_FILEID */</span>
<a name="l02928"></a>02928   <a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> attrmasklen1 = 0;
<a name="l02929"></a>02929   u_int LastOffset;
<a name="l02930"></a>02930   <a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> attrmasklist2[<a class="code" href="nfsv40_8h.html#aee5e5c06f383e00c90378fabc96deaee">FATTR4_MOUNTED_ON_FILEID</a>];     <span class="comment">/* List cannot be longer than FATTR4_MOUNTED_ON_FILEID */</span>
<a name="l02931"></a>02931   <a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> attrmasklen2 = 0;
<a name="l02932"></a>02932   <a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> i;
<a name="l02933"></a>02933   <a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> k;
<a name="l02934"></a>02934   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cmp = 0;
<a name="l02935"></a>02935   u_int len = 0;
<a name="l02936"></a>02936   <a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> attribute_to_set = 0;
<a name="l02937"></a>02937 
<a name="l02938"></a>02938   <span class="keywordflow">if</span>(Fattr1 == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02939"></a>02939     <span class="keywordflow">return</span> <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02940"></a>02940 
<a name="l02941"></a>02941   <span class="keywordflow">if</span>(Fattr2 == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02942"></a>02942     <span class="keywordflow">return</span> <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02943"></a>02943 
<a name="l02944"></a>02944   <span class="keywordflow">if</span>(Fattr1-&gt;<a class="code" href="structfattr4.html#ad00a59e5833c61e864df84d690d4a148">attrmask</a>.<a class="code" href="structbitmap4.html#afd18333034a15d0d8427f6c58f2e110a">bitmap4_len</a> != Fattr2-&gt;<a class="code" href="structfattr4.html#ad00a59e5833c61e864df84d690d4a148">attrmask</a>.<a class="code" href="structbitmap4.html#afd18333034a15d0d8427f6c58f2e110a">bitmap4_len</a>)      <span class="comment">/* different mask */</span>
<a name="l02945"></a>02945     <span class="keywordflow">return</span> <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02946"></a>02946 
<a name="l02947"></a>02947   <span class="comment">/* Convert the attribute bitmap to an attribute list */</span>
<a name="l02948"></a>02948   <a class="code" href="group__NFSprocs.html#gabd872db7513463c6ddadeec986c69051">nfs4_bitmap4_to_list</a>(&amp;(Fattr1-&gt;<a class="code" href="structfattr4.html#ad00a59e5833c61e864df84d690d4a148">attrmask</a>), &amp;attrmasklen1, attrmasklist1);
<a name="l02949"></a>02949   <a class="code" href="group__NFSprocs.html#gabd872db7513463c6ddadeec986c69051">nfs4_bitmap4_to_list</a>(&amp;(Fattr2-&gt;<a class="code" href="structfattr4.html#ad00a59e5833c61e864df84d690d4a148">attrmask</a>), &amp;attrmasklen2, attrmasklist2);
<a name="l02950"></a>02950 
<a name="l02951"></a>02951   <span class="comment">/* Should not occur, bu this is a sanity check */</span>
<a name="l02952"></a>02952   <span class="keywordflow">if</span>(attrmasklen1 != attrmasklen2)
<a name="l02953"></a>02953     <span class="keywordflow">return</span> <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02954"></a>02954 
<a name="l02955"></a>02955   <span class="keywordflow">for</span>(i = 0; i &lt; attrmasklen1; i++)
<a name="l02956"></a>02956     {
<a name="l02957"></a>02957       <span class="keywordflow">if</span>(attrmasklist1[i] != attrmasklist2[i])
<a name="l02958"></a>02958         <span class="keywordflow">return</span> 0;
<a name="l02959"></a>02959 
<a name="l02960"></a>02960       <span class="keywordflow">if</span>(attrmasklist1[i] == <a class="code" href="nfsv40_8h.html#a8bd8eefcde07a750a41d0fe967427619">FATTR4_RDATTR_ERROR</a>)
<a name="l02961"></a>02961         <span class="keywordflow">return</span> -1;
<a name="l02962"></a>02962 
<a name="l02963"></a>02963       <span class="keywordflow">if</span>(attrmasklist2[i] == <a class="code" href="nfsv40_8h.html#a8bd8eefcde07a750a41d0fe967427619">FATTR4_RDATTR_ERROR</a>)
<a name="l02964"></a>02964         <span class="keywordflow">return</span> -1;
<a name="l02965"></a>02965     }
<a name="l02966"></a>02966 
<a name="l02967"></a>02967   cmp = 0;
<a name="l02968"></a>02968   LastOffset = 0;
<a name="l02969"></a>02969   len = 0;
<a name="l02970"></a>02970 
<a name="l02971"></a>02971   <span class="keywordflow">for</span>(i = 0; i &lt; attrmasklen1; i++)
<a name="l02972"></a>02972     {
<a name="l02973"></a>02973       attribute_to_set = attrmasklist1[i];
<a name="l02974"></a>02974 
<a name="l02975"></a>02975       <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>,
<a name="l02976"></a>02976                    <span class="stringliteral">&quot;nfs4_Fattr_cmp ==============&gt; %s&quot;</span>,
<a name="l02977"></a>02977                    fattr4tab[attribute_to_set].name);
<a name="l02978"></a>02978 
<a name="l02979"></a>02979       <span class="keywordflow">switch</span> (attribute_to_set)
<a name="l02980"></a>02980         {
<a name="l02981"></a>02981         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a0b40c74ec5d17a87e0e368b0517fe587">FATTR4_SUPPORTED_ATTRS</a>:
<a name="l02982"></a>02982           memcpy(&amp;len, (<span class="keywordtype">char</span> *)(Fattr1-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a> + LastOffset),
<a name="l02983"></a>02983                  <span class="keyword">sizeof</span>(u_int));
<a name="l02984"></a>02984           cmp +=
<a name="l02985"></a>02985               memcmp((<span class="keywordtype">char</span> *)(Fattr1-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a> + LastOffset),
<a name="l02986"></a>02986                      (<span class="keywordtype">char</span> *)(Fattr2-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a> + LastOffset),
<a name="l02987"></a>02987                      <span class="keyword">sizeof</span>(u_int));
<a name="l02988"></a>02988 
<a name="l02989"></a>02989           len = htonl(len);
<a name="l02990"></a>02990           LastOffset += <span class="keyword">sizeof</span>(u_int);
<a name="l02991"></a>02991 
<a name="l02992"></a>02992           <span class="keywordflow">for</span>(k = 0; k &lt; len; k++)
<a name="l02993"></a>02993             {
<a name="l02994"></a>02994               cmp += memcmp((<span class="keywordtype">char</span> *)(Fattr1-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a> + LastOffset),
<a name="l02995"></a>02995                             (<span class="keywordtype">char</span> *)(Fattr2-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a> + LastOffset),
<a name="l02996"></a>02996                             <span class="keyword">sizeof</span>(<a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>));
<a name="l02997"></a>02997               LastOffset += <span class="keyword">sizeof</span>(<a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>);
<a name="l02998"></a>02998             }
<a name="l02999"></a>02999 
<a name="l03000"></a>03000           <span class="keywordflow">break</span>;
<a name="l03001"></a>03001 
<a name="l03002"></a>03002         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a1e31fb57ae65cd90ba2b2bd203a81c08">FATTR4_FILEHANDLE</a>:
<a name="l03003"></a>03003         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a1b417fc85e29777886744df6709723ef">FATTR4_OWNER</a>:
<a name="l03004"></a>03004         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#ab2edd15bdc0df70213cb86ac63ca80d3">FATTR4_OWNER_GROUP</a>:
<a name="l03005"></a>03005           memcpy(&amp;len, (<span class="keywordtype">char</span> *)(Fattr1-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a> + LastOffset),
<a name="l03006"></a>03006                  <span class="keyword">sizeof</span>(u_int));
<a name="l03007"></a>03007           len = ntohl(len);     <span class="comment">/* xdr marshalling on fattr4 */</span>
<a name="l03008"></a>03008           cmp += memcmp((<span class="keywordtype">char</span> *)(Fattr1-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a> + LastOffset),
<a name="l03009"></a>03009                         (<span class="keywordtype">char</span> *)(Fattr2-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a> + LastOffset),
<a name="l03010"></a>03010                         <span class="keyword">sizeof</span>(u_int));
<a name="l03011"></a>03011           LastOffset += <span class="keyword">sizeof</span>(u_int);
<a name="l03012"></a>03012           cmp += memcmp((<span class="keywordtype">char</span> *)(Fattr1-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a> + LastOffset),
<a name="l03013"></a>03013                         (<span class="keywordtype">char</span> *)(Fattr2-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a> + LastOffset), len);
<a name="l03014"></a>03014           <span class="keywordflow">break</span>;
<a name="l03015"></a>03015 
<a name="l03016"></a>03016         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#abb174f647b2425ed9d75aca5067395b8">FATTR4_TYPE</a>:
<a name="l03017"></a>03017         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a5ed19d3fb209db5890e88447460f285f">FATTR4_FH_EXPIRE_TYPE</a>:
<a name="l03018"></a>03018         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a8691d62fc300ed27650afc28f7b3da15">FATTR4_CHANGE</a>:
<a name="l03019"></a>03019         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a08162b3359ba8b437d89090e76f9f079">FATTR4_SIZE</a>:
<a name="l03020"></a>03020         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#aec89ffab45626439fefb1e2651e48e63">FATTR4_LINK_SUPPORT</a>:
<a name="l03021"></a>03021         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a16e679badc58a66f4737098ca720539f">FATTR4_SYMLINK_SUPPORT</a>:
<a name="l03022"></a>03022         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#affe2dfbefc8ff527b79a989860638c11">FATTR4_NAMED_ATTR</a>:
<a name="l03023"></a>03023         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a8aafd7594d6a927a537b9d61e7cb2cb6">FATTR4_FSID</a>:
<a name="l03024"></a>03024         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a4e770e15e93db6e2f74e2449b22e7024">FATTR4_UNIQUE_HANDLES</a>:
<a name="l03025"></a>03025         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a27b8037bffddb4a7be7f389a174789a8">FATTR4_LEASE_TIME</a>:
<a name="l03026"></a>03026         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a8bd8eefcde07a750a41d0fe967427619">FATTR4_RDATTR_ERROR</a>:
<a name="l03027"></a>03027         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a6d36bb670468c89070ab7f9c08ec940d">FATTR4_ACL</a>:
<a name="l03028"></a>03028         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#acccdc7c8c20ea3eb28e277616b1304f2">FATTR4_ACLSUPPORT</a>:
<a name="l03029"></a>03029         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a8b3c56a49215fe985cf7c9a4df761709">FATTR4_ARCHIVE</a>:
<a name="l03030"></a>03030         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a0b6b2c64419dac1453c982d1e8af6398">FATTR4_CANSETTIME</a>:
<a name="l03031"></a>03031         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a67d7fd4f682db8a9cfca18db5b6781d6">FATTR4_CASE_INSENSITIVE</a>:
<a name="l03032"></a>03032         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a5b36d50d9150e9d231d3864ef4b5bcc6">FATTR4_CASE_PRESERVING</a>:
<a name="l03033"></a>03033         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#ae9b99e276288b6673639d91bdf73e55e">FATTR4_CHOWN_RESTRICTED</a>:
<a name="l03034"></a>03034         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a12bda16e66cebbcd45fab2cae6b42667">FATTR4_FILEID</a>:
<a name="l03035"></a>03035         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#ad8f9f2cd5ae0847bb982010e5c3e3b29">FATTR4_FILES_AVAIL</a>:
<a name="l03036"></a>03036         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a7d5bb307c7d80c15ebd3308ce6ae1ad0">FATTR4_FILES_FREE</a>:
<a name="l03037"></a>03037         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a60aa97a14a44928103710908dfcdb6f4">FATTR4_FILES_TOTAL</a>:
<a name="l03038"></a>03038         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a3fd8a1bc152a73ba56daad1eed452e33">FATTR4_FS_LOCATIONS</a>:
<a name="l03039"></a>03039         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#aff8c11d90ab70e33fd064a98b0259a51">FATTR4_HIDDEN</a>:
<a name="l03040"></a>03040         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a3be8247bb6bf1239fe59f2b060497f8e">FATTR4_HOMOGENEOUS</a>:
<a name="l03041"></a>03041         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a8d77c1fa475fe6e4f59d67f5b16b0f49">FATTR4_MAXFILESIZE</a>:
<a name="l03042"></a>03042         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a152d29ee332cd4908f35a2397af1a80c">FATTR4_MAXLINK</a>:
<a name="l03043"></a>03043         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#ac08ff6c8bf52d8c743c845df01cda82f">FATTR4_MAXNAME</a>:
<a name="l03044"></a>03044         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#ad5baf95761d8da57bd659663839f78b9">FATTR4_MAXREAD</a>:
<a name="l03045"></a>03045         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a279790f50a79f2e3d6c748dbebd0f566">FATTR4_MAXWRITE</a>:
<a name="l03046"></a>03046         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a4b941a38952bb3bc3e256aa9a5dca23f">FATTR4_MIMETYPE</a>:
<a name="l03047"></a>03047         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a0ba8d7c6edcd31a2eb08bc084550e31c">FATTR4_MODE</a>:
<a name="l03048"></a>03048         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#ad3f4dd873fc24cc72a4bd5ea4186984e">FATTR4_NO_TRUNC</a>:
<a name="l03049"></a>03049         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#afa964dbe7c4a85d4fa8801059fa83bdc">FATTR4_NUMLINKS</a>:
<a name="l03050"></a>03050         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a25dad080fab7d195a71a7d664587af22">FATTR4_QUOTA_AVAIL_HARD</a>:
<a name="l03051"></a>03051         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a36b7f38832d1dfbd61c9dde55e67f092">FATTR4_QUOTA_AVAIL_SOFT</a>:
<a name="l03052"></a>03052         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a6b4447e650b20373b01f7fce2167a333">FATTR4_QUOTA_USED</a>:
<a name="l03053"></a>03053         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a89b12b6e52be105460ff2922ed361595">FATTR4_RAWDEV</a>:
<a name="l03054"></a>03054         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#af38700c788d488d1274949e56fcf3b2d">FATTR4_SPACE_AVAIL</a>:
<a name="l03055"></a>03055         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a26d8cd485c39a59250e3f039df6a8867">FATTR4_SPACE_FREE</a>:
<a name="l03056"></a>03056         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a5bed496cfda6933474ac3c18e93bc47f">FATTR4_SPACE_TOTAL</a>:
<a name="l03057"></a>03057         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#ab9058684dd550c9561b6928d58f00026">FATTR4_SPACE_USED</a>:
<a name="l03058"></a>03058         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#ae07709aa5268f86bcdce2863188aea8f">FATTR4_SYSTEM</a>:
<a name="l03059"></a>03059         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#ad74f48a420926a335bc6bb75e431ddb4">FATTR4_TIME_ACCESS</a>:
<a name="l03060"></a>03060         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a402863c5613762a8d4971acaa7a9d991">FATTR4_TIME_ACCESS_SET</a>:
<a name="l03061"></a>03061         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#adadf5f190b82cffdfcfd0508bfe44931">FATTR4_TIME_BACKUP</a>:
<a name="l03062"></a>03062         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a59b428c6296b4086d51c8575c0da9216">FATTR4_TIME_CREATE</a>:
<a name="l03063"></a>03063         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a1256030125455df517cb22c3b98bf022">FATTR4_TIME_DELTA</a>:
<a name="l03064"></a>03064         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a13c0c2b7994641285fe8cc9e130c91f3">FATTR4_TIME_METADATA</a>:
<a name="l03065"></a>03065         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#aca636cf87f02044b79a6911207579f7d">FATTR4_TIME_MODIFY</a>:
<a name="l03066"></a>03066         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a9d41d38182a69e76e8a51f3e99d4a232">FATTR4_TIME_MODIFY_SET</a>:
<a name="l03067"></a>03067         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#aee5e5c06f383e00c90378fabc96deaee">FATTR4_MOUNTED_ON_FILEID</a>:
<a name="l03068"></a>03068           cmp += memcmp((<span class="keywordtype">char</span> *)(Fattr1-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a> + LastOffset),
<a name="l03069"></a>03069                         (<span class="keywordtype">char</span> *)(Fattr2-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a> + LastOffset),
<a name="l03070"></a>03070                         fattr4tab[attribute_to_set].size_fattr4);
<a name="l03071"></a>03071           <span class="keywordflow">break</span>;
<a name="l03072"></a>03072 
<a name="l03073"></a>03073         <span class="keywordflow">default</span>:
<a name="l03074"></a>03074           <span class="keywordflow">return</span> 0;
<a name="l03075"></a>03075           <span class="keywordflow">break</span>;
<a name="l03076"></a>03076         }
<a name="l03077"></a>03077     }
<a name="l03078"></a>03078   <span class="keywordflow">if</span>(cmp == 0)
<a name="l03079"></a>03079     <span class="keywordflow">return</span> <a class="code" href="HashTable_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l03080"></a>03080   <span class="keywordflow">else</span>
<a name="l03081"></a>03081     <span class="keywordflow">return</span> <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l03082"></a>03082 }
<a name="l03083"></a>03083 
<a name="l03084"></a>03084 <span class="preprocessor">#ifdef _USE_NFS4_ACL</span>
<a name="l03085"></a>03085 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">int</span> nfs4_decode_acl_special_user(<a class="code" href="structutf8string.html">utf8string</a> *utf8str, <span class="keywordtype">int</span> *who)
<a name="l03086"></a>03086 {
<a name="l03087"></a>03087   <span class="keywordtype">int</span> i;
<a name="l03088"></a>03088 
<a name="l03089"></a>03089   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="fsal__types_8h.html#ada7433a3ebd1a7ce34085b5ae9ddb894">FSAL_ACE_SPECIAL_EVERYONE</a>; i++)
<a name="l03090"></a>03090     {
<a name="l03091"></a>03091       <span class="keywordflow">if</span>(strncmp(utf8str-&gt;<a class="code" href="structutf8string.html#a72e3ba7aecf5547219953542a1c32271">utf8string_val</a>, whostr_2_type_map[i].string, utf8str-&gt;<a class="code" href="structutf8string.html#ab651a802af8217014ea648e43ac79b6f">utf8string_len</a>) == 0)
<a name="l03092"></a>03092         {
<a name="l03093"></a>03093           *who = whostr_2_type_map[i].type;
<a name="l03094"></a>03094           <span class="keywordflow">return</span> 0;
<a name="l03095"></a>03095         }
<a name="l03096"></a>03096     }
<a name="l03097"></a>03097 
<a name="l03098"></a>03098   <span class="keywordflow">return</span> -1;
<a name="l03099"></a>03099 }
<a name="l03100"></a>03100 
<a name="l03101"></a>03101 <span class="keyword">static</span> <span class="keywordtype">int</span> nfs4_decode_acl(<a class="code" href="structfsal__attrib__list____.html">fsal_attrib_list_t</a> * pFSAL_attr, <a class="code" href="structfattr4.html">fattr4</a> * Fattr, u_int *LastOffset)
<a name="l03102"></a>03102 {
<a name="l03103"></a>03103   <a class="code" href="nfs4__acls_8h.html#a8c952b9bdb887a74d7bd618bc74b55b0">fsal_acl_status_t</a> status;
<a name="l03104"></a>03104   <a class="code" href="structfsal__acl__data____.html">fsal_acl_data_t</a> acldata;
<a name="l03105"></a>03105   <a class="code" href="structfsal__ace____.html">fsal_ace_t</a> *pace;
<a name="l03106"></a>03106   <a class="code" href="structfsal__acl____.html">fsal_acl_t</a> *pacl;
<a name="l03107"></a>03107   <span class="keywordtype">int</span> len;
<a name="l03108"></a>03108   <span class="keywordtype">char</span> buffer[MAXNAMLEN];
<a name="l03109"></a>03109   <a class="code" href="structutf8string.html">utf8string</a> utf8buffer;
<a name="l03110"></a>03110   <span class="keywordtype">int</span> who;
<a name="l03111"></a>03111 
<a name="l03112"></a>03112   <span class="comment">/* Decode number of ACEs. */</span>
<a name="l03113"></a>03113   memcpy(&amp;(acldata.<a class="code" href="structfsal__acl__data____.html#a807186edcc0a2934e768db7d8bbcdc2a">naces</a>), (<span class="keywordtype">char</span>*)(Fattr-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a> + *LastOffset), <span class="keyword">sizeof</span>(u_int));
<a name="l03114"></a>03114   acldata.<a class="code" href="structfsal__acl__data____.html#a807186edcc0a2934e768db7d8bbcdc2a">naces</a> = ntohl(acldata.<a class="code" href="structfsal__acl__data____.html#a807186edcc0a2934e768db7d8bbcdc2a">naces</a>);
<a name="l03115"></a>03115   <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>,
<a name="l03116"></a>03116                <span class="stringliteral">&quot;SATTR: Number of ACEs = %u&quot;</span>,
<a name="l03117"></a>03117                acldata.<a class="code" href="structfsal__acl__data____.html#a807186edcc0a2934e768db7d8bbcdc2a">naces</a>);
<a name="l03118"></a>03118   *LastOffset += <span class="keyword">sizeof</span>(u_int);
<a name="l03119"></a>03119 
<a name="l03120"></a>03120   <span class="comment">/* Allocate memory for ACEs. */</span>
<a name="l03121"></a>03121   acldata.<a class="code" href="structfsal__acl__data____.html#ade3520c9d3c61f027eaf5a1b1942216b">aces</a> = (<a class="code" href="structfsal__ace____.html">fsal_ace_t</a> *)<a class="code" href="nfs4__acls_8h.html#a76a519d2d5b2e43e5d99f47975f8020a">nfs4_ace_alloc</a>(acldata.<a class="code" href="structfsal__acl__data____.html#a807186edcc0a2934e768db7d8bbcdc2a">naces</a>);
<a name="l03122"></a>03122   <span class="keywordflow">if</span>(acldata.<a class="code" href="structfsal__acl__data____.html#ade3520c9d3c61f027eaf5a1b1942216b">aces</a> == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l03123"></a>03123     {
<a name="l03124"></a>03124       <a class="code" href="test__findlog_8c.html#adfd9432c5478fa14c7d678edb301feed">LogCrit</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>,
<a name="l03125"></a>03125               <span class="stringliteral">&quot;SATTR: Failed to allocate ACEs&quot;</span>);
<a name="l03126"></a>03126       <span class="keywordflow">return</span> <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aaf8c067759d4fef22cb97409d7a50c453">NFS4ERR_SERVERFAULT</a>;
<a name="l03127"></a>03127     }
<a name="l03128"></a>03128   <span class="keywordflow">else</span>
<a name="l03129"></a>03129     memset(acldata.<a class="code" href="structfsal__acl__data____.html#ade3520c9d3c61f027eaf5a1b1942216b">aces</a>, 0, acldata.<a class="code" href="structfsal__acl__data____.html#a807186edcc0a2934e768db7d8bbcdc2a">naces</a> * <span class="keyword">sizeof</span>(<a class="code" href="structfsal__ace____.html">fsal_ace_t</a>));
<a name="l03130"></a>03130 
<a name="l03131"></a>03131   <span class="comment">/* Decode ACEs. */</span>
<a name="l03132"></a>03132   <span class="keywordflow">for</span>(pace = acldata.<a class="code" href="structfsal__acl__data____.html#ade3520c9d3c61f027eaf5a1b1942216b">aces</a>; pace &lt; acldata.<a class="code" href="structfsal__acl__data____.html#ade3520c9d3c61f027eaf5a1b1942216b">aces</a> + acldata.<a class="code" href="structfsal__acl__data____.html#a807186edcc0a2934e768db7d8bbcdc2a">naces</a>; pace++)
<a name="l03133"></a>03133     {
<a name="l03134"></a>03134       memcpy(&amp;(pace-&gt;<a class="code" href="structfsal__ace____.html#aa15f2ec133a148fa3f32046ea509cad7">type</a>), (<span class="keywordtype">char</span>*)(Fattr-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a> + *LastOffset), <span class="keyword">sizeof</span>(<a class="code" href="fsal__types_8h.html#a1135ea845767702e5d9b479186a32f47">fsal_acetype_t</a>));
<a name="l03135"></a>03135       pace-&gt;<a class="code" href="structfsal__ace____.html#aa15f2ec133a148fa3f32046ea509cad7">type</a> = ntohl(pace-&gt;<a class="code" href="structfsal__ace____.html#aa15f2ec133a148fa3f32046ea509cad7">type</a>);
<a name="l03136"></a>03136       <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>,
<a name="l03137"></a>03137                    <span class="stringliteral">&quot;SATTR: ACE type = 0x%x&quot;</span>,
<a name="l03138"></a>03138                    pace-&gt;<a class="code" href="structfsal__ace____.html#aa15f2ec133a148fa3f32046ea509cad7">type</a>);
<a name="l03139"></a>03139       *LastOffset += <span class="keyword">sizeof</span>(<a class="code" href="fsal__types_8h.html#a1135ea845767702e5d9b479186a32f47">fsal_acetype_t</a>);
<a name="l03140"></a>03140 
<a name="l03141"></a>03141       memcpy(&amp;(pace-&gt;<a class="code" href="structfsal__ace____.html#aff909b18f41ea63a20ec15720122a038">flag</a>), (<span class="keywordtype">char</span>*)(Fattr-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a> + *LastOffset), <span class="keyword">sizeof</span>(<a class="code" href="fsal__types_8h.html#a0dc8094aa7f25531724880ed0c920341">fsal_aceflag_t</a>));
<a name="l03142"></a>03142       pace-&gt;<a class="code" href="structfsal__ace____.html#aff909b18f41ea63a20ec15720122a038">flag</a> = ntohl(pace-&gt;<a class="code" href="structfsal__ace____.html#aff909b18f41ea63a20ec15720122a038">flag</a>);
<a name="l03143"></a>03143       <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>,
<a name="l03144"></a>03144                    <span class="stringliteral">&quot;SATTR: ACE flag = 0x%x&quot;</span>,
<a name="l03145"></a>03145                    pace-&gt;<a class="code" href="structfsal__ace____.html#aff909b18f41ea63a20ec15720122a038">flag</a>);
<a name="l03146"></a>03146       *LastOffset += <span class="keyword">sizeof</span>(<a class="code" href="fsal__types_8h.html#a0dc8094aa7f25531724880ed0c920341">fsal_aceflag_t</a>);
<a name="l03147"></a>03147 
<a name="l03148"></a>03148       memcpy(&amp;(pace-&gt;<a class="code" href="structfsal__ace____.html#a214faed3b4151f275400602c0c88df7b">perm</a>), (<span class="keywordtype">char</span>*)(Fattr-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a> + *LastOffset), <span class="keyword">sizeof</span>(<a class="code" href="fsal__types_8h.html#aeb79eb154b0c46e5b8130a5d89982428">fsal_aceperm_t</a>));
<a name="l03149"></a>03149       pace-&gt;<a class="code" href="structfsal__ace____.html#a214faed3b4151f275400602c0c88df7b">perm</a> = ntohl(pace-&gt;<a class="code" href="structfsal__ace____.html#a214faed3b4151f275400602c0c88df7b">perm</a>);
<a name="l03150"></a>03150       <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>,
<a name="l03151"></a>03151                    <span class="stringliteral">&quot;SATTR: ACE perm = 0x%x&quot;</span>,
<a name="l03152"></a>03152                    pace-&gt;<a class="code" href="structfsal__ace____.html#a214faed3b4151f275400602c0c88df7b">perm</a>);
<a name="l03153"></a>03153       *LastOffset += <span class="keyword">sizeof</span>(<a class="code" href="fsal__types_8h.html#aeb79eb154b0c46e5b8130a5d89982428">fsal_aceperm_t</a>);
<a name="l03154"></a>03154 
<a name="l03155"></a>03155       <span class="comment">/* Find out who type */</span>
<a name="l03156"></a>03156 
<a name="l03157"></a>03157       <span class="comment">/* Convert name to uid or gid */</span>
<a name="l03158"></a>03158       memcpy(&amp;len, (<span class="keywordtype">char</span> *)(Fattr-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a> + *LastOffset), <span class="keyword">sizeof</span>(u_int));
<a name="l03159"></a>03159       len = ntohl(len);        <span class="comment">/* xdr marshalling on fattr4 */</span>
<a name="l03160"></a>03160       *LastOffset += <span class="keyword">sizeof</span>(u_int);
<a name="l03161"></a>03161 
<a name="l03162"></a>03162       memcpy(buffer, (<span class="keywordtype">char</span> *)(Fattr-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a> + *LastOffset), len);
<a name="l03163"></a>03163       buffer[len] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l03164"></a>03164 
<a name="l03165"></a>03165       <span class="comment">/* Do not forget that xdr_opaque are aligned on 32bit long words */</span>
<a name="l03166"></a>03166       <span class="keywordflow">while</span>((len % 4) != 0)
<a name="l03167"></a>03167         len += 1;
<a name="l03168"></a>03168 
<a name="l03169"></a>03169       *LastOffset += len;
<a name="l03170"></a>03170 
<a name="l03171"></a>03171       <span class="comment">/* Decode users. */</span>
<a name="l03172"></a>03172       <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>,
<a name="l03173"></a>03173                    <span class="stringliteral">&quot;SATTR: owner = %s, len = %d, type = %s&quot;</span>,
<a name="l03174"></a>03174                    buffer, len,
<a name="l03175"></a>03175                    <a class="code" href="fsal__types_8h.html#ad259ed18ee88446d62d265aa7fea85ec">GET_FSAL_ACE_WHO_TYPE</a>(*pace));
<a name="l03176"></a>03176 
<a name="l03177"></a>03177       utf8buffer.<a class="code" href="structutf8string.html#a72e3ba7aecf5547219953542a1c32271">utf8string_val</a> = buffer;
<a name="l03178"></a>03178       utf8buffer.<a class="code" href="structutf8string.html#ab651a802af8217014ea648e43ac79b6f">utf8string_len</a> = strlen(buffer);
<a name="l03179"></a>03179 
<a name="l03180"></a>03180       <span class="keywordflow">if</span>(nfs4_decode_acl_special_user(&amp;utf8buffer, &amp;who) == 0)  <span class="comment">/* Decode special user. */</span>
<a name="l03181"></a>03181         {
<a name="l03182"></a>03182           <span class="comment">/* Clear group flag for special users */</span>
<a name="l03183"></a>03183           pace-&gt;<a class="code" href="structfsal__ace____.html#aff909b18f41ea63a20ec15720122a038">flag</a> &amp;= ~(<a class="code" href="fsal__types_8h.html#afcab07e989553983982a96db1904a505">FSAL_ACE_FLAG_GROUP_ID</a>);
<a name="l03184"></a>03184           pace-&gt;<a class="code" href="structfsal__ace____.html#ac8a660837cf65180f56eebe1a9be3fdb">iflag</a> |= <a class="code" href="fsal__types_8h.html#a5bd90ec9cbb96d8611072dc7d799d370">FSAL_ACE_IFLAG_SPECIAL_ID</a>;
<a name="l03185"></a>03185           pace-&gt;<a class="code" href="structfsal__ace____.html#a0f2e247c5c3a952c25dc982acd129a99">who</a>.<a class="code" href="structfsal__ace____.html#a6cf8f375a8a3d3dcbdb4bfd6d6eedc95">uid</a> = who;
<a name="l03186"></a>03186           <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>,
<a name="l03187"></a>03187                        <span class="stringliteral">&quot;SATTR: ACE special who.uid = 0x%x&quot;</span>,
<a name="l03188"></a>03188                        pace-&gt;<a class="code" href="structfsal__ace____.html#a0f2e247c5c3a952c25dc982acd129a99">who</a>.<a class="code" href="structfsal__ace____.html#a6cf8f375a8a3d3dcbdb4bfd6d6eedc95">uid</a>);
<a name="l03189"></a>03189         }
<a name="l03190"></a>03190       <span class="keywordflow">else</span>
<a name="l03191"></a>03191         {
<a name="l03192"></a>03192           <span class="keywordflow">if</span>(pace-&gt;<a class="code" href="structfsal__ace____.html#aff909b18f41ea63a20ec15720122a038">flag</a> == <a class="code" href="fsal__types_8h.html#afcab07e989553983982a96db1904a505">FSAL_ACE_FLAG_GROUP_ID</a>)  <span class="comment">/* Decode group. */</span>
<a name="l03193"></a>03193             {
<a name="l03194"></a>03194               <a class="code" href="group__NFSprocs.html#ga8ca153cdef0f9a18cd8b7c83e525867a">utf82gid</a>(&amp;utf8buffer, &amp;(pace-&gt;<a class="code" href="structfsal__ace____.html#a0f2e247c5c3a952c25dc982acd129a99">who</a>.<a class="code" href="structfsal__ace____.html#aba3e1644d9a0302a283f9c307f3ac4e3">gid</a>));
<a name="l03195"></a>03195               <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>,
<a name="l03196"></a>03196                            <span class="stringliteral">&quot;SATTR: ACE who.gid = 0x%x&quot;</span>,
<a name="l03197"></a>03197                            pace-&gt;<a class="code" href="structfsal__ace____.html#a0f2e247c5c3a952c25dc982acd129a99">who</a>.<a class="code" href="structfsal__ace____.html#aba3e1644d9a0302a283f9c307f3ac4e3">gid</a>);
<a name="l03198"></a>03198             }
<a name="l03199"></a>03199           <span class="keywordflow">else</span>  <span class="comment">/* Decode user. */</span>
<a name="l03200"></a>03200             {
<a name="l03201"></a>03201               <a class="code" href="group__NFSprocs.html#ga07a4b947f034d31f244415e9183ab523">utf82uid</a>(&amp;utf8buffer, &amp;(pace-&gt;<a class="code" href="structfsal__ace____.html#a0f2e247c5c3a952c25dc982acd129a99">who</a>.<a class="code" href="structfsal__ace____.html#a6cf8f375a8a3d3dcbdb4bfd6d6eedc95">uid</a>));
<a name="l03202"></a>03202               <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>,
<a name="l03203"></a>03203                            <span class="stringliteral">&quot;SATTR: ACE who.uid = 0x%x&quot;</span>,
<a name="l03204"></a>03204                            pace-&gt;<a class="code" href="structfsal__ace____.html#a0f2e247c5c3a952c25dc982acd129a99">who</a>.<a class="code" href="structfsal__ace____.html#a6cf8f375a8a3d3dcbdb4bfd6d6eedc95">uid</a>);
<a name="l03205"></a>03205             }
<a name="l03206"></a>03206         }
<a name="l03207"></a>03207 
<a name="l03208"></a>03208       <span class="comment">/* Check if we can map a name string to uid or gid. If we can&#39;t, do cleanup</span>
<a name="l03209"></a>03209 <span class="comment">       * and bubble up NFS4ERR_BADOWNER. */</span>
<a name="l03210"></a>03210       <span class="keywordflow">if</span>((pace-&gt;<a class="code" href="structfsal__ace____.html#aff909b18f41ea63a20ec15720122a038">flag</a> == <a class="code" href="fsal__types_8h.html#afcab07e989553983982a96db1904a505">FSAL_ACE_FLAG_GROUP_ID</a> ? pace-&gt;<a class="code" href="structfsal__ace____.html#a0f2e247c5c3a952c25dc982acd129a99">who</a>.<a class="code" href="structfsal__ace____.html#aba3e1644d9a0302a283f9c307f3ac4e3">gid</a> : pace-&gt;<a class="code" href="structfsal__ace____.html#a0f2e247c5c3a952c25dc982acd129a99">who</a>.<a class="code" href="structfsal__ace____.html#a6cf8f375a8a3d3dcbdb4bfd6d6eedc95">uid</a>) == -1)
<a name="l03211"></a>03211         {
<a name="l03212"></a>03212           <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>,
<a name="l03213"></a>03213                        <span class="stringliteral">&quot;SATTR: bad owner&quot;</span>);
<a name="l03214"></a>03214           <a class="code" href="nfs4__acls_8h.html#a05c9cdb6e194ea7d0960869b11c84476">nfs4_ace_free</a>(acldata.<a class="code" href="structfsal__acl__data____.html#ade3520c9d3c61f027eaf5a1b1942216b">aces</a>);
<a name="l03215"></a>03215           <span class="keywordflow">return</span> <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aa86a567ffd68e7c27f1cc798143b6f7a9">NFS4ERR_BADOWNER</a>;
<a name="l03216"></a>03216         }
<a name="l03217"></a>03217     }
<a name="l03218"></a>03218 
<a name="l03219"></a>03219   pacl = <a class="code" href="nfs4__acls_8h.html#a4676360651c4776f97b089a536e1a419">nfs4_acl_new_entry</a>(&amp;acldata, &amp;status);
<a name="l03220"></a>03220   pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a8dafc43a881e3c759511afdf3fac06fe">acl</a> = pacl;
<a name="l03221"></a>03221   <span class="keywordflow">if</span>(pacl == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l03222"></a>03222     {
<a name="l03223"></a>03223       <a class="code" href="test__findlog_8c.html#adfd9432c5478fa14c7d678edb301feed">LogCrit</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>,
<a name="l03224"></a>03224               <span class="stringliteral">&quot;SATTR: Failed to create a new entry for ACL&quot;</span>);
<a name="l03225"></a>03225       <span class="keywordflow">return</span> <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aaf8c067759d4fef22cb97409d7a50c453">NFS4ERR_SERVERFAULT</a>;
<a name="l03226"></a>03226     }
<a name="l03227"></a>03227   <span class="keywordflow">else</span>
<a name="l03228"></a>03228      <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>,
<a name="l03229"></a>03229                   <span class="stringliteral">&quot;SATTR: Successfully created a new entry for ACL, status = %u&quot;</span>,
<a name="l03230"></a>03230                   status);
<a name="l03231"></a>03231 
<a name="l03232"></a>03232   <span class="comment">/* Set new ACL */</span>
<a name="l03233"></a>03233   <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>,
<a name="l03234"></a>03234                <span class="stringliteral">&quot;SATTR: new acl = %p&quot;</span>,
<a name="l03235"></a>03235                pacl);
<a name="l03236"></a>03236 
<a name="l03237"></a>03237   <span class="keywordflow">return</span> <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aacaca462c793854dd61337cf0b54fc166">NFS4_OK</a>;
<a name="l03238"></a>03238 }
<a name="l03239"></a>03239 <span class="preprocessor">#endif                          </span><span class="comment">/* _USE_NFS4_ACL */</span>
<a name="l03240"></a>03240 
<a name="l03254"></a><a class="code" href="group__NFSprocs.html#ga57a42e7d45cf051840e35619f3efc160">03254</a> <span class="keywordtype">int</span> <a class="code" href="group__NFSprocs.html#ga57a42e7d45cf051840e35619f3efc160">nfs4_attrmap_to_FSAL_attrmask</a>(<a class="code" href="structbitmap4.html">bitmap4</a> attrmap, <a class="code" href="fsal__types_8h.html#a3cf899c676941b1d5f789b2b22af8821">fsal_attrib_mask_t</a>* attrmask)
<a name="l03255"></a>03255 {
<a name="l03256"></a>03256   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> offset = 0;
<a name="l03257"></a>03257   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0;
<a name="l03258"></a>03258   <span class="keywordtype">char</span> <a class="code" href="group__NFSprocs.html#ga7efec2b565bdbe409979ac657775eeaa">__attribute__</a> ((__unused__)) funcname[] = <span class="stringliteral">&quot;nfs4_FattrToSattr&quot;</span>;
<a name="l03259"></a>03259 
<a name="l03260"></a>03260   <span class="keywordflow">for</span>(offset = 0; offset &lt; attrmap.<a class="code" href="structbitmap4.html#afd18333034a15d0d8427f6c58f2e110a">bitmap4_len</a>; offset++)
<a name="l03261"></a>03261     {
<a name="l03262"></a>03262       <span class="keywordflow">for</span>(i = 0; i &lt; 32; i++)
<a name="l03263"></a>03263         {
<a name="l03264"></a>03264           <span class="keywordflow">if</span>(attrmap.<a class="code" href="structbitmap4.html#a6b68a1ee274affc9d8cd0a810a6a0164">bitmap4_val</a>[offset] &amp; (1 &lt;&lt; i)) {
<a name="l03265"></a>03265             <a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> val = i + 32 * offset;
<a name="l03266"></a>03266             <span class="keywordflow">switch</span> (val)
<a name="l03267"></a>03267               {
<a name="l03268"></a>03268               <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#abb174f647b2425ed9d75aca5067395b8">FATTR4_TYPE</a>:
<a name="l03269"></a>03269                 *attrmask |= <a class="code" href="fsal__types_8h.html#aa8043bacec09f83fc424e2cbc638a896">FSAL_ATTR_TYPE</a>;
<a name="l03270"></a>03270                 <span class="keywordflow">break</span>;
<a name="l03271"></a>03271               <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a12bda16e66cebbcd45fab2cae6b42667">FATTR4_FILEID</a>:
<a name="l03272"></a>03272                 *attrmask |= <a class="code" href="fsal__types_8h.html#a2bccbc89b989f052b1778db8081831f2">FSAL_ATTR_FILEID</a>;
<a name="l03273"></a>03273                 <span class="keywordflow">break</span>;
<a name="l03274"></a>03274               <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a8aafd7594d6a927a537b9d61e7cb2cb6">FATTR4_FSID</a>:
<a name="l03275"></a>03275                 *attrmask |= <a class="code" href="fsal__types_8h.html#af10789529b464358c687fcf21cc46ba7">FSAL_ATTR_FSID</a>;
<a name="l03276"></a>03276                 <span class="keywordflow">break</span>;
<a name="l03277"></a>03277               <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#afa964dbe7c4a85d4fa8801059fa83bdc">FATTR4_NUMLINKS</a>:
<a name="l03278"></a>03278                 *attrmask |= <a class="code" href="fsal__types_8h.html#adc202dcb83bbb21a80346a73bcdde62a">FSAL_ATTR_NUMLINKS</a>;
<a name="l03279"></a>03279                 <span class="keywordflow">break</span>;
<a name="l03280"></a>03280               <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a08162b3359ba8b437d89090e76f9f079">FATTR4_SIZE</a>:
<a name="l03281"></a>03281                 *attrmask |= <a class="code" href="fsal__types_8h.html#a5859dca54adcb7dfed89e82ec0e265b6">FSAL_ATTR_SIZE</a>;
<a name="l03282"></a>03282                 <span class="keywordflow">break</span>;
<a name="l03283"></a>03283               <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a0ba8d7c6edcd31a2eb08bc084550e31c">FATTR4_MODE</a>:
<a name="l03284"></a>03284                 *attrmask |= <a class="code" href="fsal__types_8h.html#aa94f1053d0de1f0e5a0706d640cf300e">FSAL_ATTR_MODE</a>;
<a name="l03285"></a>03285                 <span class="keywordflow">break</span>;
<a name="l03286"></a>03286               <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a1b417fc85e29777886744df6709723ef">FATTR4_OWNER</a>:
<a name="l03287"></a>03287                 *attrmask |= <a class="code" href="fsal__types_8h.html#ac8af49f265b9c157cf8d27e156086e07">FSAL_ATTR_OWNER</a>;
<a name="l03288"></a>03288                 <span class="keywordflow">break</span>;
<a name="l03289"></a>03289               <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#ab2edd15bdc0df70213cb86ac63ca80d3">FATTR4_OWNER_GROUP</a>:
<a name="l03290"></a>03290                 *attrmask |= <a class="code" href="fsal__types_8h.html#a36d30893495819b31377203edbcb91cf">FSAL_ATTR_GROUP</a>;
<a name="l03291"></a>03291                 <span class="keywordflow">break</span>;
<a name="l03292"></a>03292               <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a8691d62fc300ed27650afc28f7b3da15">FATTR4_CHANGE</a>:
<a name="l03293"></a>03293                 *attrmask |= <a class="code" href="fsal__types_8h.html#a9fa6f5c9e02806fe1f7b18ab5c1e6f58">FSAL_ATTR_CHGTIME</a>;
<a name="l03294"></a>03294                 <span class="keywordflow">break</span>;
<a name="l03295"></a>03295               <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a89b12b6e52be105460ff2922ed361595">FATTR4_RAWDEV</a>:
<a name="l03296"></a>03296                 *attrmask |= <a class="code" href="fsal__types_8h.html#a40289b986531e7ab8635d1ba52244dee">FSAL_ATTR_RAWDEV</a>;
<a name="l03297"></a>03297                 <span class="keywordflow">break</span>;
<a name="l03298"></a>03298               <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#ab9058684dd550c9561b6928d58f00026">FATTR4_SPACE_USED</a>:
<a name="l03299"></a>03299                 *attrmask |= <a class="code" href="fsal__types_8h.html#a00384f412d9747624a5eb9caf5ac38cd">FSAL_ATTR_SPACEUSED</a>;
<a name="l03300"></a>03300                 <span class="keywordflow">break</span>;
<a name="l03301"></a>03301               <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#ad74f48a420926a335bc6bb75e431ddb4">FATTR4_TIME_ACCESS</a>:
<a name="l03302"></a>03302                 *attrmask |= <a class="code" href="fsal__types_8h.html#aa809a24aeeb4b580487163fea39856a1">FSAL_ATTR_ATIME</a>;
<a name="l03303"></a>03303                 <span class="keywordflow">break</span>;
<a name="l03304"></a>03304               <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a13c0c2b7994641285fe8cc9e130c91f3">FATTR4_TIME_METADATA</a>:
<a name="l03305"></a>03305                 *attrmask |= <a class="code" href="fsal__types_8h.html#a12ba97e931b1f15cd91ff6d1fd88b3c7">FSAL_ATTR_CTIME</a>;
<a name="l03306"></a>03306                 <span class="keywordflow">break</span>;
<a name="l03307"></a>03307               <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#aca636cf87f02044b79a6911207579f7d">FATTR4_TIME_MODIFY</a>:
<a name="l03308"></a>03308                 *attrmask |= <a class="code" href="fsal__types_8h.html#a9831a00094624d8747ecbf71c1560e8d">FSAL_ATTR_MTIME</a>;
<a name="l03309"></a>03309                 <span class="keywordflow">break</span>;
<a name="l03310"></a>03310               <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a402863c5613762a8d4971acaa7a9d991">FATTR4_TIME_ACCESS_SET</a>:
<a name="l03311"></a>03311                 *attrmask |= <a class="code" href="fsal__types_8h.html#aa809a24aeeb4b580487163fea39856a1">FSAL_ATTR_ATIME</a>;
<a name="l03312"></a>03312                 <span class="keywordflow">break</span>;
<a name="l03313"></a>03313               <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a9d41d38182a69e76e8a51f3e99d4a232">FATTR4_TIME_MODIFY_SET</a>:
<a name="l03314"></a>03314                 *attrmask |= <a class="code" href="fsal__types_8h.html#a9831a00094624d8747ecbf71c1560e8d">FSAL_ATTR_MTIME</a>;
<a name="l03315"></a>03315                 <span class="keywordflow">break</span>;
<a name="l03316"></a>03316               <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a1e31fb57ae65cd90ba2b2bd203a81c08">FATTR4_FILEHANDLE</a>:
<a name="l03317"></a>03317                 <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>,
<a name="l03318"></a>03318                              <span class="stringliteral">&quot;Filehandle attribute requested on readdir!&quot;</span>);
<a name="l03319"></a>03319                 <span class="comment">/* pFSAL_attr-&gt;asked_attributes |= FSAL_ATTR_FILEHANDLE; */</span>
<a name="l03320"></a>03320                 <span class="keywordflow">break</span>;
<a name="l03321"></a>03321 <span class="preprocessor">#ifdef _USE_NFS4_ACL</span>
<a name="l03322"></a>03322 <span class="preprocessor"></span>              <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a6d36bb670468c89070ab7f9c08ec940d">FATTR4_ACL</a>:
<a name="l03323"></a>03323                 *attrmask |= <a class="code" href="fsal__types_8h.html#a5e36114afd44dec28252c289255ff1e5">FSAL_ATTR_ACL</a>;
<a name="l03324"></a>03324                 <span class="keywordflow">break</span>;
<a name="l03325"></a>03325 <span class="preprocessor">#endif                          </span><span class="comment">/* _USE_NFS4_ACL */</span>
<a name="l03326"></a>03326               }
<a name="l03327"></a>03327           }
<a name="l03328"></a>03328         }
<a name="l03329"></a>03329     }
<a name="l03330"></a>03330   <span class="keywordflow">return</span> <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aacaca462c793854dd61337cf0b54fc166">NFS4_OK</a>;
<a name="l03331"></a>03331 }                               <span class="comment">/* nfs4_Fattr_To_FSAL_attr */</span>
<a name="l03332"></a>03332 
<a name="l03333"></a>03333 <span class="keyword">static</span> <span class="keywordtype">int</span> nfstime4_to_fsal_time(<a class="code" href="structfsal__time____.html">fsal_time_t</a> *ts, <span class="keyword">const</span> <span class="keywordtype">char</span> *attrval)
<a name="l03334"></a>03334 {
<a name="l03335"></a>03335   <span class="keywordtype">int</span> LastOffset = 0;
<a name="l03336"></a>03336   <a class="code" href="extended__types_8h.html#ad27ed092432b64ff558d2254c278720f">uint64_t</a> seconds;
<a name="l03337"></a>03337   <a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> nseconds;
<a name="l03338"></a>03338 
<a name="l03339"></a>03339   memcpy(&amp;seconds, attrval + LastOffset, <span class="keyword">sizeof</span>(seconds));
<a name="l03340"></a>03340   LastOffset += <span class="keyword">sizeof</span>(seconds) ;
<a name="l03341"></a>03341 
<a name="l03342"></a>03342   memcpy(&amp;nseconds, attrval + LastOffset, <span class="keyword">sizeof</span>(nseconds));
<a name="l03343"></a>03343   LastOffset += <span class="keyword">sizeof</span>( nseconds ) ;
<a name="l03344"></a>03344 
<a name="l03345"></a>03345   ts-&gt;<a class="code" href="structfsal__time____.html#add92ec6180384f0ba10dd2a79b659548">seconds</a> = (<a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>) <a class="code" href="group__NFSprocs.html#ga87865063f614e91e712203f47c423cb6">nfs_ntohl64</a>(seconds);
<a name="l03346"></a>03346   ts-&gt;<a class="code" href="structfsal__time____.html#a9c41918d2f2ea4627205dd4c2e347373">nseconds</a> = (<a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>) ntohl(nseconds);
<a name="l03347"></a>03347 
<a name="l03348"></a>03348   <span class="keywordflow">return</span> LastOffset; 
<a name="l03349"></a>03349 }
<a name="l03350"></a>03350 
<a name="l03351"></a>03351 <span class="keyword">static</span> <span class="keywordtype">int</span> settime4_to_fsal_time(<a class="code" href="structfsal__time____.html">fsal_time_t</a> *ts, <span class="keyword">const</span> <span class="keywordtype">char</span> *attrval)
<a name="l03352"></a>03352 {
<a name="l03353"></a>03353   <a class="code" href="nfsv40_8h.html#ab808b19df55720ecc217af4329db7ea6">time_how4</a> how;
<a name="l03354"></a>03354   <span class="keywordtype">int</span> LastOffset = 0;
<a name="l03355"></a>03355 
<a name="l03356"></a>03356   memcpy(&amp;how, attrval + LastOffset , <span class="keyword">sizeof</span>(how));
<a name="l03357"></a>03357   LastOffset += <span class="keyword">sizeof</span>(how);
<a name="l03358"></a>03358 
<a name="l03359"></a>03359   <span class="keywordflow">if</span>(ntohl(how) == <a class="code" href="nfsv40_8h.html#ab808b19df55720ecc217af4329db7ea6a440387d9a74f30f6d8a34b450b594595">SET_TO_SERVER_TIME4</a>)
<a name="l03360"></a>03360     {
<a name="l03361"></a>03361       ts-&gt;<a class="code" href="structfsal__time____.html#add92ec6180384f0ba10dd2a79b659548">seconds</a> = time(<a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);   <span class="comment">/* Use current server&#39;s time */</span>
<a name="l03362"></a>03362       ts-&gt;<a class="code" href="structfsal__time____.html#a9c41918d2f2ea4627205dd4c2e347373">nseconds</a> = 0;
<a name="l03363"></a>03363     }
<a name="l03364"></a>03364   <span class="keywordflow">else</span>
<a name="l03365"></a>03365     {
<a name="l03366"></a>03366         LastOffset += nfstime4_to_fsal_time(ts, attrval + LastOffset);
<a name="l03367"></a>03367     }
<a name="l03368"></a>03368 
<a name="l03369"></a>03369   <span class="keywordflow">return</span> LastOffset;
<a name="l03370"></a>03370 }
<a name="l03371"></a>03371 
<a name="l03389"></a><a class="code" href="group__NFSprocs.html#ga8d3ad44058a0f0979e22553326404a77">03389</a> <span class="keywordtype">int</span> <a class="code" href="group__NFSprocs.html#ga8d3ad44058a0f0979e22553326404a77">Fattr4_To_FSAL_attr</a>(<a class="code" href="structfsal__attrib__list____.html">fsal_attrib_list_t</a> * pFSAL_attr, <a class="code" href="structfattr4.html">fattr4</a> * Fattr, <a class="code" href="structnfs__fh4.html">nfs_fh4</a> *hdl4)
<a name="l03390"></a>03390 {
<a name="l03391"></a>03391   u_int LastOffset = 0;
<a name="l03392"></a>03392   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0;
<a name="l03393"></a>03393   <a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> attrmasklist[<a class="code" href="nfsv40_8h.html#aee5e5c06f383e00c90378fabc96deaee">FATTR4_MOUNTED_ON_FILEID</a>];      <span class="comment">/* List cannot be longer than FATTR4_MOUNTED_ON_FILEID */</span>
<a name="l03394"></a>03394   <a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> attrmasklen = 0;
<a name="l03395"></a>03395   <a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> attribute_to_set = 0;
<a name="l03396"></a>03396   <span class="keywordtype">int</span> len;
<a name="l03397"></a>03397   <span class="keywordtype">char</span> buffer[MAXNAMLEN];
<a name="l03398"></a>03398   <a class="code" href="structutf8string.html">utf8string</a> utf8buffer;
<a name="l03399"></a>03399 
<a name="l03400"></a>03400   <a class="code" href="nfsv40_8h.html#a3a7fa6581b5a2a9e178e185038cf3040">fattr4_type</a> attr_type;
<a name="l03401"></a>03401   <a class="code" href="structfsid4.html">fattr4_fsid</a> attr_fsid;
<a name="l03402"></a>03402   <a class="code" href="nfsv40_8h.html#a439aa2213ecdeca95541878dbac665ce">fattr4_fileid</a> attr_fileid;
<a name="l03403"></a>03403   <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0a">fattr4_rdattr_error</a> rdattr_error;
<a name="l03404"></a>03404   <a class="code" href="nfsv40_8h.html#ae000375dc5e2bf5948e198baef0f6060">fattr4_size</a> attr_size;
<a name="l03405"></a>03405   <a class="code" href="nfsv40_8h.html#a71ffc916e5afbba5e732c8ebfd0f93f1">fattr4_change</a> attr_change;
<a name="l03406"></a>03406   <a class="code" href="nfsv40_8h.html#a5dcff0ef8b51f21c45fff7847ebb9458">fattr4_numlinks</a> attr_numlinks;
<a name="l03407"></a>03407   <a class="code" href="structspecdata4.html">fattr4_rawdev</a> attr_rawdev;
<a name="l03408"></a>03408   <a class="code" href="nfsv40_8h.html#ae058190bc78422118c9fe20cb0b2872d">fattr4_space_used</a> attr_space_used;
<a name="l03409"></a>03409 <span class="preprocessor">#ifdef _USE_NFS4_ACL</span>
<a name="l03410"></a>03410 <span class="preprocessor"></span>  <span class="keywordtype">int</span> rc;
<a name="l03411"></a>03411 <span class="preprocessor">#endif</span>
<a name="l03412"></a>03412 <span class="preprocessor"></span>
<a name="l03413"></a>03413   <span class="keywordflow">if</span>(pFSAL_attr == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || Fattr == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l03414"></a>03414     <span class="keywordflow">return</span> <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aa8b3ae93b91753fe76b2d4ea5f613e34e">NFS4ERR_BADXDR</a>;
<a name="l03415"></a>03415 
<a name="l03416"></a>03416   <span class="comment">/* Check attributes data */</span>
<a name="l03417"></a>03417   <span class="keywordflow">if</span>((Fattr-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a> == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) ||
<a name="l03418"></a>03418      (Fattr-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#ad931f11e5a1224bb94fa4eaac78cfa13">attrlist4_len</a> == 0))
<a name="l03419"></a>03419     <span class="keywordflow">return</span> <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aacaca462c793854dd61337cf0b54fc166">NFS4_OK</a>;
<a name="l03420"></a>03420 
<a name="l03421"></a>03421   <span class="comment">/* Convert the attribute bitmap to an attribute list */</span>
<a name="l03422"></a>03422   <a class="code" href="group__NFSprocs.html#gabd872db7513463c6ddadeec986c69051">nfs4_bitmap4_to_list</a>(&amp;(Fattr-&gt;<a class="code" href="structfattr4.html#ad00a59e5833c61e864df84d690d4a148">attrmask</a>), &amp;attrmasklen, attrmasklist);
<a name="l03423"></a>03423 
<a name="l03424"></a>03424   <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>,
<a name="l03425"></a>03425                <span class="stringliteral">&quot;   nfs4_bitmap4_to_list ====&gt; attrmasklen = %d&quot;</span>, attrmasklen);
<a name="l03426"></a>03426 
<a name="l03427"></a>03427   <span class="comment">/* Init */</span>
<a name="l03428"></a>03428   pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a> = 0;
<a name="l03429"></a>03429 
<a name="l03430"></a>03430   <span class="keywordflow">for</span>(i = 0; i &lt; attrmasklen; i++)
<a name="l03431"></a>03431     {
<a name="l03432"></a>03432       attribute_to_set = attrmasklist[i];
<a name="l03433"></a>03433 
<a name="l03434"></a>03434 <span class="preprocessor">#ifdef _USE_NFS4_1</span>
<a name="l03435"></a>03435 <span class="preprocessor"></span>      <span class="keywordflow">if</span>(attrmasklist[i] &gt; <a class="code" href="nfsv41_8h.html#a62ba6055240092585b0d600502b5031b">FATTR4_FS_CHARSET_CAP</a>)
<a name="l03436"></a>03436 <span class="preprocessor">#else</span>
<a name="l03437"></a>03437 <span class="preprocessor"></span>      <span class="keywordflow">if</span>(attrmasklist[i] &gt; <a class="code" href="nfsv40_8h.html#aee5e5c06f383e00c90378fabc96deaee">FATTR4_MOUNTED_ON_FILEID</a>)
<a name="l03438"></a>03438 <span class="preprocessor">#endif</span>
<a name="l03439"></a>03439 <span class="preprocessor"></span>        {
<a name="l03440"></a>03440           <span class="comment">/* Erroneous value... skip */</span>
<a name="l03441"></a>03441           <span class="keywordflow">continue</span>;
<a name="l03442"></a>03442         }
<a name="l03443"></a>03443       <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>,
<a name="l03444"></a>03444                    <span class="stringliteral">&quot;=================&gt; nfs4_Fattr_To_FSAL_attr: i=%u attr=%u&quot;</span>, i,
<a name="l03445"></a>03445                    attrmasklist[i]);
<a name="l03446"></a>03446       <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>,
<a name="l03447"></a>03447                    <span class="stringliteral">&quot;Flag for Operation = %d|%d is ON,  name  = %s  reply_size = %d&quot;</span>,
<a name="l03448"></a>03448                    attrmasklist[i], fattr4tab[attribute_to_set].val,
<a name="l03449"></a>03449                    fattr4tab[attribute_to_set].name,
<a name="l03450"></a>03450                    fattr4tab[attribute_to_set].size_fattr4);
<a name="l03451"></a>03451 
<a name="l03452"></a>03452       <span class="keywordflow">switch</span> (attribute_to_set)
<a name="l03453"></a>03453         {
<a name="l03454"></a>03454         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#abb174f647b2425ed9d75aca5067395b8">FATTR4_TYPE</a>:
<a name="l03455"></a>03455           memcpy((<span class="keywordtype">char</span> *)&amp;attr_type,
<a name="l03456"></a>03456                  (<span class="keywordtype">char</span> *)(Fattr-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a> + LastOffset),
<a name="l03457"></a>03457                  <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#a3a7fa6581b5a2a9e178e185038cf3040">fattr4_type</a>));
<a name="l03458"></a>03458 
<a name="l03459"></a>03459           <span class="keywordflow">switch</span> (ntohl(attr_type))
<a name="l03460"></a>03460             {
<a name="l03461"></a>03461             <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a3a7fa6581b5a2a9e178e185038cf3040a239da84394e28d87d64fe16c4e741434">NF4REG</a>:
<a name="l03462"></a>03462               pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a03249aca39ba1b16b4712079d93b025e">type</a> = <a class="code" href="fsal__types_8h.html#a368aa63441663f9326d0201857bfcea3afb0cf0224b4c4d6adaec28b1f3d65400">FSAL_TYPE_FILE</a>;
<a name="l03463"></a>03463               <span class="keywordflow">break</span>;
<a name="l03464"></a>03464 
<a name="l03465"></a>03465             <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a3a7fa6581b5a2a9e178e185038cf3040abe9a491648d379ed4349c4e14d05d861">NF4DIR</a>:
<a name="l03466"></a>03466               pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a03249aca39ba1b16b4712079d93b025e">type</a> = <a class="code" href="fsal__types_8h.html#a368aa63441663f9326d0201857bfcea3a302bac21d091a1f3fc1ef5adb50661c3">FSAL_TYPE_DIR</a>;
<a name="l03467"></a>03467               <span class="keywordflow">break</span>;
<a name="l03468"></a>03468 
<a name="l03469"></a>03469             <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a3a7fa6581b5a2a9e178e185038cf3040a0e92ad6f7172abbf39e3d99ef8258194">NF4BLK</a>:
<a name="l03470"></a>03470               pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a03249aca39ba1b16b4712079d93b025e">type</a> = <a class="code" href="fsal__types_8h.html#a368aa63441663f9326d0201857bfcea3a4889072a63eda04f5c8d92a5a5bc04cd">FSAL_TYPE_BLK</a>;
<a name="l03471"></a>03471               <span class="keywordflow">break</span>;
<a name="l03472"></a>03472 
<a name="l03473"></a>03473             <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a3a7fa6581b5a2a9e178e185038cf3040a52df39a7dc886e01f1ba2e7c99d3f338">NF4CHR</a>:
<a name="l03474"></a>03474               pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a03249aca39ba1b16b4712079d93b025e">type</a> = <a class="code" href="fsal__types_8h.html#a368aa63441663f9326d0201857bfcea3ab2cc09e4ad4298e2b0238df7ebc18adc">FSAL_TYPE_CHR</a>;
<a name="l03475"></a>03475               <span class="keywordflow">break</span>;
<a name="l03476"></a>03476 
<a name="l03477"></a>03477             <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a3a7fa6581b5a2a9e178e185038cf3040ad1f9845817c5d9550779312950d1ac67">NF4LNK</a>:
<a name="l03478"></a>03478               pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a03249aca39ba1b16b4712079d93b025e">type</a> = <a class="code" href="fsal__types_8h.html#a368aa63441663f9326d0201857bfcea3adca35a94946e3fba05a201e70f98c3a8">FSAL_TYPE_LNK</a>;
<a name="l03479"></a>03479               <span class="keywordflow">break</span>;
<a name="l03480"></a>03480 
<a name="l03481"></a>03481             <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a3a7fa6581b5a2a9e178e185038cf3040ae57442409563dc4eaeda9b850095bccc">NF4SOCK</a>:
<a name="l03482"></a>03482               pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a03249aca39ba1b16b4712079d93b025e">type</a> = <a class="code" href="fsal__types_8h.html#a368aa63441663f9326d0201857bfcea3a832898ed571b62a052b344b6c3460b44">FSAL_TYPE_SOCK</a>;
<a name="l03483"></a>03483               <span class="keywordflow">break</span>;
<a name="l03484"></a>03484 
<a name="l03485"></a>03485             <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a3a7fa6581b5a2a9e178e185038cf3040a461211a15e43a30ad62f3d28ab9c1c87">NF4FIFO</a>:
<a name="l03486"></a>03486               pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a03249aca39ba1b16b4712079d93b025e">type</a> = <a class="code" href="fsal__types_8h.html#a368aa63441663f9326d0201857bfcea3a162623715e400bfeb41be0a079f9856e">FSAL_TYPE_FIFO</a>;
<a name="l03487"></a>03487               <span class="keywordflow">break</span>;
<a name="l03488"></a>03488 
<a name="l03489"></a>03489             <span class="keywordflow">default</span>:
<a name="l03490"></a>03490               <span class="comment">/* For wanting of a better solution */</span>
<a name="l03491"></a>03491               <span class="keywordflow">return</span> <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aa8b3ae93b91753fe76b2d4ea5f613e34e">NFS4ERR_BADXDR</a>;
<a name="l03492"></a>03492             }                   <span class="comment">/* switch( pattr-&gt;type ) */</span>
<a name="l03493"></a>03493 
<a name="l03494"></a>03494           pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a> |= <a class="code" href="fsal__types_8h.html#aa8043bacec09f83fc424e2cbc638a896">FSAL_ATTR_TYPE</a>;
<a name="l03495"></a>03495           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l03496"></a>03496           <span class="keywordflow">break</span>;
<a name="l03497"></a>03497 
<a name="l03498"></a>03498         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a12bda16e66cebbcd45fab2cae6b42667">FATTR4_FILEID</a>:
<a name="l03499"></a>03499           <span class="comment">/* The analog to the inode number. RFC3530 says &quot;a number uniquely identifying the file within the filesystem&quot;</span>
<a name="l03500"></a>03500 <span class="comment">           * I use hpss_GetObjId to extract this information from the Name Server&#39;s handle */</span>
<a name="l03501"></a>03501           memcpy((<span class="keywordtype">char</span> *)&amp;attr_fileid,
<a name="l03502"></a>03502                  (<span class="keywordtype">char</span> *)(Fattr-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a> + LastOffset),
<a name="l03503"></a>03503                  <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#a439aa2213ecdeca95541878dbac665ce">fattr4_fileid</a>));
<a name="l03504"></a>03504           pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a657a3efbc26891ced4b16f48791452c3">fileid</a> = <a class="code" href="group__NFSprocs.html#ga87865063f614e91e712203f47c423cb6">nfs_ntohl64</a>(attr_fileid);
<a name="l03505"></a>03505 
<a name="l03506"></a>03506           pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a> |= <a class="code" href="fsal__types_8h.html#a2bccbc89b989f052b1778db8081831f2">FSAL_ATTR_FILEID</a>;
<a name="l03507"></a>03507           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l03508"></a>03508 
<a name="l03509"></a>03509           <span class="keywordflow">break</span>;
<a name="l03510"></a>03510 
<a name="l03511"></a>03511         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a8aafd7594d6a927a537b9d61e7cb2cb6">FATTR4_FSID</a>:
<a name="l03512"></a>03512           memcpy((<span class="keywordtype">char</span> *)&amp;attr_fsid,
<a name="l03513"></a>03513                  (<span class="keywordtype">char</span> *)(Fattr-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a> + LastOffset),
<a name="l03514"></a>03514                  <span class="keyword">sizeof</span>(<a class="code" href="structfsid4.html">fattr4_fsid</a>));
<a name="l03515"></a>03515           pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7bd59b524b1e1f2c49a8f71229d0649a">fsid</a>.<a class="code" href="structfsal__fsid____.html#a86fa6b41da5905b04e531bd530c1573c">major</a> = <a class="code" href="group__NFSprocs.html#ga87865063f614e91e712203f47c423cb6">nfs_ntohl64</a>(attr_fsid.major);
<a name="l03516"></a>03516           pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7bd59b524b1e1f2c49a8f71229d0649a">fsid</a>.<a class="code" href="structfsal__fsid____.html#a4af3ec4bf793f168471987221d477130">minor</a> = <a class="code" href="group__NFSprocs.html#ga87865063f614e91e712203f47c423cb6">nfs_ntohl64</a>(attr_fsid.minor);
<a name="l03517"></a>03517 
<a name="l03518"></a>03518           pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a> |= <a class="code" href="fsal__types_8h.html#af10789529b464358c687fcf21cc46ba7">FSAL_ATTR_FSID</a>;
<a name="l03519"></a>03519           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l03520"></a>03520 
<a name="l03521"></a>03521           <span class="keywordflow">break</span>;
<a name="l03522"></a>03522 
<a name="l03523"></a>03523         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#afa964dbe7c4a85d4fa8801059fa83bdc">FATTR4_NUMLINKS</a>:
<a name="l03524"></a>03524           memcpy((<span class="keywordtype">char</span> *)&amp;attr_numlinks,
<a name="l03525"></a>03525                  (<span class="keywordtype">char</span> *)(Fattr-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a> + LastOffset),
<a name="l03526"></a>03526                  <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#a5dcff0ef8b51f21c45fff7847ebb9458">fattr4_numlinks</a>));
<a name="l03527"></a>03527           pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a3ed4337021700c7a893c23668d6c0f33">numlinks</a> = ntohl(attr_numlinks);
<a name="l03528"></a>03528 
<a name="l03529"></a>03529           pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a> |= <a class="code" href="fsal__types_8h.html#adc202dcb83bbb21a80346a73bcdde62a">FSAL_ATTR_NUMLINKS</a>;
<a name="l03530"></a>03530           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l03531"></a>03531 
<a name="l03532"></a>03532           <span class="keywordflow">break</span>;
<a name="l03533"></a>03533 
<a name="l03534"></a>03534         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a08162b3359ba8b437d89090e76f9f079">FATTR4_SIZE</a>:
<a name="l03535"></a>03535           memcpy((<span class="keywordtype">char</span> *)&amp;attr_size,
<a name="l03536"></a>03536                  (<span class="keywordtype">char</span> *)(Fattr-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a> + LastOffset),
<a name="l03537"></a>03537                  <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#ae000375dc5e2bf5948e198baef0f6060">fattr4_size</a>));
<a name="l03538"></a>03538 
<a name="l03539"></a>03539           <span class="comment">/* Do not forget the XDR marshalling for the fattr4 stuff */</span>
<a name="l03540"></a>03540           pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a0105c962cf3b7c8d11e2e2d1c5acff31">filesize</a> = <a class="code" href="group__NFSprocs.html#ga87865063f614e91e712203f47c423cb6">nfs_ntohl64</a>(attr_size);
<a name="l03541"></a>03541 
<a name="l03542"></a>03542           pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a> |= <a class="code" href="fsal__types_8h.html#a5859dca54adcb7dfed89e82ec0e265b6">FSAL_ATTR_SIZE</a>;
<a name="l03543"></a>03543           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l03544"></a>03544           <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>,
<a name="l03545"></a>03545                        <span class="stringliteral">&quot;      SATTR: size seen %zu&quot;</span>, (<span class="keywordtype">size_t</span>)pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a0105c962cf3b7c8d11e2e2d1c5acff31">filesize</a>);
<a name="l03546"></a>03546           <span class="keywordflow">break</span>;
<a name="l03547"></a>03547 
<a name="l03548"></a>03548         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a0ba8d7c6edcd31a2eb08bc084550e31c">FATTR4_MODE</a>:
<a name="l03549"></a>03549           memcpy((<span class="keywordtype">char</span> *)&amp;(pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a6611fe8fc39ff41d2c21d194213322e7">mode</a>),
<a name="l03550"></a>03550                  (<span class="keywordtype">char</span> *)(Fattr-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a> + LastOffset),
<a name="l03551"></a>03551                  <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#a2e828d4ef9dbc26b02c1d7bdd134f75a">fattr4_mode</a>));
<a name="l03552"></a>03552 
<a name="l03553"></a>03553           <span class="comment">/* Do not forget the XDR marshalling for the fattr4 stuff */</span>
<a name="l03554"></a>03554           pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a6611fe8fc39ff41d2c21d194213322e7">mode</a> = ntohl(pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a6611fe8fc39ff41d2c21d194213322e7">mode</a>);
<a name="l03555"></a>03555 
<a name="l03556"></a>03556           pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a> |= <a class="code" href="fsal__types_8h.html#aa94f1053d0de1f0e5a0706d640cf300e">FSAL_ATTR_MODE</a>;
<a name="l03557"></a>03557           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l03558"></a>03558           <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>,
<a name="l03559"></a>03559                        <span class="stringliteral">&quot;      SATTR: We see the mode 0%o&quot;</span>, pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a6611fe8fc39ff41d2c21d194213322e7">mode</a>);
<a name="l03560"></a>03560           <span class="keywordflow">break</span>;
<a name="l03561"></a>03561 
<a name="l03562"></a>03562         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a1b417fc85e29777886744df6709723ef">FATTR4_OWNER</a>:
<a name="l03563"></a>03563           memcpy(&amp;len, (<span class="keywordtype">char</span> *)(Fattr-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a> + LastOffset),
<a name="l03564"></a>03564                  <span class="keyword">sizeof</span>(u_int));
<a name="l03565"></a>03565           len = ntohl(len);     <span class="comment">/* xdr marshalling on fattr4 */</span>
<a name="l03566"></a>03566           LastOffset += <span class="keyword">sizeof</span>(u_int);
<a name="l03567"></a>03567 
<a name="l03568"></a>03568           memcpy(buffer, (<span class="keywordtype">char</span> *)(Fattr-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a> + LastOffset), len);
<a name="l03569"></a>03569           buffer[len] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l03570"></a>03570 
<a name="l03571"></a>03571           <span class="comment">/* Do not forget that xdr_opaque are aligned on 32bit long words */</span>
<a name="l03572"></a>03572           <span class="keywordflow">while</span>((len % 4) != 0)
<a name="l03573"></a>03573             len += 1;
<a name="l03574"></a>03574 
<a name="l03575"></a>03575           LastOffset += len;
<a name="l03576"></a>03576 
<a name="l03577"></a>03577           utf8buffer.<a class="code" href="structutf8string.html#a72e3ba7aecf5547219953542a1c32271">utf8string_val</a> = buffer;
<a name="l03578"></a>03578           utf8buffer.<a class="code" href="structutf8string.html#ab651a802af8217014ea648e43ac79b6f">utf8string_len</a> = strlen(buffer);
<a name="l03579"></a>03579 
<a name="l03580"></a>03580           <a class="code" href="group__NFSprocs.html#ga07a4b947f034d31f244415e9183ab523">utf82uid</a>(&amp;utf8buffer, &amp;(pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a89670e3e52193381c240c0b7d93d6aa6">owner</a>));
<a name="l03581"></a>03581           pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a> |= <a class="code" href="fsal__types_8h.html#ac8af49f265b9c157cf8d27e156086e07">FSAL_ATTR_OWNER</a>;
<a name="l03582"></a>03582 
<a name="l03583"></a>03583           <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>,
<a name="l03584"></a>03584                        <span class="stringliteral">&quot;      SATTR: We see the owner %s len = %d&quot;</span>, buffer, len);
<a name="l03585"></a>03585           <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>,
<a name="l03586"></a>03586                        <span class="stringliteral">&quot;      SATTR: We see the owner %d&quot;</span>, pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a89670e3e52193381c240c0b7d93d6aa6">owner</a>);
<a name="l03587"></a>03587           <span class="keywordflow">break</span>;
<a name="l03588"></a>03588 
<a name="l03589"></a>03589         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#ab2edd15bdc0df70213cb86ac63ca80d3">FATTR4_OWNER_GROUP</a>:
<a name="l03590"></a>03590           memcpy(&amp;len, (<span class="keywordtype">char</span> *)(Fattr-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a> + LastOffset),
<a name="l03591"></a>03591                  <span class="keyword">sizeof</span>(u_int));
<a name="l03592"></a>03592           len = ntohl(len);
<a name="l03593"></a>03593           LastOffset += <span class="keyword">sizeof</span>(u_int);
<a name="l03594"></a>03594 
<a name="l03595"></a>03595           memcpy(buffer, (<span class="keywordtype">char</span> *)(Fattr-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a> + LastOffset), len);
<a name="l03596"></a>03596           buffer[len] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l03597"></a>03597 
<a name="l03598"></a>03598           <span class="comment">/* Do not forget that xdr_opaque are aligned on 32bit long words */</span>
<a name="l03599"></a>03599           <span class="keywordflow">while</span>((len % 4) != 0)
<a name="l03600"></a>03600             len += 1;
<a name="l03601"></a>03601 
<a name="l03602"></a>03602           LastOffset += len;
<a name="l03603"></a>03603 
<a name="l03604"></a>03604           utf8buffer.<a class="code" href="structutf8string.html#a72e3ba7aecf5547219953542a1c32271">utf8string_val</a> = buffer;
<a name="l03605"></a>03605           utf8buffer.<a class="code" href="structutf8string.html#ab651a802af8217014ea648e43ac79b6f">utf8string_len</a> = strlen(buffer);
<a name="l03606"></a>03606 
<a name="l03607"></a>03607           <a class="code" href="group__NFSprocs.html#ga8ca153cdef0f9a18cd8b7c83e525867a">utf82gid</a>(&amp;utf8buffer, &amp;(pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e4622af711f91b5f598fce5e0bee9fa">group</a>));
<a name="l03608"></a>03608           pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a> |= <a class="code" href="fsal__types_8h.html#a36d30893495819b31377203edbcb91cf">FSAL_ATTR_GROUP</a>;
<a name="l03609"></a>03609 
<a name="l03610"></a>03610           <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>,
<a name="l03611"></a>03611                        <span class="stringliteral">&quot;      SATTR: We see the owner_group %s len = %d&quot;</span>, buffer, len);
<a name="l03612"></a>03612           <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>,
<a name="l03613"></a>03613                        <span class="stringliteral">&quot;      SATTR: We see the owner_group %d&quot;</span>, pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e4622af711f91b5f598fce5e0bee9fa">group</a>);
<a name="l03614"></a>03614           <span class="keywordflow">break</span>;
<a name="l03615"></a>03615 
<a name="l03616"></a>03616         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a8691d62fc300ed27650afc28f7b3da15">FATTR4_CHANGE</a>:
<a name="l03617"></a>03617           memcpy((<span class="keywordtype">char</span> *)&amp;attr_change,
<a name="l03618"></a>03618                  (<span class="keywordtype">char</span> *)(Fattr-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a> + LastOffset),
<a name="l03619"></a>03619                  <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#a71ffc916e5afbba5e732c8ebfd0f93f1">fattr4_change</a>));
<a name="l03620"></a>03620           pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7a45f08cab3e7b75d23099f913e1b219">chgtime</a>.<a class="code" href="structfsal__time____.html#add92ec6180384f0ba10dd2a79b659548">seconds</a> = (<a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>) <a class="code" href="group__NFSprocs.html#ga87865063f614e91e712203f47c423cb6">nfs_ntohl64</a>(attr_change);
<a name="l03621"></a>03621           pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7a45f08cab3e7b75d23099f913e1b219">chgtime</a>.<a class="code" href="structfsal__time____.html#a9c41918d2f2ea4627205dd4c2e347373">nseconds</a> = 0;
<a name="l03622"></a>03622 
<a name="l03623"></a>03623           pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#abc5d6b31965022a13adbd1e85b3faf67">change</a> =  <a class="code" href="group__NFSprocs.html#ga87865063f614e91e712203f47c423cb6">nfs_ntohl64</a>(attr_change);
<a name="l03624"></a>03624 
<a name="l03625"></a>03625           pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a> |= <a class="code" href="fsal__types_8h.html#a9fa6f5c9e02806fe1f7b18ab5c1e6f58">FSAL_ATTR_CHGTIME</a>;
<a name="l03626"></a>03626           pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a> |= <a class="code" href="fsal__types_8h.html#a73c23eb29f7b2e389be3c40cc1b3d3e6">FSAL_ATTR_CHANGE</a>;
<a name="l03627"></a>03627           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l03628"></a>03628 
<a name="l03629"></a>03629           <span class="keywordflow">break</span>;
<a name="l03630"></a>03630 
<a name="l03631"></a>03631         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a89b12b6e52be105460ff2922ed361595">FATTR4_RAWDEV</a>:
<a name="l03632"></a>03632           memcpy((<span class="keywordtype">char</span> *)&amp;attr_rawdev,
<a name="l03633"></a>03633                  (<span class="keywordtype">char</span> *)(Fattr-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a> + LastOffset),
<a name="l03634"></a>03634                  <span class="keyword">sizeof</span>(<a class="code" href="structspecdata4.html">fattr4_rawdev</a>));
<a name="l03635"></a>03635           pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#ae500abbe897ddad0af25160793468ae1">rawdev</a>.<a class="code" href="structfsal__dev____.html#af03e5fde9bbeec4835a2dbdbcdbad11b">major</a> = (<a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>) <a class="code" href="group__NFSprocs.html#ga87865063f614e91e712203f47c423cb6">nfs_ntohl64</a>(attr_rawdev.specdata1);
<a name="l03636"></a>03636           pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#ae500abbe897ddad0af25160793468ae1">rawdev</a>.<a class="code" href="structfsal__dev____.html#a922b8f1c6709b21a6f6af2bdeb8f0dd5">minor</a> = (<a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>) <a class="code" href="group__NFSprocs.html#ga87865063f614e91e712203f47c423cb6">nfs_ntohl64</a>(attr_rawdev.specdata2);
<a name="l03637"></a>03637 
<a name="l03638"></a>03638           pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a> |= <a class="code" href="fsal__types_8h.html#a40289b986531e7ab8635d1ba52244dee">FSAL_ATTR_RAWDEV</a>;
<a name="l03639"></a>03639           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l03640"></a>03640 
<a name="l03641"></a>03641           <span class="keywordflow">break</span>;
<a name="l03642"></a>03642 
<a name="l03643"></a>03643         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#ab9058684dd550c9561b6928d58f00026">FATTR4_SPACE_USED</a>:
<a name="l03644"></a>03644           memcpy((<span class="keywordtype">char</span> *)&amp;attr_space_used,
<a name="l03645"></a>03645                  (<span class="keywordtype">char</span> *)(Fattr-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a> + LastOffset),
<a name="l03646"></a>03646                  <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#ae058190bc78422118c9fe20cb0b2872d">fattr4_space_used</a>));
<a name="l03647"></a>03647           pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a98bcdb72020b255bbe3355f9fc4c6a74">spaceused</a> = (<a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>) <a class="code" href="group__NFSprocs.html#ga87865063f614e91e712203f47c423cb6">nfs_ntohl64</a>(attr_space_used);
<a name="l03648"></a>03648 
<a name="l03649"></a>03649           pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a> |= <a class="code" href="fsal__types_8h.html#a00384f412d9747624a5eb9caf5ac38cd">FSAL_ATTR_SPACEUSED</a>;
<a name="l03650"></a>03650           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l03651"></a>03651 
<a name="l03652"></a>03652           <span class="keywordflow">break</span>;
<a name="l03653"></a>03653 
<a name="l03654"></a>03654         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#ad74f48a420926a335bc6bb75e431ddb4">FATTR4_TIME_ACCESS</a>:       <span class="comment">/* Used only by FSAL_PROXY to reverse convert */</span>
<a name="l03655"></a>03655           LastOffset += nfstime4_to_fsal_time(&amp;pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a48293ea65b5bb7282d4421ad079f056f">atime</a>, 
<a name="l03656"></a>03656                                               (<span class="keywordtype">char</span> *)(Fattr-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a> + LastOffset));
<a name="l03657"></a>03657           pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a> |= <a class="code" href="fsal__types_8h.html#aa809a24aeeb4b580487163fea39856a1">FSAL_ATTR_ATIME</a>;
<a name="l03658"></a>03658           <span class="keywordflow">break</span>;
<a name="l03659"></a>03659 
<a name="l03660"></a>03660         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a13c0c2b7994641285fe8cc9e130c91f3">FATTR4_TIME_METADATA</a>:     <span class="comment">/* Used only by FSAL_PROXY to reverse convert */</span>
<a name="l03661"></a>03661           LastOffset += nfstime4_to_fsal_time(&amp;pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7087852b901550fbbc6ba2aed12c96ef">ctime</a>, 
<a name="l03662"></a>03662                                               (<span class="keywordtype">char</span> *)(Fattr-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a> + LastOffset));
<a name="l03663"></a>03663           pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a> |= <a class="code" href="fsal__types_8h.html#a12ba97e931b1f15cd91ff6d1fd88b3c7">FSAL_ATTR_CTIME</a>;
<a name="l03664"></a>03664           <span class="keywordflow">break</span>;
<a name="l03665"></a>03665 
<a name="l03666"></a>03666         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#aca636cf87f02044b79a6911207579f7d">FATTR4_TIME_MODIFY</a>:       <span class="comment">/* Used only by FSAL_PROXY to reverse convert */</span>
<a name="l03667"></a>03667           LastOffset += nfstime4_to_fsal_time(&amp;pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a441daefe7cc86152355f895d81bc2936">mtime</a>, 
<a name="l03668"></a>03668                                               (<span class="keywordtype">char</span> *)(Fattr-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a> + LastOffset));
<a name="l03669"></a>03669           pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a> |= <a class="code" href="fsal__types_8h.html#a9831a00094624d8747ecbf71c1560e8d">FSAL_ATTR_MTIME</a>;
<a name="l03670"></a>03670           <span class="keywordflow">break</span>;
<a name="l03671"></a>03671 
<a name="l03672"></a>03672         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a402863c5613762a8d4971acaa7a9d991">FATTR4_TIME_ACCESS_SET</a>:
<a name="l03673"></a>03673           LastOffset += settime4_to_fsal_time(&amp;pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a48293ea65b5bb7282d4421ad079f056f">atime</a>,
<a name="l03674"></a>03674                                               Fattr-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a> + LastOffset);
<a name="l03675"></a>03675           pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a> |= <a class="code" href="fsal__types_8h.html#aa809a24aeeb4b580487163fea39856a1">FSAL_ATTR_ATIME</a>;
<a name="l03676"></a>03676           <span class="keywordflow">break</span>;
<a name="l03677"></a>03677 
<a name="l03678"></a>03678         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a9d41d38182a69e76e8a51f3e99d4a232">FATTR4_TIME_MODIFY_SET</a>:
<a name="l03679"></a>03679           LastOffset += settime4_to_fsal_time(&amp;pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a441daefe7cc86152355f895d81bc2936">mtime</a>,
<a name="l03680"></a>03680                                               Fattr-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a> + LastOffset);
<a name="l03681"></a>03681           pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a> |= <a class="code" href="fsal__types_8h.html#a9831a00094624d8747ecbf71c1560e8d">FSAL_ATTR_MTIME</a>;
<a name="l03682"></a>03682 
<a name="l03683"></a>03683           <span class="keywordflow">break</span>;
<a name="l03684"></a>03684 
<a name="l03685"></a>03685         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a1e31fb57ae65cd90ba2b2bd203a81c08">FATTR4_FILEHANDLE</a>:
<a name="l03686"></a>03686           memcpy(&amp;len, (<span class="keywordtype">char</span> *)(Fattr-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a> + LastOffset),
<a name="l03687"></a>03687                  <span class="keyword">sizeof</span>(u_int));
<a name="l03688"></a>03688           len = ntohl(len);
<a name="l03689"></a>03689           LastOffset += <span class="keyword">sizeof</span>(u_int);
<a name="l03690"></a>03690           <span class="keywordflow">if</span>(hdl4)
<a name="l03691"></a>03691             {
<a name="l03692"></a>03692                hdl4-&gt;<a class="code" href="structnfs__fh4.html#a16f1d8d3eb38d12060bef0045f062f16">nfs_fh4_len</a> = len;
<a name="l03693"></a>03693                hdl4-&gt;<a class="code" href="structnfs__fh4.html#a1bac9f2eb01597339d8c037776010a09">nfs_fh4_val</a> = Fattr-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a> + LastOffset;
<a name="l03694"></a>03694             }
<a name="l03695"></a>03695           LastOffset += len;
<a name="l03696"></a>03696           <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>,
<a name="l03697"></a>03697                        <span class="stringliteral">&quot;     SATTR: On a demande le filehandle len =%u&quot;</span>, len);
<a name="l03698"></a>03698           <span class="keywordflow">break</span>;
<a name="l03699"></a>03699 
<a name="l03700"></a>03700         <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a8bd8eefcde07a750a41d0fe967427619">FATTR4_RDATTR_ERROR</a>:
<a name="l03701"></a>03701           memcpy((<span class="keywordtype">char</span> *)&amp;rdattr_error,
<a name="l03702"></a>03702                  (<span class="keywordtype">char</span> *)(Fattr-&gt;<a class="code" href="structfattr4.html#aaec7d166bce03e6cf76ce9d06f88540e">attr_vals</a>.<a class="code" href="structattrlist4.html#a981874587cb53b5389a5557b436eb280">attrlist4_val</a> + LastOffset),
<a name="l03703"></a>03703                  <span class="keyword">sizeof</span>(<a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0a">fattr4_rdattr_error</a>));
<a name="l03704"></a>03704           rdattr_error = ntohl(rdattr_error);
<a name="l03705"></a>03705           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l03706"></a>03706 
<a name="l03707"></a>03707           <span class="keywordflow">break</span>;
<a name="l03708"></a>03708 
<a name="l03709"></a>03709 <span class="preprocessor">#ifdef _USE_NFS4_ACL</span>
<a name="l03710"></a>03710 <span class="preprocessor"></span>        <span class="keywordflow">case</span> <a class="code" href="nfsv40_8h.html#a6d36bb670468c89070ab7f9c08ec940d">FATTR4_ACL</a>:
<a name="l03711"></a>03711           <span class="keywordflow">if</span>((rc = nfs4_decode_acl(pFSAL_attr, Fattr, &amp;LastOffset)) != <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aacaca462c793854dd61337cf0b54fc166">NFS4_OK</a>)
<a name="l03712"></a>03712             <span class="keywordflow">return</span> rc;
<a name="l03713"></a>03713 
<a name="l03714"></a>03714           pFSAL_attr-&gt;<a class="code" href="structfsal__attrib__list____.html#a7e26fea079dd3c9bb56a2426805765b9">asked_attributes</a> |= <a class="code" href="fsal__types_8h.html#a5e36114afd44dec28252c289255ff1e5">FSAL_ATTR_ACL</a>;
<a name="l03715"></a>03715           <span class="keywordflow">break</span>;
<a name="l03716"></a>03716 <span class="preprocessor">#endif                          </span><span class="comment">/* _USE_NFS4_ACL */</span>
<a name="l03717"></a>03717 
<a name="l03718"></a>03718         <span class="keywordflow">default</span>:
<a name="l03719"></a>03719           <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>,
<a name="l03720"></a>03720                        <span class="stringliteral">&quot;      SATTR: Attribut no supporte %d name=%s&quot;</span>,
<a name="l03721"></a>03721                        attribute_to_set, fattr4tab[attribute_to_set].name);
<a name="l03722"></a>03722           LastOffset += fattr4tab[attribute_to_set].size_fattr4;
<a name="l03723"></a>03723           <span class="comment">/* return NFS4ERR_ATTRNOTSUPP ; */</span><span class="comment">/* Should not stop processing */</span>
<a name="l03724"></a>03724           <span class="keywordflow">break</span>;
<a name="l03725"></a>03725         }                       <span class="comment">/* switch */</span>
<a name="l03726"></a>03726     }                           <span class="comment">/* for */</span>
<a name="l03727"></a>03727 
<a name="l03728"></a>03728   <span class="keywordflow">return</span> <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aacaca462c793854dd61337cf0b54fc166">NFS4_OK</a>;
<a name="l03729"></a>03729 }                               <span class="comment">/* Fattr4_To_FSAL_attr */</span>
<a name="l03730"></a>03730 
<a name="l03743"></a><a class="code" href="group__NFSprocs.html#ga8b54bf391e00340caa68d83ef94d833b">03743</a> <span class="keywordtype">int</span> <a class="code" href="group__NFSprocs.html#ga8b54bf391e00340caa68d83ef94d833b">nfs4_Fattr_To_FSAL_attr</a>(<a class="code" href="structfsal__attrib__list____.html">fsal_attrib_list_t</a> * pFSAL_attr, <a class="code" href="structfattr4.html">fattr4</a> * Fattr)
<a name="l03744"></a>03744 {
<a name="l03745"></a>03745   <span class="keywordflow">return</span> <a class="code" href="group__NFSprocs.html#ga8d3ad44058a0f0979e22553326404a77">Fattr4_To_FSAL_attr</a>(pFSAL_attr, Fattr, <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l03746"></a>03746 }
<a name="l03747"></a>03747 
<a name="l03748"></a>03748 <span class="comment">/* Error conversion routines */</span>
<a name="l03760"></a><a class="code" href="group__NFSprocs.html#gae5dbdad76b79459bab895e61f800278d">03760</a> <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0a">nfsstat4</a> <a class="code" href="group__NFSprocs.html#gae5dbdad76b79459bab895e61f800278d">nfs4_Errno</a>(<a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2">cache_inode_status_t</a> <a class="code" href="subr_8c.html#a1f2a342148fd3d57e387199914dd94c8">error</a>)
<a name="l03761"></a>03761 {
<a name="l03762"></a>03762   <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0a">nfsstat4</a> nfserror= <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aacd5ac22a1fa5139d3566ed06c20d9c7a">NFS4ERR_INVAL</a>;
<a name="l03763"></a>03763 
<a name="l03764"></a>03764   <span class="keywordflow">switch</span> (error)
<a name="l03765"></a>03765     {
<a name="l03766"></a>03766     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a3fdbbb2367268ae84ac11d7b189643d8">CACHE_INODE_SUCCESS</a>:
<a name="l03767"></a>03767       nfserror = <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aacaca462c793854dd61337cf0b54fc166">NFS4_OK</a>;
<a name="l03768"></a>03768       <span class="keywordflow">break</span>;
<a name="l03769"></a>03769 
<a name="l03770"></a>03770     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a1915843665e061f9b874510cc6382bc9">CACHE_INODE_MALLOC_ERROR</a>:
<a name="l03771"></a>03771     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a9cf5e7e7d9af15c56de98d2e3a8528ce">CACHE_INODE_POOL_MUTEX_INIT_ERROR</a>:
<a name="l03772"></a>03772     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a7fce719c38bc7c5184590549d6d659d1">CACHE_INODE_GET_NEW_LRU_ENTRY</a>:
<a name="l03773"></a>03773     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a86613bc3a05ba135756f102393944133">CACHE_INODE_INIT_ENTRY_FAILED</a>:
<a name="l03774"></a>03774     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2ab5b3592038c0b37022a99a7b0c87aa17">CACHE_INODE_CACHE_CONTENT_EXISTS</a>:
<a name="l03775"></a>03775     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2ad76de37772e149413ed754160f118752">CACHE_INODE_CACHE_CONTENT_EMPTY</a>:
<a name="l03776"></a>03776       nfserror = <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aaf8c067759d4fef22cb97409d7a50c453">NFS4ERR_SERVERFAULT</a>;
<a name="l03777"></a>03777       <span class="keywordflow">break</span>;
<a name="l03778"></a>03778 
<a name="l03779"></a>03779     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a1fb3e5d693699c6142279757810ae6c3">CACHE_INODE_UNAPPROPRIATED_KEY</a>:
<a name="l03780"></a>03780       nfserror = <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aad8e75713659423bc53b60934e6b2698f">NFS4ERR_BADHANDLE</a>;
<a name="l03781"></a>03781       <span class="keywordflow">break</span>;
<a name="l03782"></a>03782 
<a name="l03783"></a>03783     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a461c7aae0d7d8861bc61ee7031bf79a9">CACHE_INODE_BAD_TYPE</a>:
<a name="l03784"></a>03784     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a07fdf53f0646a04f877c108ed99c293b">CACHE_INODE_INVALID_ARGUMENT</a>:
<a name="l03785"></a>03785       nfserror = <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aacd5ac22a1fa5139d3566ed06c20d9c7a">NFS4ERR_INVAL</a>;
<a name="l03786"></a>03786       <span class="keywordflow">break</span>;
<a name="l03787"></a>03787 
<a name="l03788"></a>03788     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a31102fd54b8481b29ee40b6a7f692e75">CACHE_INODE_NOT_A_DIRECTORY</a>:
<a name="l03789"></a>03789       nfserror = <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aa45d2f7ac7308153fa3fdedfe1092392e">NFS4ERR_NOTDIR</a>;
<a name="l03790"></a>03790       <span class="keywordflow">break</span>;
<a name="l03791"></a>03791 
<a name="l03792"></a>03792     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2ae81d3dfa51b14e0e0a26bb33b2f46490">CACHE_INODE_ENTRY_EXISTS</a>:
<a name="l03793"></a>03793       nfserror = <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aa3dced8ef9c5084b538a335567ee5d60f">NFS4ERR_EXIST</a>;
<a name="l03794"></a>03794       <span class="keywordflow">break</span>;
<a name="l03795"></a>03795 
<a name="l03796"></a>03796     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2aa13bf3166511315448442f01b9909bfa">CACHE_INODE_DIR_NOT_EMPTY</a>:
<a name="l03797"></a>03797       nfserror = <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aa3c9bc7e099a12ec791239ab664d3be7b">NFS4ERR_NOTEMPTY</a>;
<a name="l03798"></a>03798       <span class="keywordflow">break</span>;
<a name="l03799"></a>03799 
<a name="l03800"></a>03800     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a49bfbcb4177d74986dd63a1c8aaaadfc">CACHE_INODE_NOT_FOUND</a>:
<a name="l03801"></a>03801       nfserror = <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aac491f4a9d0c1cbb7772f30c3270869ee">NFS4ERR_NOENT</a>;
<a name="l03802"></a>03802       <span class="keywordflow">break</span>;
<a name="l03803"></a>03803 
<a name="l03804"></a>03804     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2aa3de98320a1cba72aeeefd31e124712a">CACHE_INODE_FSAL_ERROR</a>:
<a name="l03805"></a>03805     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2af9495df7ccc04c50609ceaf8f81e9c9b">CACHE_INODE_INSERT_ERROR</a>:
<a name="l03806"></a>03806     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a076de8b129f67057d1294bedf7094aed">CACHE_INODE_LRU_ERROR</a>:
<a name="l03807"></a>03807     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2ac1838632304273d612cd61d2ab31a1ce">CACHE_INODE_HASH_SET_ERROR</a>:
<a name="l03808"></a>03808       nfserror = <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aad1967f0ef897d7be1eca8cd3d5c0dd0d">NFS4ERR_IO</a>;
<a name="l03809"></a>03809       <span class="keywordflow">break</span>;
<a name="l03810"></a>03810 
<a name="l03811"></a>03811     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2afa6e4cda579bf50a4cc7efddccab904b">CACHE_INODE_FSAL_EACCESS</a>:
<a name="l03812"></a>03812       nfserror = <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aa7d900635e440025ed74a83e8ab8b595c">NFS4ERR_ACCESS</a>;
<a name="l03813"></a>03813       <span class="keywordflow">break</span>;
<a name="l03814"></a>03814 
<a name="l03815"></a>03815     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2aaf42a5520c80584c436e6577c848fbed">CACHE_INODE_FSAL_EPERM</a>:
<a name="l03816"></a>03816     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2acdd7ce7a12331e8bd87270730d23b298">CACHE_INODE_FSAL_ERR_SEC</a>:
<a name="l03817"></a>03817       nfserror = <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aa9582781082d3764345a96b6b92b5f5f0">NFS4ERR_PERM</a>;
<a name="l03818"></a>03818       <span class="keywordflow">break</span>;
<a name="l03819"></a>03819 
<a name="l03820"></a>03820     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a0b3b3a0e6a65c9f375c366e6d0349852">CACHE_INODE_NO_SPACE_LEFT</a>:
<a name="l03821"></a>03821       nfserror = <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aa518c989e2781b42d4f35c17f0f781492">NFS4ERR_NOSPC</a>;
<a name="l03822"></a>03822       <span class="keywordflow">break</span>;
<a name="l03823"></a>03823 
<a name="l03824"></a>03824     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a3c0860cc76f604bcfc7bc09779d3d06c">CACHE_INODE_IS_A_DIRECTORY</a>:
<a name="l03825"></a>03825       nfserror = <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aa7801063893b30bf5c0b8ebef330a8e51">NFS4ERR_ISDIR</a>;
<a name="l03826"></a>03826       <span class="keywordflow">break</span>;
<a name="l03827"></a>03827 
<a name="l03828"></a>03828     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a2735653dbb65fcae621e042fe40316e3">CACHE_INODE_READ_ONLY_FS</a>:
<a name="l03829"></a>03829       nfserror = <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aa2725e727c6a2ee5d022532eeab104548">NFS4ERR_ROFS</a>;
<a name="l03830"></a>03830       <span class="keywordflow">break</span>;
<a name="l03831"></a>03831 
<a name="l03832"></a>03832     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2acc50439e4e107ce5487e79adfdbf4dc0">CACHE_INODE_IO_ERROR</a>:
<a name="l03833"></a>03833       nfserror = <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aad1967f0ef897d7be1eca8cd3d5c0dd0d">NFS4ERR_IO</a>;
<a name="l03834"></a>03834       <span class="keywordflow">break</span>;
<a name="l03835"></a>03835 
<a name="l03836"></a>03836      <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2aca5633ef3c1b4ca3d7b6c757b33e6cad">CACHE_INODE_NAME_TOO_LONG</a>:
<a name="l03837"></a>03837       nfserror = <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aa3514e6937072eb20f066bbc58992827a">NFS4ERR_NAMETOOLONG</a>;
<a name="l03838"></a>03838       <span class="keywordflow">break</span>;
<a name="l03839"></a>03839 
<a name="l03840"></a>03840     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2ac101705a0ba258752096d3b209a6c588">CACHE_INODE_KILLED</a>:
<a name="l03841"></a>03841     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2ac52f764b2c5c664df1cf11d8751965fb">CACHE_INODE_DEAD_ENTRY</a>:
<a name="l03842"></a>03842     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a753b5e42145f8290242d1990792dbb0d">CACHE_INODE_FSAL_ESTALE</a>:
<a name="l03843"></a>03843       nfserror = <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aae6e007575347505f02ae672942df2ede">NFS4ERR_STALE</a>;
<a name="l03844"></a>03844       <span class="keywordflow">break</span>;
<a name="l03845"></a>03845 
<a name="l03846"></a>03846     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2ad34d88bf1ed87798b4c684a4fa5ac940">CACHE_INODE_STATE_CONFLICT</a>:
<a name="l03847"></a>03847       nfserror = <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aa9582781082d3764345a96b6b92b5f5f0">NFS4ERR_PERM</a>;
<a name="l03848"></a>03848       <span class="keywordflow">break</span>;
<a name="l03849"></a>03849 
<a name="l03850"></a>03850     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2af5c6f8a87057aebc9e59154de348d56a">CACHE_INODE_QUOTA_EXCEEDED</a>:
<a name="l03851"></a>03851       nfserror = <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aa475bfbe3a6a00549be9f46600e87543a">NFS4ERR_DQUOT</a>;
<a name="l03852"></a>03852       <span class="keywordflow">break</span>;
<a name="l03853"></a>03853 
<a name="l03854"></a>03854     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a58fc37d01af497af261b2ee8ce65f137">CACHE_INODE_NOT_SUPPORTED</a>:
<a name="l03855"></a>03855       nfserror = <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aaae5d22fbf253cadddb8915ee5b1ae734">NFS4ERR_NOTSUPP</a>;
<a name="l03856"></a>03856       <span class="keywordflow">break</span>;
<a name="l03857"></a>03857 
<a name="l03858"></a>03858     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a682d21c0f90702d383c9b658e169f534">CACHE_INODE_DELAY</a>:
<a name="l03859"></a>03859       nfserror = <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aa7945565008f84c74ae7f29c51e4010fd">NFS4ERR_DELAY</a>;
<a name="l03860"></a>03860       <span class="keywordflow">break</span>;
<a name="l03861"></a>03861 
<a name="l03862"></a>03862     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a7aa1c02604a27429b69ae2acf7914c37">CACHE_INODE_FILE_BIG</a>:
<a name="l03863"></a>03863       nfserror = <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aa46fa0581b48f6ac3958ae6e64b6f4bde">NFS4ERR_FBIG</a>;
<a name="l03864"></a>03864       <span class="keywordflow">break</span>;
<a name="l03865"></a>03865 
<a name="l03866"></a>03866     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a913f825d5ec21974a3c12eb143b6f5de">CACHE_INODE_FILE_OPEN</a>:
<a name="l03867"></a>03867       nfserror = <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aac6ec49d28f3d1a02e60a140c4e851bab">NFS4ERR_FILE_OPEN</a>;
<a name="l03868"></a>03868       <span class="keywordflow">break</span>;
<a name="l03869"></a>03869 
<a name="l03870"></a>03870     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a30d77d9ece8c0b24f90e6839eba76906">CACHE_INODE_STATE_ERROR</a>:
<a name="l03871"></a>03871       nfserror = <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aa2584acc1c9b91061944c58053608a3fe">NFS4ERR_BAD_STATEID</a>;
<a name="l03872"></a>03872       <span class="keywordflow">break</span>;
<a name="l03873"></a>03873 
<a name="l03874"></a>03874     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2aab32538c7951dae2ab8e045c141cb348">CACHE_INODE_BAD_COOKIE</a>:
<a name="l03875"></a>03875       nfserror = <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aa9df3847c77f73d59d1338b64329d2a28">NFS4ERR_BAD_COOKIE</a>;
<a name="l03876"></a>03876       <span class="keywordflow">break</span>;
<a name="l03877"></a>03877 
<a name="l03878"></a>03878     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a3b4d85140a3d8f501b3e318c82f0d13a">CACHE_INODE_INCONSISTENT_ENTRY</a>:
<a name="l03879"></a>03879     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a37c51c9a4e1098130f3d50e15af58635">CACHE_INODE_HASH_TABLE_ERROR</a>:
<a name="l03880"></a>03880     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a6ea3d914d4fb4de66c7d13f31245a5ac">CACHE_INODE_CACHE_CONTENT_ERROR</a>:
<a name="l03881"></a>03881     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a216876f1f0ed1ec8c7e61969e9e6cbfb">CACHE_INODE_ASYNC_POST_ERROR</a>:
<a name="l03882"></a>03882       <span class="comment">/* Should not occur */</span>
<a name="l03883"></a>03883       nfserror = <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aacd5ac22a1fa5139d3566ed06c20d9c7a">NFS4ERR_INVAL</a>;
<a name="l03884"></a>03884       <span class="keywordflow">break</span>;
<a name="l03885"></a>03885     }
<a name="l03886"></a>03886 
<a name="l03887"></a>03887   <span class="keywordflow">return</span> nfserror;
<a name="l03888"></a>03888 }                               <span class="comment">/* nfs4_Errno */</span>
<a name="l03889"></a>03889 
<a name="l03901"></a><a class="code" href="group__NFSprocs.html#gaa4f9710cdfa7157d9b730110d4cb0621">03901</a> <a class="code" href="nfs23_8h.html#a1721ade9b8e43c719c5834eaaf60aac5">nfsstat3</a> <a class="code" href="group__NFSprocs.html#gaa4f9710cdfa7157d9b730110d4cb0621">nfs3_Errno</a>(<a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2">cache_inode_status_t</a> <a class="code" href="subr_8c.html#a1f2a342148fd3d57e387199914dd94c8">error</a>)
<a name="l03902"></a>03902 {
<a name="l03903"></a>03903   <a class="code" href="nfs23_8h.html#a1721ade9b8e43c719c5834eaaf60aac5">nfsstat3</a> nfserror= <a class="code" href="nfs23_8h.html#a1721ade9b8e43c719c5834eaaf60aac5a170faac3001eb06976ce757ce252c306">NFS3ERR_INVAL</a>;
<a name="l03904"></a>03904 
<a name="l03905"></a>03905   <span class="keywordflow">switch</span> (error)
<a name="l03906"></a>03906     {
<a name="l03907"></a>03907     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a3fdbbb2367268ae84ac11d7b189643d8">CACHE_INODE_SUCCESS</a>:
<a name="l03908"></a>03908       nfserror = <a class="code" href="nfs23_8h.html#a1721ade9b8e43c719c5834eaaf60aac5ae705552b166e565f66540b9412805365">NFS3_OK</a>;
<a name="l03909"></a>03909       <span class="keywordflow">break</span>;
<a name="l03910"></a>03910 
<a name="l03911"></a>03911     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a1915843665e061f9b874510cc6382bc9">CACHE_INODE_MALLOC_ERROR</a>:
<a name="l03912"></a>03912     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a9cf5e7e7d9af15c56de98d2e3a8528ce">CACHE_INODE_POOL_MUTEX_INIT_ERROR</a>:
<a name="l03913"></a>03913     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a7fce719c38bc7c5184590549d6d659d1">CACHE_INODE_GET_NEW_LRU_ENTRY</a>:
<a name="l03914"></a>03914     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a1fb3e5d693699c6142279757810ae6c3">CACHE_INODE_UNAPPROPRIATED_KEY</a>:
<a name="l03915"></a>03915     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a86613bc3a05ba135756f102393944133">CACHE_INODE_INIT_ENTRY_FAILED</a>:
<a name="l03916"></a>03916     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2ab5b3592038c0b37022a99a7b0c87aa17">CACHE_INODE_CACHE_CONTENT_EXISTS</a>:
<a name="l03917"></a>03917     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2ad76de37772e149413ed754160f118752">CACHE_INODE_CACHE_CONTENT_EMPTY</a>:
<a name="l03918"></a>03918     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2af9495df7ccc04c50609ceaf8f81e9c9b">CACHE_INODE_INSERT_ERROR</a>:
<a name="l03919"></a>03919     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a076de8b129f67057d1294bedf7094aed">CACHE_INODE_LRU_ERROR</a>:
<a name="l03920"></a>03920     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2ac1838632304273d612cd61d2ab31a1ce">CACHE_INODE_HASH_SET_ERROR</a>:
<a name="l03921"></a>03921     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a913f825d5ec21974a3c12eb143b6f5de">CACHE_INODE_FILE_OPEN</a>:
<a name="l03922"></a>03922       <a class="code" href="test__findlog_8c.html#adfd9432c5478fa14c7d678edb301feed">LogCrit</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556af6e90cb9d43106e13df4e83652c94f27">COMPONENT_NFSPROTO</a>,
<a name="l03923"></a>03923               <span class="stringliteral">&quot;Error %u converted to NFS3ERR_IO but was set non-retryable&quot;</span>,
<a name="l03924"></a>03924               error);
<a name="l03925"></a>03925       nfserror = <a class="code" href="nfs23_8h.html#a1721ade9b8e43c719c5834eaaf60aac5ab7c8b15a1e3430e7eb532260f0f7ede5">NFS3ERR_IO</a>;
<a name="l03926"></a>03926       <span class="keywordflow">break</span>;
<a name="l03927"></a>03927 
<a name="l03928"></a>03928     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a07fdf53f0646a04f877c108ed99c293b">CACHE_INODE_INVALID_ARGUMENT</a>:
<a name="l03929"></a>03929       nfserror = <a class="code" href="nfs23_8h.html#a1721ade9b8e43c719c5834eaaf60aac5a170faac3001eb06976ce757ce252c306">NFS3ERR_INVAL</a>;
<a name="l03930"></a>03930       <span class="keywordflow">break</span>;
<a name="l03931"></a>03931 
<a name="l03932"></a>03932     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2aa3de98320a1cba72aeeefd31e124712a">CACHE_INODE_FSAL_ERROR</a>:
<a name="l03933"></a>03933     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a6ea3d914d4fb4de66c7d13f31245a5ac">CACHE_INODE_CACHE_CONTENT_ERROR</a>:
<a name="l03935"></a>03935       <a class="code" href="test__findlog_8c.html#adfd9432c5478fa14c7d678edb301feed">LogCrit</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556af6e90cb9d43106e13df4e83652c94f27">COMPONENT_NFSPROTO</a>,
<a name="l03936"></a>03936               <span class="stringliteral">&quot;Error CACHE_INODE_FSAL_ERROR converted to NFS3ERR_IO but was set non-retryable&quot;</span>);
<a name="l03937"></a>03937       nfserror = <a class="code" href="nfs23_8h.html#a1721ade9b8e43c719c5834eaaf60aac5ab7c8b15a1e3430e7eb532260f0f7ede5">NFS3ERR_IO</a>;
<a name="l03938"></a>03938       <span class="keywordflow">break</span>;
<a name="l03939"></a>03939 
<a name="l03940"></a>03940     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a31102fd54b8481b29ee40b6a7f692e75">CACHE_INODE_NOT_A_DIRECTORY</a>:
<a name="l03941"></a>03941       nfserror = <a class="code" href="nfs23_8h.html#a1721ade9b8e43c719c5834eaaf60aac5a209f5840d7c6405e49354fb906ecc98b">NFS3ERR_NOTDIR</a>;
<a name="l03942"></a>03942       <span class="keywordflow">break</span>;
<a name="l03943"></a>03943 
<a name="l03944"></a>03944     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2ae81d3dfa51b14e0e0a26bb33b2f46490">CACHE_INODE_ENTRY_EXISTS</a>:
<a name="l03945"></a>03945       nfserror = <a class="code" href="nfs23_8h.html#a1721ade9b8e43c719c5834eaaf60aac5a45a20ffb24dc43974c3a1c341e0a3636">NFS3ERR_EXIST</a>;
<a name="l03946"></a>03946       <span class="keywordflow">break</span>;
<a name="l03947"></a>03947 
<a name="l03948"></a>03948     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2aa13bf3166511315448442f01b9909bfa">CACHE_INODE_DIR_NOT_EMPTY</a>:
<a name="l03949"></a>03949       nfserror = <a class="code" href="nfs23_8h.html#a1721ade9b8e43c719c5834eaaf60aac5ab35387b36d5a69a0dcef561b8539a273">NFS3ERR_NOTEMPTY</a>;
<a name="l03950"></a>03950       <span class="keywordflow">break</span>;
<a name="l03951"></a>03951 
<a name="l03952"></a>03952     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a49bfbcb4177d74986dd63a1c8aaaadfc">CACHE_INODE_NOT_FOUND</a>:
<a name="l03953"></a>03953       nfserror = <a class="code" href="nfs23_8h.html#a1721ade9b8e43c719c5834eaaf60aac5a973218c182670421fa16264f432e1916">NFS3ERR_NOENT</a>;
<a name="l03954"></a>03954       <span class="keywordflow">break</span>;
<a name="l03955"></a>03955 
<a name="l03956"></a>03956     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2afa6e4cda579bf50a4cc7efddccab904b">CACHE_INODE_FSAL_EACCESS</a>:
<a name="l03957"></a>03957       nfserror = <a class="code" href="nfs23_8h.html#a1721ade9b8e43c719c5834eaaf60aac5a13878924274a183e9d17b4550fdf7dcd">NFS3ERR_ACCES</a>;
<a name="l03958"></a>03958       <span class="keywordflow">break</span>;
<a name="l03959"></a>03959 
<a name="l03960"></a>03960     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2aaf42a5520c80584c436e6577c848fbed">CACHE_INODE_FSAL_EPERM</a>:
<a name="l03961"></a>03961     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2acdd7ce7a12331e8bd87270730d23b298">CACHE_INODE_FSAL_ERR_SEC</a>:
<a name="l03962"></a>03962       nfserror = <a class="code" href="nfs23_8h.html#a1721ade9b8e43c719c5834eaaf60aac5abf68298d0dd0c13872fa20522292fb02">NFS3ERR_PERM</a>;
<a name="l03963"></a>03963       <span class="keywordflow">break</span>;
<a name="l03964"></a>03964 
<a name="l03965"></a>03965     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a0b3b3a0e6a65c9f375c366e6d0349852">CACHE_INODE_NO_SPACE_LEFT</a>:
<a name="l03966"></a>03966       nfserror = <a class="code" href="nfs23_8h.html#a1721ade9b8e43c719c5834eaaf60aac5a6776b3311d12eb58ae6d653ee697fb72">NFS3ERR_NOSPC</a>;
<a name="l03967"></a>03967       <span class="keywordflow">break</span>;
<a name="l03968"></a>03968 
<a name="l03969"></a>03969     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a3c0860cc76f604bcfc7bc09779d3d06c">CACHE_INODE_IS_A_DIRECTORY</a>:
<a name="l03970"></a>03970       nfserror = <a class="code" href="nfs23_8h.html#a1721ade9b8e43c719c5834eaaf60aac5acab0e606157e1d31012886513e483b77">NFS3ERR_ISDIR</a>;
<a name="l03971"></a>03971       <span class="keywordflow">break</span>;
<a name="l03972"></a>03972 
<a name="l03973"></a>03973     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a2735653dbb65fcae621e042fe40316e3">CACHE_INODE_READ_ONLY_FS</a>:
<a name="l03974"></a>03974       nfserror = <a class="code" href="nfs23_8h.html#a1721ade9b8e43c719c5834eaaf60aac5a837a40b3f0a3c9cdc098895c9ab27615">NFS3ERR_ROFS</a>;
<a name="l03975"></a>03975       <span class="keywordflow">break</span>;
<a name="l03976"></a>03976 
<a name="l03977"></a>03977     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2ac101705a0ba258752096d3b209a6c588">CACHE_INODE_KILLED</a>:
<a name="l03978"></a>03978     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2ac52f764b2c5c664df1cf11d8751965fb">CACHE_INODE_DEAD_ENTRY</a>:
<a name="l03979"></a>03979     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a753b5e42145f8290242d1990792dbb0d">CACHE_INODE_FSAL_ESTALE</a>:
<a name="l03980"></a>03980       nfserror = <a class="code" href="nfs23_8h.html#a1721ade9b8e43c719c5834eaaf60aac5a8b5bc86220f037a887e03c06f3698729">NFS3ERR_STALE</a>;
<a name="l03981"></a>03981       <span class="keywordflow">break</span>;
<a name="l03982"></a>03982 
<a name="l03983"></a>03983     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2af5c6f8a87057aebc9e59154de348d56a">CACHE_INODE_QUOTA_EXCEEDED</a>:
<a name="l03984"></a>03984       nfserror = <a class="code" href="nfs23_8h.html#a1721ade9b8e43c719c5834eaaf60aac5a0e5f1cc15d418ea18f2b297c8af4bdfb">NFS3ERR_DQUOT</a>;
<a name="l03985"></a>03985       <span class="keywordflow">break</span>;
<a name="l03986"></a>03986 
<a name="l03987"></a>03987     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a461c7aae0d7d8861bc61ee7031bf79a9">CACHE_INODE_BAD_TYPE</a>:
<a name="l03988"></a>03988       nfserror = <a class="code" href="nfs23_8h.html#a1721ade9b8e43c719c5834eaaf60aac5abec6c5956c627ab04db0435236410944">NFS3ERR_BADTYPE</a>;
<a name="l03989"></a>03989       <span class="keywordflow">break</span>;
<a name="l03990"></a>03990 
<a name="l03991"></a>03991     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a58fc37d01af497af261b2ee8ce65f137">CACHE_INODE_NOT_SUPPORTED</a>:
<a name="l03992"></a>03992       nfserror = <a class="code" href="nfs23_8h.html#a1721ade9b8e43c719c5834eaaf60aac5a829e59eeb7be18d7c0e748c02ae99568">NFS3ERR_NOTSUPP</a>;
<a name="l03993"></a>03993       <span class="keywordflow">break</span>;
<a name="l03994"></a>03994 
<a name="l03995"></a>03995     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a682d21c0f90702d383c9b658e169f534">CACHE_INODE_DELAY</a>:
<a name="l03996"></a>03996       nfserror = <a class="code" href="nfs23_8h.html#a1721ade9b8e43c719c5834eaaf60aac5ac10cd6773401d0b9aa7cde749f4eff24">NFS3ERR_JUKEBOX</a>;
<a name="l03997"></a>03997       <span class="keywordflow">break</span>;
<a name="l03998"></a>03998 
<a name="l03999"></a>03999     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2acc50439e4e107ce5487e79adfdbf4dc0">CACHE_INODE_IO_ERROR</a>:
<a name="l04000"></a>04000         <a class="code" href="test__findlog_8c.html#adfd9432c5478fa14c7d678edb301feed">LogCrit</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556af6e90cb9d43106e13df4e83652c94f27">COMPONENT_NFSPROTO</a>,
<a name="l04001"></a>04001                 <span class="stringliteral">&quot;Error CACHE_INODE_IO_ERROR converted to NFS3ERR_IO but was set non-retryable&quot;</span>);
<a name="l04002"></a>04002       nfserror = <a class="code" href="nfs23_8h.html#a1721ade9b8e43c719c5834eaaf60aac5ab7c8b15a1e3430e7eb532260f0f7ede5">NFS3ERR_IO</a>;
<a name="l04003"></a>04003       <span class="keywordflow">break</span>;
<a name="l04004"></a>04004 
<a name="l04005"></a>04005     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2aca5633ef3c1b4ca3d7b6c757b33e6cad">CACHE_INODE_NAME_TOO_LONG</a>:
<a name="l04006"></a>04006       nfserror = <a class="code" href="nfs23_8h.html#a1721ade9b8e43c719c5834eaaf60aac5aec048b56837306108b00a27d19fc8b1b">NFS3ERR_NAMETOOLONG</a>;
<a name="l04007"></a>04007       <span class="keywordflow">break</span>;
<a name="l04008"></a>04008 
<a name="l04009"></a>04009     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a7aa1c02604a27429b69ae2acf7914c37">CACHE_INODE_FILE_BIG</a>:
<a name="l04010"></a>04010       nfserror = <a class="code" href="nfs23_8h.html#a1721ade9b8e43c719c5834eaaf60aac5ae62eb2c112262e968638894a34c89a40">NFS3ERR_FBIG</a>;
<a name="l04011"></a>04011       <span class="keywordflow">break</span>;
<a name="l04012"></a>04012 
<a name="l04013"></a>04013     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2aab32538c7951dae2ab8e045c141cb348">CACHE_INODE_BAD_COOKIE</a>:
<a name="l04014"></a>04014       nfserror = <a class="code" href="nfs23_8h.html#a1721ade9b8e43c719c5834eaaf60aac5a8104dd997541859f9605571955b48cf2">NFS3ERR_BAD_COOKIE</a>;
<a name="l04015"></a>04015       <span class="keywordflow">break</span>;
<a name="l04016"></a>04016 
<a name="l04017"></a>04017     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a3b4d85140a3d8f501b3e318c82f0d13a">CACHE_INODE_INCONSISTENT_ENTRY</a>:
<a name="l04018"></a>04018     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a37c51c9a4e1098130f3d50e15af58635">CACHE_INODE_HASH_TABLE_ERROR</a>:
<a name="l04019"></a>04019     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2ad34d88bf1ed87798b4c684a4fa5ac940">CACHE_INODE_STATE_CONFLICT</a>:
<a name="l04020"></a>04020     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a216876f1f0ed1ec8c7e61969e9e6cbfb">CACHE_INODE_ASYNC_POST_ERROR</a>:
<a name="l04021"></a>04021     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a30d77d9ece8c0b24f90e6839eba76906">CACHE_INODE_STATE_ERROR</a>:
<a name="l04022"></a>04022         <span class="comment">/* Should not occur */</span>
<a name="l04023"></a>04023         <a class="code" href="log_8h.html#aa7aee8ec65b5baafb430f8d2a7588d53">LogDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556af6e90cb9d43106e13df4e83652c94f27">COMPONENT_NFSPROTO</a>,
<a name="l04024"></a>04024                  <span class="stringliteral">&quot;Line %u should never be reached in nfs3_Errno for cache_status=%u&quot;</span>,
<a name="l04025"></a>04025                  __LINE__, error);
<a name="l04026"></a>04026       nfserror = <a class="code" href="nfs23_8h.html#a1721ade9b8e43c719c5834eaaf60aac5a170faac3001eb06976ce757ce252c306">NFS3ERR_INVAL</a>;
<a name="l04027"></a>04027       <span class="keywordflow">break</span>;
<a name="l04028"></a>04028     }
<a name="l04029"></a>04029 
<a name="l04030"></a>04030   <span class="keywordflow">return</span> nfserror;
<a name="l04031"></a>04031 }                               <span class="comment">/* nfs3_Errno */</span>
<a name="l04032"></a>04032 
<a name="l04044"></a><a class="code" href="group__NFSprocs.html#ga90fe1b6090478dd005254a847ecb287e">04044</a> <a class="code" href="nfs23_8h.html#a7aa4ec59cb08c181dab1f366d0c06778">nfsstat2</a> <a class="code" href="group__NFSprocs.html#ga90fe1b6090478dd005254a847ecb287e">nfs2_Errno</a>(<a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2">cache_inode_status_t</a> <a class="code" href="subr_8c.html#a1f2a342148fd3d57e387199914dd94c8">error</a>)
<a name="l04045"></a>04045 {
<a name="l04046"></a>04046   <a class="code" href="nfs23_8h.html#a7aa4ec59cb08c181dab1f366d0c06778">nfsstat2</a> nfserror= <a class="code" href="nfs23_8h.html#a7aa4ec59cb08c181dab1f366d0c06778a579c9b7724e68a522d8ea09cf95f95fe">NFSERR_IO</a>;
<a name="l04047"></a>04047 
<a name="l04048"></a>04048   <span class="keywordflow">switch</span> (error)
<a name="l04049"></a>04049     {
<a name="l04050"></a>04050     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a3fdbbb2367268ae84ac11d7b189643d8">CACHE_INODE_SUCCESS</a>:
<a name="l04051"></a>04051       nfserror = <a class="code" href="nfs23_8h.html#a7aa4ec59cb08c181dab1f366d0c06778ab31cf3caaf8dd2ab122a66434db73c96">NFS_OK</a>;
<a name="l04052"></a>04052       <span class="keywordflow">break</span>;
<a name="l04053"></a>04053 
<a name="l04054"></a>04054     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a1915843665e061f9b874510cc6382bc9">CACHE_INODE_MALLOC_ERROR</a>:
<a name="l04055"></a>04055     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a9cf5e7e7d9af15c56de98d2e3a8528ce">CACHE_INODE_POOL_MUTEX_INIT_ERROR</a>:
<a name="l04056"></a>04056     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a7fce719c38bc7c5184590549d6d659d1">CACHE_INODE_GET_NEW_LRU_ENTRY</a>:
<a name="l04057"></a>04057     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a1fb3e5d693699c6142279757810ae6c3">CACHE_INODE_UNAPPROPRIATED_KEY</a>:
<a name="l04058"></a>04058     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a86613bc3a05ba135756f102393944133">CACHE_INODE_INIT_ENTRY_FAILED</a>:
<a name="l04059"></a>04059     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a461c7aae0d7d8861bc61ee7031bf79a9">CACHE_INODE_BAD_TYPE</a>:
<a name="l04060"></a>04060     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2ab5b3592038c0b37022a99a7b0c87aa17">CACHE_INODE_CACHE_CONTENT_EXISTS</a>:
<a name="l04061"></a>04061     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2ad76de37772e149413ed754160f118752">CACHE_INODE_CACHE_CONTENT_EMPTY</a>:
<a name="l04062"></a>04062     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2af9495df7ccc04c50609ceaf8f81e9c9b">CACHE_INODE_INSERT_ERROR</a>:
<a name="l04063"></a>04063     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a076de8b129f67057d1294bedf7094aed">CACHE_INODE_LRU_ERROR</a>:
<a name="l04064"></a>04064     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2ac1838632304273d612cd61d2ab31a1ce">CACHE_INODE_HASH_SET_ERROR</a>:
<a name="l04065"></a>04065     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a07fdf53f0646a04f877c108ed99c293b">CACHE_INODE_INVALID_ARGUMENT</a>:
<a name="l04066"></a>04066     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a913f825d5ec21974a3c12eb143b6f5de">CACHE_INODE_FILE_OPEN</a>:
<a name="l04067"></a>04067       <a class="code" href="test__findlog_8c.html#adfd9432c5478fa14c7d678edb301feed">LogCrit</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556af6e90cb9d43106e13df4e83652c94f27">COMPONENT_NFSPROTO</a>,
<a name="l04068"></a>04068               <span class="stringliteral">&quot;Error %u converted to NFSERR_IO but was set non-retryable&quot;</span>,
<a name="l04069"></a>04069               error);
<a name="l04070"></a>04070       nfserror = <a class="code" href="nfs23_8h.html#a7aa4ec59cb08c181dab1f366d0c06778a579c9b7724e68a522d8ea09cf95f95fe">NFSERR_IO</a>;
<a name="l04071"></a>04071       <span class="keywordflow">break</span>;
<a name="l04072"></a>04072 
<a name="l04073"></a>04073     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a31102fd54b8481b29ee40b6a7f692e75">CACHE_INODE_NOT_A_DIRECTORY</a>:
<a name="l04074"></a>04074       nfserror = <a class="code" href="nfs23_8h.html#a7aa4ec59cb08c181dab1f366d0c06778a24f5ab8f84177e3e02837643c1eed2c1">NFSERR_NOTDIR</a>;
<a name="l04075"></a>04075       <span class="keywordflow">break</span>;
<a name="l04076"></a>04076 
<a name="l04077"></a>04077     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2ae81d3dfa51b14e0e0a26bb33b2f46490">CACHE_INODE_ENTRY_EXISTS</a>:
<a name="l04078"></a>04078       nfserror = <a class="code" href="nfs23_8h.html#a7aa4ec59cb08c181dab1f366d0c06778ab969a7b1cc51d292b22c9714ccd9b194">NFSERR_EXIST</a>;
<a name="l04079"></a>04079       <span class="keywordflow">break</span>;
<a name="l04080"></a>04080 
<a name="l04081"></a>04081     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2aa3de98320a1cba72aeeefd31e124712a">CACHE_INODE_FSAL_ERROR</a>:
<a name="l04082"></a>04082     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a6ea3d914d4fb4de66c7d13f31245a5ac">CACHE_INODE_CACHE_CONTENT_ERROR</a>:
<a name="l04083"></a>04083       <a class="code" href="test__findlog_8c.html#adfd9432c5478fa14c7d678edb301feed">LogCrit</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556af6e90cb9d43106e13df4e83652c94f27">COMPONENT_NFSPROTO</a>,
<a name="l04084"></a>04084               <span class="stringliteral">&quot;Error CACHE_INODE_FSAL_ERROR converted to NFSERR_IO but was set non-retryable&quot;</span>);
<a name="l04085"></a>04085       nfserror = <a class="code" href="nfs23_8h.html#a7aa4ec59cb08c181dab1f366d0c06778a579c9b7724e68a522d8ea09cf95f95fe">NFSERR_IO</a>;
<a name="l04086"></a>04086       <span class="keywordflow">break</span>;
<a name="l04087"></a>04087 
<a name="l04088"></a>04088     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2aa13bf3166511315448442f01b9909bfa">CACHE_INODE_DIR_NOT_EMPTY</a>:
<a name="l04089"></a>04089       nfserror = <a class="code" href="nfs23_8h.html#a7aa4ec59cb08c181dab1f366d0c06778a79661dccb6c07f56ebef87f3e20cb1c7">NFSERR_NOTEMPTY</a>;
<a name="l04090"></a>04090       <span class="keywordflow">break</span>;
<a name="l04091"></a>04091 
<a name="l04092"></a>04092     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a49bfbcb4177d74986dd63a1c8aaaadfc">CACHE_INODE_NOT_FOUND</a>:
<a name="l04093"></a>04093       nfserror = <a class="code" href="nfs23_8h.html#a7aa4ec59cb08c181dab1f366d0c06778a7ce41dbfa8d374bb38904abeb51d5b34">NFSERR_NOENT</a>;
<a name="l04094"></a>04094       <span class="keywordflow">break</span>;
<a name="l04095"></a>04095 
<a name="l04096"></a>04096     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2afa6e4cda579bf50a4cc7efddccab904b">CACHE_INODE_FSAL_EACCESS</a>:
<a name="l04097"></a>04097       nfserror = <a class="code" href="nfs23_8h.html#a7aa4ec59cb08c181dab1f366d0c06778a3180dd1c382acf6a44436b66c60068f1">NFSERR_ACCES</a>;
<a name="l04098"></a>04098       <span class="keywordflow">break</span>;
<a name="l04099"></a>04099 
<a name="l04100"></a>04100     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a0b3b3a0e6a65c9f375c366e6d0349852">CACHE_INODE_NO_SPACE_LEFT</a>:
<a name="l04101"></a>04101       nfserror = <a class="code" href="nfs23_8h.html#a7aa4ec59cb08c181dab1f366d0c06778afcac56ba5140a744e18e4e599c978884">NFSERR_NOSPC</a>;
<a name="l04102"></a>04102       <span class="keywordflow">break</span>;
<a name="l04103"></a>04103 
<a name="l04104"></a>04104     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2aaf42a5520c80584c436e6577c848fbed">CACHE_INODE_FSAL_EPERM</a>:
<a name="l04105"></a>04105     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2acdd7ce7a12331e8bd87270730d23b298">CACHE_INODE_FSAL_ERR_SEC</a>:
<a name="l04106"></a>04106       nfserror = <a class="code" href="nfs23_8h.html#a7aa4ec59cb08c181dab1f366d0c06778a45f43fb33a0b4f471a2090dce31fd5c3">NFSERR_PERM</a>;
<a name="l04107"></a>04107       <span class="keywordflow">break</span>;
<a name="l04108"></a>04108 
<a name="l04109"></a>04109     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a3c0860cc76f604bcfc7bc09779d3d06c">CACHE_INODE_IS_A_DIRECTORY</a>:
<a name="l04110"></a>04110       nfserror = <a class="code" href="nfs23_8h.html#a7aa4ec59cb08c181dab1f366d0c06778a70a89999108a1aaefe9350f6228b1a32">NFSERR_ISDIR</a>;
<a name="l04111"></a>04111       <span class="keywordflow">break</span>;
<a name="l04112"></a>04112 
<a name="l04113"></a>04113     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a2735653dbb65fcae621e042fe40316e3">CACHE_INODE_READ_ONLY_FS</a>:
<a name="l04114"></a>04114       nfserror = <a class="code" href="nfs23_8h.html#a7aa4ec59cb08c181dab1f366d0c06778a3b87fc50304674e7fdffcbd270146320">NFSERR_ROFS</a>;
<a name="l04115"></a>04115       <span class="keywordflow">break</span>;
<a name="l04116"></a>04116 
<a name="l04117"></a>04117     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2ac101705a0ba258752096d3b209a6c588">CACHE_INODE_KILLED</a>:
<a name="l04118"></a>04118     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2ac52f764b2c5c664df1cf11d8751965fb">CACHE_INODE_DEAD_ENTRY</a>:
<a name="l04119"></a>04119     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a753b5e42145f8290242d1990792dbb0d">CACHE_INODE_FSAL_ESTALE</a>:
<a name="l04120"></a>04120       nfserror = <a class="code" href="nfs23_8h.html#a7aa4ec59cb08c181dab1f366d0c06778aa647fadfd33f10bfa26008dc3f91bfc4">NFSERR_STALE</a>;
<a name="l04121"></a>04121       <span class="keywordflow">break</span>;
<a name="l04122"></a>04122 
<a name="l04123"></a>04123     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2af5c6f8a87057aebc9e59154de348d56a">CACHE_INODE_QUOTA_EXCEEDED</a>:
<a name="l04124"></a>04124       nfserror = <a class="code" href="nfs23_8h.html#a7aa4ec59cb08c181dab1f366d0c06778ab3015405f57d6f313ad642b131c5501c">NFSERR_DQUOT</a>;
<a name="l04125"></a>04125       <span class="keywordflow">break</span>;
<a name="l04126"></a>04126 
<a name="l04127"></a>04127     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2acc50439e4e107ce5487e79adfdbf4dc0">CACHE_INODE_IO_ERROR</a>:
<a name="l04128"></a>04128       <a class="code" href="test__findlog_8c.html#adfd9432c5478fa14c7d678edb301feed">LogCrit</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556af6e90cb9d43106e13df4e83652c94f27">COMPONENT_NFSPROTO</a>,
<a name="l04129"></a>04129               <span class="stringliteral">&quot;Error CACHE_INODE_IO_ERROR converted to NFSERR_IO but was set non-retryable&quot;</span>);
<a name="l04130"></a>04130       nfserror = <a class="code" href="nfs23_8h.html#a7aa4ec59cb08c181dab1f366d0c06778a579c9b7724e68a522d8ea09cf95f95fe">NFSERR_IO</a>;
<a name="l04131"></a>04131       <span class="keywordflow">break</span>;
<a name="l04132"></a>04132 
<a name="l04133"></a>04133     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2aca5633ef3c1b4ca3d7b6c757b33e6cad">CACHE_INODE_NAME_TOO_LONG</a>:
<a name="l04134"></a>04134       nfserror = <a class="code" href="nfs23_8h.html#a7aa4ec59cb08c181dab1f366d0c06778a55229297a62c954049ac0763cd430eb9">NFSERR_NAMETOOLONG</a>;
<a name="l04135"></a>04135       <span class="keywordflow">break</span>;
<a name="l04136"></a>04136 
<a name="l04137"></a>04137     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a3b4d85140a3d8f501b3e318c82f0d13a">CACHE_INODE_INCONSISTENT_ENTRY</a>:
<a name="l04138"></a>04138     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a37c51c9a4e1098130f3d50e15af58635">CACHE_INODE_HASH_TABLE_ERROR</a>:
<a name="l04139"></a>04139     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2ad34d88bf1ed87798b4c684a4fa5ac940">CACHE_INODE_STATE_CONFLICT</a>:
<a name="l04140"></a>04140     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a216876f1f0ed1ec8c7e61969e9e6cbfb">CACHE_INODE_ASYNC_POST_ERROR</a>:
<a name="l04141"></a>04141     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a30d77d9ece8c0b24f90e6839eba76906">CACHE_INODE_STATE_ERROR</a>:
<a name="l04142"></a>04142     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a58fc37d01af497af261b2ee8ce65f137">CACHE_INODE_NOT_SUPPORTED</a>:
<a name="l04143"></a>04143     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a682d21c0f90702d383c9b658e169f534">CACHE_INODE_DELAY</a>:
<a name="l04144"></a>04144     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2aab32538c7951dae2ab8e045c141cb348">CACHE_INODE_BAD_COOKIE</a>:
<a name="l04145"></a>04145     <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#aa6929668cedf7463f35a22998b8e08d2a7aa1c02604a27429b69ae2acf7914c37">CACHE_INODE_FILE_BIG</a>:
<a name="l04146"></a>04146         <span class="comment">/* Should not occur */</span>
<a name="l04147"></a>04147       <a class="code" href="log_8h.html#aa7aee8ec65b5baafb430f8d2a7588d53">LogDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556af6e90cb9d43106e13df4e83652c94f27">COMPONENT_NFSPROTO</a>,
<a name="l04148"></a>04148                <span class="stringliteral">&quot;Line %u should never be reached in nfs2_Errno&quot;</span>, __LINE__);
<a name="l04149"></a>04149       nfserror = <a class="code" href="nfs23_8h.html#a7aa4ec59cb08c181dab1f366d0c06778a579c9b7724e68a522d8ea09cf95f95fe">NFSERR_IO</a>;
<a name="l04150"></a>04150       <span class="keywordflow">break</span>;
<a name="l04151"></a>04151     }
<a name="l04152"></a>04152 
<a name="l04153"></a>04153   <span class="keywordflow">return</span> nfserror;
<a name="l04154"></a>04154 }                               <span class="comment">/* nfs2_Errno */</span>
<a name="l04155"></a>04155 
<a name="l04167"></a><a class="code" href="group__NFSprocs.html#ga5b39da99588e5c80ca897a2fe1dc01e3">04167</a> <span class="keywordtype">int</span> <a class="code" href="group__NFSprocs.html#ga5b39da99588e5c80ca897a2fe1dc01e3">nfs3_AllocateFH</a>(<a class="code" href="structnfs__fh3.html">nfs_fh3</a> *fh)
<a name="l04168"></a>04168 {
<a name="l04169"></a>04169   <span class="keywordtype">char</span> <a class="code" href="group__NFSprocs.html#ga7efec2b565bdbe409979ac657775eeaa">__attribute__</a> ((__unused__)) funcname[] = <span class="stringliteral">&quot;AllocateFH3&quot;</span>;
<a name="l04170"></a>04170 
<a name="l04171"></a>04171   <span class="keywordflow">if</span>(fh == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l04172"></a>04172     <span class="keywordflow">return</span> <a class="code" href="nfs23_8h.html#a1721ade9b8e43c719c5834eaaf60aac5a0a30819e7bab1cc416482e6743393627">NFS3ERR_SERVERFAULT</a>;
<a name="l04173"></a>04173 
<a name="l04174"></a>04174   <span class="comment">/* Allocating the filehandle in memory */</span>
<a name="l04175"></a>04175   fh-&gt;<a class="code" href="structnfs__fh3.html#ab2ae8681712f8e4d48a583f708922ca3">data</a>.<a class="code" href="structnfs__fh3.html#ad7ae3999dc62aa245ff588171cad8dd6">data_len</a> = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="structalloc__file__handle__v3.html">alloc_file_handle_v3</a>);
<a name="l04176"></a>04176   <span class="keywordflow">if</span>((fh-&gt;<a class="code" href="structnfs__fh3.html#ab2ae8681712f8e4d48a583f708922ca3">data</a>.<a class="code" href="structnfs__fh3.html#aa5864897f93ad598d7bd81537e222e86">data_val</a> = gsh_malloc(fh-&gt;<a class="code" href="structnfs__fh3.html#ab2ae8681712f8e4d48a583f708922ca3">data</a>.<a class="code" href="structnfs__fh3.html#ad7ae3999dc62aa245ff588171cad8dd6">data_len</a>)) == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l04177"></a>04177     {
<a name="l04178"></a>04178       <a class="code" href="log_8h.html#a367b67f5a0b29160763c3ce8efce0875">LogError</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556af6e90cb9d43106e13df4e83652c94f27">COMPONENT_NFSPROTO</a>, <a class="code" href="log_8h.html#ad9f6cff569b8aaff581efed5a643f26a">ERR_SYS</a>, <a class="code" href="log_8h.html#af5644a8648341ffd4c34f7fb77bf1781">ERR_MALLOC</a>, errno);
<a name="l04179"></a>04179       <span class="keywordflow">return</span> <a class="code" href="nfs23_8h.html#a1721ade9b8e43c719c5834eaaf60aac5a0a30819e7bab1cc416482e6743393627">NFS3ERR_SERVERFAULT</a>;
<a name="l04180"></a>04180     }
<a name="l04181"></a>04181 
<a name="l04182"></a>04182   memset((<span class="keywordtype">char</span> *)fh-&gt;<a class="code" href="structnfs__fh3.html#ab2ae8681712f8e4d48a583f708922ca3">data</a>.<a class="code" href="structnfs__fh3.html#aa5864897f93ad598d7bd81537e222e86">data_val</a>, 0, fh-&gt;<a class="code" href="structnfs__fh3.html#ab2ae8681712f8e4d48a583f708922ca3">data</a>.<a class="code" href="structnfs__fh3.html#ad7ae3999dc62aa245ff588171cad8dd6">data_len</a>);
<a name="l04183"></a>04183 
<a name="l04184"></a>04184   <span class="keywordflow">return</span> <a class="code" href="nfs23_8h.html#a1721ade9b8e43c719c5834eaaf60aac5ae705552b166e565f66540b9412805365">NFS3_OK</a>;
<a name="l04185"></a>04185 }                               <span class="comment">/* nfs4_AllocateFH */</span>
<a name="l04186"></a>04186 
<a name="l04198"></a><a class="code" href="group__NFSprocs.html#ga9f988a714dadc7d8a6c107bc864d30ff">04198</a> <span class="keywordtype">int</span> <a class="code" href="group__NFSprocs.html#ga9f988a714dadc7d8a6c107bc864d30ff">nfs4_AllocateFH</a>(<a class="code" href="structnfs__fh4.html">nfs_fh4</a> * fh)
<a name="l04199"></a>04199 {
<a name="l04200"></a>04200   <span class="keywordtype">char</span> <a class="code" href="group__NFSprocs.html#ga7efec2b565bdbe409979ac657775eeaa">__attribute__</a> ((__unused__)) funcname[] = <span class="stringliteral">&quot;AllocateFH4&quot;</span>;
<a name="l04201"></a>04201 
<a name="l04202"></a>04202   <span class="keywordflow">if</span>(fh == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l04203"></a>04203     <span class="keywordflow">return</span> <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aaf8c067759d4fef22cb97409d7a50c453">NFS4ERR_SERVERFAULT</a>;
<a name="l04204"></a>04204 
<a name="l04205"></a>04205   <span class="comment">/* Allocating the filehandle in memory */</span>
<a name="l04206"></a>04206   fh-&gt;<a class="code" href="structnfs__fh4.html#a16f1d8d3eb38d12060bef0045f062f16">nfs_fh4_len</a> = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="structalloc__file__handle__v4.html">alloc_file_handle_v4</a>);
<a name="l04207"></a>04207   <span class="keywordflow">if</span>((fh-&gt;<a class="code" href="structnfs__fh4.html#a1bac9f2eb01597339d8c037776010a09">nfs_fh4_val</a> = gsh_malloc(fh-&gt;<a class="code" href="structnfs__fh4.html#a16f1d8d3eb38d12060bef0045f062f16">nfs_fh4_len</a>)) == <a class="code" href="Getopt_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l04208"></a>04208     {
<a name="l04209"></a>04209       <a class="code" href="log_8h.html#a367b67f5a0b29160763c3ce8efce0875">LogError</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556a7e3a7a2880418b153e81a9e22c33209b">COMPONENT_NFS_V4</a>, <a class="code" href="log_8h.html#ad9f6cff569b8aaff581efed5a643f26a">ERR_SYS</a>, <a class="code" href="log_8h.html#af5644a8648341ffd4c34f7fb77bf1781">ERR_MALLOC</a>, errno);
<a name="l04210"></a>04210       <span class="keywordflow">return</span> <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aa56ef631d56bc42354e7995001e5c3680">NFS4ERR_RESOURCE</a>;
<a name="l04211"></a>04211     }
<a name="l04212"></a>04212 
<a name="l04213"></a>04213   memset((<span class="keywordtype">char</span> *)fh-&gt;<a class="code" href="structnfs__fh4.html#a1bac9f2eb01597339d8c037776010a09">nfs_fh4_val</a>, 0, fh-&gt;<a class="code" href="structnfs__fh4.html#a16f1d8d3eb38d12060bef0045f062f16">nfs_fh4_len</a>);
<a name="l04214"></a>04214 
<a name="l04215"></a>04215   <span class="keywordflow">return</span> <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aacaca462c793854dd61337cf0b54fc166">NFS4_OK</a>;
<a name="l04216"></a>04216 }                               <span class="comment">/* nfs4_AllocateFH */</span>
<a name="l04217"></a>04217 
<a name="l04229"></a><a class="code" href="group__NFSprocs.html#gac5009440881d6a4d6789eff4c3609224">04229</a> <span class="keywordtype">int</span> <a class="code" href="group__NFSprocs.html#gac5009440881d6a4d6789eff4c3609224">nfs4_MakeCred</a>(<a class="code" href="structcompoud__data.html" title="Compound data.">compound_data_t</a> * data)
<a name="l04230"></a>04230 {
<a name="l04231"></a>04231   <a class="code" href="structexportlist__client__entry____.html">exportlist_client_entry_t</a> related_client;
<a name="l04232"></a>04232   <span class="keyword">struct </span><a class="code" href="structuser__cred.html">user_cred</a> user_credentials;
<a name="l04233"></a>04233 
<a name="l04234"></a>04234   <span class="keywordflow">if</span> (<a class="code" href="nfs__exports_8h.html#a847064b299d18b920879397a76394da7">get_req_uid_gid</a>(data-&gt;<a class="code" href="structcompoud__data.html#a63060447acb681735feb223b8e2b1e4c">reqp</a>,
<a name="l04235"></a>04235                       data-&gt;<a class="code" href="structcompoud__data.html#aa44e02b685a675a6beb59faac8c9dc78">pexport</a>,
<a name="l04236"></a>04236                       &amp;user_credentials) == <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>)
<a name="l04237"></a>04237     <span class="keywordflow">return</span> <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aa8a11c499d44e49a1e4f207f456b6b898">NFS4ERR_WRONGSEC</a>;
<a name="l04238"></a>04238 
<a name="l04239"></a>04239   <a class="code" href="log_8h.html#a8ca2131f27bca0bd0e870c3c2da64cb1">LogFullDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556ad6840f4000a2796068317166bcb2e454">COMPONENT_DISPATCH</a>,
<a name="l04240"></a>04240                <span class="stringliteral">&quot;nfs4_MakeCred about to call nfs_export_check_access&quot;</span>);
<a name="l04241"></a>04241   <span class="keywordflow">if</span>(<a class="code" href="nfs__exports_8h.html#a8dde757a47cad9c8396d6593096f714c">nfs_export_check_access</a>(&amp;data-&gt;<a class="code" href="structcompoud__data.html#aa91cb07627ff826c4b23dab684f2252d">pworker</a>-&gt;<a class="code" href="structnfs__worker__data____.html#a16e9ef80c974f00aaf012525e7213fd4">hostaddr</a>,
<a name="l04242"></a>04242                              data-&gt;<a class="code" href="structcompoud__data.html#a63060447acb681735feb223b8e2b1e4c">reqp</a>,
<a name="l04243"></a>04243                              data-&gt;<a class="code" href="structcompoud__data.html#aa44e02b685a675a6beb59faac8c9dc78">pexport</a>,
<a name="l04244"></a>04244                              <a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#aeef2995e9b54747311db1972d158fd41">core_param</a>.<a class="code" href="structnfs__core__param____.html#aa04e466147819b7a92794e45e67ad2c9">program</a>[<a class="code" href="nfs__core_8h.html#a7f6e26c17a511d03a3e095f595a02907a69c56a6ce312422c90b25f97a43d4dc2">P_NFS</a>],
<a name="l04245"></a>04245                              <a class="code" href="nfs__core_8h.html#aeb8fc46586993cf210777049fca03969">nfs_param</a>.<a class="code" href="structnfs__param____.html#aeef2995e9b54747311db1972d158fd41">core_param</a>.<a class="code" href="structnfs__core__param____.html#aa04e466147819b7a92794e45e67ad2c9">program</a>[<a class="code" href="nfs__core_8h.html#a7f6e26c17a511d03a3e095f595a02907a9c790ab4adce0dd1d4dde907f1211eb4">P_MNT</a>],
<a name="l04246"></a>04246                              data-&gt;<a class="code" href="structcompoud__data.html#aa91cb07627ff826c4b23dab684f2252d">pworker</a>-&gt;<a class="code" href="structnfs__worker__data____.html#a9aeb8c9c91b24d8a777c7aade7ea8f93">ht_ip_stats</a>,
<a name="l04247"></a>04247                              <a class="code" href="nfs__core_8h.html#ae764f3008acff52e16850c39adfd6eda">ip_stats_pool</a>,
<a name="l04248"></a>04248                              &amp;related_client,
<a name="l04249"></a>04249                              &amp;user_credentials,
<a name="l04250"></a>04250                              <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>) <span class="comment">/* So check_access() doesn&#39;t deny based on whether this is a RO export. */</span>
<a name="l04251"></a>04251      == <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>)
<a name="l04252"></a>04252     <span class="keywordflow">return</span> <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aa8a11c499d44e49a1e4f207f456b6b898">NFS4ERR_WRONGSEC</a>;
<a name="l04253"></a>04253 
<a name="l04254"></a>04254   <span class="keywordflow">if</span>(<a class="code" href="nfs__exports_8h.html#ab567937cabef9dc08628909b09662dc8">nfs_check_anon</a>(&amp;related_client, data-&gt;<a class="code" href="structcompoud__data.html#aa44e02b685a675a6beb59faac8c9dc78">pexport</a>, &amp;user_credentials) == <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>
<a name="l04255"></a>04255      || <a class="code" href="nfs__exports_8h.html#a2c7d1b3908d57b8cd77f54574929c791">nfs_build_fsal_context</a>(data-&gt;<a class="code" href="structcompoud__data.html#a63060447acb681735feb223b8e2b1e4c">reqp</a>,
<a name="l04256"></a>04256                             data-&gt;<a class="code" href="structcompoud__data.html#aa44e02b685a675a6beb59faac8c9dc78">pexport</a>,
<a name="l04257"></a>04257                             data-&gt;<a class="code" href="structcompoud__data.html#a7e30266eb1770e922a88cb7b11ac7f01">pcontext</a>,
<a name="l04258"></a>04258                             &amp;user_credentials) == <a class="code" href="HashTable_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>)
<a name="l04259"></a>04259     <span class="keywordflow">return</span> <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aa8a11c499d44e49a1e4f207f456b6b898">NFS4ERR_WRONGSEC</a>;
<a name="l04260"></a>04260 
<a name="l04261"></a>04261   <span class="keywordflow">return</span> <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aacaca462c793854dd61337cf0b54fc166">NFS4_OK</a>;
<a name="l04262"></a>04262 }                               <span class="comment">/* nfs4_MakeCred */</span>
<a name="l04263"></a>04263 
<a name="l04264"></a>04264 <span class="comment">/* Create access mask based on given access operation. Both mode and ace4</span>
<a name="l04265"></a>04265 <span class="comment"> * mask are encoded. */</span>
<a name="l04266"></a><a class="code" href="nfs__proto__tools_8c.html#a508cd4b0b891de6663e4f99bd5adf23b">04266</a> <a class="code" href="fsal__types_8h.html#a67f294990c65fb1f373bd9a21b139d67">fsal_accessflags_t</a> <a class="code" href="nfs__proto__tools_8h.html#a508cd4b0b891de6663e4f99bd5adf23b">nfs_get_access_mask</a>(<a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> op, <a class="code" href="structfsal__attrib__list____.html">fsal_attrib_list_t</a> *pattr)
<a name="l04267"></a>04267 {
<a name="l04268"></a>04268   <a class="code" href="fsal__types_8h.html#a67f294990c65fb1f373bd9a21b139d67">fsal_accessflags_t</a> access_mask = 0;
<a name="l04269"></a>04269 
<a name="l04270"></a>04270   <span class="keywordflow">switch</span>(op)
<a name="l04271"></a>04271     {
<a name="l04272"></a>04272       <span class="keywordflow">case</span> <a class="code" href="nfs23_8h.html#a7ad99cccff38bb3a53d261dd35c3cf79">ACCESS3_READ</a>:
<a name="l04273"></a>04273         access_mask |= <a class="code" href="fsal__types_8h.html#ab668eb5af146f562a091fa83e770c727">FSAL_MODE_MASK_SET</a>(<a class="code" href="fsal__types_8h.html#ab020040c9a4e238acb118058e2702199">FSAL_R_OK</a>);
<a name="l04274"></a>04274         <span class="keywordflow">if</span>(<a class="code" href="fsal__types_8h.html#a58165f35e576089b46620b2a0642f6c7">IS_FSAL_DIR</a>(pattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a03249aca39ba1b16b4712079d93b025e">type</a>))
<a name="l04275"></a>04275           access_mask |= <a class="code" href="fsal__types_8h.html#a1bcf1fed7f807a12430f865d21fa123b">FSAL_ACE4_MASK_SET</a>(<a class="code" href="fsal__types_8h.html#ab2427954c36f40941f6ed905fe19a6e0">FSAL_ACE_PERM_LIST_DIR</a>);
<a name="l04276"></a>04276         <span class="keywordflow">else</span>
<a name="l04277"></a>04277           access_mask |= <a class="code" href="fsal__types_8h.html#a1bcf1fed7f807a12430f865d21fa123b">FSAL_ACE4_MASK_SET</a>(<a class="code" href="fsal__types_8h.html#ad239f7c8e556aac3c852cdf131a0e78d">FSAL_ACE_PERM_READ_DATA</a>);
<a name="l04278"></a>04278       <span class="keywordflow">break</span>;
<a name="l04279"></a>04279 
<a name="l04280"></a>04280       <span class="keywordflow">case</span> <a class="code" href="nfs23_8h.html#a0ecd105be986d0c387c662dd6e4d1793">ACCESS3_LOOKUP</a>:
<a name="l04281"></a>04281         <span class="keywordflow">if</span>(!<a class="code" href="fsal__types_8h.html#a58165f35e576089b46620b2a0642f6c7">IS_FSAL_DIR</a>(pattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a03249aca39ba1b16b4712079d93b025e">type</a>))
<a name="l04282"></a>04282           <span class="keywordflow">break</span>;
<a name="l04283"></a>04283         access_mask |= <a class="code" href="fsal__types_8h.html#ab668eb5af146f562a091fa83e770c727">FSAL_MODE_MASK_SET</a>(<a class="code" href="fsal__types_8h.html#a10de7a71893a30e28616caeb74956da4">FSAL_X_OK</a>);
<a name="l04284"></a>04284         access_mask |= <a class="code" href="fsal__types_8h.html#a1bcf1fed7f807a12430f865d21fa123b">FSAL_ACE4_MASK_SET</a>(<a class="code" href="fsal__types_8h.html#ab2427954c36f40941f6ed905fe19a6e0">FSAL_ACE_PERM_LIST_DIR</a>);
<a name="l04285"></a>04285       <span class="keywordflow">break</span>;
<a name="l04286"></a>04286 
<a name="l04287"></a>04287       <span class="keywordflow">case</span> <a class="code" href="nfs23_8h.html#ab3da3d85ecf5fbd06dbe40f12b761942">ACCESS3_MODIFY</a>:
<a name="l04288"></a>04288         access_mask |= <a class="code" href="fsal__types_8h.html#ab668eb5af146f562a091fa83e770c727">FSAL_MODE_MASK_SET</a>(<a class="code" href="fsal__types_8h.html#a22aa427f250d1efb3d90764d3c2eab39">FSAL_W_OK</a>);
<a name="l04289"></a>04289         <span class="keywordflow">if</span>(<a class="code" href="fsal__types_8h.html#a58165f35e576089b46620b2a0642f6c7">IS_FSAL_DIR</a>(pattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a03249aca39ba1b16b4712079d93b025e">type</a>))
<a name="l04290"></a>04290           access_mask |= <a class="code" href="fsal__types_8h.html#a1bcf1fed7f807a12430f865d21fa123b">FSAL_ACE4_MASK_SET</a>(<a class="code" href="fsal__types_8h.html#a261f82f6c5dc2108a32b7999707009b0">FSAL_ACE_PERM_DELETE_CHILD</a>);
<a name="l04291"></a>04291         <span class="keywordflow">else</span>
<a name="l04292"></a>04292           access_mask |= <a class="code" href="fsal__types_8h.html#a1bcf1fed7f807a12430f865d21fa123b">FSAL_ACE4_MASK_SET</a>(<a class="code" href="fsal__types_8h.html#a4c8c74f122161e99c6100affb92c5b59">FSAL_ACE_PERM_WRITE_DATA</a>);
<a name="l04293"></a>04293       <span class="keywordflow">break</span>;
<a name="l04294"></a>04294 
<a name="l04295"></a>04295       <span class="keywordflow">case</span> <a class="code" href="nfs23_8h.html#a550d969b8907291b8328eac18824b8a8">ACCESS3_EXTEND</a>:
<a name="l04296"></a>04296         access_mask |= <a class="code" href="fsal__types_8h.html#ab668eb5af146f562a091fa83e770c727">FSAL_MODE_MASK_SET</a>(<a class="code" href="fsal__types_8h.html#a22aa427f250d1efb3d90764d3c2eab39">FSAL_W_OK</a>);
<a name="l04297"></a>04297         <span class="keywordflow">if</span>(<a class="code" href="fsal__types_8h.html#a58165f35e576089b46620b2a0642f6c7">IS_FSAL_DIR</a>(pattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a03249aca39ba1b16b4712079d93b025e">type</a>))
<a name="l04298"></a>04298           access_mask |= <a class="code" href="fsal__types_8h.html#a1bcf1fed7f807a12430f865d21fa123b">FSAL_ACE4_MASK_SET</a>(<a class="code" href="fsal__types_8h.html#ac8fdd5545e021336cc181eaffb0cac1d">FSAL_ACE_PERM_ADD_FILE</a> |
<a name="l04299"></a>04299                                             <a class="code" href="fsal__types_8h.html#a013e1d66a050c80703c9c06989af3ddc">FSAL_ACE_PERM_ADD_SUBDIRECTORY</a>);
<a name="l04300"></a>04300         <span class="keywordflow">else</span>
<a name="l04301"></a>04301           access_mask |= <a class="code" href="fsal__types_8h.html#a1bcf1fed7f807a12430f865d21fa123b">FSAL_ACE4_MASK_SET</a>(<a class="code" href="fsal__types_8h.html#a28fda112f05c5a2e81283ff3c5a27682">FSAL_ACE_PERM_APPEND_DATA</a>);
<a name="l04302"></a>04302       <span class="keywordflow">break</span>;
<a name="l04303"></a>04303 
<a name="l04304"></a>04304       <span class="keywordflow">case</span> <a class="code" href="nfs23_8h.html#a1daefe290f2711ef4e4ba873dca7ec68">ACCESS3_DELETE</a>:
<a name="l04305"></a>04305         <span class="keywordflow">if</span>(!<a class="code" href="fsal__types_8h.html#a58165f35e576089b46620b2a0642f6c7">IS_FSAL_DIR</a>(pattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a03249aca39ba1b16b4712079d93b025e">type</a>))
<a name="l04306"></a>04306           <span class="keywordflow">break</span>;
<a name="l04307"></a>04307         access_mask |= <a class="code" href="fsal__types_8h.html#ab668eb5af146f562a091fa83e770c727">FSAL_MODE_MASK_SET</a>(<a class="code" href="fsal__types_8h.html#a22aa427f250d1efb3d90764d3c2eab39">FSAL_W_OK</a>);
<a name="l04308"></a>04308         access_mask |= <a class="code" href="fsal__types_8h.html#a1bcf1fed7f807a12430f865d21fa123b">FSAL_ACE4_MASK_SET</a>(<a class="code" href="fsal__types_8h.html#a261f82f6c5dc2108a32b7999707009b0">FSAL_ACE_PERM_DELETE_CHILD</a>);
<a name="l04309"></a>04309       <span class="keywordflow">break</span>;
<a name="l04310"></a>04310 
<a name="l04311"></a>04311       <span class="keywordflow">case</span> <a class="code" href="nfs23_8h.html#aebd86a2fb196e0682736070fac8bf6fb">ACCESS3_EXECUTE</a>:
<a name="l04312"></a>04312         <span class="keywordflow">if</span>(<a class="code" href="fsal__types_8h.html#a58165f35e576089b46620b2a0642f6c7">IS_FSAL_DIR</a>(pattr-&gt;<a class="code" href="structfsal__attrib__list____.html#a03249aca39ba1b16b4712079d93b025e">type</a>))
<a name="l04313"></a>04313           <span class="keywordflow">break</span>;
<a name="l04314"></a>04314         access_mask |= <a class="code" href="fsal__types_8h.html#ab668eb5af146f562a091fa83e770c727">FSAL_MODE_MASK_SET</a>(<a class="code" href="fsal__types_8h.html#a10de7a71893a30e28616caeb74956da4">FSAL_X_OK</a>);
<a name="l04315"></a>04315         access_mask |= <a class="code" href="fsal__types_8h.html#a1bcf1fed7f807a12430f865d21fa123b">FSAL_ACE4_MASK_SET</a>(<a class="code" href="fsal__types_8h.html#adbeb50c45f2c2085fbf4b1db7fe07f4b">FSAL_ACE_PERM_EXECUTE</a>);
<a name="l04316"></a>04316       <span class="keywordflow">break</span>;
<a name="l04317"></a>04317     }
<a name="l04318"></a>04318 
<a name="l04319"></a>04319   <span class="keywordflow">return</span> access_mask;
<a name="l04320"></a>04320 }
<a name="l04321"></a>04321 
<a name="l04322"></a><a class="code" href="nfs__proto__tools_8c.html#a370ea28f9219e3fa3b37c32886939806">04322</a> <span class="keywordtype">void</span> <a class="code" href="nfs__proto__tools_8h.html#a370ea28f9219e3fa3b37c32886939806">nfs3_access_debug</a>(<span class="keywordtype">char</span> *label, <a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> access)
<a name="l04323"></a>04323 {
<a name="l04324"></a>04324   <a class="code" href="log_8h.html#aa7aee8ec65b5baafb430f8d2a7588d53">LogDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556af6e90cb9d43106e13df4e83652c94f27">COMPONENT_NFSPROTO</a>, <span class="stringliteral">&quot;%s=%s,%s,%s,%s,%s,%s&quot;</span>,
<a name="l04325"></a>04325            label,
<a name="l04326"></a>04326            <a class="code" href="fsal_8h.html#a22431080664a539634e88f4c7420aaef">FSAL_TEST_MASK</a>(access, <a class="code" href="nfs23_8h.html#a7ad99cccff38bb3a53d261dd35c3cf79">ACCESS3_READ</a>) ? <span class="stringliteral">&quot;READ&quot;</span> : <span class="stringliteral">&quot;-&quot;</span>,
<a name="l04327"></a>04327            <a class="code" href="fsal_8h.html#a22431080664a539634e88f4c7420aaef">FSAL_TEST_MASK</a>(access, <a class="code" href="nfs23_8h.html#a0ecd105be986d0c387c662dd6e4d1793">ACCESS3_LOOKUP</a>) ? <span class="stringliteral">&quot;LOOKUP&quot;</span> : <span class="stringliteral">&quot;-&quot;</span>,
<a name="l04328"></a>04328            <a class="code" href="fsal_8h.html#a22431080664a539634e88f4c7420aaef">FSAL_TEST_MASK</a>(access, <a class="code" href="nfs23_8h.html#ab3da3d85ecf5fbd06dbe40f12b761942">ACCESS3_MODIFY</a>) ? <span class="stringliteral">&quot;MODIFY&quot;</span> : <span class="stringliteral">&quot;-&quot;</span>,
<a name="l04329"></a>04329            <a class="code" href="fsal_8h.html#a22431080664a539634e88f4c7420aaef">FSAL_TEST_MASK</a>(access, <a class="code" href="nfs23_8h.html#a550d969b8907291b8328eac18824b8a8">ACCESS3_EXTEND</a>) ? <span class="stringliteral">&quot;EXTEND&quot;</span> : <span class="stringliteral">&quot;-&quot;</span>,
<a name="l04330"></a>04330            <a class="code" href="fsal_8h.html#a22431080664a539634e88f4c7420aaef">FSAL_TEST_MASK</a>(access, <a class="code" href="nfs23_8h.html#a1daefe290f2711ef4e4ba873dca7ec68">ACCESS3_DELETE</a>) ? <span class="stringliteral">&quot;DELETE&quot;</span> : <span class="stringliteral">&quot;-&quot;</span>,
<a name="l04331"></a>04331            <a class="code" href="fsal_8h.html#a22431080664a539634e88f4c7420aaef">FSAL_TEST_MASK</a>(access, <a class="code" href="nfs23_8h.html#aebd86a2fb196e0682736070fac8bf6fb">ACCESS3_EXECUTE</a>) ? <span class="stringliteral">&quot;EXECUTE&quot;</span> : <span class="stringliteral">&quot;-&quot;</span>);
<a name="l04332"></a>04332 }
<a name="l04333"></a>04333 
<a name="l04334"></a><a class="code" href="nfs__proto__tools_8c.html#a4ae3621ed7372c3c2f6e8cdf1e69a467">04334</a> <span class="keywordtype">void</span> <a class="code" href="nfs__proto__tools_8h.html#a4ae3621ed7372c3c2f6e8cdf1e69a467">nfs4_access_debug</a>(<span class="keywordtype">char</span> *label, <a class="code" href="extended__types_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> access, <a class="code" href="fsal__types_8h.html#aeb79eb154b0c46e5b8130a5d89982428">fsal_aceperm_t</a> v4mask)
<a name="l04335"></a>04335 {
<a name="l04336"></a>04336   <a class="code" href="log_8h.html#aa7aee8ec65b5baafb430f8d2a7588d53">LogDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556af6e90cb9d43106e13df4e83652c94f27">COMPONENT_NFSPROTO</a>, <span class="stringliteral">&quot;%s=%s,%s,%s,%s,%s,%s&quot;</span>,
<a name="l04337"></a>04337            label,
<a name="l04338"></a>04338            <a class="code" href="fsal_8h.html#a22431080664a539634e88f4c7420aaef">FSAL_TEST_MASK</a>(access, <a class="code" href="nfs23_8h.html#a7ad99cccff38bb3a53d261dd35c3cf79">ACCESS3_READ</a>) ? <span class="stringliteral">&quot;READ&quot;</span> : <span class="stringliteral">&quot;-&quot;</span>,
<a name="l04339"></a>04339            <a class="code" href="fsal_8h.html#a22431080664a539634e88f4c7420aaef">FSAL_TEST_MASK</a>(access, <a class="code" href="nfs23_8h.html#a0ecd105be986d0c387c662dd6e4d1793">ACCESS3_LOOKUP</a>) ? <span class="stringliteral">&quot;LOOKUP&quot;</span> : <span class="stringliteral">&quot;-&quot;</span>,
<a name="l04340"></a>04340            <a class="code" href="fsal_8h.html#a22431080664a539634e88f4c7420aaef">FSAL_TEST_MASK</a>(access, <a class="code" href="nfs23_8h.html#ab3da3d85ecf5fbd06dbe40f12b761942">ACCESS3_MODIFY</a>) ? <span class="stringliteral">&quot;MODIFY&quot;</span> : <span class="stringliteral">&quot;-&quot;</span>,
<a name="l04341"></a>04341            <a class="code" href="fsal_8h.html#a22431080664a539634e88f4c7420aaef">FSAL_TEST_MASK</a>(access, <a class="code" href="nfs23_8h.html#a550d969b8907291b8328eac18824b8a8">ACCESS3_EXTEND</a>) ? <span class="stringliteral">&quot;EXTEND&quot;</span> : <span class="stringliteral">&quot;-&quot;</span>,
<a name="l04342"></a>04342            <a class="code" href="fsal_8h.html#a22431080664a539634e88f4c7420aaef">FSAL_TEST_MASK</a>(access, <a class="code" href="nfs23_8h.html#a1daefe290f2711ef4e4ba873dca7ec68">ACCESS3_DELETE</a>) ? <span class="stringliteral">&quot;DELETE&quot;</span> : <span class="stringliteral">&quot;-&quot;</span>,
<a name="l04343"></a>04343            <a class="code" href="fsal_8h.html#a22431080664a539634e88f4c7420aaef">FSAL_TEST_MASK</a>(access, <a class="code" href="nfs23_8h.html#aebd86a2fb196e0682736070fac8bf6fb">ACCESS3_EXECUTE</a>) ? <span class="stringliteral">&quot;EXECUTE&quot;</span> : <span class="stringliteral">&quot;-&quot;</span>);
<a name="l04344"></a>04344 
<a name="l04345"></a>04345   <span class="keywordflow">if</span>(v4mask)
<a name="l04346"></a>04346     <a class="code" href="log_8h.html#aa7aee8ec65b5baafb430f8d2a7588d53">LogDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556af6e90cb9d43106e13df4e83652c94f27">COMPONENT_NFSPROTO</a>, <span class="stringliteral">&quot;v4mask=%c%c%c%c%c%c%c%c%c%c%c%c%c%c&quot;</span>,
<a name="l04347"></a>04347              <a class="code" href="fsal_8h.html#a22431080664a539634e88f4c7420aaef">FSAL_TEST_MASK</a>(v4mask, <a class="code" href="fsal__types_8h.html#ad239f7c8e556aac3c852cdf131a0e78d">FSAL_ACE_PERM_READ_DATA</a>)             ? <span class="charliteral">&#39;r&#39;</span>:<span class="charliteral">&#39;-&#39;</span>,
<a name="l04348"></a>04348              <a class="code" href="fsal_8h.html#a22431080664a539634e88f4c7420aaef">FSAL_TEST_MASK</a>(v4mask, <a class="code" href="fsal__types_8h.html#a4c8c74f122161e99c6100affb92c5b59">FSAL_ACE_PERM_WRITE_DATA</a>)            ? <span class="charliteral">&#39;w&#39;</span>:<span class="charliteral">&#39;-&#39;</span>,
<a name="l04349"></a>04349              <a class="code" href="fsal_8h.html#a22431080664a539634e88f4c7420aaef">FSAL_TEST_MASK</a>(v4mask, <a class="code" href="fsal__types_8h.html#adbeb50c45f2c2085fbf4b1db7fe07f4b">FSAL_ACE_PERM_EXECUTE</a>)               ? <span class="charliteral">&#39;x&#39;</span>:<span class="charliteral">&#39;-&#39;</span>,
<a name="l04350"></a>04350              <a class="code" href="fsal_8h.html#a22431080664a539634e88f4c7420aaef">FSAL_TEST_MASK</a>(v4mask, <a class="code" href="fsal__types_8h.html#a013e1d66a050c80703c9c06989af3ddc">FSAL_ACE_PERM_ADD_SUBDIRECTORY</a>)    ? <span class="charliteral">&#39;m&#39;</span>:<span class="charliteral">&#39;-&#39;</span>,
<a name="l04351"></a>04351              <a class="code" href="fsal_8h.html#a22431080664a539634e88f4c7420aaef">FSAL_TEST_MASK</a>(v4mask, <a class="code" href="fsal__types_8h.html#ac1b54357ea396aa96027861276b15ae8">FSAL_ACE_PERM_READ_NAMED_ATTR</a>)       ? <span class="charliteral">&#39;n&#39;</span>:<span class="charliteral">&#39;-&#39;</span>,
<a name="l04352"></a>04352              <a class="code" href="fsal_8h.html#a22431080664a539634e88f4c7420aaef">FSAL_TEST_MASK</a>(v4mask, <a class="code" href="fsal__types_8h.html#ac25b2e6063e48abba9e9c4f9c1d6f823">FSAL_ACE_PERM_WRITE_NAMED_ATTR</a>)      ? <span class="charliteral">&#39;N&#39;</span>:<span class="charliteral">&#39;-&#39;</span>,
<a name="l04353"></a>04353              <a class="code" href="fsal_8h.html#a22431080664a539634e88f4c7420aaef">FSAL_TEST_MASK</a>(v4mask, <a class="code" href="fsal__types_8h.html#a261f82f6c5dc2108a32b7999707009b0">FSAL_ACE_PERM_DELETE_CHILD</a>)          ? <span class="charliteral">&#39;p&#39;</span>:<span class="charliteral">&#39;-&#39;</span>,
<a name="l04354"></a>04354              <a class="code" href="fsal_8h.html#a22431080664a539634e88f4c7420aaef">FSAL_TEST_MASK</a>(v4mask, <a class="code" href="fsal__types_8h.html#a80302116df024ca6832f2247e7fab626">FSAL_ACE_PERM_READ_ATTR</a>)             ? <span class="charliteral">&#39;t&#39;</span>:<span class="charliteral">&#39;-&#39;</span>,
<a name="l04355"></a>04355              <a class="code" href="fsal_8h.html#a22431080664a539634e88f4c7420aaef">FSAL_TEST_MASK</a>(v4mask, <a class="code" href="fsal__types_8h.html#a956477c2994c61508638d96181d0f2b7">FSAL_ACE_PERM_WRITE_ATTR</a>)            ? <span class="charliteral">&#39;T&#39;</span>:<span class="charliteral">&#39;-&#39;</span>,
<a name="l04356"></a>04356              <a class="code" href="fsal_8h.html#a22431080664a539634e88f4c7420aaef">FSAL_TEST_MASK</a>(v4mask, <a class="code" href="fsal__types_8h.html#afcb8a9239e32b320e4b5301cd77343cd">FSAL_ACE_PERM_DELETE</a>)                ? <span class="charliteral">&#39;d&#39;</span>:<span class="charliteral">&#39;-&#39;</span>,
<a name="l04357"></a>04357              <a class="code" href="fsal_8h.html#a22431080664a539634e88f4c7420aaef">FSAL_TEST_MASK</a>(v4mask, <a class="code" href="fsal__types_8h.html#a2553fecf1fd9ee636057009d2288e031">FSAL_ACE_PERM_READ_ACL</a>)              ? <span class="charliteral">&#39;c&#39;</span>:<span class="charliteral">&#39;-&#39;</span>,
<a name="l04358"></a>04358              <a class="code" href="fsal_8h.html#a22431080664a539634e88f4c7420aaef">FSAL_TEST_MASK</a>(v4mask, <a class="code" href="fsal__types_8h.html#a7251ea272c0b2d5b8f642d8caaca8bf5">FSAL_ACE_PERM_WRITE_ACL</a>)             ? <span class="charliteral">&#39;C&#39;</span>:<span class="charliteral">&#39;-&#39;</span>,
<a name="l04359"></a>04359              <a class="code" href="fsal_8h.html#a22431080664a539634e88f4c7420aaef">FSAL_TEST_MASK</a>(v4mask, <a class="code" href="fsal__types_8h.html#af4f3adbc877c73451695e385ffd348d4">FSAL_ACE_PERM_WRITE_OWNER</a>)   ? <span class="charliteral">&#39;o&#39;</span>:<span class="charliteral">&#39;-&#39;</span>,
<a name="l04360"></a>04360              <a class="code" href="fsal_8h.html#a22431080664a539634e88f4c7420aaef">FSAL_TEST_MASK</a>(v4mask, <a class="code" href="fsal__types_8h.html#ac2b0bd91a24c7b4037d50f9c33c9ef2d">FSAL_ACE_PERM_SYNCHRONIZE</a>)   ? <span class="charliteral">&#39;z&#39;</span>:<span class="charliteral">&#39;-&#39;</span>);
<a name="l04361"></a>04361 }
<a name="l04362"></a>04362 
<a name="l04377"></a><a class="code" href="nfs__proto__tools_8c.html#a0aca75bb08fb5037477dd5d14a9817a2">04377</a> <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0a">nfsstat4</a> <a class="code" href="nfs__proto__tools_8h.html#a0aca75bb08fb5037477dd5d14a9817a2">nfs4_sanity_check_FH</a>(<a class="code" href="structcompoud__data.html" title="Compound data.">compound_data_t</a> *data,
<a name="l04378"></a>04378                               <a class="code" href="cache__inode_8h.html#ae017962c50fe48834d8638069c7edc99">cache_inode_file_type_t</a> required_type)
<a name="l04379"></a>04379 {
<a name="l04380"></a>04380   <span class="comment">/* If there is no FH */</span>
<a name="l04381"></a>04381   <span class="keywordflow">if</span>(<a class="code" href="nfs__file__handle_8h.html#aea877e7eb396fbb3c64ff2eb789cf5fc">nfs4_Is_Fh_Empty</a>(&amp;(data-&gt;<a class="code" href="structcompoud__data.html#ab678a4d34551041e9b4ac9d2dfae4801">currentFH</a>)))
<a name="l04382"></a>04382     {
<a name="l04383"></a>04383       <a class="code" href="log_8h.html#aa7aee8ec65b5baafb430f8d2a7588d53">LogDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556afb05059e688b5317f3861f11bff44505">COMPONENT_FILEHANDLE</a>,
<a name="l04384"></a>04384                <span class="stringliteral">&quot;nfs4_Is_Fh_Empty failed&quot;</span>);
<a name="l04385"></a>04385       <span class="keywordflow">return</span> <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aa63c8fdb4f05114c5047f057f6717012e">NFS4ERR_NOFILEHANDLE</a>;
<a name="l04386"></a>04386     }
<a name="l04387"></a>04387 
<a name="l04388"></a>04388   <span class="comment">/* If the filehandle is invalid */</span>
<a name="l04389"></a>04389   <span class="keywordflow">if</span>(<a class="code" href="nfs__file__handle_8h.html#ac9471373d4493abc215f5d8b86783764">nfs4_Is_Fh_Invalid</a>(&amp;(data-&gt;<a class="code" href="structcompoud__data.html#ab678a4d34551041e9b4ac9d2dfae4801">currentFH</a>)))
<a name="l04390"></a>04390     {
<a name="l04391"></a>04391       <a class="code" href="log_8h.html#aa7aee8ec65b5baafb430f8d2a7588d53">LogDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556afb05059e688b5317f3861f11bff44505">COMPONENT_FILEHANDLE</a>,
<a name="l04392"></a>04392                <span class="stringliteral">&quot;nfs4_Is_Fh_Invalid failed&quot;</span>);
<a name="l04393"></a>04393       <span class="keywordflow">return</span> <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aad8e75713659423bc53b60934e6b2698f">NFS4ERR_BADHANDLE</a>;
<a name="l04394"></a>04394     }
<a name="l04395"></a>04395 
<a name="l04396"></a>04396   <span class="comment">/* Tests if the Filehandle is expired (for volatile filehandle) */</span>
<a name="l04397"></a>04397   <span class="keywordflow">if</span>(<a class="code" href="nfs__file__handle_8h.html#a5dd8010e82ca42c8cfb5afd636426813">nfs4_Is_Fh_Expired</a>(&amp;(data-&gt;<a class="code" href="structcompoud__data.html#ab678a4d34551041e9b4ac9d2dfae4801">currentFH</a>)))
<a name="l04398"></a>04398     {
<a name="l04399"></a>04399       <a class="code" href="log_8h.html#aa7aee8ec65b5baafb430f8d2a7588d53">LogDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556afb05059e688b5317f3861f11bff44505">COMPONENT_FILEHANDLE</a>,
<a name="l04400"></a>04400                <span class="stringliteral">&quot;nfs4_Is_Fh_Expired failed&quot;</span>);
<a name="l04401"></a>04401       <span class="keywordflow">return</span> <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aaae15974e850b796ae66526327e2b81c4">NFS4ERR_FHEXPIRED</a>;
<a name="l04402"></a>04402     }
<a name="l04403"></a>04403 
<a name="l04404"></a>04404   <span class="comment">/* Check for the correct file type */</span>
<a name="l04405"></a>04405   <span class="keywordflow">if</span> (required_type)
<a name="l04406"></a>04406     {
<a name="l04407"></a>04407       <span class="keywordflow">if</span>(data-&gt;<a class="code" href="structcompoud__data.html#ada60900c03d5b9d1ea618f97a56c31a4">current_filetype</a> != required_type)
<a name="l04408"></a>04408         {
<a name="l04409"></a>04409           <a class="code" href="log_8h.html#aa7aee8ec65b5baafb430f8d2a7588d53">LogDebug</a>(<a class="code" href="log_8h.html#aef38a41286a6a40320bc7d64135b1556af6e90cb9d43106e13df4e83652c94f27">COMPONENT_NFSPROTO</a>,
<a name="l04410"></a>04410                    <span class="stringliteral">&quot;Wrong file type&quot;</span>);
<a name="l04411"></a>04411 
<a name="l04412"></a>04412           <span class="keywordflow">if</span>(required_type == <a class="code" href="cache__inode_8h.html#a2aee8d2ff73574138b75922c7652162fa9d09f58160b1161920aad19080f568cc">DIRECTORY</a>)
<a name="l04413"></a>04413             <span class="keywordflow">return</span> <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aa45d2f7ac7308153fa3fdedfe1092392e">NFS4ERR_NOTDIR</a>;
<a name="l04414"></a>04414           <span class="keywordflow">if</span>(required_type == <a class="code" href="cache__inode_8h.html#a2aee8d2ff73574138b75922c7652162fa5aa1ff2096b431ab7b623de67c43484b">SYMBOLIC_LINK</a>)
<a name="l04415"></a>04415             <span class="keywordflow">return</span> <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aacd5ac22a1fa5139d3566ed06c20d9c7a">NFS4ERR_INVAL</a>;
<a name="l04416"></a>04416 
<a name="l04417"></a>04417           <span class="keywordflow">switch</span> (data-&gt;<a class="code" href="structcompoud__data.html#ada60900c03d5b9d1ea618f97a56c31a4">current_filetype</a>)
<a name="l04418"></a>04418             {
<a name="l04419"></a>04419             <span class="keywordflow">case</span> <a class="code" href="cache__inode_8h.html#a2aee8d2ff73574138b75922c7652162fa9d09f58160b1161920aad19080f568cc">DIRECTORY</a>:
<a name="l04420"></a>04420               <span class="keywordflow">return</span> <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aa7801063893b30bf5c0b8ebef330a8e51">NFS4ERR_ISDIR</a>;
<a name="l04421"></a>04421             <span class="keywordflow">default</span>:
<a name="l04422"></a>04422               <span class="keywordflow">return</span> <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aacd5ac22a1fa5139d3566ed06c20d9c7a">NFS4ERR_INVAL</a>;
<a name="l04423"></a>04423             }
<a name="l04424"></a>04424         }
<a name="l04425"></a>04425     }
<a name="l04426"></a>04426 
<a name="l04427"></a>04427   <span class="keywordflow">return</span> <a class="code" href="nfsv40_8h.html#aaef925ba78b4bc62effa8be298c23c0aacaca462c793854dd61337cf0b54fc166">NFS4_OK</a>;
<a name="l04428"></a>04428 }
<a name="l04429"></a>04429 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Wed Nov 21 2012 for nfs-ganesha by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </small></address>
</body>
</html>
