<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>nfs-ganesha: 9p_dispatcher.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.3 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">nfs-ganesha&#160;<span id="projectnumber">1.4</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<h1>9p_dispatcher.c File Reference</h1>  </div>
</div>
<div class="contents">

<p>The file that contain the '_9p_dispatcher_thread' routine for ganesha.  
<a href="#_details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;pthread.h&gt;</code><br/>
<code>#include &lt;fcntl.h&gt;</code><br/>
<code>#include &lt;sys/file.h&gt;</code><br/>
<code>#include &lt;sys/select.h&gt;</code><br/>
<code>#include &lt;poll.h&gt;</code><br/>
<code>#include &quot;HashData.h&quot;</code><br/>
<code>#include &quot;HashTable.h&quot;</code><br/>
<code>#include &quot;log.h&quot;</code><br/>
<code>#include &quot;abstract_mem.h&quot;</code><br/>
<code>#include &quot;<a class="el" href="nfs__init_8h_source.html">nfs_init.h</a>&quot;</code><br/>
<code>#include &quot;nfs_core.h&quot;</code><br/>
<code>#include &quot;cache_inode.h&quot;</code><br/>
<code>#include &quot;nfs_exports.h&quot;</code><br/>
<code>#include &quot;nfs_creds.h&quot;</code><br/>
<code>#include &quot;nfs_proto_functions.h&quot;</code><br/>
<code>#include &quot;nfs_dupreq.h&quot;</code><br/>
<code>#include &quot;nfs_file_handle.h&quot;</code><br/>
<code>#include &quot;nfs_stat.h&quot;</code><br/>
<code>#include &quot;SemN.h&quot;</code><br/>
<code>#include &quot;9p.h&quot;</code><br/>
</div>
<p><a href="9p__dispatcher_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="9p__dispatcher_8c.html#ac3f29ff4441fb9336214a06e3a8c55ca">P_FAMILY</a>&#160;&#160;&#160;AF_INET</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="9p__dispatcher_8c.html#acdee2cba7a7717cbe763db19a10c0225">DispatchWork9P</a> (<a class="el" href="structrequest__data____.html">request_data_t</a> *preq, unsigned int worker_index)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="9p__dispatcher_8c.html#a40f1cf2b6972734fbce1572ba15192f1">_9p_socket_thread</a> (void *Arg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="9p__dispatcher_8c.html#acf6dac1d9c6057d05fbee8f1cf830e45">_9p_create_socket</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="9p__dispatcher_8c.html#aae4976efebcebda4d63f81ebd98817e9">_9p_dispatcher_svc_run</a> (long int sock)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="9p__dispatcher_8c.html#a45e8b7e5ee90845e2231854451414b3d">_9p_dispatcher_thread</a> (void *Arg)</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>The file that contain the '_9p_dispatcher_thread' routine for ganesha. </p>
<dl class="date"><dt><b>Date:</b></dt><dd></dd></dl>
<dl class="rcs"><dt><b>Date:</b></dt><dd>2006/02/23 12:33:05 </dd></dl>
<p><a class="el" href="9p__dispatcher_8c.html" title="The file that contain the &#39;_9p_dispatcher_thread&#39; routine for ganesha.">9p_dispatcher.c</a> : The file that contain the '_9p_dispatcher_thread' routine for ganesha (and all the related stuff). </p>

<p>Definition in file <a class="el" href="9p__dispatcher_8c_source.html">9p_dispatcher.c</a>.</p>
</div><hr/><h2>Define Documentation</h2>
<a class="anchor" id="ac3f29ff4441fb9336214a06e3a8c55ca"></a><!-- doxytag: member="9p_dispatcher.c::P_FAMILY" ref="ac3f29ff4441fb9336214a06e3a8c55ca" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P_FAMILY&#160;&#160;&#160;AF_INET</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="9p__dispatcher_8c_source.html#l00067">67</a> of file <a class="el" href="9p__dispatcher_8c_source.html">9p_dispatcher.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="acf6dac1d9c6057d05fbee8f1cf830e45"></a><!-- doxytag: member="9p_dispatcher.c::_9p_create_socket" ref="acf6dac1d9c6057d05fbee8f1cf830e45" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int _9p_create_socket </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>_9p_create_socket: create the accept socket for 9P</p>
<p>This function create the accept socket for the 9p dispatcher thread.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">(none)</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>socket fd or -1 if failed. </dd></dl>

<p>Definition at line <a class="el" href="9p__dispatcher_8c_source.html#l00290">290</a> of file <a class="el" href="9p__dispatcher_8c_source.html">9p_dispatcher.c</a>.</p>

</div>
</div>
<a class="anchor" id="aae4976efebcebda4d63f81ebd98817e9"></a><!-- doxytag: member="9p_dispatcher.c::_9p_dispatcher_svc_run" ref="aae4976efebcebda4d63f81ebd98817e9" args="(long int sock)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void _9p_dispatcher_svc_run </td>
          <td>(</td>
          <td class="paramtype">long int&#160;</td>
          <td class="paramname"><em>sock</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>_9p_dispatcher_svc_run: main loop for 9p dispatcher</p>
<p>This function is the main loop for the 9p dispatcher. It never returns because it is an infinite loop.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">sock</td><td>accept socket for 9p dispatch</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>nothing (void function). </dd></dl>

<p>Definition at line <a class="el" href="9p__dispatcher_8c_source.html#l00393">393</a> of file <a class="el" href="9p__dispatcher_8c_source.html">9p_dispatcher.c</a>.</p>

</div>
</div>
<a class="anchor" id="a45e8b7e5ee90845e2231854451414b3d"></a><!-- doxytag: member="9p_dispatcher.c::_9p_dispatcher_thread" ref="a45e8b7e5ee90845e2231854451414b3d" args="(void *Arg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* _9p_dispatcher_thread </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>Arg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>_9p_dispatcher_thread: thread used for RPC dispatching.</p>
<p>Thead used for RPC dispatching. It gets the requests and then spool it to one of the worker's LRU. The worker chosen is the one with the smaller load (its LRU is the shorter one).</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">Arg</td><td>(unused)</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Pointer to the result (but this function will mostly loop forever). </dd></dl>

<p>Definition at line <a class="el" href="9p__dispatcher_8c_source.html#l00448">448</a> of file <a class="el" href="9p__dispatcher_8c_source.html">9p_dispatcher.c</a>.</p>

</div>
</div>
<a class="anchor" id="a40f1cf2b6972734fbce1572ba15192f1"></a><!-- doxytag: member="9p_dispatcher.c::_9p_socket_thread" ref="a40f1cf2b6972734fbce1572ba15192f1" args="(void *Arg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* _9p_socket_thread </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>Arg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>_9p_socket_thread: 9p socket manager.</p>
<p>This function is the main loop for the 9p socket manager. One such thread exists per connection.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">Arg</td><td>the socket number cast as a void * in pthread_create</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>NULL </dd></dl>

<p>Definition at line <a class="el" href="9p__dispatcher_8c_source.html#l00110">110</a> of file <a class="el" href="9p__dispatcher_8c_source.html">9p_dispatcher.c</a>.</p>

</div>
</div>
<a class="anchor" id="acdee2cba7a7717cbe763db19a10c0225"></a><!-- doxytag: member="9p_dispatcher.c::DispatchWork9P" ref="acdee2cba7a7717cbe763db19a10c0225" args="(request_data_t *preq, unsigned int worker_index)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void DispatchWork9P </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structrequest__data____.html">request_data_t</a> *&#160;</td>
          <td class="paramname"><em>preq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>worker_index</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="9p__dispatcher_8c_source.html#l00072">72</a> of file <a class="el" href="9p__dispatcher_8c_source.html">9p_dispatcher.c</a>.</p>

</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Wed Nov 21 2012 for nfs-ganesha by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </small></address>
</body>
</html>
