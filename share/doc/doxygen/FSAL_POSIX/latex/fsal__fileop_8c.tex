\section{fsal\_\-fileop.c File Reference}
\label{fsal__fileop_8c}\index{fsal\_\-fileop.c@{fsal\_\-fileop.c}}


Files operations.  
{\ttfamily \#include \char`\"{}fsal.h\char`\"{}}\par
{\ttfamily \#include \char`\"{}fsal\_\-internal.h\char`\"{}}\par
{\ttfamily \#include \char`\"{}fsal\_\-convert.h\char`\"{}}\par
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
fsal\_\-status\_\-t {\bf POSIXFSAL\_\-open\_\-by\_\-name} (posixfsal\_\-handle\_\-t $\ast$dirhandle, fsal\_\-name\_\-t $\ast$filename, posixfsal\_\-op\_\-context\_\-t $\ast$p\_\-context, fsal\_\-openflags\_\-t openflags, posixfsal\_\-file\_\-t $\ast$file\_\-descriptor, fsal\_\-attrib\_\-list\_\-t $\ast$file\_\-attributes)
\item 
fsal\_\-status\_\-t {\bf POSIXFSAL\_\-open} (posixfsal\_\-handle\_\-t $\ast$p\_\-filehandle, posixfsal\_\-op\_\-context\_\-t $\ast$p\_\-context, fsal\_\-openflags\_\-t openflags, posixfsal\_\-file\_\-t $\ast$p\_\-file\_\-descriptor, fsal\_\-attrib\_\-list\_\-t $\ast$p\_\-file\_\-attributes)
\item 
fsal\_\-status\_\-t {\bf POSIXFSAL\_\-read} (posixfsal\_\-file\_\-t $\ast$p\_\-file\_\-descriptor, fsal\_\-seek\_\-t $\ast$p\_\-seek\_\-descriptor, fsal\_\-size\_\-t buffer\_\-size, caddr\_\-t buffer, fsal\_\-size\_\-t $\ast$p\_\-read\_\-amount, fsal\_\-boolean\_\-t $\ast$p\_\-end\_\-of\_\-file)
\item 
fsal\_\-status\_\-t {\bf POSIXFSAL\_\-write} (posixfsal\_\-file\_\-t $\ast$p\_\-file\_\-descriptor, fsal\_\-seek\_\-t $\ast$p\_\-seek\_\-descriptor, fsal\_\-size\_\-t buffer\_\-size, caddr\_\-t buffer, fsal\_\-size\_\-t $\ast$p\_\-write\_\-amount)
\item 
fsal\_\-status\_\-t {\bf POSIXFSAL\_\-close} (posixfsal\_\-file\_\-t $\ast$p\_\-file\_\-descriptor)
\item 
fsal\_\-status\_\-t {\bfseries POSIXFSAL\_\-open\_\-by\_\-fileid} (posixfsal\_\-handle\_\-t $\ast$filehandle, fsal\_\-u64\_\-t fileid, posixfsal\_\-op\_\-context\_\-t $\ast$p\_\-context, fsal\_\-openflags\_\-t openflags, posixfsal\_\-file\_\-t $\ast$file\_\-descriptor, fsal\_\-attrib\_\-list\_\-t $\ast$file\_\-attributes)\label{fsal__fileop_8c_a53006139e77cf510d85cffe2f97f7857}

\item 
fsal\_\-status\_\-t {\bfseries POSIXFSAL\_\-close\_\-by\_\-fileid} (posixfsal\_\-file\_\-t $\ast$file\_\-descriptor, fsal\_\-u64\_\-t fileid)\label{fsal__fileop_8c_a19441298e883e70110fadaa2e06112c1}

\item 
unsigned int {\bfseries POSIXFSAL\_\-GetFileno} (posixfsal\_\-file\_\-t $\ast$pfile)\label{fsal__fileop_8c_a73c50cfaa496471eba04213b3b603d2a}

\end{DoxyCompactItemize}


\subsection{Detailed Description}
Files operations. \begin{DoxyAuthor}{Author}

\end{DoxyAuthor}
Author}
leibovic \begin{DoxyDate}{Date}

\end{DoxyDate}
Date}
2006/01/17 14:20:07 \begin{DoxyVersion}{Version}

\end{DoxyVersion}
Revision}
1.9 

Definition in file {\bf fsal\_\-fileop.c}.

\subsection{Function Documentation}
\index{fsal\_\-fileop.c@{fsal\_\-fileop.c}!POSIXFSAL\_\-close@{POSIXFSAL\_\-close}}
\index{POSIXFSAL\_\-close@{POSIXFSAL\_\-close}!fsal_fileop.c@{fsal\_\-fileop.c}}
\subsubsection[{POSIXFSAL\_\-close}]{\setlength{\rightskip}{0pt plus 5cm}fsal\_\-status\_\-t POSIXFSAL\_\-close (posixfsal\_\-file\_\-t $\ast$ {\em p\_\-file\_\-descriptor})}\label{fsal__fileop_8c_aaf458f8d02b120b7d176f1f2e930a259}
FSAL\_\-close: Free the resources allocated by the FSAL\_\-open call.


\begin{DoxyParams}{Parameters}
\item[{\em file\_\-descriptor}](input): The file descriptor returned by FSAL\_\-open.\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Major error codes:
\begin{DoxyItemize}
\item ERR\_\-FSAL\_\-NO\_\-ERROR: no error.
\item Another error code if an error occured during this call. 
\end{DoxyItemize}
\end{DoxyReturn}


Definition at line 655 of file fsal\_\-fileop.c.

References posix2fsal\_\-error(), and TakeTokenFSCall().

Referenced by POSIXFSAL\_\-rcp().\index{fsal\_\-fileop.c@{fsal\_\-fileop.c}!POSIXFSAL\_\-open@{POSIXFSAL\_\-open}}
\index{POSIXFSAL\_\-open@{POSIXFSAL\_\-open}!fsal_fileop.c@{fsal\_\-fileop.c}}
\subsubsection[{POSIXFSAL\_\-open}]{\setlength{\rightskip}{0pt plus 5cm}fsal\_\-status\_\-t POSIXFSAL\_\-open (posixfsal\_\-handle\_\-t $\ast$ {\em p\_\-filehandle}, \/  posixfsal\_\-op\_\-context\_\-t $\ast$ {\em p\_\-context}, \/  fsal\_\-openflags\_\-t {\em openflags}, \/  posixfsal\_\-file\_\-t $\ast$ {\em p\_\-file\_\-descriptor}, \/  fsal\_\-attrib\_\-list\_\-t $\ast$ {\em p\_\-file\_\-attributes})}\label{fsal__fileop_8c_a1cdc5a82565a4174a581751c73fcdf70}
FSAL\_\-open: Open a regular file for reading/writing its data content.


\begin{DoxyParams}{Parameters}
\item[{\em filehandle}](input): Handle of the file to be read/modified. \item[{\em cred}](input): Authentication context for the operation (user,...). \item[{\em openflags}](input): Flags that indicates behavior for file opening and access. This is an inclusive OR of the following values ( such of them are not compatible) :
\begin{DoxyItemize}
\item FSAL\_\-O\_\-RDONLY: opening file for reading only.
\item FSAL\_\-O\_\-RDWR: opening file for reading and writing.
\item FSAL\_\-O\_\-WRONLY: opening file for writting only.
\item FSAL\_\-O\_\-APPEND: always write at the end of the file.
\item FSAL\_\-O\_\-TRUNC: truncate the file to 0 on opening. 
\end{DoxyItemize}\item[{\em file\_\-descriptor}](output): The file descriptor to be used for FSAL\_\-read/write operations. \item[{\em file\_\-attributes}](optionnal input/output): Post operation attributes. As input, it defines the attributes that the caller wants to retrieve (by positioning flags into this structure) and the output is built considering this input (it fills the structure according to the flags it contains).\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Major error codes:
\begin{DoxyItemize}
\item ERR\_\-FSAL\_\-NO\_\-ERROR: no error.
\item Another error code if an error occured during this call. 
\end{DoxyItemize}
\end{DoxyReturn}


Definition at line 113 of file fsal\_\-fileop.c.

References fsal2posix\_\-openflags(), fsal\_\-internal\_\-getPathFromHandle(), posix2fsal\_\-error(), and TakeTokenFSCall().

Referenced by POSIXFSAL\_\-open\_\-by\_\-name(), and POSIXFSAL\_\-rcp().\index{fsal\_\-fileop.c@{fsal\_\-fileop.c}!POSIXFSAL\_\-open\_\-by\_\-name@{POSIXFSAL\_\-open\_\-by\_\-name}}
\index{POSIXFSAL\_\-open\_\-by\_\-name@{POSIXFSAL\_\-open\_\-by\_\-name}!fsal_fileop.c@{fsal\_\-fileop.c}}
\subsubsection[{POSIXFSAL\_\-open\_\-by\_\-name}]{\setlength{\rightskip}{0pt plus 5cm}fsal\_\-status\_\-t POSIXFSAL\_\-open\_\-by\_\-name (posixfsal\_\-handle\_\-t $\ast$ {\em dirhandle}, \/  fsal\_\-name\_\-t $\ast$ {\em filename}, \/  posixfsal\_\-op\_\-context\_\-t $\ast$ {\em p\_\-context}, \/  fsal\_\-openflags\_\-t {\em openflags}, \/  posixfsal\_\-file\_\-t $\ast$ {\em file\_\-descriptor}, \/  fsal\_\-attrib\_\-list\_\-t $\ast$ {\em file\_\-attributes})}\label{fsal__fileop_8c_a30dfbf30fdcf712265cd8e7fb92bf81e}
FSAL\_\-open\_\-byname: Open a regular file for reading/writing its data content.


\begin{DoxyParams}{Parameters}
\item[{\em dirhandle}](input): Handle of the directory that contain the file to be read/modified. \item[{\em filename}](input): Name of the file to be read/modified \item[{\em cred}](input): Authentication context for the operation (user,...). \item[{\em openflags}](input): Flags that indicates behavior for file opening and access. This is an inclusive OR of the following values ( such of them are not compatible) :
\begin{DoxyItemize}
\item FSAL\_\-O\_\-RDONLY: opening file for reading only.
\item FSAL\_\-O\_\-RDWR: opening file for reading and writing.
\item FSAL\_\-O\_\-WRONLY: opening file for writting only.
\item FSAL\_\-O\_\-APPEND: always write at the end of the file.
\item FSAL\_\-O\_\-TRUNC: truncate the file to 0 on opening. 
\end{DoxyItemize}\item[{\em file\_\-descriptor}](output): The file descriptor to be used for FSAL\_\-read/write operations. \item[{\em file\_\-attributes}](optionnal input/output): Post operation attributes. As input, it defines the attributes that the caller wants to retrieve (by positioning flags into this structure) and the output is built considering this input (it fills the structure according to the flags it contains).\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Major error codes:
\begin{DoxyItemize}
\item ERR\_\-FSAL\_\-NO\_\-ERROR (no error)
\item ERR\_\-FSAL\_\-ACCESS (user doesn't have the permissions for opening the file)
\item ERR\_\-FSAL\_\-STALE (filehandle does not address an existing object)
\item ERR\_\-FSAL\_\-INVAL (filehandle does not address a regular file, or open flags are conflicting)
\item ERR\_\-FSAL\_\-FAULT (a NULL pointer was passed as mandatory argument)
\item Other error codes can be returned : ERR\_\-FSAL\_\-IO, ... 
\end{DoxyItemize}
\end{DoxyReturn}


Definition at line 60 of file fsal\_\-fileop.c.

References POSIXFSAL\_\-lookup(), and POSIXFSAL\_\-open().\index{fsal\_\-fileop.c@{fsal\_\-fileop.c}!POSIXFSAL\_\-read@{POSIXFSAL\_\-read}}
\index{POSIXFSAL\_\-read@{POSIXFSAL\_\-read}!fsal_fileop.c@{fsal\_\-fileop.c}}
\subsubsection[{POSIXFSAL\_\-read}]{\setlength{\rightskip}{0pt plus 5cm}fsal\_\-status\_\-t POSIXFSAL\_\-read (posixfsal\_\-file\_\-t $\ast$ {\em p\_\-file\_\-descriptor}, \/  fsal\_\-seek\_\-t $\ast$ {\em p\_\-seek\_\-descriptor}, \/  fsal\_\-size\_\-t {\em buffer\_\-size}, \/  caddr\_\-t {\em buffer}, \/  fsal\_\-size\_\-t $\ast$ {\em p\_\-read\_\-amount}, \/  fsal\_\-boolean\_\-t $\ast$ {\em p\_\-end\_\-of\_\-file})}\label{fsal__fileop_8c_adbed54d9e06272c3baad10998c2d51cf}
FSAL\_\-read: Perform a read operation on an opened file.


\begin{DoxyParams}{Parameters}
\item[{\em file\_\-descriptor}](input): The file descriptor returned by FSAL\_\-open. \item[{\em seek\_\-descriptor}](optional input): Specifies the position where data is to be read. If not specified, data will be read at the current position. \item[{\em buffer\_\-size}](input): Amount (in bytes) of data to be read. \item[{\em buffer}](output): Address where the read data is to be stored in memory. \item[{\em read\_\-amount}](output): Pointer to the amount of data (in bytes) that have been read during this call. \item[{\em end\_\-of\_\-file}](output): Pointer to a boolean that indicates whether the end of file has been reached during this call.\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Major error codes:
\begin{DoxyItemize}
\item ERR\_\-FSAL\_\-NO\_\-ERROR: no error.
\item Another error code if an error occured during this call. 
\end{DoxyItemize}
\end{DoxyReturn}


\begin{Desc}
\item[{\bf Todo}]: manage fsal\_\-size\_\-t to size\_\-t convertion \end{Desc}


\begin{Desc}
\item[{\bf Todo}]: manage ssize\_\-t to fsal\_\-size\_\-t convertion \end{Desc}


Definition at line 317 of file fsal\_\-fileop.c.

References posix2fsal\_\-error(), and TakeTokenFSCall().

Referenced by POSIXFSAL\_\-rcp().\index{fsal\_\-fileop.c@{fsal\_\-fileop.c}!POSIXFSAL\_\-write@{POSIXFSAL\_\-write}}
\index{POSIXFSAL\_\-write@{POSIXFSAL\_\-write}!fsal_fileop.c@{fsal\_\-fileop.c}}
\subsubsection[{POSIXFSAL\_\-write}]{\setlength{\rightskip}{0pt plus 5cm}fsal\_\-status\_\-t POSIXFSAL\_\-write (posixfsal\_\-file\_\-t $\ast$ {\em p\_\-file\_\-descriptor}, \/  fsal\_\-seek\_\-t $\ast$ {\em p\_\-seek\_\-descriptor}, \/  fsal\_\-size\_\-t {\em buffer\_\-size}, \/  caddr\_\-t {\em buffer}, \/  fsal\_\-size\_\-t $\ast$ {\em p\_\-write\_\-amount})}\label{fsal__fileop_8c_a0324573c407577df6db8311c8ccba321}
FSAL\_\-write: Perform a write operation on an opened file.


\begin{DoxyParams}{Parameters}
\item[{\em file\_\-descriptor}](input): The file descriptor returned by FSAL\_\-open. \item[{\em seek\_\-descriptor}](optional input): Specifies the position where data is to be written. If not specified, data will be written at the current position. \item[{\em buffer\_\-size}](input): Amount (in bytes) of data to be written. \item[{\em buffer}](input): Address in memory of the data to write to file. \item[{\em write\_\-amount}](output): Pointer to the amount of data (in bytes) that have been written during this call.\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Major error codes:
\begin{DoxyItemize}
\item ERR\_\-FSAL\_\-NO\_\-ERROR: no error.
\item Another error code if an error occured during this call. 
\end{DoxyItemize}
\end{DoxyReturn}


\begin{Desc}
\item[{\bf Todo}]: manage fsal\_\-size\_\-t to size\_\-t convertion \end{Desc}


\begin{Desc}
\item[{\bf Todo}]: manage ssize\_\-t to fsal\_\-size\_\-t convertion \end{Desc}


Definition at line 551 of file fsal\_\-fileop.c.

References posix2fsal\_\-error(), and TakeTokenFSCall().

Referenced by POSIXFSAL\_\-rcp().