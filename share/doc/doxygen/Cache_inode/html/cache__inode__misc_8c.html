<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Cache inode layer: cache_inode_misc.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>cache_inode_misc.c File Reference</h1><code>#include &quot;LRU_List.h&quot;</code><br/>
<code>#include &quot;log_macros.h&quot;</code><br/>
<code>#include &quot;HashData.h&quot;</code><br/>
<code>#include &quot;HashTable.h&quot;</code><br/>
<code>#include &quot;fsal.h&quot;</code><br/>
<code>#include &quot;cache_inode.h&quot;</code><br/>
<code>#include &quot;cache_content.h&quot;</code><br/>
<code>#include &quot;stuff_alloc.h&quot;</code><br/>
<code>#include &lt;unistd.h&gt;</code><br/>
<code>#include &lt;sys/types.h&gt;</code><br/>
<code>#include &lt;sys/param.h&gt;</code><br/>
<code>#include &lt;time.h&gt;</code><br/>
<code>#include &lt;pthread.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>

<p><a href="cache__inode__misc_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cache__inode__misc_8c.html#a03943706e48069237cd57f2d35ca987e">XSTR</a>(s)&nbsp;&nbsp;&nbsp;STR(s)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cache__inode__misc_8c.html#a6388870e639eee9c0a69446876f1f8cc">STR</a>(s)&nbsp;&nbsp;&nbsp;#s</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cache__inode__misc_8c.html#ab2ed61f21523805c300eae3d843ada57">cache_inode_compare_key_fsal</a> (hash_buffer_t *buff1, hash_buffer_t *buff2)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cache__inode__misc_8c.html#a7bf5883d643f1a7940f2290a6d2d9686">cache_inode_fsaldata_2_key</a> (hash_buffer_t *pkey, cache_inode_fsal_data_t *pfsdata, cache_inode_client_t *pclient)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cache__inode__misc_8c.html#a85615042ce506cf412216455b73ada68">cache_inode_release_fsaldata_key</a> (hash_buffer_t *pkey, cache_inode_client_t *pclient)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cache_entry_t *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cache__inode__misc_8c.html#a8392006e0fb4aea7143cfd950e91a74a">cache_inode_new_entry</a> (cache_inode_fsal_data_t *pfsdata, fsal_attrib_list_t *pfsal_attr, cache_inode_file_type_t type, cache_inode_create_arg_t *pcreate_arg, cache_entry_t *pentry_dir_prev, hash_table_t *ht, cache_inode_client_t *pclient, fsal_op_context_t *pcontext, unsigned int create_flag, cache_inode_status_t *pstatus)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cache_inode_status_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cache__inode__misc_8c.html#aefe5de533cbaea1af0370e4393c74c4c">cache_inode_clean_entry</a> (cache_entry_t *pentry)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cache_inode_status_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cache__inode__misc_8c.html#aaa50487b9b403fd85b4a845de1a3df69">cache_inode_error_convert</a> (fsal_status_t fsal_status)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cache_inode_status_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cache__inode__misc_8c.html#aa34ae3526aa5eb8bc0f96e54a3fe8861">cache_inode_valid</a> (cache_entry_t *pentry, cache_inode_op_t op, cache_inode_client_t *pclient)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cache__inode__misc_8c.html#a8b74ff8be25748ce96f1d6258409d27d">cache_inode_get_attributes</a> (cache_entry_t *pentry, fsal_attrib_list_t *pattr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cache__inode__misc_8c.html#a7da7b52764bdb6c1a6d60a2a979322aa">cache_inode_set_attributes</a> (cache_entry_t *pentry, fsal_attrib_list_t *pattr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cache_inode_file_type_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cache__inode__misc_8c.html#a8f6934bbf38300379caf1342b6a63b26">cache_inode_fsal_type_convert</a> (fsal_nodetype_t type)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">fsal_handle_t *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cache__inode__misc_8c.html#a625ee0acb63c4e7f1b342389c5dd7a0b">cache_inode_get_fsal_handle</a> (cache_entry_t *pentry, cache_inode_status_t *pstatus)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cache__inode__misc_8c.html#a276225d5d7db59f532f94ca6cf32ab53">cache_inode_type_are_rename_compatible</a> (cache_entry_t *pentry_src, cache_entry_t *pentry_dest)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cache__inode__misc_8c.html#a5c72fb619678af886176784ba7250b3c">cache_inode_mutex_destroy</a> (cache_entry_t *pentry)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cache__inode__misc_8c.html#ab405ebfdd83c07441a5f617862fd789a">cache_inode_print_dir</a> (cache_entry_t *cache_entry_root)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cache_inode_status_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cache__inode__misc_8c.html#ad4bd35e3d32d663afea3499d1a29199e">cache_inode_dump_content</a> (char *path, cache_entry_t *pentry)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cache_inode_status_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cache__inode__misc_8c.html#ae0a8ae792a80e2143f3ae5cc1bffe95d">cache_inode_reload_content</a> (char *path, cache_entry_t *pentry)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">cache_inode_status_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cache__inode__misc_8c.html#aed59b090dbed68c7eca3a1b5514a11c5">cache_inode_kill_entry</a> (cache_entry_t *pentry, hash_table_t *ht, cache_inode_client_t *pclient, cache_inode_status_t *pstatus)</td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a6388870e639eee9c0a69446876f1f8cc"></a><!-- doxytag: member="cache_inode_misc.c::STR" ref="a6388870e639eee9c0a69446876f1f8cc" args="(s)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STR</td>
          <td>(</td>
          <td class="paramtype">s&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;#s</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a03943706e48069237cd57f2d35ca987e"></a><!-- doxytag: member="cache_inode_misc.c::XSTR" ref="a03943706e48069237cd57f2d35ca987e" args="(s)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define XSTR</td>
          <td>(</td>
          <td class="paramtype">s&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;STR(s)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="aefe5de533cbaea1af0370e4393c74c4c"></a><!-- doxytag: member="cache_inode_misc.c::cache_inode_clean_entry" ref="aefe5de533cbaea1af0370e4393c74c4c" args="(cache_entry_t *pentry)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cache_inode_status_t cache_inode_clean_entry </td>
          <td>(</td>
          <td class="paramtype">cache_entry_t *&nbsp;</td>
          <td class="paramname"> <em>pentry</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>cache_clean_entry: cleans an entry when it is garbagge collected.</p>
<p>Cleans an entry when it is garbagge collected.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pentry</em>&nbsp;</td><td>[INOUT] the entry to be cleaned.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>CACHE_INODE_SUCCESS in all cases. </dd></dl>

<p>Definition at line <a class="el" href="cache__inode__misc_8c_source.html#l00677">677</a> of file <a class="el" href="cache__inode__misc_8c_source.html">cache_inode_misc.c</a>.</p>

</div>
</div>
<a class="anchor" id="ab2ed61f21523805c300eae3d843ada57"></a><!-- doxytag: member="cache_inode_misc.c::cache_inode_compare_key_fsal" ref="ab2ed61f21523805c300eae3d843ada57" args="(hash_buffer_t *buff1, hash_buffer_t *buff2)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cache_inode_compare_key_fsal </td>
          <td>(</td>
          <td class="paramtype">hash_buffer_t *&nbsp;</td>
          <td class="paramname"> <em>buff1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">hash_buffer_t *&nbsp;</td>
          <td class="paramname"> <em>buff2</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>cache_inode_compare_key_fsal: Compares two keys used in cache inode.</p>
<p>Compare two keys used in cache inode. These keys are basically made from FSAL related information.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>buff1</em>&nbsp;</td><td>[IN] first key </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>buff2</em>&nbsp;</td><td>[IN] second key </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 if keys are the same, 1 otherwise</dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd>FSAL_handlecmp </dd></dl>

<p>Definition at line <a class="el" href="cache__inode__misc_8c_source.html#l00077">77</a> of file <a class="el" href="cache__inode__misc_8c_source.html">cache_inode_misc.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad4bd35e3d32d663afea3499d1a29199e"></a><!-- doxytag: member="cache_inode_misc.c::cache_inode_dump_content" ref="ad4bd35e3d32d663afea3499d1a29199e" args="(char *path, cache_entry_t *pentry)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cache_inode_status_t cache_inode_dump_content </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cache_entry_t *&nbsp;</td>
          <td class="paramname"> <em>pentry</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>cache_inode_dump_content: dumps the content of a pentry to a local file (used for File Content index files).</p>
<p>Dumps the content of a pentry to a local file (used for File Content index files).</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>path</em>&nbsp;</td><td>[IN] the full path to the file that will contain the data. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pentry</em>&nbsp;</td><td>[IN] the input pentry.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>CACHE_INODE_BAD_TYPE if pentry is not related to a REGULAR_FILE <br/>
 </dd>
<dd>
CACHE_INODE_INVALID_ARGUMENT if path is inconsistent <br/>
 </dd>
<dd>
CACHE_INODE_SUCCESS if operation succeded. </dd></dl>

<p>Definition at line <a class="el" href="cache__inode__misc_8c_source.html#l01278">1278</a> of file <a class="el" href="cache__inode__misc_8c_source.html">cache_inode_misc.c</a>.</p>

</div>
</div>
<a class="anchor" id="aaa50487b9b403fd85b4a845de1a3df69"></a><!-- doxytag: member="cache_inode_misc.c::cache_inode_error_convert" ref="aaa50487b9b403fd85b4a845de1a3df69" args="(fsal_status_t fsal_status)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cache_inode_status_t cache_inode_error_convert </td>
          <td>(</td>
          <td class="paramtype">fsal_status_t&nbsp;</td>
          <td class="paramname"> <em>fsal_status</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>cache_inode_error_convert: converts an FSAL error to the corresponding cache_inode error.</p>
<p>Converts an FSAL error to the corresponding cache_inode error.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fsal_status</em>&nbsp;</td><td>[IN] fsal error to be converted.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>the result of the conversion. </dd></dl>

<p>Definition at line <a class="el" href="cache__inode__misc_8c_source.html#l00699">699</a> of file <a class="el" href="cache__inode__misc_8c_source.html">cache_inode_misc.c</a>.</p>

</div>
</div>
<a class="anchor" id="a8f6934bbf38300379caf1342b6a63b26"></a><!-- doxytag: member="cache_inode_misc.c::cache_inode_fsal_type_convert" ref="a8f6934bbf38300379caf1342b6a63b26" args="(fsal_nodetype_t type)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cache_inode_file_type_t cache_inode_fsal_type_convert </td>
          <td>(</td>
          <td class="paramtype">fsal_nodetype_t&nbsp;</td>
          <td class="paramname"> <em>type</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>cache_inode_fsal_type_convert: converts an FSAL type to the cache_inode type to be used.</p>
<p>Converts an FSAL type to the cache_inode type to be used.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>type</em>&nbsp;</td><td>[IN] the input FSAL type.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>the result of the conversion. </dd></dl>

<p>Definition at line <a class="el" href="cache__inode__misc_8c_source.html#l01038">1038</a> of file <a class="el" href="cache__inode__misc_8c_source.html">cache_inode_misc.c</a>.</p>

</div>
</div>
<a class="anchor" id="a7bf5883d643f1a7940f2290a6d2d9686"></a><!-- doxytag: member="cache_inode_misc.c::cache_inode_fsaldata_2_key" ref="a7bf5883d643f1a7940f2290a6d2d9686" args="(hash_buffer_t *pkey, cache_inode_fsal_data_t *pfsdata, cache_inode_client_t *pclient)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cache_inode_fsaldata_2_key </td>
          <td>(</td>
          <td class="paramtype">hash_buffer_t *&nbsp;</td>
          <td class="paramname"> <em>pkey</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cache_inode_fsal_data_t *&nbsp;</td>
          <td class="paramname"> <em>pfsdata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cache_inode_client_t *&nbsp;</td>
          <td class="paramname"> <em>pclient</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>cache_inode_fsaldata_2_key: builds a key from the FSAL data.</p>
<p>Builds a key from the FSAL data. If the key is used for reading and stay local to the function pclient can be NULL (psfsdata in the scope of the current calling routine is used). If the key must survive after the end of the calling routine, a new key is allocated and ressource in *pclient are used</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pkey</em>&nbsp;</td><td>[OUT] computed key </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pfsdata</em>&nbsp;</td><td>[IN] FSAL data to be used to compute the key </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pclient</em>&nbsp;</td><td>[INOUT] if NULL, pfsdata is used to build the key (that stay local), if not pool_key is used to allocate a new key </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 if keys if successfully build, 1 otherwise </dd></dl>

<p>Definition at line <a class="el" href="cache__inode__misc_8c_source.html#l00121">121</a> of file <a class="el" href="cache__inode__misc_8c_source.html">cache_inode_misc.c</a>.</p>

</div>
</div>
<a class="anchor" id="a8b74ff8be25748ce96f1d6258409d27d"></a><!-- doxytag: member="cache_inode_misc.c::cache_inode_get_attributes" ref="a8b74ff8be25748ce96f1d6258409d27d" args="(cache_entry_t *pentry, fsal_attrib_list_t *pattr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cache_inode_get_attributes </td>
          <td>(</td>
          <td class="paramtype">cache_entry_t *&nbsp;</td>
          <td class="paramname"> <em>pentry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">fsal_attrib_list_t *&nbsp;</td>
          <td class="paramname"> <em>pattr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>cache_inode_get_attributes: gets the attributes cached in the entry.</p>
<p>Gets the attributes cached in the entry.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pentry</em>&nbsp;</td><td>[IN] the entry to deal with. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pattr</em>&nbsp;</td><td>[OUT] the attributes for this entry.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>nothing (void function). </dd></dl>

<p>Definition at line <a class="el" href="cache__inode__misc_8c_source.html#l00947">947</a> of file <a class="el" href="cache__inode__misc_8c_source.html">cache_inode_misc.c</a>.</p>

</div>
</div>
<a class="anchor" id="a625ee0acb63c4e7f1b342389c5dd7a0b"></a><!-- doxytag: member="cache_inode_misc.c::cache_inode_get_fsal_handle" ref="a625ee0acb63c4e7f1b342389c5dd7a0b" args="(cache_entry_t *pentry, cache_inode_status_t *pstatus)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fsal_handle_t* cache_inode_get_fsal_handle </td>
          <td>(</td>
          <td class="paramtype">cache_entry_t *&nbsp;</td>
          <td class="paramname"> <em>pentry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cache_inode_status_t *&nbsp;</td>
          <td class="paramname"> <em>pstatus</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>cache_inode_get_fsal_handle: gets the FSAL handle from a pentry.</p>
<p>Gets the FSAL handle from a pentry. The entry should be lock BEFORE this call is done (no lock is managed in this function). All DIR_BEGINNING and DIR_CONTINUE involved in the same dir_chain will return the same handle.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pentry</em>&nbsp;</td><td>[IN] the input pentry. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pstatus</em>&nbsp;</td><td>[OUT] the status for the extraction (If not CACHE_INODE_SUCCESS, there is an error).</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>the result of the conversion. NULL shows an error. </dd></dl>

<p>Definition at line <a class="el" href="cache__inode__misc_8c_source.html#l01093">1093</a> of file <a class="el" href="cache__inode__misc_8c_source.html">cache_inode_misc.c</a>.</p>

</div>
</div>
<a class="anchor" id="aed59b090dbed68c7eca3a1b5514a11c5"></a><!-- doxytag: member="cache_inode_misc.c::cache_inode_kill_entry" ref="aed59b090dbed68c7eca3a1b5514a11c5" args="(cache_entry_t *pentry, hash_table_t *ht, cache_inode_client_t *pclient, cache_inode_status_t *pstatus)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cache_inode_status_t cache_inode_kill_entry </td>
          <td>(</td>
          <td class="paramtype">cache_entry_t *&nbsp;</td>
          <td class="paramname"> <em>pentry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">hash_table_t *&nbsp;</td>
          <td class="paramname"> <em>ht</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cache_inode_client_t *&nbsp;</td>
          <td class="paramname"> <em>pclient</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cache_inode_status_t *&nbsp;</td>
          <td class="paramname"> <em>pstatus</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>cache_inode_kill_entry: force removing an entry from the cache_inode. This is used in case of a 'stale' entry.</p>
<p>Force removing an entry from the cache_inode. This is used in case of a 'stale' entry.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pentry</em>&nbsp;</td><td>[IN] the input pentry (supposed to be staled). </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ht</em>&nbsp;</td><td>[INOUT] the related hash table for the cache_inode cache. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pclient</em>&nbsp;</td><td>[INOUT] related cache_inode client. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pstatus</em>&nbsp;</td><td>[OUT] status for the operation.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>CACHE_INODE_BAD_TYPE if pentry is not related a REGULAR_FILE or DIR_BEGINNING <br/>
 </dd>
<dd>
CACHE_INODE_SUCCESS if operation succeded. </dd></dl>

<p>Definition at line <a class="el" href="cache__inode__misc_8c_source.html#l01467">1467</a> of file <a class="el" href="cache__inode__misc_8c_source.html">cache_inode_misc.c</a>.</p>

</div>
</div>
<a class="anchor" id="a5c72fb619678af886176784ba7250b3c"></a><!-- doxytag: member="cache_inode_misc.c::cache_inode_mutex_destroy" ref="a5c72fb619678af886176784ba7250b3c" args="(cache_entry_t *pentry)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cache_inode_mutex_destroy </td>
          <td>(</td>
          <td class="paramtype">cache_entry_t *&nbsp;</td>
          <td class="paramname"> <em>pentry</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>cache_inode_mutex_destroy: destroys the pthread_mutex associated with a pentry when it is put back to the spool.</p>
<p>Destroys the pthread_mutex associated with a pentry when it is put back to the spool</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pentry</em>&nbsp;</td><td>[INOUT] the input pentry.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>nothing (void function) </dd></dl>

<p>Definition at line <a class="el" href="cache__inode__misc_8c_source.html#l01206">1206</a> of file <a class="el" href="cache__inode__misc_8c_source.html">cache_inode_misc.c</a>.</p>

</div>
</div>
<a class="anchor" id="a8392006e0fb4aea7143cfd950e91a74a"></a><!-- doxytag: member="cache_inode_misc.c::cache_inode_new_entry" ref="a8392006e0fb4aea7143cfd950e91a74a" args="(cache_inode_fsal_data_t *pfsdata, fsal_attrib_list_t *pfsal_attr, cache_inode_file_type_t type, cache_inode_create_arg_t *pcreate_arg, cache_entry_t *pentry_dir_prev, hash_table_t *ht, cache_inode_client_t *pclient, fsal_op_context_t *pcontext, unsigned int create_flag, cache_inode_status_t *pstatus)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cache_entry_t* cache_inode_new_entry </td>
          <td>(</td>
          <td class="paramtype">cache_inode_fsal_data_t *&nbsp;</td>
          <td class="paramname"> <em>pfsdata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">fsal_attrib_list_t *&nbsp;</td>
          <td class="paramname"> <em>pfsal_attr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cache_inode_file_type_t&nbsp;</td>
          <td class="paramname"> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cache_inode_create_arg_t *&nbsp;</td>
          <td class="paramname"> <em>pcreate_arg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cache_entry_t *&nbsp;</td>
          <td class="paramname"> <em>pentry_dir_prev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">hash_table_t *&nbsp;</td>
          <td class="paramname"> <em>ht</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cache_inode_client_t *&nbsp;</td>
          <td class="paramname"> <em>pclient</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">fsal_op_context_t *&nbsp;</td>
          <td class="paramname"> <em>pcontext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>create_flag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cache_inode_status_t *&nbsp;</td>
          <td class="paramname"> <em>pstatus</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>cache_inode_new_entry: adds a new entry to the cache_inode.</p>
<p>adds a new entry to the cache_inode. These function os used to allocate entries of any kind. Some parameter are meaningless for some types or used for others.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pfsdata</em>&nbsp;</td><td>[IN] FSAL data for the entry to be created (used to build the key) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pfsal_attr</em>&nbsp;</td><td>[in] attributes for the entry (unused if value == NULL). Used for caching. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>type</em>&nbsp;</td><td>[IN] type of the entry to be created. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>link_content</em>&nbsp;</td><td>[IN] if type == SYMBOLIC_LINK, this is the content of the link. Unused otherwise </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pentry_dir_prev</em>&nbsp;</td><td>[IN] if type == DIR_CONTINUE, this is the previous entry in the dir_chain. Unused otherwise. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ht</em>&nbsp;</td><td>[INOUT] hash table used for the cache. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pclient</em>&nbsp;</td><td>[INOUT]ressource allocated by the client for the nfs management. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pcontext</em>&nbsp;</td><td>[IN] FSAL credentials for the operation. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>create_flag</em>&nbsp;</td><td>[IN] a flag which shows if the entry is newly created or not </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pstatus</em>&nbsp;</td><td>[OUT] returned status.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>the same as *pstatus </dd></dl>

<p>Definition at line <a class="el" href="cache__inode__misc_8c_source.html#l00206">206</a> of file <a class="el" href="cache__inode__misc_8c_source.html">cache_inode_misc.c</a>.</p>

</div>
</div>
<a class="anchor" id="ab405ebfdd83c07441a5f617862fd789a"></a><!-- doxytag: member="cache_inode_misc.c::cache_inode_print_dir" ref="ab405ebfdd83c07441a5f617862fd789a" args="(cache_entry_t *cache_entry_root)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cache_inode_print_dir </td>
          <td>(</td>
          <td class="paramtype">cache_entry_t *&nbsp;</td>
          <td class="paramname"> <em>cache_entry_root</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>cache_inode_print_dir: prints the content of a pentry that is a directory segment.</p>
<p>Prints the content of a pentry that is a DIR_BEGINNING or a DIR_CONTINUE. /!\ This function is provided for debugging purpose only, it makes no sanity check on the arguments.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pentry</em>&nbsp;</td><td>[IN] the input pentry.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>nothing (void function) </dd></dl>

<p>Definition at line <a class="el" href="cache__inode__misc_8c_source.html#l01223">1223</a> of file <a class="el" href="cache__inode__misc_8c_source.html">cache_inode_misc.c</a>.</p>

</div>
</div>
<a class="anchor" id="a85615042ce506cf412216455b73ada68"></a><!-- doxytag: member="cache_inode_misc.c::cache_inode_release_fsaldata_key" ref="a85615042ce506cf412216455b73ada68" args="(hash_buffer_t *pkey, cache_inode_client_t *pclient)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cache_inode_release_fsaldata_key </td>
          <td>(</td>
          <td class="paramtype">hash_buffer_t *&nbsp;</td>
          <td class="paramname"> <em>pkey</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cache_inode_client_t *&nbsp;</td>
          <td class="paramname"> <em>pclient</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>cache_inode_release_fsaldata_key: release a fsal key used to access the cache inode</p>
<p>Release a fsal key used to access the cache inode.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pkey</em>&nbsp;</td><td>[IN] pointer to the key to be freed </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pclient</em>&nbsp;</td><td>[INOUT] ressource allocated by the client for the nfs management.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>nothing (void function) </dd></dl>

<p>Definition at line <a class="el" href="cache__inode__misc_8c_source.html#l00175">175</a> of file <a class="el" href="cache__inode__misc_8c_source.html">cache_inode_misc.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae0a8ae792a80e2143f3ae5cc1bffe95d"></a><!-- doxytag: member="cache_inode_misc.c::cache_inode_reload_content" ref="ae0a8ae792a80e2143f3ae5cc1bffe95d" args="(char *path, cache_entry_t *pentry)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cache_inode_status_t cache_inode_reload_content </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cache_entry_t *&nbsp;</td>
          <td class="paramname"> <em>pentry</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>cache_inode_reload_content: reloads the content of a pentry from a local file (used File Content crash recovery).</p>
<p>Reloeads the content of a pentry from a local file (used File Content crash recovery).</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>path</em>&nbsp;</td><td>[IN] the full path to the file that will contain the metadata. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pentry</em>&nbsp;</td><td>[IN] the input pentry.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>CACHE_INODE_BAD_TYPE if pentry is not related to a REGULAR_FILE <br/>
 </dd>
<dd>
CACHE_INODE_SUCCESS if operation succeded. </dd></dl>

<p>Definition at line <a class="el" href="cache__inode__misc_8c_source.html#l01318">1318</a> of file <a class="el" href="cache__inode__misc_8c_source.html">cache_inode_misc.c</a>.</p>

</div>
</div>
<a class="anchor" id="a7da7b52764bdb6c1a6d60a2a979322aa"></a><!-- doxytag: member="cache_inode_misc.c::cache_inode_set_attributes" ref="a7da7b52764bdb6c1a6d60a2a979322aa" args="(cache_entry_t *pentry, fsal_attrib_list_t *pattr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cache_inode_set_attributes </td>
          <td>(</td>
          <td class="paramtype">cache_entry_t *&nbsp;</td>
          <td class="paramname"> <em>pentry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">fsal_attrib_list_t *&nbsp;</td>
          <td class="paramname"> <em>pattr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>cache_inode_set_attributes: sets the attributes cached in the entry.</p>
<p>Sets the attributes cached in the entry.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pentry</em>&nbsp;</td><td>[OUT] the entry to deal with. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pattr</em>&nbsp;</td><td>[IN] the attributes to be set for this entry.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>nothing (void function). </dd></dl>

<p>Definition at line <a class="el" href="cache__inode__misc_8c_source.html#l00994">994</a> of file <a class="el" href="cache__inode__misc_8c_source.html">cache_inode_misc.c</a>.</p>

</div>
</div>
<a class="anchor" id="a276225d5d7db59f532f94ca6cf32ab53"></a><!-- doxytag: member="cache_inode_misc.c::cache_inode_type_are_rename_compatible" ref="a276225d5d7db59f532f94ca6cf32ab53" args="(cache_entry_t *pentry_src, cache_entry_t *pentry_dest)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int cache_inode_type_are_rename_compatible </td>
          <td>(</td>
          <td class="paramtype">cache_entry_t *&nbsp;</td>
          <td class="paramname"> <em>pentry_src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cache_entry_t *&nbsp;</td>
          <td class="paramname"> <em>pentry_dest</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>cache_inode_type_are_rename_compatible: test if an existing entry could be scrtached during a rename.</p>
<p>test if an existing entry could be scrtached during a rename. No mutext management.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pentry_src</em>&nbsp;</td><td>[IN] the source pentry (the one to be renamed) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pentry_dest</em>&nbsp;</td><td>[IN] the dest pentry (the one to be scratched during the rename)</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>TRUE if rename if allowed (types are compatible), FALSE if not. </dd></dl>

<p>Definition at line <a class="el" href="cache__inode__misc_8c_source.html#l01159">1159</a> of file <a class="el" href="cache__inode__misc_8c_source.html">cache_inode_misc.c</a>.</p>

</div>
</div>
<a class="anchor" id="aa34ae3526aa5eb8bc0f96e54a3fe8861"></a><!-- doxytag: member="cache_inode_misc.c::cache_inode_valid" ref="aa34ae3526aa5eb8bc0f96e54a3fe8861" args="(cache_entry_t *pentry, cache_inode_op_t op, cache_inode_client_t *pclient)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cache_inode_status_t cache_inode_valid </td>
          <td>(</td>
          <td class="paramtype">cache_entry_t *&nbsp;</td>
          <td class="paramname"> <em>pentry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cache_inode_op_t&nbsp;</td>
          <td class="paramname"> <em>op</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cache_inode_client_t *&nbsp;</td>
          <td class="paramname"> <em>pclient</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>cache_inode_valid: validates an entry to update its garbagge status.</p>
<p>Validates an error to update its garbagge status. Entry is supposed to be locked when this function is called !!</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pentry</em>&nbsp;</td><td>[INOUT] entry to be validated. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>op</em>&nbsp;</td><td>[IN] can be set to CACHE_INODE_OP_GET or CACHE_INODE_OP_SET to show the type of operation done. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pclient</em>&nbsp;</td><td>[INOUT] ressource allocated by the client for the nfs management.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>CACHE_INODE_SUCCESS if successful <br/>
 </dd>
<dd>
CACHE_INODE_LRU_ERROR if an errorr occured in LRU management. </dd></dl>

<p>Definition at line <a class="el" href="cache__inode__misc_8c_source.html#l00798">798</a> of file <a class="el" href="cache__inode__misc_8c_source.html">cache_inode_misc.c</a>.</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 15 Sep 2010 for Cache inode layer by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
