<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>NFS and Mount protocols layer: nfs4_Compound.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>nfs4_Compound.c</h1><a href="nfs4__Compound_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * vim:expandtab:shiftwidth=8:tabstop=8:</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * Copyright CEA/DAM/DIF  (2008)</span>
<a name="l00005"></a>00005 <span class="comment"> * contributeur : Philippe DENIEL   philippe.deniel@cea.fr</span>
<a name="l00006"></a>00006 <span class="comment"> *                Thomas LEIBOVICI  thomas.leibovici@cea.fr</span>
<a name="l00007"></a>00007 <span class="comment"> *</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * Ce logiciel est un serveur implementant le protocole NFS.</span>
<a name="l00010"></a>00010 <span class="comment"> *</span>
<a name="l00011"></a>00011 <span class="comment"> * Ce logiciel est régi par la licence CeCILL soumise au droit français et</span>
<a name="l00012"></a>00012 <span class="comment"> * respectant les principes de diffusion des logiciels libres. Vous pouvez</span>
<a name="l00013"></a>00013 <span class="comment"> * utiliser, modifier et/ou redistribuer ce programme sous les conditions</span>
<a name="l00014"></a>00014 <span class="comment"> * de la licence CeCILL telle que diffusée par le CEA, le CNRS et l'INRIA</span>
<a name="l00015"></a>00015 <span class="comment"> * sur le site "http://www.cecill.info".</span>
<a name="l00016"></a>00016 <span class="comment"> *</span>
<a name="l00017"></a>00017 <span class="comment"> * En contrepartie de l'accessibilité au code source et des droits de copie,</span>
<a name="l00018"></a>00018 <span class="comment"> * de modification et de redistribution accordés par cette licence, il n'est</span>
<a name="l00019"></a>00019 <span class="comment"> * offert aux utilisateurs qu'une garantie limitée.  Pour les mêmes raisons,</span>
<a name="l00020"></a>00020 <span class="comment"> * seule une responsabilité restreinte pèse sur l'auteur du programme,  le</span>
<a name="l00021"></a>00021 <span class="comment"> * titulaire des droits patrimoniaux et les concédants successifs.</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * A cet égard  l'attention de l'utilisateur est attirée sur les risques</span>
<a name="l00024"></a>00024 <span class="comment"> * associés au chargement,  à l'utilisation,  à la modification et/ou au</span>
<a name="l00025"></a>00025 <span class="comment"> * développement et à la reproduction du logiciel par l'utilisateur étant</span>
<a name="l00026"></a>00026 <span class="comment"> * donné sa spécificité de logiciel libre, qui peut le rendre complexe à</span>
<a name="l00027"></a>00027 <span class="comment"> * manipuler et qui le réserve donc à des développeurs et des professionnels</span>
<a name="l00028"></a>00028 <span class="comment"> * avertis possédant  des  connaissances  informatiques approfondies.  Les</span>
<a name="l00029"></a>00029 <span class="comment"> * utilisateurs sont donc invités à charger  et  tester  l'adéquation  du</span>
<a name="l00030"></a>00030 <span class="comment"> * logiciel à leurs besoins dans des conditions permettant d'assurer la</span>
<a name="l00031"></a>00031 <span class="comment"> * sécurité de leurs systèmes et ou de leurs données et, plus généralement,</span>
<a name="l00032"></a>00032 <span class="comment"> * à l'utiliser et l'exploiter dans les mêmes conditions de sécurité.</span>
<a name="l00033"></a>00033 <span class="comment"> *</span>
<a name="l00034"></a>00034 <span class="comment"> * Le fait que vous puissiez accéder à cet en-tête signifie que vous avez</span>
<a name="l00035"></a>00035 <span class="comment"> * pris connaissance de la licence CeCILL, et que vous en avez accepté les</span>
<a name="l00036"></a>00036 <span class="comment"> * termes.</span>
<a name="l00037"></a>00037 <span class="comment"> *</span>
<a name="l00038"></a>00038 <span class="comment"> * ---------------------</span>
<a name="l00039"></a>00039 <span class="comment"> *</span>
<a name="l00040"></a>00040 <span class="comment"> * Copyright CEA/DAM/DIF (2005)</span>
<a name="l00041"></a>00041 <span class="comment"> *  Contributor: Philippe DENIEL  philippe.deniel@cea.fr</span>
<a name="l00042"></a>00042 <span class="comment"> *               Thomas LEIBOVICI thomas.leibovici@cea.fr</span>
<a name="l00043"></a>00043 <span class="comment"> *</span>
<a name="l00044"></a>00044 <span class="comment"> *</span>
<a name="l00045"></a>00045 <span class="comment"> * This software is a server that implements the NFS protocol.</span>
<a name="l00046"></a>00046 <span class="comment"> * </span>
<a name="l00047"></a>00047 <span class="comment"> *</span>
<a name="l00048"></a>00048 <span class="comment"> * This software is governed by the CeCILL  license under French law and</span>
<a name="l00049"></a>00049 <span class="comment"> * abiding by the rules of distribution of free software.  You can  use,</span>
<a name="l00050"></a>00050 <span class="comment"> * modify and/ or redistribute the software under the terms of the CeCILL</span>
<a name="l00051"></a>00051 <span class="comment"> * license as circulated by CEA, CNRS and INRIA at the following URL</span>
<a name="l00052"></a>00052 <span class="comment"> * "http://www.cecill.info".</span>
<a name="l00053"></a>00053 <span class="comment"> *</span>
<a name="l00054"></a>00054 <span class="comment"> * As a counterpart to the access to the source code and  rights to copy,</span>
<a name="l00055"></a>00055 <span class="comment"> * modify and redistribute granted by the license, users are provided only</span>
<a name="l00056"></a>00056 <span class="comment"> * with a limited warranty  and the software's author,  the holder of the</span>
<a name="l00057"></a>00057 <span class="comment"> * economic rights,  and the successive licensors  have only  limited</span>
<a name="l00058"></a>00058 <span class="comment"> * liability.</span>
<a name="l00059"></a>00059 <span class="comment"> *</span>
<a name="l00060"></a>00060 <span class="comment"> * In this respect, the user's attention is drawn to the risks associated</span>
<a name="l00061"></a>00061 <span class="comment"> * with loading,  using,  modifying and/or developing or reproducing the</span>
<a name="l00062"></a>00062 <span class="comment"> * software by the user in light of its specific status of free software,</span>
<a name="l00063"></a>00063 <span class="comment"> * that may mean  that it is complicated to manipulate,  and  that  also</span>
<a name="l00064"></a>00064 <span class="comment"> therefore means  that it is reserved for developers  and  experienced</span>
<a name="l00065"></a>00065 <span class="comment"> * professionals having in-depth computer knowledge. Users are therefore</span>
<a name="l00066"></a>00066 <span class="comment"> * encouraged to load and test the software's suitability as regards their</span>
<a name="l00067"></a>00067 <span class="comment"> * requirements in conditions enabling the security of their systems and/or</span>
<a name="l00068"></a>00068 <span class="comment"> * data to be ensured and,  more generally, to use and operate it in the</span>
<a name="l00069"></a>00069 <span class="comment"> * same conditions as regards security.</span>
<a name="l00070"></a>00070 <span class="comment"> *</span>
<a name="l00071"></a>00071 <span class="comment"> * The fact that you are presently reading this means that you have had</span>
<a name="l00072"></a>00072 <span class="comment"> * knowledge of the CeCILL license and that you accept its terms.</span>
<a name="l00073"></a>00073 <span class="comment"> * ---------------------------------------</span>
<a name="l00074"></a>00074 <span class="comment"> */</span>
<a name="l00075"></a>00075 
<a name="l00086"></a>00086 <span class="preprocessor">#ifdef HAVE_CONFIG_H</span>
<a name="l00087"></a>00087 <span class="preprocessor"></span><span class="preprocessor">#include "config.h"</span>
<a name="l00088"></a>00088 <span class="preprocessor">#endif</span>
<a name="l00089"></a>00089 <span class="preprocessor"></span>
<a name="l00090"></a>00090 <span class="preprocessor">#ifdef _SOLARIS</span>
<a name="l00091"></a>00091 <span class="preprocessor"></span><span class="preprocessor">#include "solaris_port.h"</span>
<a name="l00092"></a>00092 <span class="preprocessor">#endif</span>
<a name="l00093"></a>00093 <span class="preprocessor"></span>
<a name="l00094"></a>00094 
<a name="l00095"></a>00095 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00096"></a>00096 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00097"></a>00097 <span class="preprocessor">#include &lt;pthread.h&gt;</span>
<a name="l00098"></a>00098 <span class="preprocessor">#include &lt;fcntl.h&gt;</span>
<a name="l00099"></a>00099 <span class="preprocessor">#include &lt;sys/file.h&gt;</span>  <span class="comment">/* for having FNDELAY */</span>
<a name="l00100"></a>00100 <span class="preprocessor">#include "HashData.h"</span>
<a name="l00101"></a>00101 <span class="preprocessor">#include "HashTable.h"</span>
<a name="l00102"></a>00102 <span class="preprocessor">#ifdef _USE_GSSRPC</span>
<a name="l00103"></a>00103 <span class="preprocessor"></span><span class="preprocessor">#include &lt;gssrpc/types.h&gt;</span>
<a name="l00104"></a>00104 <span class="preprocessor">#include &lt;gssrpc/rpc.h&gt;</span>
<a name="l00105"></a>00105 <span class="preprocessor">#include &lt;gssrpc/auth.h&gt;</span>
<a name="l00106"></a>00106 <span class="preprocessor">#include &lt;gssrpc/pmap_clnt.h&gt;</span>
<a name="l00107"></a>00107 <span class="preprocessor">#else</span>
<a name="l00108"></a>00108 <span class="preprocessor"></span><span class="preprocessor">#include &lt;rpc/types.h&gt;</span>
<a name="l00109"></a>00109 <span class="preprocessor">#include &lt;rpc/rpc.h&gt;</span>
<a name="l00110"></a>00110 <span class="preprocessor">#include &lt;rpc/auth.h&gt;</span>
<a name="l00111"></a>00111 <span class="preprocessor">#include &lt;rpc/pmap_clnt.h&gt;</span>
<a name="l00112"></a>00112 <span class="preprocessor">#endif</span>
<a name="l00113"></a>00113 <span class="preprocessor"></span>
<a name="l00114"></a>00114 <span class="preprocessor">#include "log_functions.h"</span>
<a name="l00115"></a>00115 <span class="preprocessor">#include "stuff_alloc.h"</span>
<a name="l00116"></a>00116 <span class="preprocessor">#include "nfs23.h"</span>
<a name="l00117"></a>00117 <span class="preprocessor">#include "nfs4.h"</span>
<a name="l00118"></a>00118 <span class="preprocessor">#include "mount.h"</span>
<a name="l00119"></a>00119 <span class="preprocessor">#include "nfs_core.h"</span>
<a name="l00120"></a>00120 <span class="preprocessor">#include "cache_inode.h"</span>
<a name="l00121"></a>00121 <span class="preprocessor">#include "cache_content.h"</span>
<a name="l00122"></a>00122 <span class="preprocessor">#include "nfs_exports.h"</span>
<a name="l00123"></a>00123 <span class="preprocessor">#include "nfs_creds.h"</span>
<a name="l00124"></a>00124 <span class="preprocessor">#include "nfs_proto_functions.h"</span>
<a name="l00125"></a>00125 
<a name="l00126"></a>00126 
<a name="l00127"></a><a class="code" href="structnfs4__op__desc____.html">00127</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structnfs4__op__desc____.html">nfs4_op_desc__</a>
<a name="l00128"></a>00128 {
<a name="l00129"></a><a class="code" href="structnfs4__op__desc____.html#930e0a0f589ae041cf1a6e74e0bcfdbb">00129</a>   <span class="keywordtype">char</span> *         <a class="code" href="structnfs4__op__desc____.html#930e0a0f589ae041cf1a6e74e0bcfdbb">name</a>;
<a name="l00130"></a><a class="code" href="structnfs4__op__desc____.html#168c7621645c370c859e5fe914df7ad7">00130</a>   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>   <a class="code" href="structnfs4__op__desc____.html#168c7621645c370c859e5fe914df7ad7">val</a> ;
<a name="l00131"></a>00131   int          (*<a class="code" href="structnfs4__op__desc____.html#84c066ada70589fed546c3b1c90fc781">funct</a>)( <span class="keyword">struct </span>nfs_argop4 *,  
<a name="l00132"></a>00132                          compound_data_t *,
<a name="l00133"></a>00133                          <span class="keyword">struct </span>nfs_resop4 *) ;
<a name="l00134"></a>00134 } <a class="code" href="structnfs4__op__desc____.html">nfs4_op_desc_t</a> ;
<a name="l00135"></a>00135 
<a name="l00136"></a>00136 <span class="comment">/* This array maps the operation number to the related position in array optab4 */</span>
<a name="l00137"></a><a class="code" href="nfs4__Compound_8c.html#a98da90025ceb070e2f0cf6e09188607">00137</a> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="nfs4__Compound_8c.html#a98da90025ceb070e2f0cf6e09188607">optab4index</a>[] = { 0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,
<a name="l00138"></a>00138                             24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39 };
<a name="l00139"></a>00139 
<a name="l00140"></a>00140 
<a name="l00141"></a>00141 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structnfs4__op__desc____.html">nfs4_op_desc_t</a> optab4[] = 
<a name="l00142"></a>00142 {
<a name="l00143"></a>00143     {<span class="stringliteral">"OP_ACCESS"</span>,              NFS4_OP_ACCESS,              <a class="code" href="nfs4__op__access_8c.html#b6cc66009a7836c508333ae230514b44">nfs4_op_access</a>              },
<a name="l00144"></a>00144     {<span class="stringliteral">"OP_CLOSE"</span>,               NFS4_OP_CLOSE,               <a class="code" href="nfs4__op__close_8c.html#02fcc717d63a73d5e9c26f9ebd948270">nfs4_op_close</a>               },
<a name="l00145"></a>00145     {<span class="stringliteral">"OP_COMMIT"</span>,              NFS4_OP_COMMIT,              <a class="code" href="nfs4__op__commit_8c.html#df0b8f05386e088b737004938a0cf20b">nfs4_op_commit</a>              },
<a name="l00146"></a>00146     {<span class="stringliteral">"OP_CREATE"</span>,              NFS4_OP_CREATE,              <a class="code" href="nfs4__op__create_8c.html#14e6b2793f5ad0021dff58ef37bbf3f1">nfs4_op_create</a>              },
<a name="l00147"></a>00147     {<span class="stringliteral">"OP_DELEGPURGE"</span>,          NFS4_OP_DELEGPURGE,          <a class="code" href="nfs4__op__delegpurge_8c.html#94bb34e5f88bdb6817befb98e768bbe1">nfs4_op_delegpurge</a>          },
<a name="l00148"></a>00148     {<span class="stringliteral">"OP_DELEGRETURN"</span>,         NFS4_OP_DELEGRETURN,         <a class="code" href="nfs4__op__delegreturn_8c.html#b265ddf6f6a45902b8c8a83b41109625">nfs4_op_delegreturn</a>         },
<a name="l00149"></a>00149     {<span class="stringliteral">"OP_GETATTR"</span>,             NFS4_OP_GETATTR,             <a class="code" href="nfs4__op__getattr_8c.html#d4ed91788355d6f1dd3628b9538f4d77">nfs4_op_getattr</a>             },
<a name="l00150"></a>00150     {<span class="stringliteral">"OP_GETFH"</span>,               NFS4_OP_GETFH,               <a class="code" href="nfs4__op__getfh_8c.html#394f49ee671fb2e92fc5b83c2d2606ec">nfs4_op_getfh</a>               }, 
<a name="l00151"></a>00151     {<span class="stringliteral">"OP_LINK"</span>,                NFS4_OP_LINK,                <a class="code" href="nfs4__op__link_8c.html#5f2428dbae6231d9e45f2e54b26e0323">nfs4_op_link</a>                },
<a name="l00152"></a>00152     {<span class="stringliteral">"OP_LOCK"</span>,                NFS4_OP_LOCK,                <a class="code" href="nfs4__op__lock_8c.html#4001042e7f6119629f9ff1f48f7a8e90">nfs4_op_lock</a>                },
<a name="l00153"></a>00153     {<span class="stringliteral">"OP_LOCKT"</span>,               NFS4_OP_LOCKT,               <a class="code" href="nfs4__op__lockt_8c.html#7783cf0af6c72f7b9d83229f1d7fcd1d">nfs4_op_lockt</a>               },
<a name="l00154"></a>00154     {<span class="stringliteral">"OP_LOCKU"</span>,               NFS4_OP_LOCKU,               <a class="code" href="nfs4__op__locku_8c.html#36dd583d2f33a31d280c62ce81a0bf77">nfs4_op_locku</a>               },
<a name="l00155"></a>00155     {<span class="stringliteral">"OP_LOOKUP"</span>,              NFS4_OP_LOOKUP,              <a class="code" href="nfs4__op__lookup_8c.html#d516bf630bf4eaa0ae091e79bfb35ec9">nfs4_op_lookup</a>              },
<a name="l00156"></a>00156     {<span class="stringliteral">"OP_LOOKUPP"</span>,             NFS4_OP_LOOKUPP,             <a class="code" href="nfs4__op__lookupp_8c.html#9916f876757a2eb0cf13828e3a19ccb6">nfs4_op_lookupp</a>             },
<a name="l00157"></a>00157     {<span class="stringliteral">"OP_NVERIFY"</span>,             NFS4_OP_NVERIFY,             <a class="code" href="nfs4__op__nverify_8c.html#40b315f3bcac677184d2aecd352a9e64">nfs4_op_nverify</a>             },
<a name="l00158"></a>00158     {<span class="stringliteral">"OP_OPEN"</span>,                NFS4_OP_OPEN,                <a class="code" href="nfs4__op__open_8c.html#0a990600b8947b4a7103afebef155333">nfs4_op_open</a>                },
<a name="l00159"></a>00159     {<span class="stringliteral">"OP_OPENATTR"</span>,            NFS4_OP_OPENATTR,            <a class="code" href="nfs4__op__openattr_8c.html#36c9c5555087bce821e98f955e56147f">nfs4_op_openattr</a>            },
<a name="l00160"></a>00160     {<span class="stringliteral">"OP_OPEN_CONFIRM"</span>,        NFS4_OP_OPEN_CONFIRM,        <a class="code" href="nfs4__op__open__confirm_8c.html#30a902836fc6565515e0f2b7ac0cd778">nfs4_op_open_confirm</a>        },
<a name="l00161"></a>00161     {<span class="stringliteral">"OP_OPEN_DOWNGRADE"</span>,      NFS4_OP_OPEN_DOWNGRADE,      <a class="code" href="nfs4__op__open__downgrade_8c.html#8d24fd2047668ce755c7933564e62f42">nfs4_op_open_downgrade</a>      },
<a name="l00162"></a>00162     {<span class="stringliteral">"OP_PUTFH"</span>,               NFS4_OP_PUTFH,               <a class="code" href="nfs4__op__putfh_8c.html#196753c8469e11282467d00816dd6d14">nfs4_op_putfh</a>               },
<a name="l00163"></a>00163     {<span class="stringliteral">"OP_PUTPUBFH"</span>,            NFS4_OP_PUTPUBFH,            <a class="code" href="nfs4__op__putpubfh_8c.html#0c1e48c9a9e8f520bbdd6dc232f0b168">nfs4_op_putpubfh</a>            },
<a name="l00164"></a>00164     {<span class="stringliteral">"OP_PUTROOTFH"</span>,           NFS4_OP_PUTROOTFH,           <a class="code" href="nfs4__op__putrootfh_8c.html#f2ae7afb2b900467450251fda8abe5d1">nfs4_op_putrootfh</a>           },
<a name="l00165"></a>00165     {<span class="stringliteral">"OP_READ"</span>,                NFS4_OP_READ,                <a class="code" href="nfs4__op__read_8c.html#5c9deb973d845ec131e14e1eacd57ba3">nfs4_op_read</a>                }, 
<a name="l00166"></a>00166     {<span class="stringliteral">"OP_READDIR"</span>,             NFS4_OP_READDIR,             <a class="code" href="nfs4__op__readdir_8c.html#6635db351f8362a123052e09739f8d29">nfs4_op_readdir</a>             },
<a name="l00167"></a>00167     {<span class="stringliteral">"OP_READLINK"</span>,            NFS4_OP_READLINK,            <a class="code" href="nfs4__op__readlink_8c.html#eeb1559b5a8a1fbb8f78840b0be9f73c">nfs4_op_readlink</a>            },
<a name="l00168"></a>00168     {<span class="stringliteral">"OP_REMOVE"</span>,              NFS4_OP_REMOVE,              <a class="code" href="nfs4__op__remove_8c.html#fdd814754596420fcfd61719b609ec09">nfs4_op_remove</a>              },
<a name="l00169"></a>00169     {<span class="stringliteral">"OP_RENAME"</span>,              NFS4_OP_RENAME,              <a class="code" href="nfs4__op__rename_8c.html#e5ab2671e744ae9452d50c11e66b174a">nfs4_op_rename</a>              },
<a name="l00170"></a>00170     {<span class="stringliteral">"OP_RENEW"</span>,               NFS4_OP_RENEW,               <a class="code" href="nfs4__op__renew_8c.html#cb48c3dcef9e7f33656a552388212852">nfs4_op_renew</a>               },
<a name="l00171"></a>00171     {<span class="stringliteral">"OP_RESTOREFH"</span>,           NFS4_OP_RESTOREFH,           <a class="code" href="nfs4__op__restorefh_8c.html#db474bb1ac6d20d3be83928b2dcf7fe2">nfs4_op_restorefh</a>           },
<a name="l00172"></a>00172     {<span class="stringliteral">"OP_SAVEFH"</span>,              NFS4_OP_SAVEFH,              <a class="code" href="nfs4__op__savefh_8c.html#6e55b91063b897f0f49113a0576af2f1">nfs4_op_savefh</a>              },
<a name="l00173"></a>00173     {<span class="stringliteral">"OP_SECINFO"</span>,             NFS4_OP_SECINFO,             <a class="code" href="nfs4__op__secinfo_8c.html#5f0f8fc7563a8b01b0dec139d4cb9b73">nfs4_op_secinfo</a>             },
<a name="l00174"></a>00174     {<span class="stringliteral">"OP_SETATTR"</span>,             NFS4_OP_SETATTR,             <a class="code" href="nfs4__op__setattr_8c.html#0765ef490e8f1eb6be3ae27fabe55bfa">nfs4_op_setattr</a>             },
<a name="l00175"></a>00175     {<span class="stringliteral">"OP_SETCLIENTID"</span>,         NFS4_OP_SETCLIENTID,         <a class="code" href="nfs4__op__setclientid_8c.html#42efb5642ce641dd7b4380ed7d0eafeb">nfs4_op_setclientid</a>         },
<a name="l00176"></a>00176     {<span class="stringliteral">"OP_SETCLIENTID_CONFIRM"</span>, NFS4_OP_SETCLIENTID_CONFIRM, <a class="code" href="nfs4__op__setclientid__confirm_8c.html#a0d4c15d80ee93ef6ff28a6b95e6f1bb">nfs4_op_setclientid_confirm</a> },
<a name="l00177"></a>00177     {<span class="stringliteral">"OP_VERIFY"</span>,              NFS4_OP_VERIFY,              <a class="code" href="nfs4__op__verify_8c.html#38d8512e2a272c073870f496d0783d8a">nfs4_op_verify</a>              },
<a name="l00178"></a>00178     {<span class="stringliteral">"OP_WRITE"</span>,               NFS4_OP_WRITE,               <a class="code" href="nfs4__op__write_8c.html#c0d636bec95d998c0da4643312517fe3">nfs4_op_write</a>               },
<a name="l00179"></a>00179     {<span class="stringliteral">"OP_RELEASE_LOCKOWNER"</span>,   NFS4_OP_RELEASE_LOCKOWNER,   <a class="code" href="nfs4__op__release__lockowner_8c.html#f14c11aa252cb168ec1b09fd9c03cb8a">nfs4_op_release_lockowner</a>   },
<a name="l00180"></a>00180     {<span class="stringliteral">"OP_ILLEGAL"</span>,             NFS4_OP_ILLEGAL,             <a class="code" href="nfs4__op__illegal_8c.html#0abf9e0f0e1fdf86dbf373c7a70cb0cd">nfs4_op_illegal</a>             }
<a name="l00181"></a>00181 }; 
<a name="l00182"></a>00182 
<a name="l00183"></a>00183 
<a name="l00206"></a><a class="code" href="nfs4__Compound_8c.html#a1516130248e7ae55d3c2e1bffe90016">00206</a> <span class="keywordtype">int</span> <a class="code" href="nfs4__Compound_8c.html#a1516130248e7ae55d3c2e1bffe90016">nfs4_Compound</a>( nfs_arg_t               * parg     <span class="comment">/* IN     */</span>,
<a name="l00207"></a>00207                    exportlist_t            * pexport  <span class="comment">/* IN     */</span>,
<a name="l00208"></a>00208                    fsal_op_context_t       * pcontext <span class="comment">/* IN     */</span>,
<a name="l00209"></a>00209                    cache_inode_client_t    * pclient  <span class="comment">/* INOUT  */</span>,
<a name="l00210"></a>00210                    hash_table_t            * ht       <span class="comment">/* INOUT */</span>,
<a name="l00211"></a>00211                    <span class="keyword">struct</span> svc_req          * preq     <span class="comment">/* IN     */</span>,
<a name="l00212"></a>00212                    nfs_res_t               * pres     <span class="comment">/* OUT    */</span> ) 
<a name="l00213"></a>00213 {
<a name="l00214"></a>00214   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0 ;
<a name="l00215"></a>00215   <span class="keywordtype">int</span> status = NFS4_OK;
<a name="l00216"></a>00216   <span class="keyword">struct </span>nfs_resop4 res ; 
<a name="l00217"></a>00217   <span class="keywordtype">char</span> __attribute__(( __unused__ )) funcname[] = <span class="stringliteral">"nfs4_Compound"</span> ;
<a name="l00218"></a>00218   compound_data_t data;
<a name="l00219"></a>00219   <span class="keywordtype">int</span> opindex ;
<a name="l00220"></a>00220  
<a name="l00221"></a>00221  
<a name="l00222"></a>00222   <span class="comment">/* A "local" #define to avoid typo with nfs (too) long structure names */</span>
<a name="l00223"></a>00223 <span class="preprocessor">#define COMPOUND4_ARRAY parg-&gt;arg_compound4.argarray</span>
<a name="l00224"></a>00224 <span class="preprocessor"></span>
<a name="l00225"></a>00225   DisplayLogJdLevel( pclient-&gt;log_outputs, NIV_FULL_DEBUG, <span class="stringliteral">"NFS v4 COMPOUND REQUEST: %d operation(s)"</span>, 
<a name="l00226"></a>00226                    <a class="code" href="nfs4__Compound_8c.html#ba16ddfc9c046cb52711f148a4b4642b">COMPOUND4_ARRAY</a>.argarray_len ) ;
<a name="l00227"></a>00227 
<a name="l00228"></a>00228   <span class="keywordflow">if</span>( parg-&gt;arg_compound4.minorversion != 0 )
<a name="l00229"></a>00229     {
<a name="l00230"></a>00230       DisplayLog( <span class="stringliteral">"NFS V4 COMPOUND: Bad Minor Version : %d instead of 0"</span>, 
<a name="l00231"></a>00231                   parg-&gt;arg_compound4.minorversion );
<a name="l00232"></a>00232       
<a name="l00233"></a>00233       pres-&gt;res_compound4.status = NFS4ERR_MINOR_VERS_MISMATCH ;
<a name="l00234"></a>00234       pres-&gt;res_compound4.resarray.resarray_len = 0 ;
<a name="l00235"></a>00235       <span class="keywordflow">return</span> NFS_REQ_OK ;
<a name="l00236"></a>00236     }
<a name="l00237"></a>00237 
<a name="l00238"></a>00238   <span class="comment">/* Check for empty COMPOUND request */</span>
<a name="l00239"></a>00239   <span class="keywordflow">if</span>( <a class="code" href="nfs4__Compound_8c.html#ba16ddfc9c046cb52711f148a4b4642b">COMPOUND4_ARRAY</a>.argarray_len == 0 )
<a name="l00240"></a>00240     {
<a name="l00241"></a>00241       DisplayLogJdLevel( pclient-&gt;log_outputs, NIV_MAJOR, 
<a name="l00242"></a>00242                          <span class="stringliteral">"NFS V4 COMPOUND: an empty COMPOUND (no operation in it) was received !!"</span> ) ;
<a name="l00243"></a>00243 
<a name="l00244"></a>00244       pres-&gt;res_compound4.status = NFS4_OK ;
<a name="l00245"></a>00245       pres-&gt;res_compound4.resarray.resarray_len = 0 ;
<a name="l00246"></a>00246       <span class="keywordflow">return</span> NFS_REQ_OK ;
<a name="l00247"></a>00247     }
<a name="l00248"></a>00248 
<a name="l00249"></a>00249   <span class="comment">/* Check for too long request */</span>
<a name="l00250"></a>00250   <span class="keywordflow">if</span>( <a class="code" href="nfs4__Compound_8c.html#ba16ddfc9c046cb52711f148a4b4642b">COMPOUND4_ARRAY</a>.argarray_len &gt; 30 ) 
<a name="l00251"></a>00251     {
<a name="l00252"></a>00252       DisplayLogJdLevel( pclient-&gt;log_outputs, NIV_MAJOR, 
<a name="l00253"></a>00253                          <span class="stringliteral">"NFS V4 COMPOUND: an empty COMPOUND (no operation in it) was received !!"</span> ) ;
<a name="l00254"></a>00254 
<a name="l00255"></a>00255       pres-&gt;res_compound4.status = NFS4ERR_RESOURCE ;
<a name="l00256"></a>00256       pres-&gt;res_compound4.resarray.resarray_len = 0 ;
<a name="l00257"></a>00257       <span class="keywordflow">return</span> NFS_REQ_OK ;
<a name="l00258"></a>00258     }
<a name="l00259"></a>00259   
<a name="l00262"></a>00262   <span class="comment">/* Initialisation of the compound request internal's data */</span>
<a name="l00263"></a>00263   data.currentFH.nfs_fh4_len     = 0 ;
<a name="l00264"></a>00264   data.currentFH.nfs_fh4_val     = NULL ;
<a name="l00265"></a>00265   data.rootFH.nfs_fh4_len        = 0 ;
<a name="l00266"></a>00266   data.rootFH.nfs_fh4_val        = NULL ;
<a name="l00267"></a>00267   data.publicFH.nfs_fh4_len      = 0 ; 
<a name="l00268"></a>00268   data.publicFH.nfs_fh4_val      = NULL ; 
<a name="l00269"></a>00269   data.savedFH.nfs_fh4_len       = 0 ;
<a name="l00270"></a>00270   data.savedFH.nfs_fh4_val       = NULL ;
<a name="l00271"></a>00271   data.mounted_on_FH.nfs_fh4_len = 0 ;
<a name="l00272"></a>00272   data.mounted_on_FH.nfs_fh4_val = NULL ;
<a name="l00273"></a>00273 
<a name="l00274"></a>00274   data.current_entry             = NULL ;
<a name="l00275"></a>00275   data.saved_entry               = NULL ;
<a name="l00276"></a>00276   data.pexport                   = NULL ;
<a name="l00277"></a>00277   data.pfullexportlist           = pexport ; <span class="comment">/* Full export list is provided in input */</span>
<a name="l00278"></a>00278   data.pcontext                  = pcontext ; <span class="comment">/* Get the fsal credentials from the worker thread */</span>
<a name="l00279"></a>00279   data.pseudofs                  = <a class="code" href="nfs4__pseudo_8c.html#fa8dfb821979143aace1ff8e56bd1984">nfs4_GetPseudoFs</a>() ;
<a name="l00280"></a>00280   data.reqp                      = preq ;
<a name="l00281"></a>00281   data.ht                        = ht ;
<a name="l00282"></a>00282   data.pclient                   = pclient ;
<a name="l00283"></a>00283   strcpy( data.MntPath, <span class="stringliteral">"/"</span> ) ;
<a name="l00284"></a>00284 
<a name="l00285"></a>00285   <span class="comment">/* Building the client credential field */</span>
<a name="l00286"></a>00286   <span class="keywordflow">if</span>(  nfs_rpc_req2client_cred( preq, &amp;(data.credential) ) == -1 )
<a name="l00287"></a>00287      <span class="keywordflow">return</span> NFS_REQ_DROP ; <span class="comment">/* Malformed credential */</span>
<a name="l00288"></a>00288 
<a name="l00289"></a>00289   <span class="comment">/* Keeping the same tag as in the arguments */</span>
<a name="l00290"></a>00290   memcpy( &amp;(pres-&gt;res_compound4.tag),  &amp;(parg-&gt;arg_compound4.tag), <span class="keyword">sizeof</span>( parg-&gt;arg_compound4.tag ) ) ; 
<a name="l00291"></a>00291   
<a name="l00292"></a>00292   <span class="comment">/* Allocating the reply nfs_resop4 */</span>
<a name="l00293"></a>00293   <span class="keywordflow">if</span>( ( pres-&gt;res_compound4.resarray.resarray_val = 
<a name="l00294"></a>00294         (<span class="keyword">struct</span> nfs_resop4 *)Mem_Alloc( (<a class="code" href="nfs4__Compound_8c.html#ba16ddfc9c046cb52711f148a4b4642b">COMPOUND4_ARRAY</a>.argarray_len)*<span class="keyword">sizeof</span>( <span class="keyword">struct</span> nfs_resop4 ) )) == NULL )
<a name="l00295"></a>00295     {
<a name="l00296"></a>00296       <span class="comment">/* nfs_Log(CS_ALARM, funcname, SOFTWARE_ERROR, CRITICAL, HPSS_ENOMEM, 0, NULL, NULL); */</span>
<a name="l00297"></a>00297       <span class="keywordflow">return</span> NFS_REQ_DROP;
<a name="l00298"></a>00298     }
<a name="l00299"></a>00299   
<a name="l00300"></a>00300   <span class="comment">/* Managing the operation list */</span>
<a name="l00301"></a>00301 <span class="preprocessor">#ifdef _DEBUG_NFS_V4</span>
<a name="l00302"></a>00302 <span class="preprocessor"></span>  DisplayLogJdLevel( pclient-&gt;log_outputs, NIV_FULL_DEBUG, <span class="stringliteral">"NFS V4 COMPOUND: There are %d operations"</span>, <a class="code" href="nfs4__Compound_8c.html#ba16ddfc9c046cb52711f148a4b4642b">COMPOUND4_ARRAY</a>.argarray_len ) ;
<a name="l00303"></a>00303 <span class="preprocessor">#endif</span>
<a name="l00304"></a>00304 <span class="preprocessor"></span>
<a name="l00305"></a>00305 <span class="preprocessor">#ifdef _DEBUG_NFS_V4                   </span>
<a name="l00306"></a>00306 <span class="preprocessor"></span>  <span class="keywordflow">for</span>( i = 0 ; i &lt; <a class="code" href="nfs4__Compound_8c.html#ba16ddfc9c046cb52711f148a4b4642b">COMPOUND4_ARRAY</a>.argarray_len ; i++ )
<a name="l00307"></a>00307     printf( <span class="stringliteral">"%s "</span>, optab4[<a class="code" href="nfs4__Compound_8c.html#a98da90025ceb070e2f0cf6e09188607">optab4index</a>[<a class="code" href="nfs4__Compound_8c.html#ba16ddfc9c046cb52711f148a4b4642b">COMPOUND4_ARRAY</a>.argarray_val[i].argop]].<a class="code" href="structnfs4__op__desc____.html#930e0a0f589ae041cf1a6e74e0bcfdbb">name</a> ) ;
<a name="l00308"></a>00308   printf( <span class="stringliteral">"\n"</span> ) ;
<a name="l00309"></a>00309 <span class="preprocessor">#endif</span>
<a name="l00310"></a>00310 <span class="preprocessor"></span> 
<a name="l00311"></a>00311   pres-&gt;res_compound4.resarray.resarray_len = <a class="code" href="nfs4__Compound_8c.html#ba16ddfc9c046cb52711f148a4b4642b">COMPOUND4_ARRAY</a>.argarray_len  ; 
<a name="l00312"></a>00312   <span class="keywordflow">for</span>( i = 0 ; i &lt;  <a class="code" href="nfs4__Compound_8c.html#ba16ddfc9c046cb52711f148a4b4642b">COMPOUND4_ARRAY</a>.argarray_len ; i++ )
<a name="l00313"></a>00313     {
<a name="l00314"></a>00314       <span class="comment">/* Use optab4index to reference the operation */</span>
<a name="l00315"></a>00315       <span class="keywordflow">if</span>( <a class="code" href="nfs4__Compound_8c.html#ba16ddfc9c046cb52711f148a4b4642b">COMPOUND4_ARRAY</a>.argarray_val[i].argop &lt;= NFS4_OP_RELEASE_LOCKOWNER )
<a name="l00316"></a>00316         opindex = <a class="code" href="nfs4__Compound_8c.html#a98da90025ceb070e2f0cf6e09188607">optab4index</a>[<a class="code" href="nfs4__Compound_8c.html#ba16ddfc9c046cb52711f148a4b4642b">COMPOUND4_ARRAY</a>.argarray_val[i].argop];
<a name="l00317"></a>00317       <span class="keywordflow">else</span>
<a name="l00318"></a>00318         opindex = <a class="code" href="nfs4__Compound_8c.html#a98da90025ceb070e2f0cf6e09188607">optab4index</a>[NFS4_OP_RELEASE_LOCKOWNER+1] ; <span class="comment">/* = NFS4_OP_ILLEGAL a value to big for argop means an illegal value */</span>
<a name="l00319"></a>00319           
<a name="l00320"></a>00320       
<a name="l00321"></a>00321 <span class="preprocessor">#ifdef _DEBUG_NFS_V4                   </span>
<a name="l00322"></a>00322 <span class="preprocessor"></span>      DisplayLogJdLevel( pclient-&gt;log_outputs, NIV_FULL_DEBUG, <span class="stringliteral">"NFS V4 COMPOUND: Request #%d is %d = %s, entry #%d in the op array"</span>,
<a name="l00323"></a>00323                        i, 
<a name="l00324"></a>00324                        optab4[opindex].<a class="code" href="structnfs4__op__desc____.html#168c7621645c370c859e5fe914df7ad7">val</a>,
<a name="l00325"></a>00325                        optab4[opindex].<a class="code" href="structnfs4__op__desc____.html#930e0a0f589ae041cf1a6e74e0bcfdbb">name</a>, 
<a name="l00326"></a>00326                        opindex ) ;
<a name="l00327"></a>00327 <span class="preprocessor">#endif</span>
<a name="l00328"></a>00328 <span class="preprocessor"></span>      
<a name="l00329"></a>00329       memset( &amp;res, 0, <span class="keyword">sizeof</span>( res ) ) ;
<a name="l00330"></a>00330       status = (optab4[opindex].<a class="code" href="structnfs4__op__desc____.html#84c066ada70589fed546c3b1c90fc781">funct</a>)( &amp;(<a class="code" href="nfs4__Compound_8c.html#ba16ddfc9c046cb52711f148a4b4642b">COMPOUND4_ARRAY</a>.argarray_val[i]),
<a name="l00331"></a>00331                                         &amp;data,
<a name="l00332"></a>00332                                         &amp;res ) ;
<a name="l00333"></a>00333 
<a name="l00334"></a>00334       memcpy( &amp;(pres-&gt;res_compound4.resarray.resarray_val[i]), &amp;res, <span class="keyword">sizeof</span>( res ) ) ;
<a name="l00335"></a>00335 
<a name="l00336"></a>00336 <span class="preprocessor">#ifdef _DEBUG_NFS_V4</span>
<a name="l00337"></a>00337 <span class="preprocessor"></span>      <a class="code" href="nfs__proto__tools_8c.html#a48e0669eae8c05f43ed96006a494221">utf82str</a>( tmpstr, &amp;(pres-&gt;res_compound4.tag) ) ;
<a name="l00338"></a>00338       printf( <span class="stringliteral">"--&gt; COMPOUND REQUEST TAG is #%s#\n"</span>, tmpstr )  ;
<a name="l00339"></a>00339       
<a name="l00340"></a>00340       print_compound_fh( &amp;data ) ; 
<a name="l00341"></a>00341 
<a name="l00342"></a>00342       DisplayLogJdLevel( pclient-&gt;log_outputs, NIV_FULL_DEBUG, <span class="stringliteral">"NFS V4 COMPOUND:Status of %s in position %d = %d"</span>, 
<a name="l00343"></a>00343                          optab4[opindex].<a class="code" href="structnfs4__op__desc____.html#930e0a0f589ae041cf1a6e74e0bcfdbb">name</a>, i, status ) ;
<a name="l00344"></a>00344 <span class="preprocessor">#endif</span>
<a name="l00345"></a>00345 <span class="preprocessor"></span>
<a name="l00346"></a>00346       <span class="comment">/* All the operation, like NFS4_OP_ACESS, have a first replyied field called .status */</span>
<a name="l00347"></a>00347       pres-&gt;res_compound4.resarray.resarray_val[i].nfs_resop4_u.opaccess.status = status ; 
<a name="l00348"></a>00348 
<a name="l00349"></a>00349       <span class="keywordflow">if</span>( status != NFS4_OK )
<a name="l00350"></a>00350         {
<a name="l00351"></a>00351           <span class="comment">/* An error occured, we do not manage the other requests in the COMPOUND, this may be a regular behaviour */</span>
<a name="l00352"></a>00352 <span class="preprocessor">#ifdef _DEBUG_NFS_V4</span>
<a name="l00353"></a>00353 <span class="preprocessor"></span>          DisplayLogJdLevel( pclient-&gt;log_outputs, NIV_DEBUG, <span class="stringliteral">"NFS V4 COMPOUND: Error met, stop request with status =%d"</span>, status ) ;
<a name="l00354"></a>00354 <span class="preprocessor">#endif</span>
<a name="l00355"></a>00355 <span class="preprocessor"></span>
<a name="l00356"></a>00356           pres-&gt;res_compound4.resarray.resarray_len =  i+1 ; 
<a name="l00357"></a>00357           
<a name="l00358"></a>00358           break ;
<a name="l00359"></a>00359         }
<a name="l00360"></a>00360     }
<a name="l00361"></a>00361 
<a name="l00362"></a>00362   <span class="comment">/* Complete the reply, in particular, tell where you stopped if unsuccessfull COMPOUD */</span>
<a name="l00363"></a>00363   pres-&gt;res_compound4.status = status ;
<a name="l00364"></a>00364 
<a name="l00365"></a>00365 <span class="preprocessor">#ifdef _DEBUG_NFS_V4</span>
<a name="l00366"></a>00366 <span class="preprocessor"></span>  DisplayLogJdLevel( pclient-&gt;log_outputs, NIV_DEBUG, <span class="stringliteral">"NFS V4 COMPOUND: end status = %d|%d  lastindex = %d  last status = %d"</span>,
<a name="l00367"></a>00367                    status, pres-&gt;res_compound4.status,
<a name="l00368"></a>00368                    i,  pres-&gt;res_compound4.resarray.resarray_val[i-1].nfs_resop4_u.opaccess.status );
<a name="l00369"></a>00369   DisplayLogJdLevel( pclient-&gt;log_outputs, NIV_DEBUG, <span class="stringliteral">"==============================================================="</span> ) ;
<a name="l00370"></a>00370 <span class="preprocessor">#endif</span>
<a name="l00371"></a>00371 <span class="preprocessor"></span> 
<a name="l00372"></a>00372   <a class="code" href="nfs4__Compound_8c.html#e073647a95972fcb3fe2ba973848d5b6">compound_data_Free</a>( &amp;data ) ;
<a name="l00373"></a>00373 
<a name="l00374"></a>00374   <span class="keywordflow">return</span> NFS_REQ_OK ;
<a name="l00375"></a>00375 } <span class="comment">/* nfs4_Compound */</span>
<a name="l00376"></a>00376 
<a name="l00390"></a><a class="code" href="nfs4__Compound_8c.html#87d14750f2b16ad88320a7117d0d7609">00390</a> <span class="keywordtype">void</span> <a class="code" href="nfs4__Compound_8c.html#87d14750f2b16ad88320a7117d0d7609">nfs4_Compound_Free</a>( nfs_res_t * pres)
<a name="l00391"></a>00391 {
<a name="l00392"></a>00392   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0 ;
<a name="l00393"></a>00393 <span class="preprocessor">#ifdef _DEBUG_NFS_V4</span>
<a name="l00394"></a>00394 <span class="preprocessor"></span>  fprintf(stderr, <span class="stringliteral">"nfs4_Compound_Free de %p (resarraylen : %i)\n"</span>, pres, pres-&gt;res_compound4.resarray.resarray_len ); 
<a name="l00395"></a>00395 <span class="preprocessor">#endif</span>
<a name="l00396"></a>00396 <span class="preprocessor"></span>
<a name="l00397"></a>00397   <span class="keywordflow">for</span>( i = 0 ; i &lt; pres-&gt;res_compound4.resarray.resarray_len ; i ++ )
<a name="l00398"></a>00398     {
<a name="l00399"></a>00399 <span class="preprocessor">#ifdef _DEBUG_NFS_V4</span>
<a name="l00400"></a>00400 <span class="preprocessor"></span>      fprintf( stderr, <span class="stringliteral">"nfs4_Compound_Free sur op=%s\n"</span>,  optab4[<a class="code" href="nfs4__Compound_8c.html#a98da90025ceb070e2f0cf6e09188607">optab4index</a>[pres-&gt;res_compound4.resarray.resarray_val[i].resop]].<a class="code" href="structnfs4__op__desc____.html#930e0a0f589ae041cf1a6e74e0bcfdbb">name</a> ) ;
<a name="l00401"></a>00401 <span class="preprocessor">#endif</span>
<a name="l00402"></a>00402 <span class="preprocessor"></span>
<a name="l00403"></a>00403       <span class="keywordflow">switch</span>( pres-&gt;res_compound4.resarray.resarray_val[i].resop )
<a name="l00404"></a>00404         {
<a name="l00405"></a>00405         <span class="keywordflow">case</span> NFS4_OP_ACCESS:
<a name="l00406"></a>00406           <a class="code" href="nfs4__op__access_8c.html#1f5fecf4ae30f60f1bbb8c6d8439f5d0">nfs4_op_access_Free</a>( &amp;(pres-&gt;res_compound4.resarray.resarray_val[i].nfs_resop4_u.opaccess ) ) ;
<a name="l00407"></a>00407           break ;
<a name="l00408"></a>00408           
<a name="l00409"></a>00409         <span class="keywordflow">case</span> NFS4_OP_CLOSE:
<a name="l00410"></a>00410           <a class="code" href="nfs4__op__close_8c.html#25199f4dbbcd3893d0e0928f3185161f">nfs4_op_close_Free</a>( &amp;(pres-&gt;res_compound4.resarray.resarray_val[i].nfs_resop4_u.opclose ) ) ;
<a name="l00411"></a>00411           break ;
<a name="l00412"></a>00412 
<a name="l00413"></a>00413         <span class="keywordflow">case</span> NFS4_OP_COMMIT:
<a name="l00414"></a>00414           <a class="code" href="nfs4__op__commit_8c.html#4d7dfc9df40cb8cd08fda3209d46490a">nfs4_op_commit_Free</a>( &amp;(pres-&gt;res_compound4.resarray.resarray_val[i].nfs_resop4_u.opcommit ) ) ;
<a name="l00415"></a>00415           break ;
<a name="l00416"></a>00416           
<a name="l00417"></a>00417         <span class="keywordflow">case</span> NFS4_OP_CREATE:
<a name="l00418"></a>00418           <a class="code" href="nfs4__op__create_8c.html#a25337e227f4f42614cc57cf72c0dc57">nfs4_op_create_Free</a>( &amp;(pres-&gt;res_compound4.resarray.resarray_val[i].nfs_resop4_u.opcreate ) ) ;
<a name="l00419"></a>00419           break ;
<a name="l00420"></a>00420           
<a name="l00421"></a>00421         <span class="keywordflow">case</span> NFS4_OP_DELEGPURGE:
<a name="l00422"></a>00422           <a class="code" href="nfs4__op__delegpurge_8c.html#92e4ccd04d2cddad56ea142d309836a4">nfs4_op_delegpurge_Free</a>( &amp;(pres-&gt;res_compound4.resarray.resarray_val[i].nfs_resop4_u.opdelegpurge ) ) ;
<a name="l00423"></a>00423           break ;
<a name="l00424"></a>00424           
<a name="l00425"></a>00425         <span class="keywordflow">case</span> NFS4_OP_DELEGRETURN:
<a name="l00426"></a>00426           <a class="code" href="nfs4__op__delegreturn_8c.html#f53e30bda502fb93f5af714c734e8838">nfs4_op_delegreturn_Free</a>( &amp;(pres-&gt;res_compound4.resarray.resarray_val[i].nfs_resop4_u.opdelegreturn ) ) ;
<a name="l00427"></a>00427           break ;
<a name="l00428"></a>00428       
<a name="l00429"></a>00429         <span class="keywordflow">case</span> NFS4_OP_GETATTR:
<a name="l00430"></a>00430           <a class="code" href="nfs4__op__getattr_8c.html#aac60fe2fd6bfe547f897b0e7f331bab">nfs4_op_getattr_Free</a>( &amp;(pres-&gt;res_compound4.resarray.resarray_val[i].nfs_resop4_u. opgetattr ) ) ;
<a name="l00431"></a>00431           break ;
<a name="l00432"></a>00432           
<a name="l00433"></a>00433         <span class="keywordflow">case</span> NFS4_OP_GETFH:    
<a name="l00434"></a>00434           <a class="code" href="nfs4__op__getfh_8c.html#25d863d571b1820e76a53282d0eb6465">nfs4_op_getfh_Free</a>( &amp;(pres-&gt;res_compound4.resarray.resarray_val[i].nfs_resop4_u.opgetfh ) ) ;
<a name="l00435"></a>00435           break ;
<a name="l00436"></a>00436     
<a name="l00437"></a>00437         <span class="keywordflow">case</span> NFS4_OP_LINK:
<a name="l00438"></a>00438           <a class="code" href="nfs4__op__link_8c.html#84460c1087db1ca9a6c361571ce206c6">nfs4_op_link_Free</a>( &amp;(pres-&gt;res_compound4.resarray.resarray_val[i].nfs_resop4_u. oplink ) ) ;
<a name="l00439"></a>00439           break ;
<a name="l00440"></a>00440           
<a name="l00441"></a>00441         <span class="keywordflow">case</span> NFS4_OP_LOCK:
<a name="l00442"></a>00442           <a class="code" href="nfs4__op__lock_8c.html#f8734f9586b401ff79c347a610433be7">nfs4_op_lock_Free</a>( &amp;(pres-&gt;res_compound4.resarray.resarray_val[i].nfs_resop4_u.oplock ) ) ;
<a name="l00443"></a>00443           break ;
<a name="l00444"></a>00444           
<a name="l00445"></a>00445         <span class="keywordflow">case</span> NFS4_OP_LOCKT:
<a name="l00446"></a>00446           <a class="code" href="nfs4__op__lockt_8c.html#378560c32461ea4a5a0f007afa3e1228">nfs4_op_lockt_Free</a>( &amp;(pres-&gt;res_compound4.resarray.resarray_val[i].nfs_resop4_u.oplockt ) ) ;
<a name="l00447"></a>00447           break ;
<a name="l00448"></a>00448           
<a name="l00449"></a>00449         <span class="keywordflow">case</span> NFS4_OP_LOCKU:
<a name="l00450"></a>00450           <a class="code" href="nfs4__op__locku_8c.html#554fcb3fb560fecbb8e01606413cf82e">nfs4_op_locku_Free</a>( &amp;(pres-&gt;res_compound4.resarray.resarray_val[i].nfs_resop4_u.oplocku ) ) ;
<a name="l00451"></a>00451           break ;
<a name="l00452"></a>00452           
<a name="l00453"></a>00453         <span class="keywordflow">case</span> NFS4_OP_LOOKUP:
<a name="l00454"></a>00454           <a class="code" href="nfs4__op__lookup_8c.html#1148d2f61c5a838cd54948cf4c83d209">nfs4_op_lookup_Free</a>( &amp;(pres-&gt;res_compound4.resarray.resarray_val[i].nfs_resop4_u.oplookup ) ) ;
<a name="l00455"></a>00455           break ;
<a name="l00456"></a>00456 
<a name="l00457"></a>00457         <span class="keywordflow">case</span> NFS4_OP_LOOKUPP:
<a name="l00458"></a>00458           <a class="code" href="nfs4__op__lookupp_8c.html#7c8c227cdd5f90f51e55e0f5c748df93">nfs4_op_lookupp_Free</a>( &amp;(pres-&gt;res_compound4.resarray.resarray_val[i].nfs_resop4_u.oplookupp ) ) ;
<a name="l00459"></a>00459           break ;
<a name="l00460"></a>00460           
<a name="l00461"></a>00461         <span class="keywordflow">case</span> NFS4_OP_NVERIFY:
<a name="l00462"></a>00462           <a class="code" href="nfs4__op__nverify_8c.html#db8569a375d79bd47a947309dd2ebbbe">nfs4_op_nverify_Free</a>( &amp;(pres-&gt;res_compound4.resarray.resarray_val[i].nfs_resop4_u.opnverify ) ) ;
<a name="l00463"></a>00463           break ;
<a name="l00464"></a>00464                
<a name="l00465"></a>00465         <span class="keywordflow">case</span> NFS4_OP_OPEN:
<a name="l00466"></a>00466           <a class="code" href="nfs4__op__open_8c.html#176e8625a08e183acf91a73f6a1651c3">nfs4_op_open_Free</a>( &amp;(pres-&gt;res_compound4.resarray.resarray_val[i].nfs_resop4_u.opopen ) ) ;
<a name="l00467"></a>00467           break ;
<a name="l00468"></a>00468           
<a name="l00469"></a>00469         <span class="keywordflow">case</span> NFS4_OP_OPENATTR:
<a name="l00470"></a>00470           <a class="code" href="nfs4__op__openattr_8c.html#f065b976f38f38f6f207515e1103ac14">nfs4_op_openattr_Free</a>( &amp;(pres-&gt;res_compound4.resarray.resarray_val[i].nfs_resop4_u.opopenattr ) ) ;
<a name="l00471"></a>00471           break ;
<a name="l00472"></a>00472           
<a name="l00473"></a>00473         <span class="keywordflow">case</span> NFS4_OP_OPEN_CONFIRM:
<a name="l00474"></a>00474           <a class="code" href="nfs4__op__open__confirm_8c.html#28be7a3bd4874cfa3c2cfeb8f6d51642">nfs4_op_open_confirm_Free</a>( &amp;(pres-&gt;res_compound4.resarray.resarray_val[i].nfs_resop4_u.opopen_confirm ) ) ;
<a name="l00475"></a>00475           break ;
<a name="l00476"></a>00476           
<a name="l00477"></a>00477         <span class="keywordflow">case</span> NFS4_OP_OPEN_DOWNGRADE:
<a name="l00478"></a>00478           <a class="code" href="nfs4__op__open__downgrade_8c.html#3fab8a65a5442c37d203595dd169251a">nfs4_op_open_downgrade_Free</a>( &amp;(pres-&gt;res_compound4.resarray.resarray_val[i].nfs_resop4_u.opopen_downgrade ) ) ;
<a name="l00479"></a>00479           break ;
<a name="l00480"></a>00480           
<a name="l00481"></a>00481         <span class="keywordflow">case</span> NFS4_OP_PUTFH:
<a name="l00482"></a>00482           <a class="code" href="nfs4__op__putfh_8c.html#4ef844018e86af5ea52cbbe3cf3032c8">nfs4_op_putfh_Free</a>( &amp;(pres-&gt;res_compound4.resarray.resarray_val[i].nfs_resop4_u.opputfh ) ) ;
<a name="l00483"></a>00483           break ;
<a name="l00484"></a>00484         
<a name="l00485"></a>00485         <span class="keywordflow">case</span> NFS4_OP_PUTPUBFH:
<a name="l00486"></a>00486           <a class="code" href="nfs4__op__putpubfh_8c.html#42c88a3096c35d10d58b6225e0a88124">nfs4_op_putpubfh_Free</a>( &amp;(pres-&gt;res_compound4.resarray.resarray_val[i].nfs_resop4_u.opputpubfh ) ) ;
<a name="l00487"></a>00487           break ;
<a name="l00488"></a>00488         
<a name="l00489"></a>00489         <span class="keywordflow">case</span> NFS4_OP_PUTROOTFH:
<a name="l00490"></a>00490           <a class="code" href="nfs4__op__putrootfh_8c.html#e258bd72c46d705e7fd3317ef9ca56ce">nfs4_op_putrootfh_Free</a>( &amp;(pres-&gt;res_compound4.resarray.resarray_val[i].nfs_resop4_u.opputrootfh ) ) ;
<a name="l00491"></a>00491           break ;
<a name="l00492"></a>00492           
<a name="l00493"></a>00493         <span class="keywordflow">case</span> NFS4_OP_READ:
<a name="l00494"></a>00494           <a class="code" href="nfs4__op__read_8c.html#4a682aa2f7680c72dfc8ae3da56fe76e">nfs4_op_read_Free</a>( &amp;(pres-&gt;res_compound4.resarray.resarray_val[i].nfs_resop4_u.opread ) ) ;
<a name="l00495"></a>00495           break ;
<a name="l00496"></a>00496           
<a name="l00497"></a>00497         <span class="keywordflow">case</span> NFS4_OP_READDIR:
<a name="l00498"></a>00498           <a class="code" href="nfs4__op__readdir_8c.html#28bd74099667237874d6ec1103df378f">nfs4_op_readdir_Free</a>( &amp;(pres-&gt;res_compound4.resarray.resarray_val[i].nfs_resop4_u.opreaddir ) ) ;
<a name="l00499"></a>00499           break ;
<a name="l00500"></a>00500           
<a name="l00501"></a>00501         <span class="keywordflow">case</span> NFS4_OP_REMOVE: 
<a name="l00502"></a>00502           <a class="code" href="nfs4__op__remove_8c.html#aeb8b2280313379e498033a19d8d7bb7">nfs4_op_remove_Free</a>( &amp;(pres-&gt;res_compound4.resarray.resarray_val[i].nfs_resop4_u.opremove ) ) ;
<a name="l00503"></a>00503           break ;
<a name="l00504"></a>00504           
<a name="l00505"></a>00505         <span class="keywordflow">case</span> NFS4_OP_RENAME:
<a name="l00506"></a>00506           <a class="code" href="nfs4__op__rename_8c.html#ed7816b02b197e63bdca58c6796c2bb9">nfs4_op_rename_Free</a>( &amp;(pres-&gt;res_compound4.resarray.resarray_val[i].nfs_resop4_u.oprename ) ) ;
<a name="l00507"></a>00507           break ;
<a name="l00508"></a>00508           
<a name="l00509"></a>00509         <span class="keywordflow">case</span> NFS4_OP_RENEW:
<a name="l00510"></a>00510           <a class="code" href="nfs4__op__renew_8c.html#ea68bb03f99ab56ccb4f10ec79f078d9">nfs4_op_renew_Free</a>( &amp;(pres-&gt;res_compound4.resarray.resarray_val[i].nfs_resop4_u.oprenew ) ) ;
<a name="l00511"></a>00511           break ;
<a name="l00512"></a>00512           
<a name="l00513"></a>00513         <span class="keywordflow">case</span> NFS4_OP_RESTOREFH:
<a name="l00514"></a>00514           <a class="code" href="nfs4__op__restorefh_8c.html#d330b0f6777d5a7e68f9ce6b7657716f">nfs4_op_restorefh_Free</a>( &amp;(pres-&gt;res_compound4.resarray.resarray_val[i].nfs_resop4_u.oprestorefh ) ) ;
<a name="l00515"></a>00515           break ;
<a name="l00516"></a>00516           
<a name="l00517"></a>00517         <span class="keywordflow">case</span> NFS4_OP_SAVEFH:
<a name="l00518"></a>00518           <a class="code" href="nfs4__op__savefh_8c.html#1df4091d7cc137f329eb50a1636e3648">nfs4_op_savefh_Free</a>( &amp;(pres-&gt;res_compound4.resarray.resarray_val[i].nfs_resop4_u.opsavefh ) ) ;
<a name="l00519"></a>00519           break ;
<a name="l00520"></a>00520           
<a name="l00521"></a>00521         <span class="keywordflow">case</span> NFS4_OP_SECINFO:
<a name="l00522"></a>00522           <a class="code" href="nfs4__op__secinfo_8c.html#a3352471af44539548e9878d87d5abc6">nfs4_op_secinfo_Free</a>( &amp;(pres-&gt;res_compound4.resarray.resarray_val[i].nfs_resop4_u.opsecinfo ) ) ;
<a name="l00523"></a>00523           break ;
<a name="l00524"></a>00524           
<a name="l00525"></a>00525         <span class="keywordflow">case</span> NFS4_OP_SETATTR:
<a name="l00526"></a>00526           <a class="code" href="nfs4__op__setattr_8c.html#3dcd2f4c6d945e1a4419e26f9518b5c6">nfs4_op_setattr_Free</a>( &amp;(pres-&gt;res_compound4.resarray.resarray_val[i].nfs_resop4_u.opsetattr ) ) ;
<a name="l00527"></a>00527           break ;
<a name="l00528"></a>00528           
<a name="l00529"></a>00529         <span class="keywordflow">case</span> NFS4_OP_SETCLIENTID:
<a name="l00530"></a>00530           <a class="code" href="nfs4__op__setclientid_8c.html#46a601807c0e869612de03307b8b573e">nfs4_op_setclientid_Free</a>( &amp;(pres-&gt;res_compound4.resarray.resarray_val[i].nfs_resop4_u.opsetclientid ) ) ;
<a name="l00531"></a>00531           break ;
<a name="l00532"></a>00532           
<a name="l00533"></a>00533         <span class="keywordflow">case</span> NFS4_OP_SETCLIENTID_CONFIRM:
<a name="l00534"></a>00534           <a class="code" href="nfs4__op__setclientid__confirm_8c.html#3fe33066712097b76729a91af3682a63">nfs4_op_setclientid_confirm_Free</a>( &amp;(pres-&gt;res_compound4.resarray.resarray_val[i].nfs_resop4_u.opsetclientid_confirm ) ) ;
<a name="l00535"></a>00535           break ;
<a name="l00536"></a>00536           
<a name="l00537"></a>00537         <span class="keywordflow">case</span> NFS4_OP_VERIFY:
<a name="l00538"></a>00538           <a class="code" href="nfs4__op__verify_8c.html#40463524946e14f65b6c4d8a26905c39">nfs4_op_verify_Free</a>( &amp;(pres-&gt;res_compound4.resarray.resarray_val[i].nfs_resop4_u.opverify ) ) ;
<a name="l00539"></a>00539           break ;
<a name="l00540"></a>00540           
<a name="l00541"></a>00541         <span class="keywordflow">case</span> NFS4_OP_WRITE:
<a name="l00542"></a>00542           <a class="code" href="nfs4__op__write_8c.html#f620c1ffb14a543781d77f1be3fbd515">nfs4_op_write_Free</a>( &amp;(pres-&gt;res_compound4.resarray.resarray_val[i].nfs_resop4_u.opwrite ) ) ;
<a name="l00543"></a>00543           break ;
<a name="l00544"></a>00544           
<a name="l00545"></a>00545         <span class="keywordflow">case</span> NFS4_OP_RELEASE_LOCKOWNER:
<a name="l00546"></a>00546           <a class="code" href="nfs4__op__release__lockowner_8c.html#567f052ae0bd5a6cdd824a16e8cc8ac8">nfs4_op_release_lockowner_Free</a>( &amp;(pres-&gt;res_compound4.resarray.resarray_val[i].nfs_resop4_u.oprelease_lockowner ) ) ;
<a name="l00547"></a>00547           break ;
<a name="l00548"></a>00548           
<a name="l00549"></a>00549         <span class="keywordflow">case</span> NFS4_OP_ILLEGAL:
<a name="l00550"></a>00550           <a class="code" href="nfs4__op__illegal_8c.html#d9bd7bac3b2ca98d3403883dc3d565e8">nfs4_op_illegal_Free</a>( &amp;(pres-&gt;res_compound4.resarray.resarray_val[i].nfs_resop4_u.opillegal ) ) ;
<a name="l00551"></a>00551           break ;
<a name="l00552"></a>00552           
<a name="l00553"></a>00553         <span class="keywordflow">default</span>:
<a name="l00554"></a>00554           <span class="comment">/* Should not happen */</span>
<a name="l00555"></a>00555           <span class="comment">/* BUGAZOMEU : Un nouveau message d'erreur */</span>
<a name="l00556"></a>00556           break ;
<a name="l00557"></a>00557         } <span class="comment">/* switch */</span>
<a name="l00558"></a>00558 
<a name="l00559"></a>00559     } <span class="comment">/* for i */</span>
<a name="l00560"></a>00560   Mem_Free( (<span class="keywordtype">char</span> *)pres-&gt;res_compound4.resarray.resarray_val );
<a name="l00561"></a>00561   <span class="keywordflow">if</span>( pres-&gt;res_compound4.tag.utf8string_len != 0 )
<a name="l00562"></a>00562     Mem_Free( pres-&gt;res_compound4.tag.utf8string_val ) ;
<a name="l00563"></a>00563 
<a name="l00564"></a>00564   return ;
<a name="l00565"></a>00565 } <span class="comment">/* nfs4_Compound_Free */</span>
<a name="l00566"></a>00566 
<a name="l00580"></a><a class="code" href="nfs4__Compound_8c.html#e073647a95972fcb3fe2ba973848d5b6">00580</a> <span class="keywordtype">void</span> <a class="code" href="nfs4__Compound_8c.html#e073647a95972fcb3fe2ba973848d5b6">compound_data_Free</a>( compound_data_t * data )
<a name="l00581"></a>00581 {
<a name="l00582"></a>00582 
<a name="l00583"></a>00583   <span class="keywordflow">if</span>( data-&gt;currentFH.nfs_fh4_val != NULL ) 
<a name="l00584"></a>00584      Mem_Free( (<span class="keywordtype">char</span> *)data-&gt;currentFH.nfs_fh4_val ) ;
<a name="l00585"></a>00585 
<a name="l00586"></a>00586   <span class="keywordflow">if</span>( data-&gt;rootFH.nfs_fh4_val  != NULL ) 
<a name="l00587"></a>00587      Mem_Free( (<span class="keywordtype">char</span> *)data-&gt;rootFH.nfs_fh4_val ) ;
<a name="l00588"></a>00588 
<a name="l00589"></a>00589   <span class="keywordflow">if</span>( data-&gt;publicFH.nfs_fh4_val != NULL ) 
<a name="l00590"></a>00590      Mem_Free( (<span class="keywordtype">char</span> *)data-&gt;publicFH.nfs_fh4_val ) ;
<a name="l00591"></a>00591 
<a name="l00592"></a>00592   <span class="keywordflow">if</span>( data-&gt;savedFH.nfs_fh4_val != NULL ) 
<a name="l00593"></a>00593      Mem_Free( (<span class="keywordtype">char</span> *)data-&gt;savedFH.nfs_fh4_val ); 
<a name="l00594"></a>00594 
<a name="l00595"></a>00595   <span class="keywordflow">if</span>( data-&gt;mounted_on_FH.nfs_fh4_val != NULL )
<a name="l00596"></a>00596      Mem_Free( (<span class="keywordtype">char</span> *)data-&gt;mounted_on_FH.nfs_fh4_val ) ;
<a name="l00597"></a>00597 
<a name="l00598"></a>00598 } <span class="comment">/* compound_data_Free */</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Tue Mar 31 14:37:44 2009 for NFS and Mount protocols layer by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.7.1 </small></address>
</body>
</html>
