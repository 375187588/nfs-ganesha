<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>File System Abstraction Layer (HPSS) library: fsal_common.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>fsal_common.c</h1><div class="fragment"><pre class="fragment">00001 <span class="comment">/*</span>
00002 <span class="comment"> * vim:expandtab:shiftwidth=8:tabstop=8:</span>
00003 <span class="comment"> */</span>
00004 
00009 <span class="preprocessor">#ifdef HAVE_CONFIG_H</span>
00010 <span class="preprocessor"></span><span class="preprocessor">#include "config.h"</span>
00011 <span class="preprocessor">#endif</span>
00012 <span class="preprocessor"></span>
00013 <span class="preprocessor">#include "fsal_common.h"</span>
00014 <span class="preprocessor">#include "fsal_internal.h"</span>
00015 
00016 <span class="preprocessor">#define STRCMP strcasecmp</span>
00017 <span class="preprocessor"></span>
00027 <span class="keywordtype">int</span> HPSSFSAL_GetFilesetRoot( <span class="keywordtype">char</span> * fileset_name, ns_ObjHandle_t * p_root_hdl )
00028 {   
00029     <span class="keywordtype">int</span> rc;
00030     
00031     <span class="comment">/* if fileset_name is null, root fileset is returned */</span>
00032 
00033     <span class="keywordflow">if</span> ( fileset_name == NULL || fileset_name[0] == <span class="charliteral">'\0'</span> )
00034     {
00035       hpss_fileattr_t root_attr;
00036     
00037       rc = hpss_FileGetAttributes(<span class="stringliteral">"/"</span>,&amp;root_attr);
00038       <span class="keywordflow">if</span> ( rc ) <span class="keywordflow">return</span> rc;
00039       
00040       *p_root_hdl = root_attr.ObjectHandle;
00041       <span class="keywordflow">return</span> 0;
00042       
00043     }
00044     <span class="keywordflow">else</span>
00045     {
00046       ns_FilesetAttrBits_t  attrBits;
00047       ns_FilesetAttrs_t     fsattrs;
00048       
00049       attrBits = cast64m(0);
00050       attrBits = orbit64m( attrBits, NS_FS_ATTRINDEX_FILESET_HANDLE );
00051       
00052       rc = hpss_FilesetGetAttributes( fileset_name, NULL, NULL, NULL,
00053                                       attrBits, &amp;fsattrs );
00054 
00055       <span class="keywordflow">if</span> (rc) <span class="keywordflow">return</span> rc;
00056       
00057       *p_root_hdl = fsattrs.FilesetHandle;
00058       <span class="keywordflow">return</span> 0;
00059       
00060     }
00061 }
00062 
00063 
00078 <span class="keywordtype">void</span> HPSSFSAL_BuildCos( fsal_uint_t CosId, 
00079                         hpss_cos_hints_t  * hints,
00080                         hpss_cos_priorities_t * hintpri )
00081 {
00082 
00083   <span class="comment">/* clears the structures */</span>
00084   memset(hints, 0, <span class="keyword">sizeof</span>(hpss_cos_hints_t));
00085   memset(hintpri, 0, <span class="keyword">sizeof</span>(hpss_cos_priorities_t));
00086 
00087   hints-&gt;COSId = (unsigned32)CosId;
00088   hintpri-&gt;COSIdPriority = REQUIRED_PRIORITY;
00089 
00090   hintpri-&gt;COSNamePriority = NO_PRIORITY;
00091   hintpri-&gt;WriteOpsPriority = NO_PRIORITY;
00092   hintpri-&gt;ReadOpsPriority = NO_PRIORITY;
00093   hintpri-&gt;AccessFrequencyPriority = NO_PRIORITY;
00094   hintpri-&gt;TransferRatePriority = NO_PRIORITY;
00095   hintpri-&gt;MinFileSizePriority = NO_PRIORITY;
00096   hintpri-&gt;MaxFileSizePriority = NO_PRIORITY;
00097   hintpri-&gt;OptimumAccessSizePriority = NO_PRIORITY;
00098   hintpri-&gt;AvgLatencyPriority = NO_PRIORITY;
00099   hintpri-&gt;StageCodePriority = NO_PRIORITY;
00100   
00101   <span class="keywordflow">return</span>;
00102   
00103 }
00104 
00105 
00106 <span class="keywordtype">int</span> HPSSFSAL_IsStaleHandle( ns_ObjHandle_t * p_hdl,
00107                             TYPE_CRED_HPSS * p_cred )
00108 {
00109   <span class="keywordtype">int</span> rc;
00110   
00111   <a class="code" href="fsal__internal_8c.html#a18">TakeTokenFSCall</a>();
00112   
00113   rc = HPSSFSAL_GetRawAttrHandle(
00114         p_hdl,
00115         NULL,
00116         p_cred,
00117         FALSE, <span class="comment">/* don't solve junctions */</span>
00118         NULL,
00119         NULL,
00120         NULL);
00121   
00122   ReleaseTokenFSCall();
00123   
00124   <span class="keywordflow">if</span> ( (rc == HPSS_ENOENT) || (rc == HPSS_ENOTDIR) )
00125     <span class="keywordflow">return</span> TRUE;
00126   
00127   <span class="keywordflow">return</span> FALSE;
00128 }
00129 
00130 
00131 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Apr 9 08:24:43 2008 for File System Abstraction Layer (HPSS) library by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
