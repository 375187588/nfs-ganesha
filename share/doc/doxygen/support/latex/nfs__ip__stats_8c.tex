\section{nfs\_\-ip\_\-stats.c File Reference}
\label{nfs__ip__stats_8c}\index{nfs_ip_stats.c@{nfs\_\-ip\_\-stats.c}}
The management of the IP stats per machines. 

{\tt \#include \char`\"{}Hash\-Data.h\char`\"{}}\par
{\tt \#include \char`\"{}Hash\-Table.h\char`\"{}}\par
{\tt \#include \char`\"{}log\_\-functions.h\char`\"{}}\par
{\tt \#include \char`\"{}stuff\_\-alloc.h\char`\"{}}\par
{\tt \#include \char`\"{}nfs\_\-core.h\char`\"{}}\par
{\tt \#include \char`\"{}nfs\_\-exports.h\char`\"{}}\par
{\tt \#include \char`\"{}config\_\-parsing.h\char`\"{}}\par
{\tt \#include \char`\"{}nfs\_\-ip\_\-stats.h\char`\"{}}\par
{\tt \#include $<$stdlib.h$>$}\par
{\tt \#include $<$string.h$>$}\par
\subsection*{Functions}
\begin{CompactItemize}
\item 
unsigned long int {\bf ip\_\-stats\_\-value\_\-hash\_\-func} (hash\_\-parameter\_\-t $\ast$p\_\-hparam, hash\_\-buffer\_\-t $\ast$buffclef)
\item 
unsigned long int {\bf ip\_\-stats\_\-rbt\_\-hash\_\-func} (hash\_\-parameter\_\-t $\ast$p\_\-hparam, hash\_\-buffer\_\-t $\ast$buffclef)
\item 
int {\bf compare\_\-ip\_\-stats} (hash\_\-buffer\_\-t $\ast$buff1, hash\_\-buffer\_\-t $\ast$buff2)
\item 
int {\bf display\_\-ip\_\-stats} (hash\_\-buffer\_\-t $\ast$pbuff, char $\ast$str)
\item 
int {\bf nfs\_\-ip\_\-stats\_\-add} (hash\_\-table\_\-t $\ast$ht\_\-ip\_\-stats, unsigned int ipaddr, nfs\_\-ip\_\-stats\_\-t $\ast$nfs\_\-ip\_\-stats\_\-pool)
\item 
int {\bf nfs\_\-ip\_\-stats\_\-incr} (hash\_\-table\_\-t $\ast$ht\_\-ip\_\-stats, unsigned int ipaddr, unsigned int nfs\_\-prog, unsigned int mnt\_\-prog, struct svc\_\-req $\ast$ptr\_\-req)
\item 
int {\bf nfs\_\-ip\_\-stats\_\-get} (hash\_\-table\_\-t $\ast$ht\_\-ip\_\-stats, unsigned int ipaddr, nfs\_\-ip\_\-stats\_\-t $\ast$$\ast$pnfs\_\-ip\_\-stats)
\item 
int {\bf nfs\_\-ip\_\-stats\_\-remove} (hash\_\-table\_\-t $\ast$ht\_\-ip\_\-stats, int ipaddr, nfs\_\-ip\_\-stats\_\-t $\ast$nfs\_\-ip\_\-stats\_\-pool)
\item 
hash\_\-table\_\-t $\ast$ {\bf nfs\_\-Init\_\-ip\_\-stats} (nfs\_\-ip\_\-stats\_\-parameter\_\-t param)
\item 
void {\bf nfs\_\-ip\_\-stats\_\-dump} (hash\_\-table\_\-t $\ast$$\ast$ht\_\-ip\_\-stats, unsigned int nb\_\-worker, char $\ast$path\_\-stat)
\end{CompactItemize}
\subsection*{Variables}
\begin{CompactItemize}
\item 
nfs\_\-parameter\_\-t {\bf nfs\_\-param}
\item 
unsigned int {\bf expiration\_\-time}
\end{CompactItemize}


\subsection{Detailed Description}
The management of the IP stats per machines. 

\begin{Desc}
\item[Author:]\begin{Desc}
\item[Author]leibovic \end{Desc}
\end{Desc}
\begin{Desc}
\item[Date:]\begin{Desc}
\item[Date]2006/01/24 13:49:12 \end{Desc}
\end{Desc}
\begin{Desc}
\item[Version:]\begin{Desc}
\item[Revision]1.4 \end{Desc}
\end{Desc}
{\bf nfs\_\-ip\_\-stats.c}{\rm (p.\,\pageref{nfs__ip__stats_8c})} : The management of the IP stats per machines.

\begin{Desc}
\item[Header]/cea/S/home/cvs/cvs/SHERPA/Base\-Cvs/GANESHA/src/support/nfs\_\-ip\_\-stats.c,v 1.4 2006/01/24 13:49:12 leibovic Exp \end{Desc}


\begin{Desc}
\item[Log]{\bf nfs\_\-ip\_\-stats.c}{\rm (p.\,\pageref{nfs__ip__stats_8c})},v \end{Desc}
Revision 1.4 2006/01/24 13:49:12 leibovic Adding missing includes.

Revision 1.3 2006/01/20 07:39:23 leibovic Back to the previous version.

Revision 1.1 2005/11/30 09:28:42 deniel IP/stats cache per thread (no bottleneck) is complete

Definition in file {\bf nfs\_\-ip\_\-stats.c}.

\subsection{Function Documentation}
\index{nfs_ip_stats.c@{nfs\_\-ip\_\-stats.c}!compare_ip_stats@{compare\_\-ip\_\-stats}}
\index{compare_ip_stats@{compare\_\-ip\_\-stats}!nfs_ip_stats.c@{nfs\_\-ip\_\-stats.c}}
\subsubsection{\setlength{\rightskip}{0pt plus 5cm}int compare\_\-ip\_\-stats (hash\_\-buffer\_\-t $\ast$ {\em buff1}, hash\_\-buffer\_\-t $\ast$ {\em buff2})}\label{nfs__ip__stats_8c_a4}


compare\_\-ip\_\-stats: compares the ip address stored in the key buffers.

compare the ip address stored in the key buffers. This function is to be used as 'compare\_\-key' field in the hashtable storing the nfs duplicated requests.

\begin{Desc}
\item[Parameters:]
\begin{description}
\item[{\em buff1}][IN] first key \item[{\em buff2}][IN] second key\end{description}
\end{Desc}
\begin{Desc}
\item[Returns:]0 if keys are identifical, 1 if they are different. \end{Desc}


Definition at line 178 of file nfs\_\-ip\_\-stats.c.\index{nfs_ip_stats.c@{nfs\_\-ip\_\-stats.c}!display_ip_stats@{display\_\-ip\_\-stats}}
\index{display_ip_stats@{display\_\-ip\_\-stats}!nfs_ip_stats.c@{nfs\_\-ip\_\-stats.c}}
\subsubsection{\setlength{\rightskip}{0pt plus 5cm}int display\_\-ip\_\-stats (hash\_\-buffer\_\-t $\ast$ {\em pbuff}, char $\ast$ {\em str})}\label{nfs__ip__stats_8c_a5}


display\_\-ip\_\-stats: displays the ip\_\-stats stored in the buffer.

displays the ip\_\-stats stored in the buffer. This function is to be used as 'key\_\-to\_\-str' field in the hashtable storing the nfs duplicated requests.

\begin{Desc}
\item[Parameters:]
\begin{description}
\item[{\em buff1}][IN] buffer to display \item[{\em buff2}][OUT] output string\end{description}
\end{Desc}
\begin{Desc}
\item[Returns:]number of character written. \end{Desc}


Definition at line 199 of file nfs\_\-ip\_\-stats.c.\index{nfs_ip_stats.c@{nfs\_\-ip\_\-stats.c}!ip_stats_rbt_hash_func@{ip\_\-stats\_\-rbt\_\-hash\_\-func}}
\index{ip_stats_rbt_hash_func@{ip\_\-stats\_\-rbt\_\-hash\_\-func}!nfs_ip_stats.c@{nfs\_\-ip\_\-stats.c}}
\subsubsection{\setlength{\rightskip}{0pt plus 5cm}unsigned long int ip\_\-stats\_\-rbt\_\-hash\_\-func (hash\_\-parameter\_\-t $\ast$ {\em p\_\-hparam}, hash\_\-buffer\_\-t $\ast$ {\em buffclef})}\label{nfs__ip__stats_8c_a3}


ip\_\-stats\_\-rbt\_\-hash\_\-func: computes the rbt value for the entry in IP stats cache.

Computes the rbt value for the entry in IP stats cache. In fact, it just use the address value itself (which is an unsigned integer) as the rbt value. This function is called internal in the Has\-Table\_\-$\ast$ function

\begin{Desc}
\item[Parameters:]
\begin{description}
\item[{\em hparam}][IN] hash table parameter. \item[{\em buffcleff\mbox{[}in\mbox{]}}]pointer to the hash key buffer\end{description}
\end{Desc}
\begin{Desc}
\item[Returns:]the computed rbt value.\end{Desc}
\begin{Desc}
\item[See also:]Hash\-Table\_\-Init \end{Desc}


Definition at line 159 of file nfs\_\-ip\_\-stats.c.\index{nfs_ip_stats.c@{nfs\_\-ip\_\-stats.c}!ip_stats_value_hash_func@{ip\_\-stats\_\-value\_\-hash\_\-func}}
\index{ip_stats_value_hash_func@{ip\_\-stats\_\-value\_\-hash\_\-func}!nfs_ip_stats.c@{nfs\_\-ip\_\-stats.c}}
\subsubsection{\setlength{\rightskip}{0pt plus 5cm}unsigned long int ip\_\-stats\_\-value\_\-hash\_\-func (hash\_\-parameter\_\-t $\ast$ {\em p\_\-hparam}, hash\_\-buffer\_\-t $\ast$ {\em buffclef})}\label{nfs__ip__stats_8c_a2}


ip\_\-stats\_\-rbt\_\-hash\_\-func: computes the hash value for the entry in IP stats cache.

Computes the hash value for the entry in IP stats cache. In fact, it just use addresse as value (identity function) modulo the size of the hash. This function is called internal in the Has\-Table\_\-$\ast$ function

\begin{Desc}
\item[Parameters:]
\begin{description}
\item[{\em hparam}][IN] hash table parameter. \item[{\em buffcleff\mbox{[}in\mbox{]}}]pointer to the hash key buffer\end{description}
\end{Desc}
\begin{Desc}
\item[Returns:]the computed hash value.\end{Desc}
\begin{Desc}
\item[See also:]Hash\-Table\_\-Init \end{Desc}


Definition at line 137 of file nfs\_\-ip\_\-stats.c.\index{nfs_ip_stats.c@{nfs\_\-ip\_\-stats.c}!nfs_Init_ip_stats@{nfs\_\-Init\_\-ip\_\-stats}}
\index{nfs_Init_ip_stats@{nfs\_\-Init\_\-ip\_\-stats}!nfs_ip_stats.c@{nfs\_\-ip\_\-stats.c}}
\subsubsection{\setlength{\rightskip}{0pt plus 5cm}hash\_\-table\_\-t$\ast$ nfs\_\-Init\_\-ip\_\-stats (nfs\_\-ip\_\-stats\_\-parameter\_\-t {\em param})}\label{nfs__ip__stats_8c_a10}


nfs\_\-Init\_\-ip\_\-stats: Init the hashtable for IP stats cache.

Perform all the required initialization for hashtable IP stats cache

\begin{Desc}
\item[Parameters:]
\begin{description}
\item[{\em param}][IN] parameter used to init the duplicate request cache\end{description}
\end{Desc}
\begin{Desc}
\item[Returns:]0 if successful, -1 otherwise \end{Desc}


Definition at line 469 of file nfs\_\-ip\_\-stats.c.\index{nfs_ip_stats.c@{nfs\_\-ip\_\-stats.c}!nfs_ip_stats_add@{nfs\_\-ip\_\-stats\_\-add}}
\index{nfs_ip_stats_add@{nfs\_\-ip\_\-stats\_\-add}!nfs_ip_stats.c@{nfs\_\-ip\_\-stats.c}}
\subsubsection{\setlength{\rightskip}{0pt plus 5cm}int nfs\_\-ip\_\-stats\_\-add (hash\_\-table\_\-t $\ast$ {\em ht\_\-ip\_\-stats}, unsigned int {\em ipaddr}, nfs\_\-ip\_\-stats\_\-t $\ast$ {\em nfs\_\-ip\_\-stats\_\-pool})}\label{nfs__ip__stats_8c_a6}


nfs\_\-ip\_\-stats\_\-add: adds an entry in the duplicate requests cache.

Adds an entry in the duplicate requests cache.

\begin{Desc}
\item[Parameters:]
\begin{description}
\item[{\em ipaddr}][IN] the ipaddr to be used as key \item[{\em nfs\_\-ip\_\-stats\_\-pool}][INOUT] values pool for hash table\end{description}
\end{Desc}
\begin{Desc}
\item[Returns:]IP\_\-STATS\_\-SUCCESS if successfull\par
. 

IP\_\-STATS\_\-INSERT\_\-MALLOC\_\-ERROR if an error occured during the insertion process \par
 

IP\_\-STATS\_\-NETDB\_\-ERROR if an error occured during the netdb query (via gethostbyaddr). \end{Desc}


Definition at line 227 of file nfs\_\-ip\_\-stats.c.

References nfs\_\-param.

Referenced by nfs\_\-export\_\-check\_\-access().\index{nfs_ip_stats.c@{nfs\_\-ip\_\-stats.c}!nfs_ip_stats_dump@{nfs\_\-ip\_\-stats\_\-dump}}
\index{nfs_ip_stats_dump@{nfs\_\-ip\_\-stats\_\-dump}!nfs_ip_stats.c@{nfs\_\-ip\_\-stats.c}}
\subsubsection{\setlength{\rightskip}{0pt plus 5cm}void nfs\_\-ip\_\-stats\_\-dump (hash\_\-table\_\-t $\ast$$\ast$ {\em ht\_\-ip\_\-stats}, unsigned int {\em nb\_\-worker}, char $\ast$ {\em path\_\-stat})}\label{nfs__ip__stats_8c_a11}


nfs\_\-ip\_\-stats\_\-dump: Dumps the IP Stats for each client to a file per client

\begin{Desc}
\item[Parameters:]
\begin{description}
\item[{\em ht\_\-ip\_\-stats}][IN] hash table to be dumped \item[{\em path\_\-stat}][IN] pattern used to build path used for dumping stats\end{description}
\end{Desc}
\begin{Desc}
\item[Returns:]nothing (void function). \end{Desc}


Definition at line 493 of file nfs\_\-ip\_\-stats.c.

References nfs\_\-ip\_\-stats\_\-get(), and nfs\_\-param.\index{nfs_ip_stats.c@{nfs\_\-ip\_\-stats.c}!nfs_ip_stats_get@{nfs\_\-ip\_\-stats\_\-get}}
\index{nfs_ip_stats_get@{nfs\_\-ip\_\-stats\_\-get}!nfs_ip_stats.c@{nfs\_\-ip\_\-stats.c}}
\subsubsection{\setlength{\rightskip}{0pt plus 5cm}int nfs\_\-ip\_\-stats\_\-get (hash\_\-table\_\-t $\ast$ {\em ht\_\-ip\_\-stats}, unsigned int {\em ipaddr}, nfs\_\-ip\_\-stats\_\-t $\ast$$\ast$ {\em pnfs\_\-ip\_\-stats})}\label{nfs__ip__stats_8c_a8}


nfs\_\-ip\_\-stats\_\-get: gets the stats value.

gets the stats value.

\begin{Desc}
\item[Parameters:]
\begin{description}
\item[{\em ipaddr}][IN] the ip address requested\end{description}
\end{Desc}
\begin{Desc}
\item[Returns:]the computed number of call for this ipaddr. Negative value is a failure \end{Desc}


Definition at line 381 of file nfs\_\-ip\_\-stats.c.

References nfs\_\-param.

Referenced by nfs\_\-ip\_\-stats\_\-dump().\index{nfs_ip_stats.c@{nfs\_\-ip\_\-stats.c}!nfs_ip_stats_incr@{nfs\_\-ip\_\-stats\_\-incr}}
\index{nfs_ip_stats_incr@{nfs\_\-ip\_\-stats\_\-incr}!nfs_ip_stats.c@{nfs\_\-ip\_\-stats.c}}
\subsubsection{\setlength{\rightskip}{0pt plus 5cm}int nfs\_\-ip\_\-stats\_\-incr (hash\_\-table\_\-t $\ast$ {\em ht\_\-ip\_\-stats}, unsigned int {\em ipaddr}, unsigned int {\em nfs\_\-prog}, unsigned int {\em mnt\_\-prog}, struct svc\_\-req $\ast$ {\em ptr\_\-req})}\label{nfs__ip__stats_8c_a7}


nfs\_\-ip\_\-stats\_\-incr: increments the stats value.

increments the stats value.

\begin{Desc}
\item[Parameters:]
\begin{description}
\item[{\em ipaddr}][IN] the ip address requested\end{description}
\end{Desc}
\begin{Desc}
\item[Returns:]the computed number of call for this ipaddr. Negative value is a failure \end{Desc}


Definition at line 302 of file nfs\_\-ip\_\-stats.c.

References nfs\_\-param.

Referenced by nfs\_\-export\_\-check\_\-access().\index{nfs_ip_stats.c@{nfs\_\-ip\_\-stats.c}!nfs_ip_stats_remove@{nfs\_\-ip\_\-stats\_\-remove}}
\index{nfs_ip_stats_remove@{nfs\_\-ip\_\-stats\_\-remove}!nfs_ip_stats.c@{nfs\_\-ip\_\-stats.c}}
\subsubsection{\setlength{\rightskip}{0pt plus 5cm}int nfs\_\-ip\_\-stats\_\-remove (hash\_\-table\_\-t $\ast$ {\em ht\_\-ip\_\-stats}, int {\em ipaddr}, nfs\_\-ip\_\-stats\_\-t $\ast$ {\em nfs\_\-ip\_\-stats\_\-pool})}\label{nfs__ip__stats_8c_a9}


nfs\_\-ip\_\-stats\_\-remove: Tries to remove an entry for ip\_\-stats cache

Tries to remove an entry for ip\_\-stats cache.

\begin{Desc}
\item[Parameters:]
\begin{description}
\item[{\em ipaddr}][IN] the ip address to be uncached. \item[{\em nfs\_\-ip\_\-stats\_\-pool}][INOUT] values pool for hash table\end{description}
\end{Desc}
\begin{Desc}
\item[Returns:]the result previously set if $\ast$pstatus == IP\_\-STATS\_\-SUCCESS \end{Desc}


Definition at line 424 of file nfs\_\-ip\_\-stats.c.

References nfs\_\-param.

\subsection{Variable Documentation}
\index{nfs_ip_stats.c@{nfs\_\-ip\_\-stats.c}!expiration_time@{expiration\_\-time}}
\index{expiration_time@{expiration\_\-time}!nfs_ip_stats.c@{nfs\_\-ip\_\-stats.c}}
\subsubsection{\setlength{\rightskip}{0pt plus 5cm}unsigned int {\bf expiration\_\-time}}\label{nfs__ip__stats_8c_a1}




Definition at line 118 of file nfs\_\-ip\_\-stats.c.\index{nfs_ip_stats.c@{nfs\_\-ip\_\-stats.c}!nfs_param@{nfs\_\-param}}
\index{nfs_param@{nfs\_\-param}!nfs_ip_stats.c@{nfs\_\-ip\_\-stats.c}}
\subsubsection{\setlength{\rightskip}{0pt plus 5cm}nfs\_\-parameter\_\-t {\bf nfs\_\-param}}\label{nfs__ip__stats_8c_a0}




Definition at line 146 of file test\_\-clientid.c.