<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ganeshell: cmd_nfstools.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>cmd_nfstools.c</h1><a href="cmd__nfstools_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">/*</span>
00002 <span class="comment"> * vim:expandtab:shiftwidth=8:tabstop=8:</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> * Copyright CEA/DAM/DIF  (2008)</span>
00005 <span class="comment"> * contributeur : Philippe DENIEL   philippe.deniel@cea.fr</span>
00006 <span class="comment"> *                Thomas LEIBOVICI  thomas.leibovici@cea.fr</span>
00007 <span class="comment"> *</span>
00008 <span class="comment"> *</span>
00009 <span class="comment"> * Ce logiciel est un serveur implementant le protocole NFS.</span>
00010 <span class="comment"> *</span>
00011 <span class="comment"> * Ce logiciel est régi par la licence CeCILL soumise au droit français et</span>
00012 <span class="comment"> * respectant les principes de diffusion des logiciels libres. Vous pouvez</span>
00013 <span class="comment"> * utiliser, modifier et/ou redistribuer ce programme sous les conditions</span>
00014 <span class="comment"> * de la licence CeCILL telle que diffusée par le CEA, le CNRS et l'INRIA</span>
00015 <span class="comment"> * sur le site "http://www.cecill.info".</span>
00016 <span class="comment"> *</span>
00017 <span class="comment"> * En contrepartie de l'accessibilité au code source et des droits de copie,</span>
00018 <span class="comment"> * de modification et de redistribution accordés par cette licence, il n'est</span>
00019 <span class="comment"> * offert aux utilisateurs qu'une garantie limitée.  Pour les mêmes raisons,</span>
00020 <span class="comment"> * seule une responsabilité restreinte pèse sur l'auteur du programme,  le</span>
00021 <span class="comment"> * titulaire des droits patrimoniaux et les concédants successifs.</span>
00022 <span class="comment"> *</span>
00023 <span class="comment"> * A cet égard  l'attention de l'utilisateur est attirée sur les risques</span>
00024 <span class="comment"> * associés au chargement,  à l'utilisation,  à la modification et/ou au</span>
00025 <span class="comment"> * développement et à la reproduction du logiciel par l'utilisateur étant</span>
00026 <span class="comment"> * donné sa spécificité de logiciel libre, qui peut le rendre complexe à</span>
00027 <span class="comment"> * manipuler et qui le réserve donc à des développeurs et des professionnels</span>
00028 <span class="comment"> * avertis possédant  des  connaissances  informatiques approfondies.  Les</span>
00029 <span class="comment"> * utilisateurs sont donc invités à charger  et  tester  l'adéquation  du</span>
00030 <span class="comment"> * logiciel à leurs besoins dans des conditions permettant d'assurer la</span>
00031 <span class="comment"> * sécurité de leurs systèmes et ou de leurs données et, plus généralement,</span>
00032 <span class="comment"> * à l'utiliser et l'exploiter dans les mêmes conditions de sécurité.</span>
00033 <span class="comment"> *</span>
00034 <span class="comment"> * Le fait que vous puissiez accéder à cet en-tête signifie que vous avez</span>
00035 <span class="comment"> * pris connaissance de la licence CeCILL, et que vous en avez accepté les</span>
00036 <span class="comment"> * termes.</span>
00037 <span class="comment"> *</span>
00038 <span class="comment"> * ---------------------</span>
00039 <span class="comment"> *</span>
00040 <span class="comment"> * Copyright CEA/DAM/DIF (2005)</span>
00041 <span class="comment"> *  Contributor: Philippe DENIEL  philippe.deniel@cea.fr</span>
00042 <span class="comment"> *               Thomas LEIBOVICI thomas.leibovici@cea.fr</span>
00043 <span class="comment"> *</span>
00044 <span class="comment"> *</span>
00045 <span class="comment"> * This software is a server that implements the NFS protocol.</span>
00046 <span class="comment"> * </span>
00047 <span class="comment"> *</span>
00048 <span class="comment"> * This software is governed by the CeCILL  license under French law and</span>
00049 <span class="comment"> * abiding by the rules of distribution of free software.  You can  use,</span>
00050 <span class="comment"> * modify and/ or redistribute the software under the terms of the CeCILL</span>
00051 <span class="comment"> * license as circulated by CEA, CNRS and INRIA at the following URL</span>
00052 <span class="comment"> * "http://www.cecill.info".</span>
00053 <span class="comment"> *</span>
00054 <span class="comment"> * As a counterpart to the access to the source code and  rights to copy,</span>
00055 <span class="comment"> * modify and redistribute granted by the license, users are provided only</span>
00056 <span class="comment"> * with a limited warranty  and the software's author,  the holder of the</span>
00057 <span class="comment"> * economic rights,  and the successive licensors  have only  limited</span>
00058 <span class="comment"> * liability.</span>
00059 <span class="comment"> *</span>
00060 <span class="comment"> * In this respect, the user's attention is drawn to the risks associated</span>
00061 <span class="comment"> * with loading,  using,  modifying and/or developing or reproducing the</span>
00062 <span class="comment"> * software by the user in light of its specific status of free software,</span>
00063 <span class="comment"> * that may mean  that it is complicated to manipulate,  and  that  also</span>
00064 <span class="comment"> therefore means  that it is reserved for developers  and  experienced</span>
00065 <span class="comment"> * professionals having in-depth computer knowledge. Users are therefore</span>
00066 <span class="comment"> * encouraged to load and test the software's suitability as regards their</span>
00067 <span class="comment"> * requirements in conditions enabling the security of their systems and/or</span>
00068 <span class="comment"> * data to be ensured and,  more generally, to use and operate it in the</span>
00069 <span class="comment"> * same conditions as regards security.</span>
00070 <span class="comment"> *</span>
00071 <span class="comment"> * The fact that you are presently reading this means that you have had</span>
00072 <span class="comment"> * knowledge of the CeCILL license and that you accept its terms.</span>
00073 <span class="comment"> * ---------------------------------------</span>
00074 <span class="comment"> */</span>
00075 
00159 <span class="preprocessor">#ifdef HAVE_CONFIG_H</span>
00160 <span class="preprocessor"></span><span class="preprocessor">#include "config.h"</span>
00161 <span class="preprocessor">#endif</span>
00162 <span class="preprocessor"></span>
00163 
00164 <span class="preprocessor">#include &lt;limits.h&gt;</span>
00165 <span class="preprocessor">#include &lt;string.h&gt;</span>
00166 <span class="preprocessor">#include &lt;sys/stat.h&gt;</span>
00167 <span class="preprocessor">#include "<a class="code" href="cmd__nfstools_8h.html">cmd_nfstools.h</a>"</span>
00168 <span class="preprocessor">#include "stuff_alloc.h"</span>
00169 <span class="preprocessor">#include "nfs23.h"</span>
00170 <span class="preprocessor">#include "nfs4.h"</span>
00171 <span class="preprocessor">#include "mount.h"</span>
00172 <span class="preprocessor">#include "nfs_proto_functions.h"</span>
00173 <span class="preprocessor">#include "nfs_tools.h"</span>
00174 <span class="preprocessor">#include "nfs_proto_tools.h"</span>
00175 <span class="preprocessor">#include "nfs_file_handle.h"</span>
00176 <span class="preprocessor">#include "<a class="code" href="cmd__tools_8h.html">cmd_tools.h</a>"</span>
00177 
00178 <span class="comment">/* 2 char per byte + '\0' */</span>
<a name="l00179"></a><a class="code" href="cmd__nfstools_8c.html#a0">00179</a> <span class="preprocessor">#define SIZE_STR_NFSHANDLE2 (2 * NFS2_FHSIZE + 1)</span>
<a name="l00180"></a><a class="code" href="cmd__nfstools_8c.html#a1">00180</a> <span class="preprocessor"></span><span class="preprocessor">#define SIZE_STR_NFSHANDLE3 (2 * NFS3_FHSIZE + 1)</span>
00181 <span class="preprocessor"></span>
00182 <span class="comment">/* unsolved symbol */</span>
<a name="l00183"></a><a class="code" href="cmd__nfstools_8c.html#a58">00183</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8c.html#a58">get_rpc_xid</a>()
00184 {
00185   <span class="keywordflow">return</span> 0;
00186 }
00187 
00188 <span class="comment">/* encoding/decoding function definitions */</span>
00189 
<a name="l00190"></a><a class="code" href="cmd__nfstools_8h.html#a15">00190</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a15">cmdnfs_void</a>(
00191       cmdnfs_encodetype_t encodeflag,
00192       <span class="keywordtype">int</span> argc,   <span class="keywordtype">char</span> ** argv,
00193       <span class="keywordtype">int</span> indent, FILE *      out_stream,
00194       caddr_t   p_nfs_struct
00195     )
00196 {
00197   <span class="keywordflow">if</span> (( encodeflag == CMDNFS_ENCODE ) &amp;&amp; (argc !=0 )) <span class="keywordflow">return</span> FALSE;
00198   
00199   <span class="keywordflow">return</span> TRUE;
00200 }
00201 
00202     
<a name="l00203"></a><a class="code" href="cmd__nfstools_8h.html#a16">00203</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a16">cmdnfs_dirpath</a>(
00204       cmdnfs_encodetype_t encodeflag,
00205       <span class="keywordtype">int</span> argc,   <span class="keywordtype">char</span> ** argv,
00206       <span class="keywordtype">int</span> indent, FILE *  out_stream,
00207       caddr_t   p_nfs_struct
00208     )
00209 {
00210   size_t len;  
00211   dirpath * p_dirpath = (dirpath *)p_nfs_struct;
00212   
00213   <span class="comment">/* sanity check */</span>
00214   <span class="keywordflow">if</span> ( p_dirpath == NULL ) <span class="keywordflow">return</span> FALSE;
00215   
00216   <span class="keywordflow">switch</span> ( encodeflag )
00217   {
00218     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
00219       
00220       <span class="keywordflow">if</span> ( argc != 1 ) <span class="keywordflow">return</span> FALSE;
00221       
00222       len = strlen(argv[0]);
00223       *p_dirpath = Mem_Alloc( len + 1 );
00224       
00225       <span class="keywordflow">if</span> ( *p_dirpath == NULL )
00226       {
00227         fprintf(stderr,<span class="stringliteral">"Not enough memory.\n"</span>);
00228         <span class="keywordflow">return</span> FALSE;
00229       }
00230 
00231       strcpy( *p_dirpath, argv[0] );
00232       
00233       <span class="keywordflow">return</span> TRUE;
00234       
00235       <span class="keywordflow">break</span>;
00236     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
00237             
00238       fprintf(out_stream, <span class="stringliteral">"%*sdirpath = %s\n"</span>,indent, <span class="stringliteral">" "</span>, *p_dirpath);
00239       <span class="keywordflow">return</span> TRUE;
00240       
00241       <span class="keywordflow">break</span>;
00242       
00243     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
00244       
00245       Mem_Free( *p_dirpath );
00246       <span class="keywordflow">break</span>;
00247       
00248     <span class="keywordflow">default</span>:
00249       <span class="keywordflow">return</span> FALSE;
00250   }
00251     
00252 }
00253 
00254 
<a name="l00255"></a><a class="code" href="cmd__nfstools_8h.html#a18">00255</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a18">cmdnfs_fhandle2</a>(
00256       cmdnfs_encodetype_t     encodeflag,
00257       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
00258       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
00259       caddr_t     p_nfs_struct
00260     )
00261 {
00262   fhandle2 * p_fhandle = ( fhandle2 *) p_nfs_struct ;
00263   
00264   <span class="keywordtype">char</span> * str_handle;
00265   <span class="keywordtype">char</span> str_printhandle[ SIZE_STR_NFSHANDLE2 ];
00266   <span class="keywordtype">int</span> rc;
00267   
00268   <span class="comment">/* sanity check */</span>
00269   <span class="keywordflow">if</span> ( p_fhandle == NULL ) <span class="keywordflow">return</span> FALSE;
00270   
00271   <span class="keywordflow">switch</span> ( encodeflag )
00272   {
00273     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
00274       
00275       <span class="keywordflow">if</span> ( argc != 1 )  <span class="keywordflow">return</span> FALSE;
00276       
00277       str_handle = argv[0];
00278       
00279       <span class="comment">/* check that it begins with an @ */</span>
00280       <span class="keywordflow">if</span> ( str_handle[0] != <span class="charliteral">'@'</span> ) <span class="keywordflow">return</span> FALSE;
00281       
00282       <span class="comment">/* escaping the first char @ */</span>
00283       str_handle ++;
00284       
00285       rc = sscanmem( (caddr_t)p_fhandle,NFS2_FHSIZE, str_handle );
00286       
00287       <span class="comment">/* we must have read at least the handle size */</span>
00288       <span class="keywordflow">if</span> ( rc &lt; 2 * (int)<span class="keyword">sizeof</span>( file_handle_v2_t ) )
00289         <span class="keywordflow">return</span> FALSE;
00290       
00291       <span class="keywordflow">return</span> TRUE;
00292       
00293       <span class="keywordflow">break</span>;
00294     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
00295       
00296       <span class="keywordflow">if</span> ( snprintmem( str_printhandle, <a class="code" href="cmd__nfstools_8c.html#a0">SIZE_STR_NFSHANDLE2</a>, (caddr_t)p_fhandle , NFS2_FHSIZE )
00297            &lt; 0 )
00298       {
00299         <span class="keywordflow">return</span> FALSE;
00300       }
00301           
00302       fprintf(out_stream, <span class="stringliteral">"%*sfhandle2 = @%s\n"</span>,indent, <span class="stringliteral">" "</span>, str_printhandle);
00303       
00304       <span class="keywordflow">return</span> TRUE;
00305       
00306       <span class="keywordflow">break</span>;
00307       
00308     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
00309       
00310       <span class="comment">/* nothing to do */</span>
00311       <span class="keywordflow">return</span> TRUE;
00312       
00313       <span class="keywordflow">break</span>;
00314       
00315     <span class="keywordflow">default</span>:
00316       <span class="keywordflow">return</span> FALSE;
00317   }
00318   
00319 }   
00320 
00321 
00322 
<a name="l00323"></a><a class="code" href="cmd__nfstools_8h.html#a17">00323</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a17">cmdnfs_fhstatus2</a>(
00324       cmdnfs_encodetype_t encodeflag,
00325       <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> ** argv,
00326       <span class="keywordtype">int</span> indent, FILE * out_stream,
00327       caddr_t     p_nfs_struct
00328     )
00329 {
00330   fhstatus2 * p_fhstatus = ( fhstatus2 *) p_nfs_struct ;
00331     
00332   <span class="comment">/* sanity check */</span>
00333   <span class="keywordflow">if</span> ( p_fhstatus == NULL ) <span class="keywordflow">return</span> FALSE;
00334   
00335   <span class="keywordflow">switch</span> ( encodeflag )
00336   {
00337     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
00338       
00339       <span class="comment">/* it is never an input */</span>
00340       <span class="keywordflow">return</span> FALSE;
00341       
00342       <span class="keywordflow">break</span>;
00343     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
00344             
00345       fprintf(out_stream, <span class="stringliteral">"%*sfhstatus2 =\n"</span>,indent, <span class="stringliteral">" "</span>);
00346       fprintf(out_stream, <span class="stringliteral">"%*s{\n"</span>,indent, <span class="stringliteral">" "</span>);
00347       
00348       <span class="comment">/* Convert status to error code */</span>
00349       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a27">cmdnfs_nfsstat2</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+2, out_stream,
00350                              (caddr_t)&amp;p_fhstatus-&gt;status  ) == FALSE )
00351       {
00352         <span class="keywordflow">return</span> FALSE;
00353       }
00354 
00355       <span class="keywordflow">if</span> ( p_fhstatus-&gt;status == NFS_OK )
00356       {        
00357         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a18">cmdnfs_fhandle2</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+2, out_stream,
00358                                (caddr_t)&amp;p_fhstatus-&gt;fhstatus2_u.directory  ) == FALSE )
00359         {
00360           <span class="keywordflow">return</span> FALSE;
00361         }
00362       }
00363       fprintf(out_stream, <span class="stringliteral">"%*s}\n"</span>,indent, <span class="stringliteral">" "</span>);
00364       
00365       <span class="keywordflow">return</span> TRUE;
00366       
00367       <span class="keywordflow">break</span>;
00368       
00369     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
00370       
00371       <span class="comment">/* it is never an input (never encoded, never allocated) */</span>
00372       <span class="keywordflow">return</span> FALSE;
00373       
00374       <span class="keywordflow">break</span>;
00375       
00376     <span class="keywordflow">default</span>:
00377       <span class="keywordflow">return</span> FALSE;
00378   }  
00379 }
00380 
00381 
<a name="l00382"></a><a class="code" href="cmd__nfstools_8h.html#a67">00382</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a67">cmdnfs_STATFS2res</a>(
00383       cmdnfs_encodetype_t encodeflag,
00384       <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> ** argv,
00385       <span class="keywordtype">int</span> indent, FILE *      out_stream,
00386       caddr_t     p_nfs_struct
00387     )
00388 {
00389   
00390   STATFS2res * p_statres = ( STATFS2res *) p_nfs_struct ;
00391     
00392   <span class="comment">/* sanity check */</span>
00393   <span class="keywordflow">if</span> ( p_statres == NULL ) <span class="keywordflow">return</span> FALSE;
00394   
00395   <span class="keywordflow">switch</span> ( encodeflag )
00396   {
00397     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
00398       
00399       <span class="comment">/* it is never an input */</span>
00400       <span class="keywordflow">return</span> FALSE;
00401       
00402       <span class="keywordflow">break</span>;
00403     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
00404             
00405       fprintf(out_stream, <span class="stringliteral">"%*sSTATFS2res =\n"</span>,indent, <span class="stringliteral">" "</span>);
00406       fprintf(out_stream, <span class="stringliteral">"%*s{\n"</span>,indent, <span class="stringliteral">" "</span>);
00407       
00408       <span class="comment">/* Convert status to error code */</span>
00409       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a27">cmdnfs_nfsstat2</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+2, out_stream,
00410                              (caddr_t)&amp;p_statres-&gt;status  ) == FALSE )
00411       {
00412         <span class="keywordflow">return</span> FALSE;
00413       }
00414 
00415       <span class="keywordflow">if</span> ( p_statres-&gt;status == NFS_OK )
00416       {
00417         <span class="comment">/* print statinfo2 */</span>
00418         fprintf(out_stream, <span class="stringliteral">"%*sinfo =\n"</span>,indent+2, <span class="stringliteral">" "</span>);
00419         fprintf(out_stream, <span class="stringliteral">"%*s{\n"</span>,indent+2, <span class="stringliteral">" "</span>);
00420         fprintf(out_stream, <span class="stringliteral">"%*stsize  = %u\n"</span>, indent + 4, <span class="stringliteral">" "</span>,p_statres-&gt;STATFS2res_u.info.tsize );
00421         fprintf(out_stream, <span class="stringliteral">"%*sbsize  = %u\n"</span>, indent + 4, <span class="stringliteral">" "</span>,p_statres-&gt;STATFS2res_u.info.bsize );
00422         fprintf(out_stream, <span class="stringliteral">"%*sblocks = %u\n"</span>, indent + 4, <span class="stringliteral">" "</span>,p_statres-&gt;STATFS2res_u.info.blocks);
00423         fprintf(out_stream, <span class="stringliteral">"%*sbfree  = %u\n"</span>, indent + 4, <span class="stringliteral">" "</span>,p_statres-&gt;STATFS2res_u.info.bfree );
00424         fprintf(out_stream, <span class="stringliteral">"%*sbavail = %u\n"</span>, indent + 4, <span class="stringliteral">" "</span>,p_statres-&gt;STATFS2res_u.info.bavail);
00425         fprintf(out_stream, <span class="stringliteral">"%*s}\n"</span>,indent+2, <span class="stringliteral">" "</span>);
00426         
00427       }
00428       fprintf(out_stream, <span class="stringliteral">"%*s}\n"</span>,indent, <span class="stringliteral">" "</span>);
00429       
00430       <span class="keywordflow">return</span> TRUE;
00431       
00432       <span class="keywordflow">break</span>;
00433       
00434     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
00435       
00436       <span class="comment">/* it is never an input (never encoded, never allocated) */</span>
00437       <span class="keywordflow">return</span> FALSE;
00438       
00439       <span class="keywordflow">break</span>;
00440       
00441     <span class="keywordflow">default</span>:
00442       <span class="keywordflow">return</span> FALSE;
00443   }
00444   
00445 }
00446 
00447 
00448 
<a name="l00449"></a><a class="code" href="cmd__nfstools_8h.html#a19">00449</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a19">cmdnfs_mountlist</a>(
00450       cmdnfs_encodetype_t encodeflag,
00451       <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> ** argv,
00452       <span class="keywordtype">int</span> indent, FILE *      out_stream,
00453       caddr_t     p_nfs_struct
00454     )
00455 {
00456   mountlist * p_mountlist = (mountlist *) p_nfs_struct;
00457   
00458   <span class="comment">/* sanity check */</span>
00459   <span class="keywordflow">if</span> ( p_mountlist == NULL ) <span class="keywordflow">return</span> FALSE;
00460   
00461   <span class="comment">/* empty list */</span>
00462   <span class="keywordflow">if</span> ( *p_mountlist == NULL ) <span class="keywordflow">return</span> TRUE;
00463   
00464   <span class="keywordflow">switch</span> ( encodeflag )
00465   {
00466     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
00467       
00468       <span class="comment">/* it is never an input */</span>
00469       <span class="keywordflow">return</span> FALSE;
00470       
00471       <span class="keywordflow">break</span>;
00472     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
00473             
00474       fprintf(out_stream, <span class="stringliteral">"%*s{\n"</span>,indent, <span class="stringliteral">" "</span>);
00475       fprintf(out_stream, <span class="stringliteral">"%*shostname = %s\n"</span>,indent+2, <span class="stringliteral">" "</span>,(*p_mountlist)-&gt;ml_hostname);
00476       fprintf(out_stream, <span class="stringliteral">"%*spathname = %s\n"</span>,indent+2, <span class="stringliteral">" "</span>,(*p_mountlist)-&gt;ml_directory);
00477       fprintf(out_stream, <span class="stringliteral">"%*s}\n"</span>,indent, <span class="stringliteral">" "</span>);
00478       
00479       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a19">cmdnfs_mountlist</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent, out_stream,
00480              (caddr_t)&amp;((*p_mountlist)-&gt;ml_next) ) == FALSE )
00481       {
00482         <span class="keywordflow">return</span> FALSE;
00483       }
00484       
00485       <span class="keywordflow">return</span> TRUE;
00486       
00487       <span class="keywordflow">break</span>;
00488       
00489     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
00490       
00491       <span class="comment">/* it is never an input (never encoded, never allocated) */</span>
00492       <span class="keywordflow">return</span> FALSE;
00493       
00494       <span class="keywordflow">break</span>;
00495       
00496     <span class="keywordflow">default</span>:
00497       <span class="keywordflow">return</span> FALSE;
00498   }
00499   
00500 }
00501 
00502 
<a name="l00503"></a><a class="code" href="cmd__nfstools_8h.html#a20">00503</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a20">cmdnfs_exports</a>(
00504       cmdnfs_encodetype_t     encodeflag,
00505       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
00506       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
00507       caddr_t     p_nfs_struct
00508     )
00509 {
00510   exports * p_exports = (exports *) p_nfs_struct;
00511   
00512   groups  group_list;
00513       
00514   <span class="comment">/* sanity check */</span>
00515   <span class="keywordflow">if</span> ( p_exports == NULL ) <span class="keywordflow">return</span> FALSE;
00516   
00517   <span class="comment">/* empty list */</span>
00518   <span class="keywordflow">if</span> ( *p_exports == NULL ) <span class="keywordflow">return</span> TRUE;
00519   
00520   <span class="keywordflow">switch</span> ( encodeflag )
00521   {
00522     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
00523       
00524       <span class="comment">/* it is never an input */</span>
00525       <span class="keywordflow">return</span> FALSE;
00526       
00527       <span class="keywordflow">break</span>;
00528     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
00529             
00530       fprintf(out_stream, <span class="stringliteral">"%*s{\n"</span>,indent, <span class="stringliteral">" "</span>);
00531       fprintf(out_stream, <span class="stringliteral">"%*sex_dir = %s\n"</span>,indent+2, <span class="stringliteral">" "</span>,(*p_exports)-&gt;ex_dir );
00532       fprintf(out_stream, <span class="stringliteral">"%*sex_groups =\n"</span>,indent+2, <span class="stringliteral">" "</span>);
00533       
00534       group_list = (*p_exports)-&gt;ex_groups;
00535       <span class="keywordflow">while</span> ( group_list )
00536       {
00537         fprintf(out_stream, <span class="stringliteral">"%*sgr_name = %s\n"</span>,indent+4, <span class="stringliteral">" "</span>, group_list-&gt;gr_name);
00538         group_list = group_list-&gt;gr_next;
00539       }
00540       
00541       fprintf(out_stream, <span class="stringliteral">"%*s}\n"</span>,indent, <span class="stringliteral">" "</span>);
00542       
00543       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a20">cmdnfs_exports</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent, out_stream,
00544              (caddr_t)&amp;((*p_exports)-&gt;ex_next) ) == FALSE )
00545       {
00546         <span class="keywordflow">return</span> FALSE;
00547       }
00548       
00549       <span class="keywordflow">return</span> TRUE;
00550       
00551       <span class="keywordflow">break</span>;
00552       
00553     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
00554       
00555       <span class="comment">/* it is never an input (never encoded, never allocated) */</span>
00556       <span class="keywordflow">return</span> FALSE;
00557       
00558       <span class="keywordflow">break</span>;
00559       
00560     <span class="keywordflow">default</span>:
00561       <span class="keywordflow">return</span> FALSE;
00562   }
00563   
00564 }
00565 
00566 
<a name="l00567"></a><a class="code" href="cmd__nfstools_8h.html#a22">00567</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a22">cmdnfs_fhandle3</a>(
00568       cmdnfs_encodetype_t     encodeflag,
00569       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
00570       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
00571       caddr_t     p_nfs_struct
00572     )
00573 {
00574   fhandle3 * p_fhandle = ( fhandle3 *) p_nfs_struct ;
00575   
00576   <span class="keywordtype">char</span> * str_handle;
00577   <span class="keywordtype">char</span> str_printhandle[ SIZE_STR_NFSHANDLE3 ];
00578   <span class="keywordtype">int</span> rc;
00579   
00580   <span class="comment">/* sanity check */</span>
00581   <span class="keywordflow">if</span> ( p_fhandle == NULL ) <span class="keywordflow">return</span> FALSE;
00582   
00583   <span class="keywordflow">switch</span> ( encodeflag )
00584   {
00585     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
00586       
00587       <span class="keywordflow">if</span> ( argc != 1 )  <span class="keywordflow">return</span> FALSE;
00588       
00589       str_handle = argv[0];
00590       
00591       <span class="comment">/* check that it begins with an @ */</span>
00592       <span class="keywordflow">if</span> ( str_handle[0] != <span class="charliteral">'@'</span> ) <span class="keywordflow">return</span> FALSE;
00593       
00594       <span class="comment">/* escaping the first char @ */</span>
00595       str_handle ++;
00596       
00597       <span class="comment">/* Allocation of the nfs3 handle */</span>
00598       p_fhandle-&gt;fhandle3_val = Mem_Alloc( NFS3_FHSIZE );
00599       
00600       <span class="keywordflow">if</span> ( p_fhandle-&gt;fhandle3_val == NULL )
00601       {
00602         fprintf(stderr,<span class="stringliteral">"Not enough memory.\n"</span>);
00603         <span class="keywordflow">return</span> FALSE;
00604       }
00605       
00606       p_fhandle-&gt;fhandle3_len = (<span class="keywordtype">unsigned</span> int)<span class="keyword">sizeof</span>( file_handle_v3_t );
00607       
00608       rc = sscanmem( (caddr_t)(p_fhandle-&gt;fhandle3_val),(<span class="keywordtype">int</span>)<span class="keyword">sizeof</span>( file_handle_v3_t ), str_handle );
00609       
00610       <span class="keywordflow">if</span> ( rc &lt; 2 * (int)<span class="keyword">sizeof</span>( file_handle_v3_t ) )
00611         <span class="keywordflow">return</span> FALSE;
00612       
00613       <span class="keywordflow">return</span> TRUE;
00614       
00615       <span class="keywordflow">break</span>;
00616     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
00617       
00618       <span class="keywordflow">if</span> ( snprintmem( str_printhandle, <a class="code" href="cmd__nfstools_8c.html#a1">SIZE_STR_NFSHANDLE3</a>, (caddr_t)(p_fhandle-&gt;fhandle3_val) , p_fhandle-&gt;fhandle3_len )
00619            &lt; 0 )
00620       {
00621         <span class="keywordflow">return</span> FALSE;
00622       }
00623           
00624       fprintf(out_stream, <span class="stringliteral">"%*sfhandle3 = @%s\n"</span>,indent, <span class="stringliteral">" "</span>, str_printhandle);
00625       
00626       <span class="keywordflow">return</span> TRUE;
00627       
00628       <span class="keywordflow">break</span>;
00629       
00630     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
00631       
00632       Mem_Free( p_fhandle-&gt;fhandle3_val );      
00633       <span class="keywordflow">return</span> TRUE;
00634       
00635       <span class="keywordflow">break</span>;
00636       
00637     <span class="keywordflow">default</span>:
00638       <span class="keywordflow">return</span> FALSE;
00639   }
00640   
00641 }   
00642 
<a name="l00643"></a><a class="code" href="cmd__nfstools_8c.html#a2">00643</a> <span class="preprocessor">#define MNT_HANDLE( p_mount_res3 ) ( (p_mount_res3)-&gt;mountres3_u.mountinfo.fhandle )</span>
<a name="l00644"></a><a class="code" href="cmd__nfstools_8c.html#a3">00644</a> <span class="preprocessor"></span><span class="preprocessor">#define AUTH_FLAVORS( p_mount_res3 ) ( (p_mount_res3)-&gt;mountres3_u.mountinfo.auth_flavors )</span>
00645 <span class="preprocessor"></span>
<a name="l00646"></a><a class="code" href="cmd__nfstools_8h.html#a21">00646</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a21">cmdnfs_mountres3</a>(
00647       cmdnfs_encodetype_t     encodeflag,
00648       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
00649       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
00650       caddr_t     p_nfs_struct
00651     )
00652 {
00653   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;
00654   mountres3 * p_mountres = ( mountres3 *) p_nfs_struct ;
00655   
00656     
00657   <span class="comment">/* sanity check */</span>
00658   <span class="keywordflow">if</span> ( p_mountres == NULL ) <span class="keywordflow">return</span> FALSE;
00659   
00660   <span class="keywordflow">switch</span> ( encodeflag )
00661   {
00662     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
00663             
00664       fprintf(out_stream, <span class="stringliteral">"%*smountres3 =\n"</span>,indent, <span class="stringliteral">" "</span>);
00665       fprintf(out_stream, <span class="stringliteral">"%*s{\n"</span>,indent, <span class="stringliteral">" "</span>);
00666       
00668       fprintf(out_stream, <span class="stringliteral">"%*sfhs_status = %u\n"</span>,indent+2, <span class="stringliteral">" "</span>,p_mountres-&gt;fhs_status);
00669 
00670       <span class="keywordflow">if</span> ( p_mountres-&gt;fhs_status == MNT3_OK )
00671       {
00672         fprintf(out_stream, <span class="stringliteral">"%*smountinfo =\n"</span>,indent+2, <span class="stringliteral">" "</span> );
00673         fprintf(out_stream, <span class="stringliteral">"%*s{\n"</span>,indent+2, <span class="stringliteral">" "</span>);
00674         
00675         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a22">cmdnfs_fhandle3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+4, out_stream,
00676                                (caddr_t) &amp; <a class="code" href="cmd__nfstools_8c.html#a2">MNT_HANDLE</a>(p_mountres) ) == FALSE )
00677         {
00678           <span class="keywordflow">return</span> FALSE;
00679         }
00680         
00681         <span class="keywordflow">for</span> ( i = 0 ; i&lt; <a class="code" href="cmd__nfstools_8c.html#a3">AUTH_FLAVORS</a>( p_mountres ).auth_flavors_len ; i++ )
00682         {
00683           fprintf(out_stream, <span class="stringliteral">"%*sauth_flavor = %d\n"</span>,indent+4, <span class="stringliteral">" "</span>, 
00684                 <a class="code" href="cmd__nfstools_8c.html#a3">AUTH_FLAVORS</a>( p_mountres ).auth_flavors_val[i] );
00685         }
00686         
00687         fprintf(out_stream, <span class="stringliteral">"%*s}\n"</span>,indent+2, <span class="stringliteral">" "</span>);
00688       }
00689       
00690       fprintf(out_stream, <span class="stringliteral">"%*s}\n"</span>,indent, <span class="stringliteral">" "</span>);
00691       
00692       <span class="keywordflow">return</span> TRUE;
00693       
00694       <span class="keywordflow">break</span>;
00695       
00696     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
00697       <span class="comment">/* never an input */</span>
00698     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:      
00699       <span class="comment">/* it is never an input (never encoded, never allocated) */</span>
00700     <span class="keywordflow">default</span>:
00701       <span class="keywordflow">return</span> FALSE;
00702   }
00703 
00704 }
00705 
00706 <span class="comment">/* undefine dirty macros... */</span>
00707 <span class="preprocessor">#undef MNT_HANDLE</span>
00708 <span class="preprocessor"></span><span class="preprocessor">#undef AUTH_FLAVORS</span>
00709 <span class="preprocessor"></span>
00710 
<a name="l00711"></a><a class="code" href="cmd__nfstools_8h.html#a27">00711</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a27">cmdnfs_nfsstat2</a>(
00712       cmdnfs_encodetype_t     encodeflag,
00713       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
00714       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
00715       caddr_t     p_nfs_struct
00716     )
00717 {
00718   
00719   <span class="keywordtype">int</span> i;
00720   nfsstat2 * p_stat2 = ( nfsstat2 *) p_nfs_struct ;
00721   
00722     
00723   <span class="comment">/* sanity check */</span>
00724   <span class="keywordflow">if</span> ( p_stat2 == NULL ) <span class="keywordflow">return</span> FALSE;
00725   
00726   <span class="keywordflow">switch</span> ( encodeflag )
00727   {
00728     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
00729        
00730       fprintf(out_stream, <span class="stringliteral">"%*sstatus = %d (%s)\n"</span>,indent, <span class="stringliteral">" "</span>, (<span class="keywordtype">int</span>)(*p_stat2), nfsstat2_to_str(*p_stat2) );
00731       <span class="keywordflow">return</span> TRUE;
00732       
00733       <span class="keywordflow">break</span>;
00734       
00735     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
00736     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
00737       <span class="comment">/* never encoded */</span>
00738     <span class="keywordflow">default</span>:
00739       <span class="keywordflow">return</span> FALSE;
00740   }
00741 
00742 }
00743 
00744 
00745 
<a name="l00746"></a><a class="code" href="cmd__nfstools_8h.html#a23">00746</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a23">cmdnfs_fattr2</a>(
00747       cmdnfs_encodetype_t     encodeflag,
00748       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
00749       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
00750       caddr_t     p_nfs_struct
00751     )
00752 {
00753   
00754   <span class="keywordtype">int</span> i;
00755   fattr2 * p_fattr = ( fattr2 *) p_nfs_struct ;
00756   <span class="keywordtype">char</span> tmp_buff[256]=<span class="stringliteral">""</span>;
00757   
00758   <span class="keyword">struct </span>tm paramtm;
00759     
00760   <span class="comment">/* sanity check */</span>
00761   <span class="keywordflow">if</span> ( p_fattr == NULL ) <span class="keywordflow">return</span> FALSE;
00762   
00763   <span class="keywordflow">switch</span> ( encodeflag )
00764   {
00765     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
00766       
00768       <span class="keywordflow">return</span> FALSE;
00769       
00770       <span class="keywordflow">break</span>;
00771     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
00772             
00773       fprintf(out_stream, <span class="stringliteral">"%*sfattr2 =\n"</span>,indent, <span class="stringliteral">" "</span>);
00774       fprintf(out_stream, <span class="stringliteral">"%*s{\n"</span>,indent, <span class="stringliteral">" "</span>);
00775       
00776       fprintf(out_stream, <span class="stringliteral">"%*stype = %d (%s)\n"</span>,indent+2, <span class="stringliteral">" "</span>,(<span class="keywordtype">int</span>)p_fattr-&gt;type, nfstype2_to_str(p_fattr-&gt;type));
00777       fprintf(out_stream, <span class="stringliteral">"%*smode = 0%o\n"</span>,indent+2, <span class="stringliteral">" "</span>,p_fattr-&gt;mode);
00778       fprintf(out_stream, <span class="stringliteral">"%*snlink = %u\n"</span>,indent+2, <span class="stringliteral">" "</span>,p_fattr-&gt;nlink);
00779       fprintf(out_stream, <span class="stringliteral">"%*suid = %u\n"</span>,indent+2, <span class="stringliteral">" "</span>,p_fattr-&gt;uid);
00780       fprintf(out_stream, <span class="stringliteral">"%*sgid = %u\n"</span>,indent+2, <span class="stringliteral">" "</span>,p_fattr-&gt;gid);
00781       fprintf(out_stream, <span class="stringliteral">"%*ssize = %u\n"</span>,indent+2, <span class="stringliteral">" "</span>,p_fattr-&gt;size);
00782       fprintf(out_stream, <span class="stringliteral">"%*sblocksize = %u\n"</span>,indent+2, <span class="stringliteral">" "</span>,p_fattr-&gt;blocksize);
00783       fprintf(out_stream, <span class="stringliteral">"%*srdev = %hu.%hu\n"</span>,indent+2, <span class="stringliteral">" "</span>,(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)(p_fattr-&gt;rdev&gt;&gt;16),(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)p_fattr-&gt;rdev);
00784       fprintf(out_stream, <span class="stringliteral">"%*sblocks = %u\n"</span>,indent+2, <span class="stringliteral">" "</span>,p_fattr-&gt;blocks);
00785       fprintf(out_stream, <span class="stringliteral">"%*sfsid = %#x\n"</span>,indent+2, <span class="stringliteral">" "</span>,p_fattr-&gt;fsid );
00786       fprintf(out_stream, <span class="stringliteral">"%*sfileid = %#x\n"</span>,indent+2, <span class="stringliteral">" "</span>,p_fattr-&gt;fileid );
00787           
00788       strftime(tmp_buff,256,<span class="stringliteral">"%Y-%m-%d %T"</span>,<a class="code" href="cmd__tools_8h.html#a9">Localtime_r</a>((time_t*)&amp;p_fattr-&gt;atime.seconds, &amp;paramtm));
00789       fprintf(out_stream, <span class="stringliteral">"%*satime = %u.%.6u (%s)\n"</span>,indent+2, <span class="stringliteral">" "</span>,
00790           p_fattr-&gt;atime.seconds,p_fattr-&gt;atime.useconds,tmp_buff);
00791 
00792       strftime(tmp_buff,256,<span class="stringliteral">"%Y-%m-%d %T"</span>,<a class="code" href="cmd__tools_8h.html#a9">Localtime_r</a>((time_t*)&amp;p_fattr-&gt;mtime.seconds, &amp;paramtm));
00793       fprintf(out_stream, <span class="stringliteral">"%*smtime = %u.%.6u (%s)\n"</span>,indent+2, <span class="stringliteral">" "</span>,
00794           p_fattr-&gt;mtime.seconds,p_fattr-&gt;mtime.useconds,tmp_buff);
00795       
00796       strftime(tmp_buff,256,<span class="stringliteral">"%Y-%m-%d %T"</span>,<a class="code" href="cmd__tools_8h.html#a9">Localtime_r</a>((time_t*)&amp;p_fattr-&gt;ctime.seconds, &amp;paramtm));
00797       fprintf(out_stream, <span class="stringliteral">"%*sctime = %u.%.6u (%s)\n"</span>,indent+2, <span class="stringliteral">" "</span>,
00798           p_fattr-&gt;ctime.seconds,p_fattr-&gt;ctime.useconds,tmp_buff);
00799       
00800       fprintf(out_stream, <span class="stringliteral">"%*s}\n"</span>,indent, <span class="stringliteral">" "</span>);
00801       
00802       <span class="keywordflow">return</span> TRUE;
00803       
00804       <span class="keywordflow">break</span>;
00805       
00806     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
00807       
00809       <span class="keywordflow">return</span> FALSE;
00810       
00811       <span class="keywordflow">break</span>;
00812       
00813     <span class="keywordflow">default</span>:
00814       <span class="keywordflow">return</span> FALSE;
00815   }
00816 
00817 }
00818 
<a name="l00819"></a><a class="code" href="cmd__nfstools_8c.html#a4">00819</a> <span class="preprocessor">#define ATTR2_ATTRIBUTES( _p_attr2res ) ( (_p_attr2res)-&gt;ATTR2res_u.attributes )</span>
00820 <span class="preprocessor"></span>
<a name="l00821"></a><a class="code" href="cmd__nfstools_8h.html#a24">00821</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a24">cmdnfs_ATTR2res</a>(
00822       cmdnfs_encodetype_t     encodeflag,
00823       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
00824       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
00825       caddr_t     p_nfs_struct
00826     )
00827 {
00828   ATTR2res * p_attr2res = ( ATTR2res *) p_nfs_struct ;
00829       
00830   <span class="comment">/* sanity check */</span>
00831   <span class="keywordflow">if</span> ( p_attr2res == NULL ) <span class="keywordflow">return</span> FALSE;
00832   
00833   <span class="keywordflow">switch</span> ( encodeflag )
00834   {
00835     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
00836             
00837       fprintf(out_stream, <span class="stringliteral">"%*sATTR2res =\n"</span>,indent, <span class="stringliteral">" "</span>);
00838       fprintf(out_stream, <span class="stringliteral">"%*s{\n"</span>,indent, <span class="stringliteral">" "</span>);
00839       
00840       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a27">cmdnfs_nfsstat2</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+2, out_stream,
00841                             (caddr_t) &amp;p_attr2res-&gt;status ) == FALSE )
00842       {
00843         <span class="keywordflow">return</span> FALSE;
00844       }
00845 
00846       <span class="keywordflow">if</span> ( p_attr2res-&gt;status == NFS_OK )
00847       {
00848         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a23">cmdnfs_fattr2</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+2, out_stream,
00849                                (caddr_t) &amp; <a class="code" href="cmd__nfstools_8c.html#a4">ATTR2_ATTRIBUTES</a>(p_attr2res) ) == FALSE )
00850         {
00851           <span class="keywordflow">return</span> FALSE;
00852         }
00853         
00854       }
00855       
00856       fprintf(out_stream, <span class="stringliteral">"%*s}\n"</span>,indent, <span class="stringliteral">" "</span>);
00857       
00858       <span class="keywordflow">return</span> TRUE;
00859       
00860       <span class="keywordflow">break</span>;
00861       
00862     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
00863       <span class="comment">/* never encoded */</span>
00864     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
00865       <span class="comment">/* it is never an input (never encoded, never allocated) */</span>
00866     <span class="keywordflow">default</span>:
00867       <span class="keywordflow">return</span> FALSE;
00868   }
00869   
00870 }
00871 
00872 <span class="preprocessor">#undef ATTR2_ATTRIBUTES</span>
00873 <span class="preprocessor"></span>
00874 
<a name="l00875"></a><a class="code" href="cmd__nfstools_8c.html#a5">00875</a> <span class="preprocessor">#define DIROP2_HANDLE( _p_dirop ) ( (_p_dirop)-&gt;DIROP2res_u.diropok.file )</span>
<a name="l00876"></a><a class="code" href="cmd__nfstools_8c.html#a6">00876</a> <span class="preprocessor"></span><span class="preprocessor">#define DIROP2_ATTRIBUTES( _p_dirop ) ( (_p_dirop)-&gt;DIROP2res_u.diropok.attributes )</span>
00877 <span class="preprocessor"></span>
00878 
<a name="l00879"></a><a class="code" href="cmd__nfstools_8h.html#a25">00879</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a25">cmdnfs_DIROP2res</a>(
00880       cmdnfs_encodetype_t     encodeflag,
00881       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
00882       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
00883       caddr_t     p_nfs_struct
00884     )
00885 {
00886   DIROP2res * p_dirop2res = (  DIROP2res *) p_nfs_struct ;
00887       
00888   <span class="comment">/* sanity check */</span>
00889   <span class="keywordflow">if</span> ( p_dirop2res == NULL ) <span class="keywordflow">return</span> FALSE;
00890   
00891   <span class="keywordflow">switch</span> ( encodeflag )
00892   {
00893     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
00894             
00895       fprintf(out_stream, <span class="stringliteral">"%*sDIROP2res =\n"</span>,indent, <span class="stringliteral">" "</span>);
00896       fprintf(out_stream, <span class="stringliteral">"%*s{\n"</span>,indent, <span class="stringliteral">" "</span>);
00897       
00898       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a27">cmdnfs_nfsstat2</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+2, out_stream,
00899                             (caddr_t) &amp;p_dirop2res-&gt;status ) == FALSE )
00900       {
00901         <span class="keywordflow">return</span> FALSE;
00902       }
00903 
00904       <span class="keywordflow">if</span> ( p_dirop2res-&gt;status == NFS_OK )
00905       {
00906         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a18">cmdnfs_fhandle2</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+2, out_stream,
00907                                (caddr_t) &amp; <a class="code" href="cmd__nfstools_8c.html#a5">DIROP2_HANDLE</a>(p_dirop2res) ) == FALSE )
00908         {
00909           <span class="keywordflow">return</span> FALSE;
00910         }
00911         
00912         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a23">cmdnfs_fattr2</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+2, out_stream,
00913                                (caddr_t) &amp; <a class="code" href="cmd__nfstools_8c.html#a6">DIROP2_ATTRIBUTES</a>(p_dirop2res) ) == FALSE )
00914         {
00915           <span class="keywordflow">return</span> FALSE;
00916         }
00917       }
00918       
00919       fprintf(out_stream, <span class="stringliteral">"%*s}\n"</span>,indent, <span class="stringliteral">" "</span>);
00920       
00921       <span class="keywordflow">return</span> TRUE;
00922       
00923       <span class="keywordflow">break</span>;
00924       
00925     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
00926       <span class="comment">/* never encoded */</span>
00927     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
00928       <span class="comment">/* it is never an input (never encoded, never allocated) */</span>
00929     <span class="keywordflow">default</span>:
00930       <span class="keywordflow">return</span> FALSE;
00931   }
00932   
00933 }
00934 <span class="preprocessor">#undef DIROP2_HANDLE</span>
00935 <span class="preprocessor"></span><span class="preprocessor">#undef DIROP2_ATTRIBUTES</span>
00936 <span class="preprocessor"></span>
00937 
<a name="l00938"></a><a class="code" href="cmd__nfstools_8h.html#a26">00938</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a26">cmdnfs_diropargs2</a>(
00939       cmdnfs_encodetype_t     encodeflag,
00940       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
00941       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
00942       caddr_t     p_nfs_struct
00943     )
00944 {
00945   diropargs2 * p_diropargs = (  diropargs2 *) p_nfs_struct ;
00946 
00947   <span class="comment">/* sanity check */</span>
00948   <span class="keywordflow">if</span> ( p_diropargs == NULL ) <span class="keywordflow">return</span> FALSE;
00949   
00950   <span class="keywordflow">switch</span> ( encodeflag )
00951   {
00952     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
00953       
00954       <span class="keywordflow">if</span> ( argc != 2 ) <span class="keywordflow">return</span> FALSE;
00955       
00956       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a18">cmdnfs_fhandle2</a>( <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>, 1, argv , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
00957                             (caddr_t) &amp;(p_diropargs-&gt;dir) ) == FALSE )
00958       {
00959         <span class="keywordflow">return</span> FALSE;
00960       }
00961       
00962       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a16">cmdnfs_dirpath</a>( <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>, 1, argv+1 , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
00963                            (caddr_t) &amp;(p_diropargs-&gt;name) ) == FALSE )
00964       {
00965         <span class="keywordflow">return</span> FALSE;
00966       }
00967       
00968       <span class="keywordflow">return</span> TRUE;
00969       
00970     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
00971       <a class="code" href="cmd__nfstools_8h.html#a18">cmdnfs_fhandle2</a>( <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a> , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
00972                             (caddr_t) &amp;(p_diropargs-&gt;dir) );
00973       <a class="code" href="cmd__nfstools_8h.html#a16">cmdnfs_dirpath</a>( <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a> , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
00974                            (caddr_t) &amp;(p_diropargs-&gt;name) );            
00975       <span class="keywordflow">break</span>;
00976       
00977     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
00978       <span class="comment">/* never decoded */</span>
00979     <span class="keywordflow">default</span>:
00980       <span class="keywordflow">return</span> FALSE;
00981   }
00982   
00983 
00984 }
00985 
<a name="l00986"></a><a class="code" href="cmd__nfstools_8c.html#a7">00986</a> <span class="preprocessor">#define READLINKRES_PATH( _p_rl2res ) ( (_p_rl2res)-&gt;READLINK2res_u.data )</span>
00987 <span class="preprocessor"></span>
<a name="l00988"></a><a class="code" href="cmd__nfstools_8h.html#a28">00988</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a28">cmdnfs_READLINK2res</a>(
00989       cmdnfs_encodetype_t     encodeflag,
00990       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
00991       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
00992       caddr_t     p_nfs_struct
00993     )
00994 {
00995   
00996   READLINK2res * p_rl2res = (  READLINK2res *) p_nfs_struct ;
00997       
00998   <span class="comment">/* sanity check */</span>
00999   <span class="keywordflow">if</span> ( p_rl2res == NULL ) <span class="keywordflow">return</span> FALSE;
01000   
01001   <span class="keywordflow">switch</span> ( encodeflag )
01002   {
01003     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
01004             
01005       fprintf(out_stream, <span class="stringliteral">"%*sREADLINK2res =\n"</span>,indent, <span class="stringliteral">" "</span>);
01006       fprintf(out_stream, <span class="stringliteral">"%*s{\n"</span>,indent, <span class="stringliteral">" "</span>);
01007       
01008       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a27">cmdnfs_nfsstat2</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+2, out_stream,
01009                             (caddr_t) &amp;p_rl2res-&gt;status ) == FALSE )
01010       {
01011         <span class="keywordflow">return</span> FALSE;
01012       }
01013 
01014       <span class="keywordflow">if</span> ( p_rl2res-&gt;status == NFS_OK )
01015       {        
01016         fprintf( out_stream, <span class="stringliteral">"%*sdata = \"%s\"\n"</span>,indent+2, <span class="stringliteral">" "</span>, <a class="code" href="cmd__nfstools_8c.html#a7">READLINKRES_PATH</a>( p_rl2res ) );
01017       }
01018       
01019       fprintf(out_stream, <span class="stringliteral">"%*s}\n"</span>,indent, <span class="stringliteral">" "</span>);
01020       
01021       <span class="keywordflow">return</span> TRUE;
01022       
01023       <span class="keywordflow">break</span>;
01024       
01025     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
01026       <span class="comment">/* never encoded */</span>
01027     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
01028       <span class="comment">/* it is never an input (never encoded, never allocated) */</span>
01029     <span class="keywordflow">default</span>:
01030       <span class="keywordflow">return</span> FALSE;
01031   }
01032   
01033 }
01034 
01035 <span class="preprocessor">#undef READLINKRES_PATH</span>
01036 <span class="preprocessor"></span>
<a name="l01037"></a><a class="code" href="cmd__nfstools_8h.html#a29">01037</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a29">cmdnfs_sattr2</a>(
01038       cmdnfs_encodetype_t     encodeflag,
01039       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
01040       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
01041       caddr_t     p_nfs_struct
01042     )
01043 {
01044  
01045   sattr2 * p_sattr2 = (  sattr2 *) p_nfs_struct ;
01046 
01047   <span class="keywordtype">char</span> * next_str = NULL;
01048   <span class="keywordtype">char</span> * attrib_str;
01049   <span class="keywordtype">char</span> * value_str;
01050 
01051     <span class="keywordtype">int</span> mode, userid, groupid, rc;
01052   time_t  a_sec,m_sec;
01053   <span class="keywordtype">int</span>     a_usec, m_usec;
01054   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> size;
01055   <span class="keywordtype">char</span> * usec_str;
01056   <span class="keywordtype">char</span> * time_str;
01057       
01058       
01059   <span class="comment">/* sanity check */</span>
01060   <span class="keywordflow">if</span> ( p_sattr2 == NULL ) <span class="keywordflow">return</span> FALSE;
01061   
01062   <span class="keywordflow">switch</span> ( encodeflag )
01063   {
01064     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
01065       
01066 
01067       <span class="comment">/* inits structure */</span>
01068       
01069       p_sattr2-&gt;mode = (<span class="keywordtype">unsigned</span> int)-1;
01070       p_sattr2-&gt;uid= (<span class="keywordtype">unsigned</span> int)-1;
01071           p_sattr2-&gt;gid= (<span class="keywordtype">unsigned</span> int)-1;
01072           p_sattr2-&gt;size= (<span class="keywordtype">unsigned</span> int)-1;
01073           p_sattr2-&gt;atime.seconds= (<span class="keywordtype">unsigned</span> int)-1;
01074           p_sattr2-&gt;atime.useconds= (<span class="keywordtype">unsigned</span> int)-1;
01075           p_sattr2-&gt;mtime.seconds= (<span class="keywordtype">unsigned</span> int)-1;
01076           p_sattr2-&gt;mtime.useconds= (<span class="keywordtype">unsigned</span> int)-1;
01077             
01078       <span class="keywordflow">if</span> ( argc == 0 ) <span class="keywordflow">return</span> TRUE;
01079       
01080       <span class="comment">/* at this point it must not be more than one string */</span>
01081       <span class="keywordflow">if</span> (argc != 1) <span class="keywordflow">return</span> FALSE;
01082       
01083       <span class="comment">/* the attributes are:</span>
01084 <span class="comment">       * mode, uid, gid, size, atime, mtime</span>
01085 <span class="comment">       */</span>
01086             
01087       attrib_str = strtok_r(argv[0],<span class="stringliteral">","</span>,&amp;next_str);
01088       
01089       <span class="keywordflow">if</span> ( attrib_str == NULL )
01090       {
01091 <span class="preprocessor">#ifdef _DEBUG_NFS_SHELL</span>
01092 <span class="preprocessor"></span>        printf( <span class="stringliteral">"Unexpected parsing error.\n"</span>);
01093 <span class="preprocessor">#endif</span>
01094 <span class="preprocessor"></span>        <span class="keywordflow">return</span> FALSE;
01095       }
01096       
01097       <span class="keywordflow">while</span> ( attrib_str != NULL )
01098       {
01099         
01100         <span class="comment">/* retrieving attribute name and value */</span>
01101         attrib_str = strtok_r( attrib_str,<span class="stringliteral">"="</span>,&amp;value_str );
01102         
01103         <span class="keywordflow">if</span> ( (attrib_str == NULL) || (value_str == NULL) )
01104         {
01105 <span class="preprocessor">  #ifdef _DEBUG_NFS_SHELL</span>
01106 <span class="preprocessor"></span>          printf( <span class="stringliteral">"Syntax error for sattr2.\nExpected syntax: &lt;attr&gt;=&lt;value&gt;,&lt;attr&gt;=&lt;value&gt;,...\n"</span>);
01107 <span class="preprocessor">  #endif</span>
01108 <span class="preprocessor"></span>          <span class="keywordflow">return</span> FALSE;
01109         }
01110 
01111 <span class="preprocessor">#ifdef _DEBUG_NFS_SHELL</span>
01112 <span class="preprocessor"></span>        printf( <span class="stringliteral">"Attribute: \"%s\", Value: \"%s\"\n"</span>,attrib_str,value_str);
01113 <span class="preprocessor">#endif</span>
01114 <span class="preprocessor"></span>        
01115         <span class="keywordflow">if</span> (!strcmp( attrib_str, <span class="stringliteral">"mode"</span> ))
01116         {
01117           mode = <a class="code" href="cmd__tools_8h.html#a11">atomode</a>( value_str );
01118           <span class="keywordflow">if</span> (mode &lt; 0) <span class="keywordflow">return</span> FALSE;
01119           p_sattr2-&gt;mode = (<span class="keywordtype">unsigned</span> int) mode;
01120 <span class="preprocessor">#ifdef _DEBUG_NFS_SHELL      </span>
01121 <span class="preprocessor"></span>          printf (<span class="stringliteral">"  mode = 0%o\n"</span>,p_sattr2-&gt;mode );
01122 <span class="preprocessor">#endif</span>
01123 <span class="preprocessor"></span>        }
01124         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp( attrib_str, <span class="stringliteral">"uid"</span> ))
01125         {
01126           userid = <a class="code" href="cmd__tools_8h.html#a10">my_atoi</a>( value_str );
01127           <span class="keywordflow">if</span> (userid &lt; 0) <span class="keywordflow">return</span> FALSE; 
01128           p_sattr2-&gt;uid = (<span class="keywordtype">unsigned</span> int) userid;
01129 <span class="preprocessor">#ifdef _DEBUG_NFS_SHELL      </span>
01130 <span class="preprocessor"></span>          printf (<span class="stringliteral">"  uid = %u\n"</span>,p_sattr2-&gt;uid );
01131 <span class="preprocessor">#endif</span>
01132 <span class="preprocessor"></span>        }
01133         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp( attrib_str, <span class="stringliteral">"gid"</span> ))
01134         {
01135           groupid = <a class="code" href="cmd__tools_8h.html#a10">my_atoi</a>( value_str );
01136           <span class="keywordflow">if</span> (groupid &lt; 0) <span class="keywordflow">return</span> FALSE;
01137           p_sattr2-&gt;gid = (<span class="keywordtype">unsigned</span> int) groupid;
01138 <span class="preprocessor">#ifdef _DEBUG_NFS_SHELL      </span>
01139 <span class="preprocessor"></span>          printf (<span class="stringliteral">"  gid = %u\n"</span>,p_sattr2-&gt;gid );
01140 <span class="preprocessor">#endif</span>
01141 <span class="preprocessor"></span>        }
01142         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp( attrib_str, <span class="stringliteral">"size"</span> ))
01143         {
01144           rc = <a class="code" href="cmd__tools_8h.html#a12">ato64</a>( value_str, &amp;size );
01145           <span class="keywordflow">if</span> ( rc ) <span class="keywordflow">return</span> FALSE;
01146           <span class="keywordflow">if</span> ( size &gt; ( <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> long ) UINT_MAX ) <span class="keywordflow">return</span> FALSE;
01147           p_sattr2-&gt;size = (<span class="keywordtype">unsigned</span> int) size;
01148 <span class="preprocessor">#ifdef _DEBUG_NFS_SHELL</span>
01149 <span class="preprocessor"></span>          printf (<span class="stringliteral">"  size = %u\n"</span>,p_sattr2-&gt;size );
01150 <span class="preprocessor">#endif</span>
01151 <span class="preprocessor"></span>        }
01152         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp( attrib_str, <span class="stringliteral">"atime"</span> ))
01153         {
01154           time_str = strtok_r(value_str,<span class="stringliteral">"."</span>,&amp;usec_str);
01155 
01156           a_sec = <a class="code" href="cmd__tools_8h.html#a13">atotime</a>( time_str );
01157           <span class="keywordflow">if</span> ( a_sec == ((time_t)-1)) <span class="keywordflow">return</span> FALSE;
01158 
01159           <span class="keywordflow">if</span> ( usec_str == NULL )
01160           {
01161             a_usec = 0;
01162           }
01163           <span class="keywordflow">else</span>
01164           {
01165             a_usec = <a class="code" href="cmd__tools_8h.html#a10">my_atoi</a>( usec_str );
01166             <span class="comment">/* 1 million is authorized and is interpreted by server as a "set to server time" */</span>
01167             <span class="keywordflow">if</span> ( (a_usec &lt; 0) || (a_usec &gt; 1000000) ) <span class="keywordflow">return</span> FALSE;
01168           }
01169           p_sattr2-&gt;atime.seconds= (<span class="keywordtype">unsigned</span> int)a_sec;
01170           p_sattr2-&gt;atime.useconds= (<span class="keywordtype">unsigned</span> int)a_usec;          
01171           
01172 <span class="preprocessor">#ifdef _DEBUG_NFS_SHELL</span>
01173 <span class="preprocessor"></span>          printf (<span class="stringliteral">"  atime = %u.%.6u\n"</span>, p_sattr2-&gt;atime.seconds,
01174                   p_sattr-&gt;atime.useconds );
01175 <span class="preprocessor">#endif</span>
01176 <span class="preprocessor"></span>        }
01177         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp( attrib_str, <span class="stringliteral">"mtime"</span> ))
01178         {
01179           time_str = strtok_r(value_str,<span class="stringliteral">"."</span>,&amp;usec_str);
01180 
01181           m_sec = <a class="code" href="cmd__tools_8h.html#a13">atotime</a>( time_str );
01182           <span class="keywordflow">if</span> ( m_sec == ((time_t)-1)) <span class="keywordflow">return</span> FALSE;
01183 
01184           <span class="keywordflow">if</span> ( usec_str == NULL )
01185           {
01186             m_usec = 0;
01187           }
01188           <span class="keywordflow">else</span>
01189           {
01190             m_usec = <a class="code" href="cmd__tools_8h.html#a10">my_atoi</a>( usec_str );
01191             <span class="comment">/* 1 million is authorized and is interpreted by server as a "set to server time" */</span>
01192             <span class="keywordflow">if</span> ( (m_usec &lt; 0) || (m_usec &gt; 1000000) ) <span class="keywordflow">return</span> FALSE;
01193           }
01194           p_sattr2-&gt;mtime.seconds= (<span class="keywordtype">unsigned</span> int)m_sec;
01195           p_sattr2-&gt;mtime.useconds= (<span class="keywordtype">unsigned</span> int)m_usec;          
01196           
01197 <span class="preprocessor">#ifdef _DEBUG_NFS_SHELL</span>
01198 <span class="preprocessor"></span>          printf (<span class="stringliteral">"  mtime = %u.%.6u\n"</span>, p_sattr2-&gt;mtime.seconds,
01199                   p_sattr-&gt;mtime.useconds );
01200 <span class="preprocessor">#endif</span>
01201 <span class="preprocessor"></span>        }
01202         <span class="keywordflow">else</span>
01203         {
01204 <span class="preprocessor">  #ifdef _DEBUG_NFS_SHELL</span>
01205 <span class="preprocessor"></span>          printf( <span class="stringliteral">"Syntax error for sattr2.\n&lt;attr&gt; must be one of the following: mode, uid, gid, size, atime, mtime.\n"</span>);
01206 <span class="preprocessor">  #endif</span>
01207 <span class="preprocessor"></span>          <span class="keywordflow">return</span> FALSE;
01208         }
01209         
01210         attrib_str = next_str;
01211         
01212         next_str = NULL; <span class="comment">/* paranoid setting */</span>
01213         value_str = NULL; <span class="comment">/* paranoid setting */</span>
01214         
01215         <span class="keywordflow">if</span> ( attrib_str != NULL )
01216           attrib_str = strtok_r(attrib_str,<span class="stringliteral">","</span>,&amp;next_str);
01217         
01218       }
01219       
01220       <span class="keywordflow">return</span> TRUE;
01221       
01222     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
01223       <span class="comment">/* nothing to do */</span>
01224       <span class="keywordflow">return</span> TRUE;
01225       <span class="keywordflow">break</span>;
01226       
01227     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
01228       <span class="comment">/* never decoded */</span>
01229     <span class="keywordflow">default</span>:
01230       <span class="keywordflow">return</span> FALSE;
01231   } 
01232   
01233 }
01234 
01235 
01236 
<a name="l01237"></a><a class="code" href="cmd__nfstools_8h.html#a30">01237</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a30">cmdnfs_CREATE2args</a>(
01238       cmdnfs_encodetype_t     encodeflag,
01239       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
01240       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
01241       caddr_t         p_nfs_struct
01242     )
01243 {
01244   CREATE2args * p_create2args = (  CREATE2args *) p_nfs_struct ;
01245 
01246   <span class="comment">/* sanity check */</span>
01247   <span class="keywordflow">if</span> ( p_create2args == NULL ) <span class="keywordflow">return</span> FALSE;
01248   
01249   <span class="keywordflow">switch</span> ( encodeflag )
01250   {
01251     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
01252       
01253       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a26">cmdnfs_diropargs2</a>( <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>, 2, argv , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
01254                             (caddr_t) &amp;(p_create2args-&gt;where) ) == FALSE )
01255       {
01256         <span class="keywordflow">return</span> FALSE;
01257       }
01258       
01259       <span class="comment">/* optional sattr2 parameters */</span>
01260       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a29">cmdnfs_sattr2</a>( <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>, argc-2, argv+2 , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
01261                           (caddr_t) &amp;(p_create2args-&gt;attributes) ) == FALSE )
01262       {
01263         <span class="keywordflow">return</span> FALSE;
01264       }
01265       
01266       <span class="keywordflow">return</span> TRUE;
01267       
01268     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
01269       <a class="code" href="cmd__nfstools_8h.html#a26">cmdnfs_diropargs2</a>( <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a> , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
01270                             (caddr_t) &amp;(p_create2args-&gt;where) );
01271       <a class="code" href="cmd__nfstools_8h.html#a29">cmdnfs_sattr2</a>( <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a> , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
01272                            (caddr_t) &amp;(p_create2args-&gt;attributes) );   
01273       <span class="keywordflow">break</span>;
01274       
01275     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
01276       <span class="comment">/* never decoded */</span>
01277     <span class="keywordflow">default</span>:
01278       <span class="keywordflow">return</span> FALSE;
01279   }
01280   
01281   
01282 }
01283 
01284 
<a name="l01285"></a><a class="code" href="cmd__nfstools_8h.html#a31">01285</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a31">cmdnfs_SETATTR2args</a>(
01286       cmdnfs_encodetype_t     encodeflag,
01287       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
01288       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
01289       caddr_t         p_nfs_struct
01290     )
01291 {
01292   SETATTR2args * p_SETATTR2args = (  SETATTR2args *) p_nfs_struct ;
01293 
01294   <span class="comment">/* sanity check */</span>
01295   <span class="keywordflow">if</span> ( p_SETATTR2args == NULL ) <span class="keywordflow">return</span> FALSE;
01296   
01297   <span class="keywordflow">switch</span> ( encodeflag )
01298   {
01299     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
01300       
01301       <span class="keywordflow">if</span> ( argc != 2 ) <span class="keywordflow">return</span> FALSE;
01302       
01303       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a18">cmdnfs_fhandle2</a>( <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>, 1, argv , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
01304                             (caddr_t) &amp;(p_SETATTR2args-&gt;file) ) == FALSE )
01305       {
01306         <span class="keywordflow">return</span> FALSE;
01307       }
01308       
01309       <span class="comment">/* mandatory sattr2 parameter */</span>
01310       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a29">cmdnfs_sattr2</a>( <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>, argc-1, argv+1 , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
01311                           (caddr_t) &amp;(p_SETATTR2args-&gt;attributes) ) == FALSE )
01312       {
01313         <span class="keywordflow">return</span> FALSE;
01314       }
01315       
01316       <span class="keywordflow">return</span> TRUE;
01317       
01318     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
01319       <a class="code" href="cmd__nfstools_8h.html#a18">cmdnfs_fhandle2</a>( <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a> , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
01320                            (caddr_t) &amp;(p_SETATTR2args-&gt;file) );
01321       <a class="code" href="cmd__nfstools_8h.html#a29">cmdnfs_sattr2</a>( <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a> , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
01322                            (caddr_t) &amp;(p_SETATTR2args-&gt;attributes) );
01323       <span class="keywordflow">break</span>;
01324       
01325     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
01326       <span class="comment">/* never decoded */</span>
01327     <span class="keywordflow">default</span>:
01328       <span class="keywordflow">return</span> FALSE;
01329   }
01330   
01331   
01332 }
01333 
01334 
01335 
<a name="l01336"></a><a class="code" href="cmd__nfstools_8h.html#a32">01336</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a32">cmdnfs_READDIR2args</a>(
01337       cmdnfs_encodetype_t     encodeflag,
01338       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
01339       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
01340       caddr_t         p_nfs_struct
01341     )
01342 {
01343   caddr_t p_cookie;
01344   <span class="keywordtype">int</span> rc;
01345   <span class="keywordtype">int</span> count;
01346   <span class="keywordtype">int</span> cookie;
01347   READDIR2args * p_READDIR2args = (  READDIR2args *) p_nfs_struct ;
01348 
01349   <span class="comment">/* sanity check */</span>
01350   <span class="keywordflow">if</span> ( p_READDIR2args == NULL ) <span class="keywordflow">return</span> FALSE;
01351   
01352   <span class="keywordflow">switch</span> ( encodeflag )
01353   {
01354     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
01355       
01356       <span class="keywordflow">if</span> ( argc != 3 ) <span class="keywordflow">return</span> FALSE;
01357       
01358       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a18">cmdnfs_fhandle2</a>( <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>, 1, argv , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
01359                             (caddr_t) &amp;(p_READDIR2args-&gt;dir) ) == FALSE )
01360       {
01361         <span class="keywordflow">return</span> FALSE;
01362       }
01363       
01364       <span class="comment">/* cookie = 4 octets */</span>
01365 
01366       cookie = <a class="code" href="cmd__tools_8h.html#a10">my_atoi</a>( argv[1] );
01367       <span class="keywordflow">if</span> ( cookie &lt; 0 ) <span class="keywordflow">return</span> FALSE;      
01368       p_cookie = (caddr_t) &amp;(p_READDIR2args-&gt;cookie) ;
01369       
01370       memcpy( p_cookie, &amp;cookie, 4 );
01371             
01372       <span class="comment">/* count */</span>
01373       
01374       count = <a class="code" href="cmd__tools_8h.html#a10">my_atoi</a>( argv[2] );
01375       <span class="keywordflow">if</span> (count &lt; 0) <span class="keywordflow">return</span> FALSE; 
01376       p_READDIR2args-&gt;count = (<span class="keywordtype">unsigned</span> int) count;
01377 
01378             
01379       <span class="keywordflow">return</span> TRUE;
01380       
01381     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
01382       <a class="code" href="cmd__nfstools_8h.html#a18">cmdnfs_fhandle2</a>( <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a> , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
01383                            (caddr_t) &amp;(p_READDIR2args-&gt;dir) );
01384             
01385       <span class="keywordflow">break</span>;
01386       
01387     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
01388       <span class="comment">/* never decoded */</span>
01389     <span class="keywordflow">default</span>:
01390       <span class="keywordflow">return</span> FALSE;
01391   }
01392   
01393   
01394 }
01395 
01396 
01397 
01398 <span class="keyword">static</span> <span class="keywordtype">int</span> cmdnfs_READDIR2resok(
01399       cmdnfs_encodetype_t     encodeflag,
01400       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
01401       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
01402       caddr_t         p_nfs_struct
01403     )
01404 {
01405   READDIR2resok * p_READDIR2resok = ( READDIR2resok *) p_nfs_struct ;
01406   
01407   entry2 * p_entry2 = p_READDIR2resok-&gt;entries ;
01408   
01409   <span class="keywordflow">switch</span> ( encodeflag )
01410   {
01411     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
01412       
01413       <span class="comment">/* print the list of entries */</span>
01414       <span class="keywordflow">if</span> ( p_entry2 != NULL )
01415         fprintf(out_stream, <span class="stringliteral">"%*sDirEntries:\n"</span>,        indent, <span class="stringliteral">" "</span>);
01416       
01417       <span class="keywordflow">while</span> ( p_entry2 )
01418       {
01419         fprintf(out_stream, <span class="stringliteral">"%*s{\n"</span>,             indent+2, <span class="stringliteral">" "</span>);
01420         fprintf(out_stream, <span class="stringliteral">"%*sfileid = %#x\n"</span>,  indent+4, <span class="stringliteral">" "</span>,p_entry2-&gt;fileid );
01421         fprintf(out_stream, <span class="stringliteral">"%*sname = %s\n"</span>,     indent+4, <span class="stringliteral">" "</span>,p_entry2-&gt;name );
01422         fprintf(out_stream, <span class="stringliteral">"%*scookie = %u\n"</span>,   indent+4, <span class="stringliteral">" "</span>, *((<span class="keywordtype">int</span> *)p_entry2-&gt;cookie) );
01423         fprintf(out_stream, <span class="stringliteral">"%*s}\n"</span>,             indent+2, <span class="stringliteral">" "</span>);
01424         
01425         p_entry2 = p_entry2-&gt;nextentry;
01426       }
01427       
01428       <span class="comment">/* prinf the eof boolean */</span>
01429       
01430       <span class="keywordflow">if</span> ( p_READDIR2resok-&gt;eof )
01431         fprintf(out_stream, <span class="stringliteral">"%*seof = TRUE\n"</span>,indent, <span class="stringliteral">" "</span>);
01432       <span class="keywordflow">else</span>
01433         fprintf(out_stream, <span class="stringliteral">"%*seof = FALSE\n"</span>,indent, <span class="stringliteral">" "</span>);
01434                   
01435       <span class="keywordflow">return</span> TRUE;
01436       <span class="keywordflow">break</span>;
01437       
01438     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
01439       <span class="comment">/* never encoded */</span>
01440     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
01441       <span class="comment">/* it is never an input (never encoded, never allocated) */</span>
01442     <span class="keywordflow">default</span>:
01443       <span class="keywordflow">return</span> FALSE;
01444   }
01445 }
01446 
<a name="l01447"></a><a class="code" href="cmd__nfstools_8h.html#a33">01447</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a33">cmdnfs_READDIR2res</a>(
01448       cmdnfs_encodetype_t encodeflag,
01449       <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> ** argv,
01450       <span class="keywordtype">int</span> indent, FILE * out_stream,
01451       caddr_t     p_nfs_struct
01452     )
01453 {
01454   READDIR2res * p_READDIR2res = ( READDIR2res *) p_nfs_struct ;
01455     
01456   <span class="comment">/* sanity check */</span>
01457   <span class="keywordflow">if</span> ( p_READDIR2res == NULL ) <span class="keywordflow">return</span> FALSE;
01458   
01459   <span class="keywordflow">switch</span> ( encodeflag )
01460   {
01461     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
01462       
01463       <span class="comment">/* it is never an input */</span>
01464       <span class="keywordflow">return</span> FALSE;
01465       
01466       <span class="keywordflow">break</span>;
01467     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
01468             
01469       fprintf(out_stream, <span class="stringliteral">"%*sREADDIR2res =\n"</span>,indent, <span class="stringliteral">" "</span>);
01470       fprintf(out_stream, <span class="stringliteral">"%*s{\n"</span>,indent, <span class="stringliteral">" "</span>);
01471       
01472       <span class="comment">/* Convert status to error code */</span>
01473       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a27">cmdnfs_nfsstat2</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+2, out_stream,
01474                              (caddr_t)&amp;p_READDIR2res-&gt;status  ) == FALSE )
01475       {
01476         <span class="keywordflow">return</span> FALSE;
01477       }
01478 
01479       <span class="keywordflow">if</span> ( p_READDIR2res-&gt;status == NFS_OK )
01480       {
01481         <span class="keywordflow">if</span> ( cmdnfs_READDIR2resok( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+2, out_stream,
01482                                (caddr_t)&amp;p_READDIR2res-&gt;READDIR2res_u.readdirok  ) == FALSE )
01483         {
01484           <span class="keywordflow">return</span> FALSE;
01485         }
01486       }
01487       fprintf(out_stream, <span class="stringliteral">"%*s}\n"</span>,indent, <span class="stringliteral">" "</span>);
01488       
01489       <span class="keywordflow">return</span> TRUE;
01490       
01491       <span class="keywordflow">break</span>;
01492       
01493     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
01494       
01495       <span class="comment">/* it is never an input (never encoded, never allocated) */</span>
01496       <span class="keywordflow">return</span> FALSE;
01497       
01498       <span class="keywordflow">break</span>;
01499       
01500     <span class="keywordflow">default</span>:
01501       <span class="keywordflow">return</span> FALSE;
01502   }  
01503 }
01504 
01505 
<a name="l01506"></a><a class="code" href="cmd__nfstools_8h.html#a66">01506</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a66">cmdnfs_RENAME2args</a>(
01507       cmdnfs_encodetype_t     encodeflag,
01508       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
01509       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
01510       caddr_t         p_nfs_struct    
01511     )
01512 {
01513   RENAME2args * p_RENAME2args = (  RENAME2args *) p_nfs_struct ;
01514   
01515   <span class="comment">/* sanity check */</span>
01516   <span class="keywordflow">if</span> ( p_RENAME2args == NULL ) <span class="keywordflow">return</span> FALSE;
01517   
01518   <span class="keywordflow">switch</span> ( encodeflag )
01519   {
01520     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
01521       
01522       <span class="keywordflow">if</span> ( argc != 4 ) <span class="keywordflow">return</span> FALSE;
01523       
01524       <span class="comment">/* The first 2 args */</span>
01525       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a26">cmdnfs_diropargs2</a>( <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>, 2, argv , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
01526                              (caddr_t) &amp;(p_RENAME2args-&gt;from) ) == FALSE )
01527       {
01528         <span class="keywordflow">return</span> FALSE;
01529       }
01530       
01531       <span class="comment">/* The last 2 args */</span>
01532       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a26">cmdnfs_diropargs2</a>( <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>, argc-2, argv+2 , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
01533                              (caddr_t) &amp;(p_RENAME2args-&gt;to) ) == FALSE )
01534       {
01535         <span class="keywordflow">return</span> FALSE;
01536       }
01537       
01538       
01539       <span class="keywordflow">return</span> TRUE;
01540       
01541     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
01542       <a class="code" href="cmd__nfstools_8h.html#a26">cmdnfs_diropargs2</a>( <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a> , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
01543                          (caddr_t) &amp;(p_RENAME2args-&gt;from) );
01544       <a class="code" href="cmd__nfstools_8h.html#a26">cmdnfs_diropargs2</a>( <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a> , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
01545                          (caddr_t) &amp;(p_RENAME2args-&gt;to) );
01546       <span class="keywordflow">return</span> TRUE;
01547       <span class="keywordflow">break</span>;
01548       
01549     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
01550       <span class="comment">/* never decoded */</span>
01551     <span class="keywordflow">default</span>:
01552       <span class="keywordflow">return</span> FALSE;
01553   } 
01554 }
01555 
01556 
<a name="l01557"></a><a class="code" href="cmd__nfstools_8h.html#a34">01557</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a34">cmdnfs_nfsstat3</a>(
01558       cmdnfs_encodetype_t     encodeflag,
01559       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
01560       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
01561       caddr_t     p_nfs_struct
01562     )
01563 {
01564   
01565   <span class="keywordtype">int</span> i;
01566   nfsstat3 * p_stat3 = ( nfsstat3 *) p_nfs_struct ;
01567   
01568     
01569   <span class="comment">/* sanity check */</span>
01570   <span class="keywordflow">if</span> ( p_stat3 == NULL ) <span class="keywordflow">return</span> FALSE;
01571   
01572   <span class="keywordflow">switch</span> ( encodeflag )
01573   {
01574     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
01575        
01576       fprintf(out_stream, <span class="stringliteral">"%*sstatus = %d (%s)\n"</span>,indent, <span class="stringliteral">" "</span>, (<span class="keywordtype">int</span>)(*p_stat3),nfsstat3_to_str(*p_stat3));
01577       <span class="keywordflow">return</span> TRUE;
01578       
01579       <span class="keywordflow">break</span>;
01580       
01581     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
01582     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
01583       <span class="comment">/* never encoded */</span>
01584     <span class="keywordflow">default</span>:
01585       <span class="keywordflow">return</span> FALSE;
01586   }
01587 
01588 }
01589 
01590 
<a name="l01591"></a><a class="code" href="cmd__nfstools_8h.html#a35">01591</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a35">cmdnfs_fattr3</a>(
01592       cmdnfs_encodetype_t     encodeflag,
01593       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
01594       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
01595       caddr_t     p_nfs_struct
01596     )
01597 {
01598   
01599   <span class="keywordtype">int</span> i;
01600   fattr3 * p_fattr = ( fattr3 *) p_nfs_struct ;
01601   <span class="keywordtype">char</span> tmp_buff[256]=<span class="stringliteral">""</span>;
01602   <span class="keyword">struct </span>tm paramtm;
01603       
01604   <span class="comment">/* sanity check */</span>
01605   <span class="keywordflow">if</span> ( p_fattr == NULL ) <span class="keywordflow">return</span> FALSE;
01606   
01607   <span class="keywordflow">switch</span> ( encodeflag )
01608   {
01609     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
01610       
01612       <span class="keywordflow">return</span> FALSE;
01613       
01614       <span class="keywordflow">break</span>;
01615     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
01616             
01617       fprintf(out_stream, <span class="stringliteral">"%*sfattr3 =\n"</span>,indent, <span class="stringliteral">" "</span>);
01618       fprintf(out_stream, <span class="stringliteral">"%*s{\n"</span>,indent, <span class="stringliteral">" "</span>);
01619       
01620       fprintf(out_stream, <span class="stringliteral">"%*stype = %d (%s)\n"</span>,indent+2, <span class="stringliteral">" "</span>,(<span class="keywordtype">int</span>)p_fattr-&gt;type,nfstype3_to_str(p_fattr-&gt;type));      
01621       fprintf(out_stream, <span class="stringliteral">"%*smode = 0%o\n"</span>,indent+2, <span class="stringliteral">" "</span>,p_fattr-&gt;mode);
01622       fprintf(out_stream, <span class="stringliteral">"%*snlink = %u\n"</span>,indent+2, <span class="stringliteral">" "</span>,p_fattr-&gt;nlink);
01623       fprintf(out_stream, <span class="stringliteral">"%*suid = %u\n"</span>,indent+2, <span class="stringliteral">" "</span>,p_fattr-&gt;uid);
01624       fprintf(out_stream, <span class="stringliteral">"%*sgid = %u\n"</span>,indent+2, <span class="stringliteral">" "</span>,p_fattr-&gt;gid);
01625       fprintf(out_stream, <span class="stringliteral">"%*ssize = %llu\n"</span>,indent+2, <span class="stringliteral">" "</span>,p_fattr-&gt;size);
01626       fprintf(out_stream, <span class="stringliteral">"%*sused = %llu\n"</span>,indent+2, <span class="stringliteral">" "</span>,p_fattr-&gt;used);
01627       fprintf(out_stream, <span class="stringliteral">"%*srdev = %u.%u\n"</span>,indent+2, <span class="stringliteral">" "</span>,p_fattr-&gt;rdev.specdata1,p_fattr-&gt;rdev.specdata2);
01628       fprintf(out_stream, <span class="stringliteral">"%*sfsid = %#llx\n"</span>,indent+2, <span class="stringliteral">" "</span>,p_fattr-&gt;fsid );
01629       fprintf(out_stream, <span class="stringliteral">"%*sfileid = %#llx\n"</span>,indent+2, <span class="stringliteral">" "</span>,p_fattr-&gt;fileid );
01630       
01631       strftime(tmp_buff,256,<span class="stringliteral">"%Y-%m-%d %T"</span>,<a class="code" href="cmd__tools_8h.html#a9">Localtime_r</a>((time_t*)&amp;p_fattr-&gt;atime.seconds, &amp;paramtm));
01632       fprintf(out_stream, <span class="stringliteral">"%*satime = %u.%.9u (%s)\n"</span>,indent+2, <span class="stringliteral">" "</span>,
01633           p_fattr-&gt;atime.seconds,p_fattr-&gt;atime.nseconds,tmp_buff);
01634       
01635       strftime(tmp_buff,256,<span class="stringliteral">"%Y-%m-%d %T"</span>,<a class="code" href="cmd__tools_8h.html#a9">Localtime_r</a>((time_t*)&amp;p_fattr-&gt;mtime.seconds, &amp;paramtm));
01636       fprintf(out_stream, <span class="stringliteral">"%*smtime = %u.%.9u (%s)\n"</span>,indent+2, <span class="stringliteral">" "</span>,
01637           p_fattr-&gt;mtime.seconds,p_fattr-&gt;mtime.nseconds,tmp_buff);
01638       
01639       strftime(tmp_buff,256,<span class="stringliteral">"%Y-%m-%d %T"</span>,<a class="code" href="cmd__tools_8h.html#a9">Localtime_r</a>((time_t*)&amp;p_fattr-&gt;ctime.seconds, &amp;paramtm));
01640       fprintf(out_stream, <span class="stringliteral">"%*sctime = %u.%.9u (%s)\n"</span>,indent+2, <span class="stringliteral">" "</span>,
01641           p_fattr-&gt;ctime.seconds,p_fattr-&gt;ctime.nseconds, tmp_buff);
01642       
01643       fprintf(out_stream, <span class="stringliteral">"%*s}\n"</span>,indent, <span class="stringliteral">" "</span>);
01644       
01645       <span class="keywordflow">return</span> TRUE;
01646       
01647       <span class="keywordflow">break</span>;
01648       
01649     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
01650       
01652       <span class="keywordflow">return</span> FALSE;
01653       
01654       <span class="keywordflow">break</span>;
01655       
01656     <span class="keywordflow">default</span>:
01657       <span class="keywordflow">return</span> FALSE;
01658   }
01659 
01660 }
01661 
01662 
01663 <span class="comment">/* interprets a list of attributes separated with a colon :</span>
01664 <span class="comment"> * mode=0755,uid=...,gid=...,etc...</span>
01665 <span class="comment"> */</span>
<a name="l01666"></a><a class="code" href="cmd__nfstools_8h.html#a36">01666</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a36">cmdnfs_sattr3</a>(
01667       cmdnfs_encodetype_t     encodeflag,
01668       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
01669       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
01670       caddr_t     p_nfs_struct
01671     )
01672 {
01673   
01674   <span class="keywordtype">int</span> i;
01675   sattr3 * p_sattr = ( sattr3 *) p_nfs_struct ;
01676   <span class="keywordtype">char</span> * next_str = NULL;
01677   <span class="keywordtype">char</span> * attrib_str;
01678   <span class="keywordtype">char</span> * value_str;
01679   
01680   <span class="keywordtype">int</span> mode, userid, groupid, rc;
01681   time_t  a_sec,m_sec;
01682   <span class="keywordtype">int</span>     a_nsec, m_nsec;
01683   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> size;
01684   <span class="keywordtype">char</span> * nsec_str;
01685   <span class="keywordtype">char</span> * time_str;
01686     
01687   <span class="comment">/* sanity check */</span>
01688   <span class="keywordflow">if</span> ( p_sattr == NULL ) <span class="keywordflow">return</span> FALSE;
01689   
01690   <span class="keywordflow">switch</span> ( encodeflag )
01691   {
01692     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
01693       
01694       <span class="comment">/* inits structure */</span>
01695       memset( (caddr_t)p_sattr, 0, <span class="keyword">sizeof</span>( sattr3 ) );
01696       
01697       p_sattr-&gt;mode.set_it = FALSE;
01698       p_sattr-&gt;uid.set_it = FALSE;
01699       p_sattr-&gt;gid.set_it = FALSE;
01700       p_sattr-&gt;size.set_it = FALSE;
01701       p_sattr-&gt;atime.set_it = DONT_CHANGE;
01702       p_sattr-&gt;mtime.set_it = DONT_CHANGE;
01703         
01704       <span class="keywordflow">if</span> ( argc == 0 ) <span class="keywordflow">return</span> TRUE;
01705       
01706       <span class="comment">/* at this point it must not be more than one string */</span>
01707       <span class="keywordflow">if</span> (argc != 1) <span class="keywordflow">return</span> FALSE;
01708       
01709       <span class="comment">/* the attributes are:</span>
01710 <span class="comment">       * mode, uid, gid, size, atime, mtime</span>
01711 <span class="comment">       */</span>
01712       
01713       attrib_str = strtok_r(argv[0],<span class="stringliteral">","</span>,&amp;next_str);
01714       
01715       <span class="keywordflow">if</span> ( attrib_str == NULL )
01716       {
01717 <span class="preprocessor">#ifdef _DEBUG_NFS_SHELL</span>
01718 <span class="preprocessor"></span>        printf( <span class="stringliteral">"Unexpected parsing error.\n"</span>);
01719 <span class="preprocessor">#endif</span>
01720 <span class="preprocessor"></span>        <span class="keywordflow">return</span> FALSE;
01721       }
01722       
01723       <span class="keywordflow">while</span> ( attrib_str != NULL )
01724       {
01725         
01726         <span class="comment">/* retrieving attribute value */</span>
01727         attrib_str = strtok_r( attrib_str,<span class="stringliteral">"="</span>,&amp;value_str );
01728         
01729         <span class="keywordflow">if</span> ( (attrib_str == NULL) || (value_str == NULL) )
01730         {
01731 <span class="preprocessor">  #ifdef _DEBUG_NFS_SHELL</span>
01732 <span class="preprocessor"></span>          printf( <span class="stringliteral">"Syntax error for sattr3.\nExpected syntax: &lt;attr&gt;=&lt;value&gt;,&lt;attr&gt;=&lt;value&gt;,...\n"</span>);
01733 <span class="preprocessor">  #endif</span>
01734 <span class="preprocessor"></span>          <span class="keywordflow">return</span> FALSE;
01735         }
01736 
01737 <span class="preprocessor">#ifdef _DEBUG_NFS_SHELL</span>
01738 <span class="preprocessor"></span>        printf( <span class="stringliteral">"Attribute: \"%s\", Value: \"%s\"\n"</span>,attrib_str,value_str);
01739 <span class="preprocessor">#endif</span>
01740 <span class="preprocessor"></span>        
01741         <span class="keywordflow">if</span> (!strcmp( attrib_str, <span class="stringliteral">"mode"</span> ))
01742         {
01743           mode = <a class="code" href="cmd__tools_8h.html#a11">atomode</a>( value_str );
01744           <span class="keywordflow">if</span> (mode &lt; 0) <span class="keywordflow">return</span> FALSE;          
01745           p_sattr-&gt;mode.set_it = TRUE;
01746           p_sattr-&gt;mode.set_mode3_u.mode = (<span class="keywordtype">unsigned</span> int) mode;
01747 <span class="preprocessor">#ifdef _DEBUG_NFS_SHELL      </span>
01748 <span class="preprocessor"></span>          printf (<span class="stringliteral">"  mode = 0%o\n"</span>,p_sattr-&gt;mode.set_mode3_u.mode);
01749 <span class="preprocessor">#endif</span>
01750 <span class="preprocessor"></span>        }
01751         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp( attrib_str, <span class="stringliteral">"uid"</span> ))
01752         {
01753           userid = <a class="code" href="cmd__tools_8h.html#a10">my_atoi</a>( value_str );
01754           <span class="keywordflow">if</span> (userid &lt; 0) <span class="keywordflow">return</span> FALSE;          
01755           p_sattr-&gt;uid.set_it = TRUE;
01756           p_sattr-&gt;uid.set_uid3_u.uid = (<span class="keywordtype">unsigned</span> int) userid;
01757 <span class="preprocessor">#ifdef _DEBUG_NFS_SHELL      </span>
01758 <span class="preprocessor"></span>          printf (<span class="stringliteral">"  uid = %u\n"</span>,p_sattr-&gt;uid.set_uid3_u.uid);
01759 <span class="preprocessor">#endif</span>
01760 <span class="preprocessor"></span>        }
01761         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp( attrib_str, <span class="stringliteral">"gid"</span> ))
01762         {
01763           groupid = <a class="code" href="cmd__tools_8h.html#a10">my_atoi</a>( value_str );
01764           <span class="keywordflow">if</span> (groupid &lt; 0) <span class="keywordflow">return</span> FALSE;
01765           p_sattr-&gt;gid.set_it = TRUE;
01766           p_sattr-&gt;gid.set_gid3_u.gid = (<span class="keywordtype">unsigned</span> int) groupid;
01767 <span class="preprocessor">#ifdef _DEBUG_NFS_SHELL      </span>
01768 <span class="preprocessor"></span>          printf (<span class="stringliteral">"  gid = %u\n"</span>,p_sattr-&gt;gid.set_gid3_u.gid);
01769 <span class="preprocessor">#endif</span>
01770 <span class="preprocessor"></span>        }
01771         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp( attrib_str, <span class="stringliteral">"size"</span> ))
01772         {
01773           rc = <a class="code" href="cmd__tools_8h.html#a12">ato64</a>( value_str, &amp;size );
01774           <span class="keywordflow">if</span> ( rc ) <span class="keywordflow">return</span> FALSE;      
01775           p_sattr-&gt;size.set_it = TRUE;
01776           p_sattr-&gt;size.set_size3_u.size = (size3) size;
01777 <span class="preprocessor">#ifdef _DEBUG_NFS_SHELL</span>
01778 <span class="preprocessor"></span>          printf (<span class="stringliteral">"  size = %llu\n"</span>,p_sattr-&gt;size.set_size3_u.size);
01779 <span class="preprocessor">#endif</span>
01780 <span class="preprocessor"></span>        }
01781         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp( attrib_str, <span class="stringliteral">"atime"</span> ))
01782         {
01783           time_str = strtok_r(value_str,<span class="stringliteral">"."</span>,&amp;nsec_str);
01784 
01785           a_sec = <a class="code" href="cmd__tools_8h.html#a13">atotime</a>( time_str );
01786           <span class="keywordflow">if</span> ( a_sec == ((time_t)-1)) <span class="keywordflow">return</span> FALSE;
01787 
01788           <span class="keywordflow">if</span> ( nsec_str == NULL )
01789           {
01790             a_nsec = 0;
01791           }
01792           <span class="keywordflow">else</span>
01793           {
01794             a_nsec = <a class="code" href="cmd__tools_8h.html#a10">my_atoi</a>( nsec_str );
01795             <span class="keywordflow">if</span> ( (a_nsec &lt; 0) || (a_nsec &gt; 999999999) ) <span class="keywordflow">return</span> FALSE;
01796           }
01797           
01798           p_sattr-&gt;atime.set_it = SET_TO_CLIENT_TIME;
01799           p_sattr-&gt;atime.set_atime_u.atime.seconds = a_sec;
01800           p_sattr-&gt;atime.set_atime_u.atime.nseconds = a_nsec;
01801           
01802 <span class="preprocessor">#ifdef _DEBUG_NFS_SHELL</span>
01803 <span class="preprocessor"></span>          printf (<span class="stringliteral">"  atime = %u.%.9u\n"</span>, p_sattr-&gt;atime.set_atime_u.atime.seconds,
01804                   p_sattr-&gt;atime.set_atime_u.atime.nseconds );
01805 <span class="preprocessor">#endif</span>
01806 <span class="preprocessor"></span>        }
01807         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp( attrib_str, <span class="stringliteral">"mtime"</span> ))
01808         {
01809           time_str = strtok_r(value_str,<span class="stringliteral">"."</span>,&amp;nsec_str);
01810 
01811           m_sec = <a class="code" href="cmd__tools_8h.html#a13">atotime</a>( time_str );
01812           <span class="keywordflow">if</span> ( m_sec == ((time_t)-1)) <span class="keywordflow">return</span> FALSE;
01813 
01814           <span class="keywordflow">if</span> ( nsec_str == NULL )
01815           {
01816             m_nsec = 0;
01817           }
01818           <span class="keywordflow">else</span>
01819           {
01820             m_nsec = <a class="code" href="cmd__tools_8h.html#a10">my_atoi</a>( nsec_str );
01821             <span class="keywordflow">if</span> ( (m_nsec &lt; 0) || (m_nsec &gt; 999999999) ) <span class="keywordflow">return</span> FALSE;
01822           }
01823           
01824           p_sattr-&gt;mtime.set_it = SET_TO_CLIENT_TIME;
01825           p_sattr-&gt;mtime.set_mtime_u.mtime.seconds = m_sec;
01826           p_sattr-&gt;mtime.set_mtime_u.mtime.nseconds = m_nsec;
01827 <span class="preprocessor">#ifdef _DEBUG_NFS_SHELL</span>
01828 <span class="preprocessor"></span>          printf (<span class="stringliteral">"  mtime = %u.%.9u\n"</span>, p_sattr-&gt;mtime.set_mtime_u.mtime.seconds,
01829                   p_sattr-&gt;mtime.set_mtime_u.mtime.nseconds );
01830 <span class="preprocessor">#endif</span>
01831 <span class="preprocessor"></span>        }
01832         <span class="keywordflow">else</span>
01833         {
01834 <span class="preprocessor">  #ifdef _DEBUG_NFS_SHELL</span>
01835 <span class="preprocessor"></span>          printf( <span class="stringliteral">"Syntax error for sattr3.\n&lt;attr&gt; must be one of the following: mode, uid, gid, size, atime, mtime.\n"</span>);
01836 <span class="preprocessor">  #endif</span>
01837 <span class="preprocessor"></span>          <span class="keywordflow">return</span> FALSE;
01838         }
01839         
01840         attrib_str = next_str;
01841         
01842         next_str = NULL; <span class="comment">/* paranoid setting */</span>
01843         value_str = NULL; <span class="comment">/* paranoid setting */</span>
01844         
01845         <span class="keywordflow">if</span> ( attrib_str != NULL )
01846           attrib_str = strtok_r(attrib_str,<span class="stringliteral">","</span>,&amp;next_str);
01847 
01848       }
01849       
01850       
01851       
01852       <span class="keywordflow">return</span> TRUE;
01853       <span class="keywordflow">break</span>;
01854       
01855     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:      
01856       <span class="comment">/* nothing to do */</span>      
01857       <span class="keywordflow">return</span> TRUE;      
01858       <span class="keywordflow">break</span>;
01859       
01860     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
01861       <span class="comment">/* never decoded */</span>
01862     <span class="keywordflow">default</span>:
01863       <span class="keywordflow">return</span> FALSE;
01864   }
01865 
01866 } <span class="comment">/* cmdnfs_sattr3 */</span>
01867 
01868 
01869 
<a name="l01870"></a><a class="code" href="cmd__nfstools_8c.html#a8">01870</a> <span class="preprocessor">#define GETATTR3_ATTRIBUTES( _p_GETATTR3res ) ( (_p_GETATTR3res)-&gt;GETATTR3res_u.resok.obj_attributes )</span>
01871 <span class="preprocessor"></span>
<a name="l01872"></a><a class="code" href="cmd__nfstools_8h.html#a37">01872</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a37">cmdnfs_GETATTR3res</a>(
01873       cmdnfs_encodetype_t     encodeflag,
01874       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
01875       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
01876       caddr_t     p_nfs_struct
01877     )
01878 {
01879   GETATTR3res * p_gattr3res = ( GETATTR3res *) p_nfs_struct ;
01880       
01881   <span class="comment">/* sanity check */</span>
01882   <span class="keywordflow">if</span> ( p_gattr3res == NULL ) <span class="keywordflow">return</span> FALSE;
01883   
01884   <span class="keywordflow">switch</span> ( encodeflag )
01885   {
01886     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
01887             
01888       fprintf(out_stream, <span class="stringliteral">"%*sGETATTR3res =\n"</span>,indent, <span class="stringliteral">" "</span>);
01889       fprintf(out_stream, <span class="stringliteral">"%*s{\n"</span>,indent, <span class="stringliteral">" "</span>);
01890       
01891       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a34">cmdnfs_nfsstat3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+2, out_stream,
01892                             (caddr_t) &amp;p_gattr3res-&gt;status ) == FALSE )
01893       {
01894         <span class="keywordflow">return</span> FALSE;
01895       }
01896 
01897       <span class="keywordflow">if</span> ( p_gattr3res-&gt;status == NFS3_OK )
01898       {
01899         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a35">cmdnfs_fattr3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+2, out_stream,
01900                              (caddr_t) &amp; <a class="code" href="cmd__nfstools_8c.html#a8">GETATTR3_ATTRIBUTES</a>(p_gattr3res) ) == FALSE )
01901         {
01902           <span class="keywordflow">return</span> FALSE;
01903         }
01904         
01905       }
01906       
01907       fprintf(out_stream, <span class="stringliteral">"%*s}\n"</span>,indent, <span class="stringliteral">" "</span>);
01908       
01909       <span class="keywordflow">return</span> TRUE;
01910       
01911       <span class="keywordflow">break</span>;
01912       
01913     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
01914       <span class="comment">/* never encoded */</span>
01915     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
01916       <span class="comment">/* it is never an input (never encoded, never allocated) */</span>
01917     <span class="keywordflow">default</span>:
01918       <span class="keywordflow">return</span> FALSE;
01919   }
01920   
01921 }
01922 
01923 <span class="preprocessor">#undef GETATTR3_ATTRIBUTES</span>
01924 <span class="preprocessor"></span>
01925 
<a name="l01926"></a><a class="code" href="cmd__nfstools_8h.html#a40">01926</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a40">cmdnfs_diropargs3</a>(
01927       cmdnfs_encodetype_t     encodeflag,
01928       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
01929       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
01930       caddr_t     p_nfs_struct
01931     )
01932 {
01933   diropargs3 * p_dirop3 = (  diropargs3 *) p_nfs_struct ;
01934 
01935   <span class="comment">/* sanity check */</span>
01936   <span class="keywordflow">if</span> ( p_dirop3 == NULL ) <span class="keywordflow">return</span> FALSE;
01937   
01938   <span class="keywordflow">switch</span> ( encodeflag )
01939   {
01940     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
01941       
01942       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a22">cmdnfs_fhandle3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>, 1, argv , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
01943                             (caddr_t) &amp;(p_dirop3-&gt;dir) ) == FALSE )
01944       {
01945         <span class="keywordflow">return</span> FALSE;
01946       }
01947       
01948       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a16">cmdnfs_dirpath</a>( <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>, argc-1, argv+1 , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
01949                           (caddr_t) &amp;(p_dirop3-&gt;name) ) == FALSE )
01950       {
01951         <span class="keywordflow">return</span> FALSE;
01952       }
01953       
01954       <span class="keywordflow">return</span> TRUE;
01955       
01956     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
01957       <a class="code" href="cmd__nfstools_8h.html#a22">cmdnfs_fhandle3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a> , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
01958                             (caddr_t) &amp;(p_dirop3-&gt;dir) );
01959       <a class="code" href="cmd__nfstools_8h.html#a16">cmdnfs_dirpath</a>( <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a> , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
01960                            (caddr_t) &amp;(p_dirop3-&gt;name) );   
01961       <span class="keywordflow">break</span>;
01962       
01963     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
01964       <span class="comment">/* never decoded */</span>
01965     <span class="keywordflow">default</span>:
01966       <span class="keywordflow">return</span> FALSE;
01967   }
01968   
01969 }
01970 
01971 
01972 
<a name="l01973"></a><a class="code" href="cmd__nfstools_8h.html#a38">01973</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a38">cmdnfs_postopattr</a>(
01974       cmdnfs_encodetype_t     encodeflag,
01975       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
01976       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
01977       caddr_t     p_nfs_struct
01978     )
01979 {
01980   post_op_attr * p_opattr = (post_op_attr *) p_nfs_struct;
01981   
01982   <span class="comment">/* sanity check */</span>
01983   <span class="keywordflow">if</span> ( p_opattr == NULL ) <span class="keywordflow">return</span> FALSE;
01984 
01985   <span class="keywordflow">switch</span> ( encodeflag )
01986   {
01987     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
01988             
01989         <span class="keywordflow">if</span> ( p_opattr-&gt;attributes_follow )
01990         {
01991           <span class="keywordflow">return</span> <a class="code" href="cmd__nfstools_8h.html#a35">cmdnfs_fattr3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent, out_stream,
01992                          (caddr_t) &amp;(p_opattr-&gt;post_op_attr_u.attributes) );
01993         }
01994         <span class="keywordflow">else</span>
01995         {
01996           fprintf(out_stream, <span class="stringliteral">"%*sN/A\n"</span>,indent, <span class="stringliteral">" "</span>);
01997           <span class="keywordflow">return</span> TRUE;
01998         }
01999         
02000       <span class="keywordflow">break</span>;
02001       
02002     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
02003       <span class="comment">/* never encoded */</span>
02004     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
02005       <span class="comment">/* it is never an input (never encoded, never allocated) */</span>
02006     <span class="keywordflow">default</span>:
02007       <span class="keywordflow">return</span> FALSE;
02008   }
02009 }
02010 
02011 
<a name="l02012"></a><a class="code" href="cmd__nfstools_8h.html#a39">02012</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a39">cmdnfs_postopfh3</a>(
02013       cmdnfs_encodetype_t     encodeflag,
02014       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
02015       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
02016       caddr_t     p_nfs_struct
02017     )
02018 {
02019   post_op_fh3 * p_opfh3 = (post_op_fh3 *) p_nfs_struct;
02020   
02021   <span class="comment">/* sanity check */</span>
02022   <span class="keywordflow">if</span> ( p_opfh3 == NULL ) <span class="keywordflow">return</span> FALSE;
02023 
02024   <span class="keywordflow">switch</span> ( encodeflag )
02025   {
02026     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
02027             
02028         <span class="keywordflow">if</span> ( p_opfh3-&gt;handle_follows )
02029         {
02030           <span class="keywordflow">return</span> <a class="code" href="cmd__nfstools_8h.html#a22">cmdnfs_fhandle3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent, out_stream,
02031                          (caddr_t) &amp;(p_opfh3-&gt;post_op_fh3_u.handle) );
02032         }
02033         <span class="keywordflow">else</span>
02034         {
02035           fprintf(out_stream, <span class="stringliteral">"%*sN/A\n"</span>,indent, <span class="stringliteral">" "</span>);
02036           <span class="keywordflow">return</span> TRUE;
02037         }
02038         
02039       <span class="keywordflow">break</span>;
02040       
02041     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
02042       <span class="comment">/* never encoded */</span>
02043     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
02044       <span class="comment">/* it is never an input (never encoded, never allocated) */</span>
02045     <span class="keywordflow">default</span>:
02046       <span class="keywordflow">return</span> FALSE;
02047   }
02048 }
02049 
02050 
<a name="l02051"></a><a class="code" href="cmd__nfstools_8c.html#a9">02051</a> <span class="preprocessor">#define LOOKUP3_OK_HANDLE( _p_LOOKUP3res ) ( (_p_LOOKUP3res)-&gt;LOOKUP3res_u.resok.object )</span>
<a name="l02052"></a><a class="code" href="cmd__nfstools_8c.html#a10">02052</a> <span class="preprocessor"></span><span class="preprocessor">#define LOOKUP3_OK_OBJATTR( _p_LOOKUP3res ) ( (_p_LOOKUP3res)-&gt;LOOKUP3res_u.resok.obj_attributes )</span>
<a name="l02053"></a><a class="code" href="cmd__nfstools_8c.html#a11">02053</a> <span class="preprocessor"></span><span class="preprocessor">#define LOOKUP3_OK_DIRATTR( _p_LOOKUP3res ) ( (_p_LOOKUP3res)-&gt;LOOKUP3res_u.resok.dir_attributes )</span>
<a name="l02054"></a><a class="code" href="cmd__nfstools_8c.html#a12">02054</a> <span class="preprocessor"></span><span class="preprocessor">#define LOOKUP3_FAIL_DIRATTR( _p_LOOKUP3res ) ( (_p_LOOKUP3res)-&gt;LOOKUP3res_u.resfail.dir_attributes )</span>
02055 <span class="preprocessor"></span>
<a name="l02056"></a><a class="code" href="cmd__nfstools_8h.html#a41">02056</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a41">cmdnfs_LOOKUP3res</a>(
02057       cmdnfs_encodetype_t     encodeflag,
02058       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
02059       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
02060       caddr_t     p_nfs_struct
02061     )
02062 {
02063   LOOKUP3res * p_lkup3res = ( LOOKUP3res *) p_nfs_struct ;
02064       
02065   <span class="comment">/* sanity check */</span>
02066   <span class="keywordflow">if</span> ( p_lkup3res == NULL ) <span class="keywordflow">return</span> FALSE;
02067   
02068   <span class="keywordflow">switch</span> ( encodeflag )
02069   {
02070     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
02071             
02072       fprintf(out_stream, <span class="stringliteral">"%*sLOOKUP3res =\n"</span>,indent, <span class="stringliteral">" "</span>);
02073       fprintf(out_stream, <span class="stringliteral">"%*s{\n"</span>,indent, <span class="stringliteral">" "</span>);
02074       
02075       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a34">cmdnfs_nfsstat3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+2, out_stream,
02076                             (caddr_t) &amp;p_lkup3res-&gt;status ) == FALSE )
02077       {
02078         <span class="keywordflow">return</span> FALSE;
02079       }
02080 
02081       <span class="keywordflow">if</span> ( p_lkup3res-&gt;status == NFS3_OK )
02082       {
02083         
02084         fprintf(out_stream, <span class="stringliteral">"%*sObject Handle:\n"</span>,indent+2, <span class="stringliteral">" "</span>);
02085         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a22">cmdnfs_fhandle3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+4, out_stream,
02086                              (caddr_t) &amp; <a class="code" href="cmd__nfstools_8c.html#a9">LOOKUP3_OK_HANDLE</a>(p_lkup3res) ) == FALSE )
02087         {
02088           <span class="keywordflow">return</span> FALSE;
02089         }
02090         
02091         fprintf(out_stream, <span class="stringliteral">"%*sPost-op attributes (object):\n"</span>,indent+2, <span class="stringliteral">" "</span>);
02092         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a38">cmdnfs_postopattr</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+4, out_stream,
02093                              (caddr_t) &amp; <a class="code" href="cmd__nfstools_8c.html#a10">LOOKUP3_OK_OBJATTR</a>(p_lkup3res) ) == FALSE )
02094         {
02095           <span class="keywordflow">return</span> FALSE;
02096         }
02097         
02098         fprintf(out_stream, <span class="stringliteral">"%*sPost-op attributes (directory):\n"</span>,indent+2, <span class="stringliteral">" "</span>);
02099         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a38">cmdnfs_postopattr</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+4, out_stream,
02100                              (caddr_t) &amp; <a class="code" href="cmd__nfstools_8c.html#a11">LOOKUP3_OK_DIRATTR</a>(p_lkup3res) ) == FALSE )
02101         {
02102           <span class="keywordflow">return</span> FALSE;
02103         }
02104         
02105       }
02106       <span class="keywordflow">else</span>
02107       {
02108         fprintf(out_stream, <span class="stringliteral">"%*sPost-op attributes (directory):\n"</span>,indent+2, <span class="stringliteral">" "</span>);
02109         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a38">cmdnfs_postopattr</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+4, out_stream,
02110                              (caddr_t) &amp; <a class="code" href="cmd__nfstools_8c.html#a12">LOOKUP3_FAIL_DIRATTR</a>(p_lkup3res) ) == FALSE )
02111         {
02112           <span class="keywordflow">return</span> FALSE;
02113         }    
02114       }
02115       
02116       fprintf(out_stream, <span class="stringliteral">"%*s}\n"</span>,indent, <span class="stringliteral">" "</span>);
02117       
02118       <span class="keywordflow">return</span> TRUE;
02119       
02120       <span class="keywordflow">break</span>;
02121       
02122     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
02123       <span class="comment">/* never encoded */</span>
02124     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
02125       <span class="comment">/* it is never an input (never encoded, never allocated) */</span>
02126     <span class="keywordflow">default</span>:
02127       <span class="keywordflow">return</span> FALSE;
02128   }
02129   
02130 }
02131 
02132 
02133 <span class="preprocessor">#undef LOOKUP3_OK_HANDLE</span>
02134 <span class="preprocessor"></span><span class="preprocessor">#undef LOOKUP3_OK_OBJATTR</span>
02135 <span class="preprocessor"></span><span class="preprocessor">#undef LOOKUP3_OK_DIRATTR</span>
02136 <span class="preprocessor"></span><span class="preprocessor">#undef LOOKUP3_FAIL_DIRATTR</span>
02137 <span class="preprocessor"></span>
02138 
02139 
02140 <span class="keyword">static</span> <span class="keywordtype">int</span> cmdnfs_verf3(
02141       cmdnfs_encodetype_t     encodeflag,
02142       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
02143       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
02144       caddr_t     p_nfs_struct,
02145       <span class="keywordtype">char</span> * verfname <span class="comment">/* name to be printed for the verifier (DECODE mode only) */</span>
02146     )
02147 {
02148   <span class="comment">/* pointer to an opaque buff */</span>
02149   caddr_t p_verf = p_nfs_struct ;
02150   
02151   <span class="keywordtype">char</span> * str_verf;
02152   <span class="keywordtype">char</span> str_printverf[ 17 ];
02153   <span class="keywordtype">int</span> rc;
02154   
02155   <span class="comment">/* sanity check */</span>
02156   <span class="keywordflow">if</span> ( p_verf == NULL ) <span class="keywordflow">return</span> FALSE;
02157   
02158   <span class="keywordflow">switch</span> ( encodeflag )
02159   {
02160     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
02161       
02162       <span class="keywordflow">if</span> ( argc != 1 )  <span class="keywordflow">return</span> FALSE;
02163       
02164       str_verf = argv[0];
02165       
02166       memset( p_verf, 0, 8 );
02167       
02168       rc = sscanmem( p_verf, 8, str_verf );
02169       
02170 <span class="preprocessor">#ifdef _DEBUG_NFS_SHELL</span>
02171 <span class="preprocessor"></span>        fprintf(stderr,<span class="stringliteral">"verf = \"%s\"\n"</span>,str_verf);
02172         fprintf(stderr,<span class="stringliteral">"-&gt; %d bytes read.\n"</span>,rc);
02173         fprintf(stderr,<span class="stringliteral">"buffer=%02X.%02X.%02X.%02X.%02X.%02X.%02X.%02X\n"</span>,
02174                        p_verf[0],p_verf[1],p_verf[2],p_verf[3],
02175                        p_verf[4],p_verf[5],p_verf[6],p_verf[7] );
02176         
02177 <span class="preprocessor">#endif</span>
02178 <span class="preprocessor"></span>              
02179       <span class="comment">/* we must have read at least the verf size */</span>
02180       <span class="keywordflow">if</span> ( rc &lt; 0 ) <span class="keywordflow">return</span> FALSE;
02181       
02182       <span class="keywordflow">return</span> TRUE;
02183       
02184       <span class="keywordflow">break</span>;
02185     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
02186       
02187       <span class="keywordflow">if</span> ( snprintmem( str_printverf, 17, p_verf , 8 )
02188            &lt; 0 )
02189       {
02190         <span class="keywordflow">return</span> FALSE;
02191       }
02192           
02193       fprintf(out_stream, <span class="stringliteral">"%*s%s = %s\n"</span>,indent, <span class="stringliteral">" "</span>, verfname, str_printverf);
02194       
02195       <span class="keywordflow">return</span> TRUE;      
02196       <span class="keywordflow">break</span>;
02197       
02198     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
02199       <span class="comment">/* nothing to do */</span>
02200       <span class="keywordflow">return</span> TRUE;      
02201       <span class="keywordflow">break</span>;
02202       
02203     <span class="keywordflow">default</span>:
02204       <span class="keywordflow">return</span> FALSE;
02205   }
02206 }
02207 
02208 
02209 <span class="keyword">static</span> <span class="keywordtype">int</span> cmdnfs_dirlist3(
02210       cmdnfs_encodetype_t     encodeflag,
02211       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
02212       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
02213       caddr_t     p_nfs_struct
02214     )
02215 {
02216   dirlist3 * p_dirlist3 = ( dirlist3 *) p_nfs_struct ;
02217   
02218   entry3 * p_entry = NULL;
02219   
02220   <span class="comment">/* sanity check */</span>
02221   <span class="keywordflow">if</span> ( p_dirlist3 == NULL ) <span class="keywordflow">return</span> FALSE;
02222 
02223   <span class="keywordflow">switch</span> ( encodeflag )
02224   {
02225     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
02226       
02227       <span class="comment">/* print the list of entries */</span>
02228       p_entry = p_dirlist3-&gt;entries;
02229       
02230       fprintf(out_stream, <span class="stringliteral">"%*sDirEntries:\n"</span>,        indent, <span class="stringliteral">" "</span>);
02231       <span class="keywordflow">while</span> ( p_entry )
02232       {
02233         fprintf(out_stream, <span class="stringliteral">"%*s{\n"</span>,             indent+2, <span class="stringliteral">" "</span>);
02234         fprintf(out_stream, <span class="stringliteral">"%*sfileid = %#llx\n"</span>,indent+4, <span class="stringliteral">" "</span>,p_entry-&gt;fileid );
02235         fprintf(out_stream, <span class="stringliteral">"%*sname = %s\n"</span>,     indent+4, <span class="stringliteral">" "</span>,p_entry-&gt;name );
02236         fprintf(out_stream, <span class="stringliteral">"%*scookie = %llu\n"</span>, indent+4, <span class="stringliteral">" "</span>,p_entry-&gt;cookie );            
02237         fprintf(out_stream, <span class="stringliteral">"%*s}\n"</span>,             indent+2, <span class="stringliteral">" "</span>);
02238         
02239         p_entry = p_entry-&gt;nextentry;
02240       }
02241       
02242       <span class="comment">/* prinf the eof boolean */</span>
02243       
02244       <span class="keywordflow">if</span> ( p_dirlist3-&gt;eof )
02245         fprintf(out_stream, <span class="stringliteral">"%*seof = TRUE\n"</span>,indent, <span class="stringliteral">" "</span>);
02246       <span class="keywordflow">else</span>
02247         fprintf(out_stream, <span class="stringliteral">"%*seof = FALSE\n"</span>,indent, <span class="stringliteral">" "</span>);
02248                   
02249       <span class="keywordflow">return</span> TRUE;
02250       <span class="keywordflow">break</span>;
02251       
02252     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
02253       <span class="comment">/* never encoded */</span>
02254     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
02255       <span class="comment">/* it is never an input (never encoded, never allocated) */</span>
02256     <span class="keywordflow">default</span>:
02257       <span class="keywordflow">return</span> FALSE;
02258   }
02259 }
02260 
02261 
<a name="l02262"></a><a class="code" href="cmd__nfstools_8h.html#a42">02262</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a42">cmdnfs_READDIR3args</a>(
02263       cmdnfs_encodetype_t     encodeflag,
02264       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
02265       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
02266       caddr_t     p_nfs_struct
02267     )
02268 {
02269   READDIR3args * p_rd3arg = ( READDIR3args *) p_nfs_struct ;
02270   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> tmp64;
02271   <span class="keywordtype">int</span> rc;
02272       
02273   <span class="comment">/* sanity check */</span>
02274   <span class="keywordflow">if</span> ( p_rd3arg == NULL ) <span class="keywordflow">return</span> FALSE;
02275   
02276   
02277   <span class="keywordflow">switch</span> ( encodeflag )
02278   {
02279     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
02280       
02281       <span class="keywordflow">if</span> (argc != 4) <span class="keywordflow">return</span> FALSE;
02282       
02283       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a22">cmdnfs_fhandle3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>, 1, argv , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
02284                             (caddr_t) &amp;(p_rd3arg-&gt;dir) ) == FALSE )
02285       {
02286 <span class="preprocessor">#ifdef _DEBUG_NFS_SHELL        </span>
02287 <span class="preprocessor"></span>        fprintf(stderr,<span class="stringliteral">"dir_handle error.\n"</span>);
02288 <span class="preprocessor">#endif</span>
02289 <span class="preprocessor"></span>        <span class="keywordflow">return</span> FALSE;
02290       }
02291       
02292       rc = <a class="code" href="cmd__tools_8h.html#a12">ato64</a>( argv[1], &amp;tmp64 );
02293       <span class="keywordflow">if</span> ( rc ){
02294 <span class="preprocessor">#ifdef _DEBUG_NFS_SHELL</span>
02295 <span class="preprocessor"></span>        fprintf(stderr,<span class="stringliteral">"cookie error.\n"</span>);        
02296 <span class="preprocessor">#endif        </span>
02297 <span class="preprocessor"></span>        <span class="keywordflow">return</span> FALSE;
02298       }
02299       p_rd3arg-&gt;cookie = tmp64;
02300       
02301 <span class="preprocessor">#ifdef _DEBUG_NFS_SHELL</span>
02302 <span class="preprocessor"></span>        fprintf(stderr,<span class="stringliteral">"cookie = %llu.\n"</span>,tmp64);
02303 <span class="preprocessor">#endif        </span>
02304 <span class="preprocessor"></span>      
02305       <span class="keywordflow">if</span> ( cmdnfs_verf3( <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>, 1, argv+2 , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
02306                          (caddr_t) &amp;(p_rd3arg-&gt;cookieverf),<a class="code" href="Getopt_8c.html#a0">NULL</a> ) == FALSE )
02307       {
02308 <span class="preprocessor">#ifdef _DEBUG_NFS_SHELL</span>
02309 <span class="preprocessor"></span>        fprintf(stderr,<span class="stringliteral">"cookieverf error.\n"</span>);        
02310 <span class="preprocessor">#endif        </span>
02311 <span class="preprocessor"></span>        <span class="keywordflow">return</span> FALSE;
02312       }
02313       
02314       rc = <a class="code" href="cmd__tools_8h.html#a12">ato64</a>( argv[3], &amp;tmp64 );
02315       <span class="keywordflow">if</span> ( rc ){
02316 <span class="preprocessor">#ifdef _DEBUG_NFS_SHELL</span>
02317 <span class="preprocessor"></span>        fprintf(stderr,<span class="stringliteral">"count error (not a number).\n"</span>);
02318 <span class="preprocessor">#endif                </span>
02319 <span class="preprocessor"></span>        <span class="keywordflow">return</span> FALSE;
02320       }
02321       <span class="keywordflow">if</span> ( tmp64 &gt; (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> long) UINT_MAX ){
02322 <span class="preprocessor">#ifdef _DEBUG_NFS_SHELL</span>
02323 <span class="preprocessor"></span>        fprintf(stderr,<span class="stringliteral">"count error (number too big).\n"</span>);
02324 <span class="preprocessor">#endif                        </span>
02325 <span class="preprocessor"></span>        <span class="keywordflow">return</span> FALSE;
02326       }
02327       
02328       p_rd3arg-&gt;count = (<span class="keywordtype">unsigned</span> int) tmp64;
02329 <span class="preprocessor">#ifdef _DEBUG_NFS_SHELL</span>
02330 <span class="preprocessor"></span>      fprintf(stderr,<span class="stringliteral">"count = %u\n"</span>,p_rd3arg-&gt;count);
02331 <span class="preprocessor">#endif                        </span>
02332 <span class="preprocessor"></span>            
02333       <span class="keywordflow">return</span> TRUE;
02334       
02335     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
02336       
02337       <a class="code" href="cmd__nfstools_8h.html#a22">cmdnfs_fhandle3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a> , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
02338                        (caddr_t) &amp;(p_rd3arg-&gt;dir) );
02339       
02340       <span class="keywordflow">break</span>;
02341       
02342     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
02343       <span class="comment">/* never decoded */</span>
02344     <span class="keywordflow">default</span>:
02345       <span class="keywordflow">return</span> FALSE;
02346   }
02347 }
02348 
02349 
<a name="l02350"></a><a class="code" href="cmd__nfstools_8c.html#a13">02350</a> <span class="preprocessor">#define READDIR3_OK( _p_READDIR3res ) ( (_p_READDIR3res)-&gt;READDIR3res_u.resok )</span>
<a name="l02351"></a><a class="code" href="cmd__nfstools_8c.html#a14">02351</a> <span class="preprocessor"></span><span class="preprocessor">#define READDIR3_FAIL( _p_READDIR3res ) ( (_p_READDIR3res)-&gt;READDIR3res_u.resfail )</span>
02352 <span class="preprocessor"></span>
<a name="l02353"></a><a class="code" href="cmd__nfstools_8h.html#a43">02353</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a43">cmdnfs_READDIR3res</a>(
02354       cmdnfs_encodetype_t     encodeflag,
02355       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
02356       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
02357       caddr_t     p_nfs_struct
02358     )
02359 {
02360   READDIR3res * p_rd3res = ( READDIR3res *) p_nfs_struct ;
02361       
02362   <span class="comment">/* sanity check */</span>
02363   <span class="keywordflow">if</span> ( p_rd3res == NULL ) <span class="keywordflow">return</span> FALSE;
02364 
02365    <span class="keywordflow">switch</span> ( encodeflag )
02366   {
02367     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
02368             
02369       fprintf(out_stream, <span class="stringliteral">"%*sREADDIR3res =\n"</span>,indent, <span class="stringliteral">" "</span>);
02370       fprintf(out_stream, <span class="stringliteral">"%*s{\n"</span>,indent, <span class="stringliteral">" "</span>);
02371       
02372       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a34">cmdnfs_nfsstat3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+2, out_stream,
02373                             (caddr_t) &amp;p_rd3res-&gt;status ) == FALSE )
02374       {
02375         <span class="keywordflow">return</span> FALSE;
02376       }
02377 
02378       <span class="keywordflow">if</span> ( p_rd3res-&gt;status == NFS3_OK )
02379       {
02380         fprintf(out_stream, <span class="stringliteral">"%*sPost-op attributes (directory):\n"</span>,indent+2, <span class="stringliteral">" "</span>);
02381         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a38">cmdnfs_postopattr</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+4, out_stream,
02382                              (caddr_t) &amp;(<a class="code" href="cmd__nfstools_8c.html#a13">READDIR3_OK</a>(p_rd3res).dir_attributes) ) == FALSE )
02383         {
02384           <span class="keywordflow">return</span> FALSE;
02385         }
02386         <span class="keywordflow">if</span> ( cmdnfs_verf3( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+2, out_stream,
02387                              (caddr_t) &amp;(<a class="code" href="cmd__nfstools_8c.html#a13">READDIR3_OK</a>(p_rd3res).cookieverf), <span class="stringliteral">"cookieverf"</span> ) == FALSE )
02388         {
02389           <span class="keywordflow">return</span> FALSE;
02390         }
02391         
02392         <span class="keywordflow">if</span> ( cmdnfs_dirlist3( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+2, out_stream,
02393                              (caddr_t) &amp;(<a class="code" href="cmd__nfstools_8c.html#a13">READDIR3_OK</a>(p_rd3res).reply) ) == FALSE )
02394         {
02395           <span class="keywordflow">return</span> FALSE;
02396         }
02397         
02398         
02399       }
02400       <span class="keywordflow">else</span>
02401       {
02402         fprintf(out_stream, <span class="stringliteral">"%*sPost-op attributes (directory):\n"</span>,indent+2, <span class="stringliteral">" "</span>);
02403         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a38">cmdnfs_postopattr</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+4, out_stream,
02404                              (caddr_t) &amp;(<a class="code" href="cmd__nfstools_8c.html#a14">READDIR3_FAIL</a>(p_rd3res).dir_attributes) ) == FALSE )
02405         {
02406           <span class="keywordflow">return</span> FALSE;
02407         }    
02408       }
02409       
02410       fprintf(out_stream, <span class="stringliteral">"%*s}\n"</span>,indent, <span class="stringliteral">" "</span>);
02411       
02412       <span class="keywordflow">return</span> TRUE;
02413       
02414       <span class="keywordflow">break</span>;
02415       
02416     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
02417       <span class="comment">/* never encoded */</span>
02418     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
02419       <span class="comment">/* it is never an input (never encoded, never allocated) */</span>
02420     <span class="keywordflow">default</span>:
02421       <span class="keywordflow">return</span> FALSE;
02422   }
02423 }
02424 <span class="preprocessor">#undef READDIR3_OK</span>
02425 <span class="preprocessor"></span><span class="preprocessor">#undef READDIR3_FAIL</span>
02426 <span class="preprocessor"></span>
02427 
02428 
<a name="l02429"></a><a class="code" href="cmd__nfstools_8h.html#a44">02429</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a44">cmdnfs_READDIRPLUS3args</a>(
02430       cmdnfs_encodetype_t     encodeflag,
02431       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
02432       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
02433       caddr_t     p_nfs_struct
02434     )
02435 {
02436   READDIRPLUS3args * p_rdp3arg = ( READDIRPLUS3args *) p_nfs_struct ;
02437   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> tmp64;
02438   <span class="keywordtype">int</span> rc;
02439       
02440   <span class="comment">/* sanity check */</span>
02441   <span class="keywordflow">if</span> ( p_rdp3arg == NULL ) <span class="keywordflow">return</span> FALSE;
02442   
02443   
02444   <span class="keywordflow">switch</span> ( encodeflag )
02445   {
02446     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
02447       
02448       <span class="keywordflow">if</span> (argc != 5) <span class="keywordflow">return</span> FALSE;
02449       
02450       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a22">cmdnfs_fhandle3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>, 1, argv , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
02451                             (caddr_t) &amp;(p_rdp3arg-&gt;dir) ) == FALSE )
02452       {
02453 <span class="preprocessor">#ifdef _DEBUG_NFS_SHELL        </span>
02454 <span class="preprocessor"></span>        fprintf(stderr,<span class="stringliteral">"dir_handle error.\n"</span>);
02455 <span class="preprocessor">#endif</span>
02456 <span class="preprocessor"></span>        <span class="keywordflow">return</span> FALSE;
02457       }
02458       
02459       rc = <a class="code" href="cmd__tools_8h.html#a12">ato64</a>( argv[1], &amp;tmp64 );
02460       <span class="keywordflow">if</span> ( rc ){
02461 <span class="preprocessor">#ifdef _DEBUG_NFS_SHELL</span>
02462 <span class="preprocessor"></span>        fprintf(stderr,<span class="stringliteral">"cookie error.\n"</span>);        
02463 <span class="preprocessor">#endif        </span>
02464 <span class="preprocessor"></span>        <span class="keywordflow">return</span> FALSE;
02465       }
02466       p_rdp3arg-&gt;cookie = tmp64;
02467       
02468 <span class="preprocessor">#ifdef _DEBUG_NFS_SHELL</span>
02469 <span class="preprocessor"></span>        fprintf(stderr,<span class="stringliteral">"cookie = %llu.\n"</span>,tmp64);
02470 <span class="preprocessor">#endif        </span>
02471 <span class="preprocessor"></span>      
02472       <span class="keywordflow">if</span> ( cmdnfs_verf3( <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>, 1, argv+2 , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
02473                          (caddr_t) &amp;(p_rdp3arg-&gt;cookieverf),<a class="code" href="Getopt_8c.html#a0">NULL</a> ) == FALSE )
02474       {
02475 <span class="preprocessor">#ifdef _DEBUG_NFS_SHELL</span>
02476 <span class="preprocessor"></span>        fprintf(stderr,<span class="stringliteral">"cookieverf error.\n"</span>);        
02477 <span class="preprocessor">#endif        </span>
02478 <span class="preprocessor"></span>        <span class="keywordflow">return</span> FALSE;
02479       }
02480       
02481       rc = <a class="code" href="cmd__tools_8h.html#a12">ato64</a>( argv[3], &amp;tmp64 );
02482       <span class="keywordflow">if</span> ( rc ){
02483 <span class="preprocessor">#ifdef _DEBUG_NFS_SHELL</span>
02484 <span class="preprocessor"></span>        fprintf(stderr,<span class="stringliteral">"dircount error (not a number).\n"</span>);
02485 <span class="preprocessor">#endif                </span>
02486 <span class="preprocessor"></span>        <span class="keywordflow">return</span> FALSE;
02487       }
02488       <span class="keywordflow">if</span> ( tmp64 &gt; (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> long) UINT_MAX ){
02489 <span class="preprocessor">#ifdef _DEBUG_NFS_SHELL</span>
02490 <span class="preprocessor"></span>        fprintf(stderr,<span class="stringliteral">"dircount error (number too big).\n"</span>);
02491 <span class="preprocessor">#endif                        </span>
02492 <span class="preprocessor"></span>        <span class="keywordflow">return</span> FALSE;
02493       }
02494       
02495       p_rdp3arg-&gt;dircount = (<span class="keywordtype">unsigned</span> int) tmp64;
02496 <span class="preprocessor">#ifdef _DEBUG_NFS_SHELL</span>
02497 <span class="preprocessor"></span>      fprintf(stderr,<span class="stringliteral">"dircount = %u\n"</span>,p_rdp3arg-&gt;dircount);
02498 <span class="preprocessor">#endif</span>
02499 <span class="preprocessor"></span>
02500       rc = <a class="code" href="cmd__tools_8h.html#a12">ato64</a>( argv[4], &amp;tmp64 );
02501       <span class="keywordflow">if</span> ( rc ){
02502 <span class="preprocessor">#ifdef _DEBUG_NFS_SHELL</span>
02503 <span class="preprocessor"></span>        fprintf(stderr,<span class="stringliteral">"maxcount error (not a number).\n"</span>);
02504 <span class="preprocessor">#endif                </span>
02505 <span class="preprocessor"></span>        <span class="keywordflow">return</span> FALSE;
02506       }
02507       <span class="keywordflow">if</span> ( tmp64 &gt; (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> long) UINT_MAX ){
02508 <span class="preprocessor">#ifdef _DEBUG_NFS_SHELL</span>
02509 <span class="preprocessor"></span>        fprintf(stderr,<span class="stringliteral">"maxcount error (number too big).\n"</span>);
02510 <span class="preprocessor">#endif                        </span>
02511 <span class="preprocessor"></span>        <span class="keywordflow">return</span> FALSE;
02512       }
02513       
02514       p_rdp3arg-&gt;maxcount = (<span class="keywordtype">unsigned</span> int) tmp64;
02515 <span class="preprocessor">#ifdef _DEBUG_NFS_SHELL</span>
02516 <span class="preprocessor"></span>      fprintf(stderr,<span class="stringliteral">"maxcount = %u\n"</span>,p_rdp3arg-&gt;maxcount);
02517 <span class="preprocessor">#endif</span>
02518 <span class="preprocessor"></span>      
02519       
02520       <span class="keywordflow">return</span> TRUE;
02521       
02522     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
02523       
02524       <a class="code" href="cmd__nfstools_8h.html#a22">cmdnfs_fhandle3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a> , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
02525                        (caddr_t) &amp;(p_rdp3arg-&gt;dir) );
02526       
02527       <span class="keywordflow">break</span>;
02528       
02529     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
02530       <span class="comment">/* never decoded */</span>
02531     <span class="keywordflow">default</span>:
02532       <span class="keywordflow">return</span> FALSE;
02533   }
02534 }
02535 
02536 
02537 <span class="keyword">static</span> <span class="keywordtype">int</span> cmdnfs_dirlistplus3(
02538       cmdnfs_encodetype_t     encodeflag,
02539       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
02540       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
02541       caddr_t     p_nfs_struct
02542     )
02543 {
02544   dirlistplus3 * p_dirlistplus3 = ( dirlistplus3 *) p_nfs_struct ;
02545   
02546   entryplus3 * p_entry = NULL;
02547   
02548   <span class="comment">/* sanity check */</span>
02549   <span class="keywordflow">if</span> ( p_dirlistplus3 == NULL ) <span class="keywordflow">return</span> FALSE;
02550 
02551   <span class="keywordflow">switch</span> ( encodeflag )
02552   {
02553     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
02554       
02555       <span class="comment">/* print the list of entries */</span>
02556       p_entry = p_dirlistplus3-&gt;entries;
02557       
02558       fprintf(out_stream, <span class="stringliteral">"%*sDirEntries:\n"</span>,        indent, <span class="stringliteral">" "</span>);
02559       <span class="keywordflow">while</span> ( p_entry )
02560       {
02561         fprintf(out_stream, <span class="stringliteral">"%*s{\n"</span>,             indent+2, <span class="stringliteral">" "</span>);
02562         fprintf(out_stream, <span class="stringliteral">"%*sfileid = %#llx\n"</span>,indent+4, <span class="stringliteral">" "</span>,p_entry-&gt;fileid );
02563         fprintf(out_stream, <span class="stringliteral">"%*sname = %s\n"</span>,     indent+4, <span class="stringliteral">" "</span>,p_entry-&gt;name );
02564         fprintf(out_stream, <span class="stringliteral">"%*scookie = %llu\n"</span>, indent+4, <span class="stringliteral">" "</span>,p_entry-&gt;cookie );
02565         
02566         fprintf(out_stream, <span class="stringliteral">"%*sPost-op attributes:\n"</span>, indent+4, <span class="stringliteral">" "</span>);
02567         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a38">cmdnfs_postopattr</a>( CMDNFS_DECODE, 0, NULL, indent+6, out_stream,
02568                              (caddr_t) &amp;(p_entry-&gt;name_attributes) ) == FALSE )
02569         {
02570           <span class="keywordflow">return</span> FALSE;
02571         }
02572         
02573         fprintf(out_stream, <span class="stringliteral">"%*sPost-op handle:\n"</span>,     indent+4, <span class="stringliteral">" "</span>);
02574         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a39">cmdnfs_postopfh3</a>( CMDNFS_DECODE, 0, NULL, indent+6, out_stream,
02575                              (caddr_t) &amp;(p_entry-&gt;name_handle) ) == FALSE )
02576         {
02577           <span class="keywordflow">return</span> FALSE;
02578         }
02579          
02580         fprintf(out_stream, <span class="stringliteral">"%*s}\n"</span>,             indent+2, <span class="stringliteral">" "</span>);
02581         
02582         p_entry = p_entry-&gt;nextentry;
02583       }
02584       
02585       <span class="comment">/* prinf the eof boolean */</span>
02586       
02587       <span class="keywordflow">if</span> ( p_dirlistplus3-&gt;eof )
02588         fprintf(out_stream, <span class="stringliteral">"%*seof = TRUE\n"</span>,indent, <span class="stringliteral">" "</span>);
02589       <span class="keywordflow">else</span>
02590         fprintf(out_stream, <span class="stringliteral">"%*seof = FALSE\n"</span>,indent, <span class="stringliteral">" "</span>);
02591                   
02592       <span class="keywordflow">return</span> TRUE;
02593       <span class="keywordflow">break</span>;
02594       
02595     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
02596       <span class="comment">/* never encoded */</span>
02597     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
02598       <span class="comment">/* it is never an input (never encoded, never allocated) */</span>
02599     <span class="keywordflow">default</span>:
02600       <span class="keywordflow">return</span> FALSE;
02601   }
02602 }
02603 
02604 
02605 
02606 
<a name="l02607"></a><a class="code" href="cmd__nfstools_8c.html#a15">02607</a> <span class="preprocessor">#define READDIRPLUS3_OK( _p_READDIRPLUS3res ) ( (_p_READDIRPLUS3res)-&gt;READDIRPLUS3res_u.resok )</span>
<a name="l02608"></a><a class="code" href="cmd__nfstools_8c.html#a16">02608</a> <span class="preprocessor"></span><span class="preprocessor">#define READDIRPLUS3_FAIL( _p_READDIRPLUS3res ) ( (_p_READDIRPLUS3res)-&gt;READDIRPLUS3res_u.resfail )</span>
02609 <span class="preprocessor"></span>
<a name="l02610"></a><a class="code" href="cmd__nfstools_8h.html#a45">02610</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a45">cmdnfs_READDIRPLUS3res</a>(
02611       cmdnfs_encodetype_t     encodeflag,
02612       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
02613       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
02614       caddr_t     p_nfs_struct
02615     )
02616 {
02617   READDIRPLUS3res * p_rdp3res = ( READDIRPLUS3res *) p_nfs_struct ;
02618       
02619   <span class="comment">/* sanity check */</span>
02620   <span class="keywordflow">if</span> ( p_rdp3res == NULL ) <span class="keywordflow">return</span> FALSE;
02621 
02622    <span class="keywordflow">switch</span> ( encodeflag )
02623   {
02624     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
02625             
02626       fprintf(out_stream, <span class="stringliteral">"%*sREADDIRPLUS3res =\n"</span>,indent, <span class="stringliteral">" "</span>);
02627       fprintf(out_stream, <span class="stringliteral">"%*s{\n"</span>,indent, <span class="stringliteral">" "</span>);
02628       
02629       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a34">cmdnfs_nfsstat3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+2, out_stream,
02630                             (caddr_t) &amp;p_rdp3res-&gt;status ) == FALSE )
02631       {
02632         <span class="keywordflow">return</span> FALSE;
02633       }
02634 
02635       <span class="keywordflow">if</span> ( p_rdp3res-&gt;status == NFS3_OK )
02636       {
02637         fprintf(out_stream, <span class="stringliteral">"%*sPost-op attributes (directory):\n"</span>,indent+2, <span class="stringliteral">" "</span>);
02638         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a38">cmdnfs_postopattr</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+4, out_stream,
02639                              (caddr_t) &amp;(<a class="code" href="cmd__nfstools_8c.html#a15">READDIRPLUS3_OK</a>(p_rdp3res).dir_attributes) ) == FALSE )
02640         {
02641           <span class="keywordflow">return</span> FALSE;
02642         }
02643         <span class="keywordflow">if</span> ( cmdnfs_verf3( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+2, out_stream,
02644                              (caddr_t) &amp;(<a class="code" href="cmd__nfstools_8c.html#a15">READDIRPLUS3_OK</a>(p_rdp3res).cookieverf), <span class="stringliteral">"cookieverf"</span> ) == FALSE )
02645         {
02646           <span class="keywordflow">return</span> FALSE;
02647         }
02648         
02649         <span class="keywordflow">if</span> ( cmdnfs_dirlistplus3( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+2, out_stream,
02650                                   (caddr_t) &amp;(<a class="code" href="cmd__nfstools_8c.html#a15">READDIRPLUS3_OK</a>(p_rdp3res).reply) ) == FALSE )
02651         {
02652           <span class="keywordflow">return</span> FALSE;
02653         }
02654         
02655         
02656       }
02657       <span class="keywordflow">else</span>
02658       {
02659         fprintf(out_stream, <span class="stringliteral">"%*sPost-op attributes (directory):\n"</span>,indent+2, <span class="stringliteral">" "</span>);
02660         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a38">cmdnfs_postopattr</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+4, out_stream,
02661                              (caddr_t) &amp;(<a class="code" href="cmd__nfstools_8c.html#a16">READDIRPLUS3_FAIL</a>(p_rdp3res).dir_attributes) ) == FALSE )
02662         {
02663           <span class="keywordflow">return</span> FALSE;
02664         }    
02665       }
02666       
02667       fprintf(out_stream, <span class="stringliteral">"%*s}\n"</span>,indent, <span class="stringliteral">" "</span>);
02668       
02669       <span class="keywordflow">return</span> TRUE;
02670       
02671       <span class="keywordflow">break</span>;
02672       
02673     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
02674       <span class="comment">/* never encoded */</span>
02675     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
02676       <span class="comment">/* it is never an input (never encoded, never allocated) */</span>
02677     <span class="keywordflow">default</span>:
02678       <span class="keywordflow">return</span> FALSE;
02679   }
02680 }
02681 <span class="preprocessor">#undef READDIRPLUS3_OK</span>
02682 <span class="preprocessor"></span><span class="preprocessor">#undef READDIRPLUS3_FAIL</span>
02683 <span class="preprocessor"></span>
02684 
02685 
<a name="l02686"></a><a class="code" href="cmd__nfstools_8c.html#a17">02686</a> <span class="preprocessor">#define READLINK3_OK_ATTRS( _p_READLINK3res ) ( (_p_READLINK3res)-&gt;READLINK3res_u.resok.symlink_attributes )</span>
<a name="l02687"></a><a class="code" href="cmd__nfstools_8c.html#a18">02687</a> <span class="preprocessor"></span><span class="preprocessor">#define READLINK3_OK_DATA( _p_READLINK3res ) ( (_p_READLINK3res)-&gt;READLINK3res_u.resok.data )</span>
<a name="l02688"></a><a class="code" href="cmd__nfstools_8c.html#a19">02688</a> <span class="preprocessor"></span><span class="preprocessor">#define READLINK3_FAIL_ATTRS( _p_READLINK3res ) ( (_p_READLINK3res)-&gt;READLINK3res_u.resfail.symlink_attributes )</span>
02689 <span class="preprocessor"></span>
<a name="l02690"></a><a class="code" href="cmd__nfstools_8h.html#a46">02690</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a46">cmdnfs_READLINK3res</a>(
02691       cmdnfs_encodetype_t     encodeflag,
02692       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
02693       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
02694       caddr_t     p_nfs_struct
02695     )
02696 {
02697   READLINK3res * p_readlnk3res = ( READLINK3res *) p_nfs_struct ;
02698       
02699   <span class="comment">/* sanity check */</span>
02700   <span class="keywordflow">if</span> ( p_readlnk3res == NULL ) <span class="keywordflow">return</span> FALSE;
02701   
02702   <span class="keywordflow">switch</span> ( encodeflag )
02703   {
02704     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
02705             
02706       fprintf(out_stream, <span class="stringliteral">"%*sREADLINK3res =\n"</span>,indent, <span class="stringliteral">" "</span>);
02707       fprintf(out_stream, <span class="stringliteral">"%*s{\n"</span>,indent, <span class="stringliteral">" "</span>);
02708       
02709       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a34">cmdnfs_nfsstat3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+2, out_stream,
02710                             (caddr_t) &amp;p_readlnk3res-&gt;status ) == FALSE )
02711       {
02712         <span class="keywordflow">return</span> FALSE;
02713       }
02714 
02715       <span class="keywordflow">if</span> ( p_readlnk3res-&gt;status == NFS3_OK )
02716       {
02717         
02718         fprintf(out_stream, <span class="stringliteral">"%*sPost-op attributes (symlink):\n"</span>,indent+2, <span class="stringliteral">" "</span>);
02719         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a38">cmdnfs_postopattr</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+4, out_stream,
02720                              (caddr_t) &amp; <a class="code" href="cmd__nfstools_8c.html#a17">READLINK3_OK_ATTRS</a>(p_readlnk3res) ) == FALSE )
02721         {
02722           <span class="keywordflow">return</span> FALSE;
02723         }
02724         
02725         fprintf( out_stream, <span class="stringliteral">"%*sdata = \"%s\"\n"</span>,indent+2, <span class="stringliteral">" "</span>, <a class="code" href="cmd__nfstools_8c.html#a18">READLINK3_OK_DATA</a>( p_readlnk3res ) );
02726       }
02727       <span class="keywordflow">else</span>
02728       {
02729         fprintf(out_stream, <span class="stringliteral">"%*sPost-op attributes (symlink):\n"</span>,indent+2, <span class="stringliteral">" "</span>);
02730         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a38">cmdnfs_postopattr</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+4, out_stream,
02731                              (caddr_t) &amp; <a class="code" href="cmd__nfstools_8c.html#a19">READLINK3_FAIL_ATTRS</a>(p_readlnk3res) ) == FALSE )
02732         {
02733           <span class="keywordflow">return</span> FALSE;
02734         }    
02735       }
02736       
02737       fprintf(out_stream, <span class="stringliteral">"%*s}\n"</span>,indent, <span class="stringliteral">" "</span>);
02738       
02739       <span class="keywordflow">return</span> TRUE;
02740       
02741       <span class="keywordflow">break</span>;
02742       
02743     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
02744       <span class="comment">/* never encoded */</span>
02745     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
02746       <span class="comment">/* it is never an input (never encoded, never allocated) */</span>
02747     <span class="keywordflow">default</span>:
02748       <span class="keywordflow">return</span> FALSE;
02749   }
02750 }
02751 
02752 <span class="preprocessor">#undef READLINK3_OK_ATTRS</span>
02753 <span class="preprocessor"></span><span class="preprocessor">#undef READLINK3_OK_DATA</span>
02754 <span class="preprocessor"></span><span class="preprocessor">#undef READLINK3_FAIL_ATTRS</span>
02755 <span class="preprocessor"></span>
02756 
<a name="l02757"></a><a class="code" href="cmd__nfstools_8c.html#a20">02757</a> <span class="preprocessor">#define FSSTAT3_OK( _p_FSSTAT3res ) ( (_p_FSSTAT3res)-&gt;FSSTAT3res_u.resok )</span>
<a name="l02758"></a><a class="code" href="cmd__nfstools_8c.html#a21">02758</a> <span class="preprocessor"></span><span class="preprocessor">#define FSSTAT3_FAIL_ATTRS( _p_FSSTAT3res ) ( (_p_FSSTAT3res)-&gt;FSSTAT3res_u.resfail.obj_attributes )</span>
02759 <span class="preprocessor"></span>
<a name="l02760"></a><a class="code" href="cmd__nfstools_8h.html#a47">02760</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a47">cmdnfs_FSSTAT3res</a>(
02761       cmdnfs_encodetype_t     encodeflag,
02762       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
02763       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
02764       caddr_t     p_nfs_struct    
02765     )
02766 {
02767     FSSTAT3res * p_fsstat3res = ( FSSTAT3res *) p_nfs_struct ;
02768       
02769   <span class="comment">/* sanity check */</span>
02770   <span class="keywordflow">if</span> ( p_fsstat3res == NULL ) <span class="keywordflow">return</span> FALSE;
02771   
02772   <span class="keywordflow">switch</span> ( encodeflag )
02773   {
02774     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
02775             
02776       fprintf(out_stream, <span class="stringliteral">"%*sFSSTAT3res =\n"</span>,indent, <span class="stringliteral">" "</span>);
02777       fprintf(out_stream, <span class="stringliteral">"%*s{\n"</span>,indent, <span class="stringliteral">" "</span>);
02778       
02779       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a34">cmdnfs_nfsstat3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+2, out_stream,
02780                             (caddr_t) &amp;p_fsstat3res-&gt;status ) == FALSE )
02781       {
02782         <span class="keywordflow">return</span> FALSE;
02783       }
02784 
02785       <span class="keywordflow">if</span> ( p_fsstat3res-&gt;status == NFS3_OK )
02786       {
02787         
02788         fprintf(out_stream, <span class="stringliteral">"%*sPost-op attributes (symlink):\n"</span>,indent+2, <span class="stringliteral">" "</span>);
02789         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a38">cmdnfs_postopattr</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+4, out_stream,
02790                              (caddr_t) &amp;(<a class="code" href="cmd__nfstools_8c.html#a20">FSSTAT3_OK</a>(p_fsstat3res).obj_attributes) ) == FALSE )
02791         {
02792           <span class="keywordflow">return</span> FALSE;
02793         }
02794         fprintf(out_stream, <span class="stringliteral">"%*stotal_bytes = %llu\n"</span>,indent+2, <span class="stringliteral">" "</span>,<a class="code" href="cmd__nfstools_8c.html#a20">FSSTAT3_OK</a>(p_fsstat3res).tbytes);
02795         fprintf(out_stream, <span class="stringliteral">"%*sfree_bytes = %llu\n"</span>,indent+2, <span class="stringliteral">" "</span>,<a class="code" href="cmd__nfstools_8c.html#a20">FSSTAT3_OK</a>(p_fsstat3res).fbytes);
02796         fprintf(out_stream, <span class="stringliteral">"%*savail_bytes = %llu\n"</span>,indent+2, <span class="stringliteral">" "</span>,<a class="code" href="cmd__nfstools_8c.html#a20">FSSTAT3_OK</a>(p_fsstat3res).abytes);
02797         fprintf(out_stream, <span class="stringliteral">"%*stotal_files = %llu\n"</span>,indent+2, <span class="stringliteral">" "</span>,<a class="code" href="cmd__nfstools_8c.html#a20">FSSTAT3_OK</a>(p_fsstat3res).tfiles);
02798         fprintf(out_stream, <span class="stringliteral">"%*sfree_files = %llu\n"</span>,indent+2, <span class="stringliteral">" "</span>,<a class="code" href="cmd__nfstools_8c.html#a20">FSSTAT3_OK</a>(p_fsstat3res).ffiles);
02799         fprintf(out_stream, <span class="stringliteral">"%*savail_files = %llu\n"</span>,indent+2, <span class="stringliteral">" "</span>,<a class="code" href="cmd__nfstools_8c.html#a20">FSSTAT3_OK</a>(p_fsstat3res).afiles);
02800         fprintf(out_stream, <span class="stringliteral">"%*sinvar_sec = %u\n"</span>,indent+2, <span class="stringliteral">" "</span>,<a class="code" href="cmd__nfstools_8c.html#a20">FSSTAT3_OK</a>(p_fsstat3res).invarsec);
02801         
02802       }
02803       <span class="keywordflow">else</span>
02804       {
02805         fprintf(out_stream, <span class="stringliteral">"%*sPost-op attributes (object):\n"</span>,indent+2, <span class="stringliteral">" "</span>);
02806         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a38">cmdnfs_postopattr</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+4, out_stream,
02807                              (caddr_t) &amp; <a class="code" href="cmd__nfstools_8c.html#a21">FSSTAT3_FAIL_ATTRS</a>(p_fsstat3res) ) == FALSE )
02808         {
02809           <span class="keywordflow">return</span> FALSE;
02810         }    
02811       }
02812       
02813       fprintf(out_stream, <span class="stringliteral">"%*s}\n"</span>,indent, <span class="stringliteral">" "</span>);
02814       
02815       <span class="keywordflow">return</span> TRUE;
02816       
02817       <span class="keywordflow">break</span>;
02818       
02819     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
02820       <span class="comment">/* never encoded */</span>
02821     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
02822       <span class="comment">/* it is never an input (never encoded, never allocated) */</span>
02823     <span class="keywordflow">default</span>:
02824       <span class="keywordflow">return</span> FALSE;
02825   }
02826 }
02827 
02828 <span class="preprocessor">#undef FSSTAT3_OK</span>
02829 <span class="preprocessor"></span><span class="preprocessor">#undef FSSTAT3_FAIL_ATTRS</span>
02830 <span class="preprocessor"></span>    
02831 
02832 
<a name="l02833"></a><a class="code" href="cmd__nfstools_8h.html#a48">02833</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a48">cmdnfs_ACCESS3args</a>(
02834       cmdnfs_encodetype_t     encodeflag,
02835       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
02836       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
02837       caddr_t     p_nfs_struct    
02838     )
02839 {
02840   ACCESS3args * p_access3args = (  ACCESS3args *) p_nfs_struct ;
02841 
02842   <span class="keywordtype">char</span> * str_access;
02843   <span class="comment">/* sanity check */</span>
02844   <span class="keywordflow">if</span> ( p_access3args == NULL ) <span class="keywordflow">return</span> FALSE;
02845   
02846   <span class="keywordflow">switch</span> ( encodeflag )
02847   {
02848     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
02849       
02850       <span class="keywordflow">if</span> ( argc != 2 ) <span class="keywordflow">return</span> FALSE;
02851       
02852       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a22">cmdnfs_fhandle3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>, 1, argv , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
02853                             (caddr_t) &amp;(p_access3args-&gt;object) ) == FALSE )
02854       {
02855         <span class="keywordflow">return</span> FALSE;
02856       }
02857       
02858       <span class="comment">/* access 2e arg: R(ead) L(ookup) M(odify) E(xtend) D(elete) (e)X(ecute) */</span>
02859       <span class="comment">/* convert a "RLMEDX" string to an NFS access mask. */</span>
02860       
02861       p_access3args-&gt;access = 0;
02862       
02863       str_access = argv[1];
02864       <span class="keywordflow">while</span> ( str_access[0] != <span class="charliteral">'\0'</span> )
02865       {
02866         <span class="keywordflow">if</span> ( (str_access[0] == <span class="charliteral">'r'</span>) || (str_access[0] == <span class="charliteral">'R'</span>) )
02867           p_access3args-&gt;access |= ACCESS3_READ;
02868         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (str_access[0] == <span class="charliteral">'l'</span>) || (str_access[0] == <span class="charliteral">'L'</span>) )
02869           p_access3args-&gt;access |= ACCESS3_LOOKUP;
02870         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (str_access[0] == <span class="charliteral">'m'</span>) || (str_access[0] == <span class="charliteral">'M'</span>) )
02871           p_access3args-&gt;access |= ACCESS3_MODIFY;
02872         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (str_access[0] == <span class="charliteral">'e'</span>) || (str_access[0] == <span class="charliteral">'E'</span>) )
02873           p_access3args-&gt;access |= ACCESS3_EXTEND;
02874         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (str_access[0] == <span class="charliteral">'d'</span>) || (str_access[0] == <span class="charliteral">'D'</span>) )
02875           p_access3args-&gt;access |= ACCESS3_DELETE;
02876         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (str_access[0] == <span class="charliteral">'x'</span>) || (str_access[0] == <span class="charliteral">'X'</span>) )
02877           p_access3args-&gt;access |= ACCESS3_EXECUTE;
02878         <span class="keywordflow">else</span>
02879         {
02880 <span class="preprocessor">#ifdef _DEBUG_NFS_SHELL</span>
02881 <span class="preprocessor"></span>          fprintf(stderr,<span class="stringliteral">"access flag error: unknown flag \"%c\".\n"</span>,str_access[0]);
02882 <span class="preprocessor">#endif</span>
02883 <span class="preprocessor"></span>          <span class="keywordflow">return</span> FALSE;
02884         }
02885         
02886         str_access ++;
02887       }
02888             
02889       <span class="keywordflow">return</span> TRUE;
02890       
02891     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
02892       <a class="code" href="cmd__nfstools_8h.html#a22">cmdnfs_fhandle3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a> , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
02893                             (caddr_t) &amp;(p_access3args-&gt;object) );
02894       <span class="keywordflow">return</span> TRUE;
02895       <span class="keywordflow">break</span>;
02896       
02897     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
02898       <span class="comment">/* never decoded */</span>
02899     <span class="keywordflow">default</span>:
02900       <span class="keywordflow">return</span> FALSE;
02901   } 
02902 }
02903 
02904 
<a name="l02905"></a><a class="code" href="cmd__nfstools_8c.html#a22">02905</a> <span class="preprocessor">#define ACCESS3_OK_ATTRS( _p_ACCESS3res ) ( (_p_ACCESS3res)-&gt;ACCESS3res_u.resok.obj_attributes )</span>
<a name="l02906"></a><a class="code" href="cmd__nfstools_8c.html#a23">02906</a> <span class="preprocessor"></span><span class="preprocessor">#define ACCESS3_OK_ACCESS( _p_ACCESS3res ) ( (_p_ACCESS3res)-&gt;ACCESS3res_u.resok.access )</span>
<a name="l02907"></a><a class="code" href="cmd__nfstools_8c.html#a24">02907</a> <span class="preprocessor"></span><span class="preprocessor">#define ACCESS3_FAIL_ATTRS( _p_ACCESS3res ) ( (_p_ACCESS3res)-&gt;ACCESS3res_u.resfail.obj_attributes )</span>
02908 <span class="preprocessor"></span>
<a name="l02909"></a><a class="code" href="cmd__nfstools_8h.html#a49">02909</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a49">cmdnfs_ACCESS3res</a>(
02910       cmdnfs_encodetype_t     encodeflag,
02911       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
02912       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
02913       caddr_t     p_nfs_struct    
02914     )
02915 {
02916     ACCESS3res * p_access3res = ( ACCESS3res *) p_nfs_struct ;
02917       
02918   <span class="comment">/* sanity check */</span>
02919   <span class="keywordflow">if</span> ( p_access3res == NULL ) <span class="keywordflow">return</span> FALSE;
02920   
02921   <span class="keywordflow">switch</span> ( encodeflag )
02922   {
02923     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
02924             
02925       fprintf(out_stream, <span class="stringliteral">"%*sACCESS3res =\n"</span>,indent, <span class="stringliteral">" "</span>);
02926       fprintf(out_stream, <span class="stringliteral">"%*s{\n"</span>,indent, <span class="stringliteral">" "</span>);
02927       
02928       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a34">cmdnfs_nfsstat3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+2, out_stream,
02929                             (caddr_t) &amp;p_access3res-&gt;status ) == FALSE )
02930       {
02931         <span class="keywordflow">return</span> FALSE;
02932       }
02933 
02934       <span class="keywordflow">if</span> ( p_access3res-&gt;status == NFS3_OK )
02935       {
02936         
02937         fprintf(out_stream, <span class="stringliteral">"%*sPost-op attributes (object):\n"</span>,indent+2, <span class="stringliteral">" "</span>);
02938         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a38">cmdnfs_postopattr</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+4, out_stream,
02939                              (caddr_t) &amp; <a class="code" href="cmd__nfstools_8c.html#a22">ACCESS3_OK_ATTRS</a>(p_access3res) ) == FALSE )
02940         {
02941           <span class="keywordflow">return</span> FALSE;
02942         }
02943         
02944         <span class="comment">/* print acces rights */</span>        
02945         fprintf(out_stream, <span class="stringliteral">"%*saccess ="</span>,indent+2, <span class="stringliteral">" "</span>);
02946         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8c.html#a23">ACCESS3_OK_ACCESS</a>(p_access3res) &amp;  ACCESS3_READ ) 
02947           fprintf(out_stream, <span class="stringliteral">" READ"</span>);
02948         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8c.html#a23">ACCESS3_OK_ACCESS</a>(p_access3res) &amp;  ACCESS3_LOOKUP ) 
02949           fprintf(out_stream, <span class="stringliteral">" LOOKUP"</span>);
02950         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8c.html#a23">ACCESS3_OK_ACCESS</a>(p_access3res) &amp;  ACCESS3_MODIFY ) 
02951           fprintf(out_stream, <span class="stringliteral">" MODIFY"</span>);
02952         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8c.html#a23">ACCESS3_OK_ACCESS</a>(p_access3res) &amp;  ACCESS3_EXTEND ) 
02953           fprintf(out_stream, <span class="stringliteral">" EXTEND"</span>);
02954         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8c.html#a23">ACCESS3_OK_ACCESS</a>(p_access3res) &amp;  ACCESS3_DELETE ) 
02955           fprintf(out_stream, <span class="stringliteral">" DELETE"</span>);
02956         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8c.html#a23">ACCESS3_OK_ACCESS</a>(p_access3res) &amp;  ACCESS3_EXECUTE ) 
02957           fprintf(out_stream, <span class="stringliteral">" EXECUTE"</span>);
02958         fprintf(out_stream, <span class="stringliteral">" (%#.4x)\n"</span>, <a class="code" href="cmd__nfstools_8c.html#a23">ACCESS3_OK_ACCESS</a>(p_access3res));
02959 
02960       }
02961       <span class="keywordflow">else</span>
02962       {
02963         fprintf(out_stream, <span class="stringliteral">"%*sPost-op attributes (object):\n"</span>,indent+2, <span class="stringliteral">" "</span>);
02964         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a38">cmdnfs_postopattr</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+4, out_stream,
02965                              (caddr_t) &amp; <a class="code" href="cmd__nfstools_8c.html#a24">ACCESS3_FAIL_ATTRS</a>(p_access3res) ) == FALSE )
02966         {
02967           <span class="keywordflow">return</span> FALSE;
02968         }    
02969       }
02970       
02971       fprintf(out_stream, <span class="stringliteral">"%*s}\n"</span>,indent, <span class="stringliteral">" "</span>);
02972       
02973       <span class="keywordflow">return</span> TRUE;
02974       
02975       <span class="keywordflow">break</span>;
02976       
02977     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
02978       <span class="comment">/* never encoded */</span>
02979     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
02980       <span class="comment">/* it is never an input (never encoded, never allocated) */</span>
02981     <span class="keywordflow">default</span>:
02982       <span class="keywordflow">return</span> FALSE;
02983   }
02984 }
02985 
02986 <span class="preprocessor">#undef ACCESS3_OK_ATTRS</span>
02987 <span class="preprocessor"></span><span class="preprocessor">#undef ACCESS3_OK_ACCESS</span>
02988 <span class="preprocessor"></span><span class="preprocessor">#undef ACCESS3_FAIL_ATTRS</span>
02989 <span class="preprocessor"></span>
02990 
02991 
02992 
<a name="l02993"></a><a class="code" href="cmd__nfstools_8h.html#a50">02993</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a50">cmdnfs_CREATE3args</a>(
02994       cmdnfs_encodetype_t     encodeflag,
02995       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
02996       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
02997       caddr_t     p_nfs_struct    
02998     )
02999 {
03000   CREATE3args * p_CREATE3args = (  CREATE3args *) p_nfs_struct ;
03001   <span class="keywordtype">char</span> * str_mode;
03002   
03003   <span class="comment">/* sanity check */</span>
03004   <span class="keywordflow">if</span> ( p_CREATE3args == NULL ) <span class="keywordflow">return</span> FALSE;
03005   
03006   <span class="keywordflow">switch</span> ( encodeflag )
03007   {
03008     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
03009       
03010       <span class="keywordflow">if</span> ( (argc != 3) &amp;&amp; (argc != 4) ) <span class="keywordflow">return</span> FALSE;
03011       
03012       <span class="comment">/* The first two args */</span>
03013       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a40">cmdnfs_diropargs3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>, 2, argv , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
03014                             (caddr_t) &amp;(p_CREATE3args-&gt;where) ) == FALSE )
03015       {
03016         <span class="keywordflow">return</span> FALSE;
03017       }
03018       
03019       <span class="comment">/* CREATE 3e arg: UNCHECKED, GUARDED or EXCLUSIVE */</span>
03020       
03021       str_mode = argv[2];
03022       <span class="keywordflow">if</span> (!strcmp( str_mode, <span class="stringliteral">"UNCHECKED"</span> ))
03023         p_CREATE3args-&gt;how.mode = UNCHECKED;
03024       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp( str_mode, <span class="stringliteral">"GUARDED"</span> ))
03025         p_CREATE3args-&gt;how.mode = GUARDED;
03026       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp( str_mode, <span class="stringliteral">"EXCLUSIVE"</span> ))
03027         p_CREATE3args-&gt;how.mode = EXCLUSIVE;
03028       <span class="keywordflow">else</span>
03029         <span class="keywordflow">return</span> FALSE;
03030       
03031       <span class="comment">/* CREATE 4th arg: sattr3 list or a create verifier */</span>
03032       
03033       <span class="keywordflow">switch</span>( p_CREATE3args-&gt;how.mode )
03034       {
03035         <span class="keywordflow">case</span> UNCHECKED:
03036         <span class="keywordflow">case</span> GUARDED:
03037           
03038           <span class="comment">/* The optional 4th arg is a sattr3 list */</span>
03039           <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a36">cmdnfs_sattr3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>, argc -3, argv + 3, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
03040                              (caddr_t)&amp;(p_CREATE3args-&gt;how.createhow3_u.obj_attributes))
03041                              == FALSE )
03042           {
03043             <span class="keywordflow">return</span> FALSE;
03044           }
03045           
03046           <span class="keywordflow">break</span>;
03047         <span class="keywordflow">case</span> EXCLUSIVE:
03048           
03049           <span class="comment">/* The mandatory 4rd arg is a create verifier*/</span>
03050           <span class="keywordflow">if</span> ( cmdnfs_verf3( <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>, argc - 3, argv + 3, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
03051                            (caddr_t)&amp;(p_CREATE3args-&gt;how.createhow3_u.verf),
03052                             <a class="code" href="Getopt_8c.html#a0">NULL</a> ) == FALSE )
03053           {
03054             <span class="keywordflow">return</span> FALSE;
03055           }
03056           
03057           <span class="keywordflow">break</span>;
03058       }
03059        
03060       <span class="keywordflow">return</span> TRUE;
03061       
03062     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
03063       
03064       <a class="code" href="cmd__nfstools_8h.html#a40">cmdnfs_diropargs3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a> , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
03065                             (caddr_t) &amp;(p_CREATE3args-&gt;where) );
03066       
03067       <span class="keywordflow">switch</span>( p_CREATE3args-&gt;how.mode )
03068       {
03069         <span class="keywordflow">case</span> UNCHECKED:
03070         <span class="keywordflow">case</span> GUARDED:
03071         <a class="code" href="cmd__nfstools_8h.html#a36">cmdnfs_sattr3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a> , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
03072                       (caddr_t) &amp;(p_CREATE3args-&gt;how.createhow3_u.obj_attributes) );
03073           <span class="keywordflow">break</span>;
03074         
03075         <span class="keywordflow">case</span> EXCLUSIVE:
03076           cmdnfs_verf3( <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a> , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
03077                       (caddr_t) &amp;(p_CREATE3args-&gt;how.createhow3_u.verf), <a class="code" href="Getopt_8c.html#a0">NULL</a> );
03078         <span class="keywordflow">break</span>;
03079       }
03080       
03081       <span class="keywordflow">return</span> TRUE;
03082       <span class="keywordflow">break</span>;
03083       
03084     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
03085       <span class="comment">/* never decoded */</span>
03086     <span class="keywordflow">default</span>:
03087       <span class="keywordflow">return</span> FALSE;
03088   } 
03089 }
03090 
03091 
<a name="l03092"></a><a class="code" href="cmd__nfstools_8c.html#a101">03092</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8c.html#a101">cmdnfs_preopattr</a>(
03093       cmdnfs_encodetype_t     encodeflag,
03094       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
03095       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
03096       caddr_t     p_nfs_struct
03097     )
03098 {
03099   pre_op_attr * p_opattr = (pre_op_attr *) p_nfs_struct;
03100   wcc_attr * p_wccattr;
03101   <span class="keywordtype">char</span> tmp_buff[256];
03102   <span class="keyword">struct </span>tm paramtm;
03103   <span class="comment">/* sanity check */</span>
03104   <span class="keywordflow">if</span> ( p_opattr == NULL ) <span class="keywordflow">return</span> FALSE;
03105 
03106   <span class="keywordflow">switch</span> ( encodeflag )
03107   {
03108     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
03109             
03110         <span class="keywordflow">if</span> ( p_opattr-&gt;attributes_follow )
03111         {
03112           p_wccattr = &amp;(p_opattr-&gt;pre_op_attr_u.attributes);
03113           
03114           fprintf(out_stream, <span class="stringliteral">"%*s{\n"</span>,indent, <span class="stringliteral">" "</span>);
03115 
03116           fprintf(out_stream, <span class="stringliteral">"%*ssize = %llu\n"</span>,indent+2, <span class="stringliteral">" "</span>,p_wccattr-&gt;size);
03117           
03118           strftime(tmp_buff,256,<span class="stringliteral">"%Y-%m-%d %T"</span>,<a class="code" href="cmd__tools_8h.html#a9">Localtime_r</a>((time_t*)&amp;p_wccattr-&gt;mtime.seconds, &amp;paramtm));
03119           fprintf(out_stream, <span class="stringliteral">"%*smtime = %u.%.9u (%s)\n"</span>,indent+2, <span class="stringliteral">" "</span>,
03120               p_wccattr-&gt;mtime.seconds,p_wccattr-&gt;mtime.nseconds,tmp_buff);
03121 
03122           strftime(tmp_buff,256,<span class="stringliteral">"%Y-%m-%d %T"</span>,<a class="code" href="cmd__tools_8h.html#a9">Localtime_r</a>((time_t*)&amp;p_wccattr-&gt;ctime.seconds, &amp;paramtm));
03123           fprintf(out_stream, <span class="stringliteral">"%*sctime = %u.%.9u (%s)\n"</span>,indent+2, <span class="stringliteral">" "</span>,
03124               p_wccattr-&gt;ctime.seconds,p_wccattr-&gt;ctime.nseconds, tmp_buff);
03125 
03126           fprintf(out_stream, <span class="stringliteral">"%*s}\n"</span>,indent, <span class="stringliteral">" "</span>);
03127         }
03128         <span class="keywordflow">else</span>
03129         {
03130           fprintf(out_stream, <span class="stringliteral">"%*sN/A\n"</span>,indent, <span class="stringliteral">" "</span>);
03131           <span class="keywordflow">return</span> TRUE;
03132         }
03133         
03134       <span class="keywordflow">break</span>;
03135       
03136     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
03137       <span class="comment">/* never encoded */</span>
03138     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
03139       <span class="comment">/* it is never an input (never encoded, never allocated) */</span>
03140     <span class="keywordflow">default</span>:
03141       <span class="keywordflow">return</span> FALSE;
03142   }
03143 }
03144 
03145 
<a name="l03146"></a><a class="code" href="cmd__nfstools_8c.html#a102">03146</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8c.html#a102">cmdnfs_wccdata</a>(
03147       cmdnfs_encodetype_t     encodeflag,
03148       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
03149       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
03150       caddr_t     p_nfs_struct
03151     )
03152 {
03153   wcc_data * p_wccdata = (wcc_data *) p_nfs_struct;
03154   <span class="comment">/* sanity check */</span>
03155   
03156   <span class="keywordflow">if</span> ( p_wccdata == NULL ) <span class="keywordflow">return</span> FALSE;
03157 
03158   <span class="keywordflow">switch</span> ( encodeflag )
03159   {
03160     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
03161             
03162       fprintf(out_stream, <span class="stringliteral">"%*swcc_before:\n"</span>,indent, <span class="stringliteral">" "</span>);
03163       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8c.html#a101">cmdnfs_preopattr</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent, out_stream,
03164                         (caddr_t)&amp;(p_wccdata-&gt;before) ) == FALSE )
03165         <span class="keywordflow">return</span> FALSE;
03166       
03167       fprintf(out_stream, <span class="stringliteral">"%*swcc_after:\n"</span>,indent, <span class="stringliteral">" "</span>);
03168       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a38">cmdnfs_postopattr</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent, out_stream,
03169                         (caddr_t)&amp;(p_wccdata-&gt;after) ) == FALSE )
03170         <span class="keywordflow">return</span> FALSE;
03171 
03172       <span class="keywordflow">return</span> TRUE;
03173       <span class="keywordflow">break</span>;
03174       
03175     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
03176       <span class="comment">/* never encoded */</span>
03177     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
03178       <span class="comment">/* it is never an input (never encoded, never allocated) */</span>
03179     <span class="keywordflow">default</span>:
03180       <span class="keywordflow">return</span> FALSE;
03181   }
03182 }
03183 
03184 
<a name="l03185"></a><a class="code" href="cmd__nfstools_8c.html#a25">03185</a> <span class="preprocessor">#define CREATE3_OK_FH( _p_CREATE3res ) ( (_p_CREATE3res)-&gt;CREATE3res_u.resok.obj )</span>
<a name="l03186"></a><a class="code" href="cmd__nfstools_8c.html#a26">03186</a> <span class="preprocessor"></span><span class="preprocessor">#define CREATE3_OK_ATTRS( _p_CREATE3res ) ( (_p_CREATE3res)-&gt;CREATE3res_u.resok.obj_attributes )</span>
<a name="l03187"></a><a class="code" href="cmd__nfstools_8c.html#a27">03187</a> <span class="preprocessor"></span><span class="preprocessor">#define CREATE3_OK_WCC( _p_CREATE3res ) ( (_p_CREATE3res)-&gt;CREATE3res_u.resok.dir_wcc )</span>
<a name="l03188"></a><a class="code" href="cmd__nfstools_8c.html#a28">03188</a> <span class="preprocessor"></span><span class="preprocessor">#define CREATE3_FAIL_WCC( _p_CREATE3res ) ( (_p_CREATE3res)-&gt;CREATE3res_u.resfail.dir_wcc )</span>
03189 <span class="preprocessor"></span>
<a name="l03190"></a><a class="code" href="cmd__nfstools_8h.html#a51">03190</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a51">cmdnfs_CREATE3res</a>(
03191       cmdnfs_encodetype_t     encodeflag,
03192       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
03193       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
03194       caddr_t     p_nfs_struct    
03195     )
03196 {
03197   
03198   CREATE3res * p_CREATE3res = ( CREATE3res *) p_nfs_struct ;
03199       
03200   <span class="comment">/* sanity check */</span>
03201   <span class="keywordflow">if</span> ( p_CREATE3res == NULL ) <span class="keywordflow">return</span> FALSE;
03202   
03203   <span class="keywordflow">switch</span> ( encodeflag )
03204   {
03205     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
03206             
03207       fprintf(out_stream, <span class="stringliteral">"%*sCREATE3res =\n"</span>,indent, <span class="stringliteral">" "</span>);
03208       fprintf(out_stream, <span class="stringliteral">"%*s{\n"</span>,indent, <span class="stringliteral">" "</span>);
03209       
03210       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a34">cmdnfs_nfsstat3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+2, out_stream,
03211                             (caddr_t) &amp;p_CREATE3res-&gt;status ) == FALSE )
03212       {
03213         <span class="keywordflow">return</span> FALSE;
03214       }
03215 
03216       <span class="keywordflow">if</span> ( p_CREATE3res-&gt;status == NFS3_OK )
03217       {
03218         
03219         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a39">cmdnfs_postopfh3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+2, out_stream,
03220                               (caddr_t) &amp; <a class="code" href="cmd__nfstools_8c.html#a25">CREATE3_OK_FH</a>(p_CREATE3res) ) == FALSE )
03221         {
03222           <span class="keywordflow">return</span> FALSE;
03223         }
03224         
03225         fprintf(out_stream, <span class="stringliteral">"%*sPost-op attributes (object):\n"</span>,indent+2, <span class="stringliteral">" "</span>);
03226         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a38">cmdnfs_postopattr</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+4, out_stream,
03227                                 (caddr_t) &amp; <a class="code" href="cmd__nfstools_8c.html#a26">CREATE3_OK_ATTRS</a>(p_CREATE3res) ) == FALSE )
03228         {
03229           <span class="keywordflow">return</span> FALSE;
03230         }
03231         
03232         fprintf(out_stream, <span class="stringliteral">"%*sWcc_data (directory):\n"</span>,indent+2, <span class="stringliteral">" "</span>);
03233         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8c.html#a102">cmdnfs_wccdata</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+4, out_stream,
03234                              (caddr_t) &amp; <a class="code" href="cmd__nfstools_8c.html#a27">CREATE3_OK_WCC</a>(p_CREATE3res) ) == FALSE )
03235         {
03236           <span class="keywordflow">return</span> FALSE;
03237         }
03238                 
03239       }
03240       <span class="keywordflow">else</span>
03241       {
03242         fprintf(out_stream, <span class="stringliteral">"%*sWcc_data (directory):\n"</span>,indent+2, <span class="stringliteral">" "</span>);
03243         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8c.html#a102">cmdnfs_wccdata</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+4, out_stream,
03244                              (caddr_t) &amp; <a class="code" href="cmd__nfstools_8c.html#a28">CREATE3_FAIL_WCC</a>(p_CREATE3res) ) == FALSE )
03245         {
03246           <span class="keywordflow">return</span> FALSE;
03247         }    
03248       }
03249       
03250       fprintf(out_stream, <span class="stringliteral">"%*s}\n"</span>,indent, <span class="stringliteral">" "</span>);
03251       
03252       <span class="keywordflow">return</span> TRUE;
03253       
03254       <span class="keywordflow">break</span>;
03255       
03256     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
03257       <span class="comment">/* never encoded */</span>
03258     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
03259       <span class="comment">/* it is never an input (never encoded, never allocated) */</span>
03260     <span class="keywordflow">default</span>:
03261       <span class="keywordflow">return</span> FALSE;
03262   }
03263   
03264 }    
03265 
03266 <span class="preprocessor">#undef CREATE3_OK_FH</span>
03267 <span class="preprocessor"></span><span class="preprocessor">#undef CREATE3_OK_ATTRS</span>
03268 <span class="preprocessor"></span><span class="preprocessor">#undef CREATE3_OK_WCC</span>
03269 <span class="preprocessor"></span><span class="preprocessor">#undef CREATE3_FAIL_WCC</span>
03270 <span class="preprocessor"></span>
03271 
<a name="l03272"></a><a class="code" href="cmd__nfstools_8h.html#a52">03272</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a52">cmdnfs_MKDIR3args</a>(
03273       cmdnfs_encodetype_t     encodeflag,
03274       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
03275       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
03276       caddr_t     p_nfs_struct    
03277     )
03278 {
03279   MKDIR3args * p_MKDIR3args = (  MKDIR3args *) p_nfs_struct ;
03280   <span class="keywordtype">char</span> * str_mode;
03281   
03282   <span class="comment">/* sanity check */</span>
03283   <span class="keywordflow">if</span> ( p_MKDIR3args == NULL ) <span class="keywordflow">return</span> FALSE;
03284   
03285   <span class="keywordflow">switch</span> ( encodeflag )
03286   {
03287     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
03288       
03289       <span class="keywordflow">if</span> ( (argc != 2) &amp;&amp; (argc != 3) ) <span class="keywordflow">return</span> FALSE;
03290       
03291       <span class="comment">/* The first two args */</span>
03292       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a40">cmdnfs_diropargs3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>, 2, argv , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
03293                             (caddr_t) &amp;(p_MKDIR3args-&gt;where) ) == FALSE )
03294       {
03295         <span class="keywordflow">return</span> FALSE;
03296       }
03297       
03298       <span class="comment">/* MKDIR 3th arg: sattr3 list or a MKDIR verifier */</span>
03299       
03300       <span class="keywordflow">if</span> ( argc == 3 )
03301       {
03302         <span class="comment">/* The 3th arg is a sattr3 list */</span>
03303         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a36">cmdnfs_sattr3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>, 1, argv + 2, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
03304                            (caddr_t)&amp;(p_MKDIR3args-&gt;attributes))
03305                            == FALSE )
03306         {
03307           <span class="keywordflow">return</span> FALSE;
03308         }        
03309       }
03310       <span class="keywordflow">else</span>
03311       {
03312         <span class="comment">/* the sattr3 strucure is empty */</span>
03313         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a36">cmdnfs_sattr3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
03314                            (caddr_t)&amp;(p_MKDIR3args-&gt;attributes))
03315                            == FALSE )
03316         {
03317           <span class="keywordflow">return</span> FALSE;
03318         }
03319       }
03320        
03321       <span class="keywordflow">return</span> TRUE;
03322       
03323     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
03324       <a class="code" href="cmd__nfstools_8h.html#a40">cmdnfs_diropargs3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a> , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
03325                             (caddr_t) &amp;(p_MKDIR3args-&gt;where) );
03326       <a class="code" href="cmd__nfstools_8h.html#a36">cmdnfs_sattr3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a> , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
03327                     (caddr_t) &amp;(p_MKDIR3args-&gt;attributes) );
03328       <span class="keywordflow">return</span> TRUE;
03329       <span class="keywordflow">break</span>;
03330       
03331     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
03332       <span class="comment">/* never decoded */</span>
03333     <span class="keywordflow">default</span>:
03334       <span class="keywordflow">return</span> FALSE;
03335   } 
03336 }
03337 
03338 
<a name="l03339"></a><a class="code" href="cmd__nfstools_8c.html#a29">03339</a> <span class="preprocessor">#define MKDIR3_OK_FH( _p_MKDIR3res ) ( (_p_MKDIR3res)-&gt;MKDIR3res_u.resok.obj )</span>
<a name="l03340"></a><a class="code" href="cmd__nfstools_8c.html#a30">03340</a> <span class="preprocessor"></span><span class="preprocessor">#define MKDIR3_OK_ATTRS( _p_MKDIR3res ) ( (_p_MKDIR3res)-&gt;MKDIR3res_u.resok.obj_attributes )</span>
<a name="l03341"></a><a class="code" href="cmd__nfstools_8c.html#a31">03341</a> <span class="preprocessor"></span><span class="preprocessor">#define MKDIR3_OK_WCC( _p_MKDIR3res ) ( (_p_MKDIR3res)-&gt;MKDIR3res_u.resok.dir_wcc )</span>
<a name="l03342"></a><a class="code" href="cmd__nfstools_8c.html#a32">03342</a> <span class="preprocessor"></span><span class="preprocessor">#define MKDIR3_FAIL_WCC( _p_MKDIR3res ) ( (_p_MKDIR3res)-&gt;MKDIR3res_u.resfail.dir_wcc )</span>
03343 <span class="preprocessor"></span>
<a name="l03344"></a><a class="code" href="cmd__nfstools_8h.html#a53">03344</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a53">cmdnfs_MKDIR3res</a>(
03345       cmdnfs_encodetype_t     encodeflag,
03346       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
03347       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
03348       caddr_t     p_nfs_struct    
03349     )
03350 {
03351   
03352   MKDIR3res * p_MKDIR3res = ( MKDIR3res *) p_nfs_struct ;
03353       
03354   <span class="comment">/* sanity check */</span>
03355   <span class="keywordflow">if</span> ( p_MKDIR3res == NULL ) <span class="keywordflow">return</span> FALSE;
03356   
03357   <span class="keywordflow">switch</span> ( encodeflag )
03358   {
03359     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
03360             
03361       fprintf(out_stream, <span class="stringliteral">"%*sMKDIR3res =\n"</span>,indent, <span class="stringliteral">" "</span>);
03362       fprintf(out_stream, <span class="stringliteral">"%*s{\n"</span>,indent, <span class="stringliteral">" "</span>);
03363       
03364       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a34">cmdnfs_nfsstat3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+2, out_stream,
03365                             (caddr_t) &amp;p_MKDIR3res-&gt;status ) == FALSE )
03366       {
03367         <span class="keywordflow">return</span> FALSE;
03368       }
03369 
03370       <span class="keywordflow">if</span> ( p_MKDIR3res-&gt;status == NFS3_OK )
03371       {
03372         
03373         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a39">cmdnfs_postopfh3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+2, out_stream,
03374                               (caddr_t) &amp; <a class="code" href="cmd__nfstools_8c.html#a29">MKDIR3_OK_FH</a>(p_MKDIR3res) ) == FALSE )
03375         {
03376           <span class="keywordflow">return</span> FALSE;
03377         }
03378         
03379         fprintf(out_stream, <span class="stringliteral">"%*sPost-op attributes (new dir):\n"</span>,indent+2, <span class="stringliteral">" "</span>);
03380         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a38">cmdnfs_postopattr</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+4, out_stream,
03381                                 (caddr_t) &amp; <a class="code" href="cmd__nfstools_8c.html#a30">MKDIR3_OK_ATTRS</a>(p_MKDIR3res) ) == FALSE )
03382         {
03383           <span class="keywordflow">return</span> FALSE;
03384         }
03385         
03386         fprintf(out_stream, <span class="stringliteral">"%*sWcc_data (parent dir):\n"</span>,indent+2, <span class="stringliteral">" "</span>);
03387         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8c.html#a102">cmdnfs_wccdata</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+4, out_stream,
03388                              (caddr_t) &amp; <a class="code" href="cmd__nfstools_8c.html#a31">MKDIR3_OK_WCC</a>(p_MKDIR3res) ) == FALSE )
03389         {
03390           <span class="keywordflow">return</span> FALSE;
03391         }
03392                 
03393       }
03394       <span class="keywordflow">else</span>
03395       {
03396         fprintf(out_stream, <span class="stringliteral">"%*sWcc_data (parent dir):\n"</span>,indent+2, <span class="stringliteral">" "</span>);
03397         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8c.html#a102">cmdnfs_wccdata</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+4, out_stream,
03398                              (caddr_t) &amp; <a class="code" href="cmd__nfstools_8c.html#a32">MKDIR3_FAIL_WCC</a>(p_MKDIR3res) ) == FALSE )
03399         {
03400           <span class="keywordflow">return</span> FALSE;
03401         }    
03402       }
03403       
03404       fprintf(out_stream, <span class="stringliteral">"%*s}\n"</span>,indent, <span class="stringliteral">" "</span>);
03405       
03406       <span class="keywordflow">return</span> TRUE;
03407       
03408       <span class="keywordflow">break</span>;
03409       
03410     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
03411       <span class="comment">/* never encoded */</span>
03412     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
03413       <span class="comment">/* it is never an input (never encoded, never allocated) */</span>
03414     <span class="keywordflow">default</span>:
03415       <span class="keywordflow">return</span> FALSE;
03416   }
03417   
03418 }    
03419 
03420 <span class="preprocessor">#undef MKDIR3_OK_FH</span>
03421 <span class="preprocessor"></span><span class="preprocessor">#undef MKDIR3_OK_ATTRS</span>
03422 <span class="preprocessor"></span><span class="preprocessor">#undef MKDIR3_OK_WCC</span>
03423 <span class="preprocessor"></span><span class="preprocessor">#undef MKDIR3_FAIL_WCC</span>
03424 <span class="preprocessor"></span>
03425 
<a name="l03426"></a><a class="code" href="cmd__nfstools_8c.html#a33">03426</a> <span class="preprocessor">#define REMOVE3_OK_WCC( _p_REMOVE3res ) ( (_p_REMOVE3res)-&gt;REMOVE3res_u.resok.dir_wcc )</span>
<a name="l03427"></a><a class="code" href="cmd__nfstools_8c.html#a34">03427</a> <span class="preprocessor"></span><span class="preprocessor">#define REMOVE3_FAIL_WCC( _p_REMOVE3res ) ( (_p_REMOVE3res)-&gt;REMOVE3res_u.resfail.dir_wcc )</span>
03428 <span class="preprocessor"></span>
<a name="l03429"></a><a class="code" href="cmd__nfstools_8h.html#a54">03429</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a54">cmdnfs_REMOVE3res</a>(
03430       cmdnfs_encodetype_t     encodeflag,
03431       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
03432       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
03433       caddr_t     p_nfs_struct    
03434     )
03435 {
03436   
03437   REMOVE3res * p_REMOVE3res = ( REMOVE3res *) p_nfs_struct ;
03438       
03439   <span class="comment">/* sanity check */</span>
03440   <span class="keywordflow">if</span> ( p_REMOVE3res == NULL ) <span class="keywordflow">return</span> FALSE;
03441   
03442   <span class="keywordflow">switch</span> ( encodeflag )
03443   {
03444     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
03445             
03446       fprintf(out_stream, <span class="stringliteral">"%*sREMOVE3res =\n"</span>,indent, <span class="stringliteral">" "</span>);
03447       fprintf(out_stream, <span class="stringliteral">"%*s{\n"</span>,indent, <span class="stringliteral">" "</span>);
03448       
03449       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a34">cmdnfs_nfsstat3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+2, out_stream,
03450                             (caddr_t) &amp;p_REMOVE3res-&gt;status ) == FALSE )
03451       {
03452         <span class="keywordflow">return</span> FALSE;
03453       }
03454 
03455       <span class="keywordflow">if</span> ( p_REMOVE3res-&gt;status == NFS3_OK )
03456       {
03457         
03458         fprintf(out_stream, <span class="stringliteral">"%*sWcc_data (parent dir):\n"</span>,indent+2, <span class="stringliteral">" "</span>);
03459         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8c.html#a102">cmdnfs_wccdata</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+4, out_stream,
03460                              (caddr_t) &amp; <a class="code" href="cmd__nfstools_8c.html#a33">REMOVE3_OK_WCC</a>(p_REMOVE3res) ) == FALSE )
03461         {
03462           <span class="keywordflow">return</span> FALSE;
03463         }
03464                 
03465       }
03466       <span class="keywordflow">else</span>
03467       {
03468         fprintf(out_stream, <span class="stringliteral">"%*sWcc_data (parent dir):\n"</span>,indent+2, <span class="stringliteral">" "</span>);
03469         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8c.html#a102">cmdnfs_wccdata</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+4, out_stream,
03470                              (caddr_t) &amp; <a class="code" href="cmd__nfstools_8c.html#a34">REMOVE3_FAIL_WCC</a>(p_REMOVE3res) ) == FALSE )
03471         {
03472           <span class="keywordflow">return</span> FALSE;
03473         }    
03474       }
03475       
03476       fprintf(out_stream, <span class="stringliteral">"%*s}\n"</span>,indent, <span class="stringliteral">" "</span>);
03477       
03478       <span class="keywordflow">return</span> TRUE;
03479       
03480       <span class="keywordflow">break</span>;
03481       
03482     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
03483       <span class="comment">/* never encoded */</span>
03484     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
03485       <span class="comment">/* it is never an input (never encoded, never allocated) */</span>
03486     <span class="keywordflow">default</span>:
03487       <span class="keywordflow">return</span> FALSE;
03488   }
03489   
03490 }    
03491 
03492 <span class="preprocessor">#undef REMOVE3_OK_WCC</span>
03493 <span class="preprocessor"></span><span class="preprocessor">#undef REMOVE3_FAIL_WCC</span>
03494 <span class="preprocessor"></span>
<a name="l03495"></a><a class="code" href="cmd__nfstools_8c.html#a35">03495</a> <span class="preprocessor">#define RMDIR3_OK_WCC( _p_RMDIR3res ) ( (_p_RMDIR3res)-&gt;RMDIR3res_u.resok.dir_wcc )</span>
<a name="l03496"></a><a class="code" href="cmd__nfstools_8c.html#a36">03496</a> <span class="preprocessor"></span><span class="preprocessor">#define RMDIR3_FAIL_WCC( _p_RMDIR3res ) ( (_p_RMDIR3res)-&gt;RMDIR3res_u.resfail.dir_wcc )</span>
03497 <span class="preprocessor"></span>
<a name="l03498"></a><a class="code" href="cmd__nfstools_8h.html#a55">03498</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a55">cmdnfs_RMDIR3res</a>(
03499       cmdnfs_encodetype_t     encodeflag,
03500       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
03501       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
03502       caddr_t     p_nfs_struct    
03503     )
03504 {
03505   
03506   RMDIR3res * p_RMDIR3res = ( RMDIR3res *) p_nfs_struct ;
03507       
03508   <span class="comment">/* sanity check */</span>
03509   <span class="keywordflow">if</span> ( p_RMDIR3res == NULL ) <span class="keywordflow">return</span> FALSE;
03510   
03511   <span class="keywordflow">switch</span> ( encodeflag )
03512   {
03513     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
03514             
03515       fprintf(out_stream, <span class="stringliteral">"%*sRMDIR3res =\n"</span>,indent, <span class="stringliteral">" "</span>);
03516       fprintf(out_stream, <span class="stringliteral">"%*s{\n"</span>,indent, <span class="stringliteral">" "</span>);
03517       
03518       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a34">cmdnfs_nfsstat3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+2, out_stream,
03519                             (caddr_t) &amp;p_RMDIR3res-&gt;status ) == FALSE )
03520       {
03521         <span class="keywordflow">return</span> FALSE;
03522       }
03523 
03524       <span class="keywordflow">if</span> ( p_RMDIR3res-&gt;status == NFS3_OK )
03525       {
03526         
03527         fprintf(out_stream, <span class="stringliteral">"%*sWcc_data (parent dir):\n"</span>,indent+2, <span class="stringliteral">" "</span>);
03528         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8c.html#a102">cmdnfs_wccdata</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+4, out_stream,
03529                              (caddr_t) &amp; <a class="code" href="cmd__nfstools_8c.html#a35">RMDIR3_OK_WCC</a>(p_RMDIR3res) ) == FALSE )
03530         {
03531           <span class="keywordflow">return</span> FALSE;
03532         }
03533                 
03534       }
03535       <span class="keywordflow">else</span>
03536       {
03537         fprintf(out_stream, <span class="stringliteral">"%*sWcc_data (parent dir):\n"</span>,indent+2, <span class="stringliteral">" "</span>);
03538         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8c.html#a102">cmdnfs_wccdata</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+4, out_stream,
03539                              (caddr_t) &amp; <a class="code" href="cmd__nfstools_8c.html#a36">RMDIR3_FAIL_WCC</a>(p_RMDIR3res) ) == FALSE )
03540         {
03541           <span class="keywordflow">return</span> FALSE;
03542         }    
03543       }
03544       
03545       fprintf(out_stream, <span class="stringliteral">"%*s}\n"</span>,indent, <span class="stringliteral">" "</span>);
03546       
03547       <span class="keywordflow">return</span> TRUE;
03548       
03549       <span class="keywordflow">break</span>;
03550       
03551     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
03552       <span class="comment">/* never encoded */</span>
03553     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
03554       <span class="comment">/* it is never an input (never encoded, never allocated) */</span>
03555     <span class="keywordflow">default</span>:
03556       <span class="keywordflow">return</span> FALSE;
03557   }
03558   
03559 }    
03560 
03561 <span class="preprocessor">#undef RMDIR3_OK_WCC</span>
03562 <span class="preprocessor"></span><span class="preprocessor">#undef RMDIR3_FAIL_WCC</span>
03563 <span class="preprocessor"></span>
<a name="l03564"></a><a class="code" href="cmd__nfstools_8c.html#a108">03564</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8c.html#a108">cmdnfs_sattrguard3</a>(
03565       cmdnfs_encodetype_t     encodeflag,
03566       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
03567       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
03568       caddr_t     p_nfs_struct
03569     )
03570 {
03571   
03572   <span class="keywordtype">int</span> i;
03573   sattrguard3 * p_sattr = ( sattrguard3 *) p_nfs_struct ;
03574   
03575   time_t  c_sec;
03576   <span class="keywordtype">int</span>     c_nsec;
03577   <span class="keywordtype">char</span> * nsec_str;
03578   <span class="keywordtype">char</span> * time_str;
03579     
03580   <span class="comment">/* sanity check */</span>
03581   <span class="keywordflow">if</span> ( p_sattr == NULL ) <span class="keywordflow">return</span> FALSE;
03582   
03583   <span class="keywordflow">switch</span> ( encodeflag )
03584   {
03585     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
03586       
03587       <span class="comment">/* inits structure */</span>
03588       memset( (caddr_t)p_sattr, 0, <span class="keyword">sizeof</span>( sattrguard3 ) );
03589         
03590       <span class="keywordflow">if</span> ( argc == 0 )
03591       {
03592         <span class="comment">/* empty structure */</span>
03593         p_sattr-&gt;check = FALSE;
03594         <span class="keywordflow">return</span> TRUE;
03595       }
03596       
03597       <span class="comment">/* at this point it must not be more than one string */</span>
03598       <span class="keywordflow">if</span> (argc != 1) <span class="keywordflow">return</span> FALSE;
03599       
03600       time_str = strtok_r(argv[0],<span class="stringliteral">"."</span>,&amp;nsec_str);
03601 
03602       c_sec = <a class="code" href="cmd__tools_8h.html#a13">atotime</a>( time_str );
03603       <span class="keywordflow">if</span> ( c_sec == ((time_t)-1)) <span class="keywordflow">return</span> FALSE;
03604 
03605       <span class="keywordflow">if</span> ( nsec_str == NULL )
03606       {
03607         c_nsec = 0;
03608       }
03609       <span class="keywordflow">else</span>
03610       {
03611         c_nsec = <a class="code" href="cmd__tools_8h.html#a10">my_atoi</a>( nsec_str );
03612         <span class="keywordflow">if</span> ( (c_nsec &lt; 0) || (c_nsec &gt; 999999999) ) <span class="keywordflow">return</span> FALSE;
03613       }
03614 
03615       p_sattr-&gt;check = TRUE;
03616       p_sattr-&gt;sattrguard3_u.obj_ctime.seconds = c_sec;
03617       p_sattr-&gt;sattrguard3_u.obj_ctime.nseconds = c_nsec;
03618 
03619 <span class="preprocessor">#ifdef _DEBUG_NFS_SHELL</span>
03620 <span class="preprocessor"></span>      printf (<span class="stringliteral">"ctime check = %u.%.9u\n"</span>, p_sattr-&gt;sattrguard3_u.obj_ctime.seconds,
03621               p_sattr-&gt;sattrguard3_u.obj_ctime.nseconds );
03622 <span class="preprocessor">#endif</span>
03623 <span class="preprocessor"></span>      
03624       <span class="keywordflow">return</span> TRUE;
03625       <span class="keywordflow">break</span>;
03626     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:      
03627       <span class="comment">/* nothing to do */</span>      
03628       <span class="keywordflow">return</span> TRUE;      
03629       <span class="keywordflow">break</span>;
03630       
03631     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
03632       <span class="comment">/* never decoded */</span>
03633     <span class="keywordflow">default</span>:
03634       <span class="keywordflow">return</span> FALSE;
03635   }
03636 
03637 } <span class="comment">/* cmdnfs_sattrguard3 */</span>
03638 
03639 
<a name="l03640"></a><a class="code" href="cmd__nfstools_8h.html#a56">03640</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a56">cmdnfs_SETATTR3args</a>(
03641       cmdnfs_encodetype_t     encodeflag,
03642       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
03643       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
03644       caddr_t         p_nfs_struct    
03645     )
03646 {
03647   SETATTR3args * p_SETATTR3args = (  SETATTR3args *) p_nfs_struct ;
03648   <span class="keywordtype">char</span> * str_mode;
03649   
03650   <span class="comment">/* sanity check */</span>
03651   <span class="keywordflow">if</span> ( p_SETATTR3args == NULL ) <span class="keywordflow">return</span> FALSE;
03652   
03653   <span class="keywordflow">switch</span> ( encodeflag )
03654   {
03655     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
03656       
03657       <span class="keywordflow">if</span> ( (argc != 2) &amp;&amp; (argc != 3) ) <span class="keywordflow">return</span> FALSE;
03658       
03659       <span class="comment">/* The first arg */</span>
03660       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a22">cmdnfs_fhandle3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>, 1, argv , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
03661                             (caddr_t) &amp;(p_SETATTR3args-&gt;object) ) == FALSE )
03662       {
03663         <span class="keywordflow">return</span> FALSE;
03664       }
03665       
03666       <span class="comment">/* SETATTR 2th arg: sattr3 list */</span>
03667       
03668       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a36">cmdnfs_sattr3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>, 1, argv + 1, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
03669                          (caddr_t)&amp;(p_SETATTR3args-&gt;new_attributes))
03670                          == FALSE )
03671       {
03672         <span class="keywordflow">return</span> FALSE;
03673       }        
03674        
03675       <span class="comment">/* SETATTR optionnal 3th arg: sattrguard3 */</span>
03676       
03677       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8c.html#a108">cmdnfs_sattrguard3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>, argc - 2 , argv + 2, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
03678                                (caddr_t)&amp;(p_SETATTR3args-&gt;guard))
03679                                == FALSE )
03680       {
03681         <span class="keywordflow">return</span> FALSE;
03682       }        
03683       
03684       
03685       <span class="keywordflow">return</span> TRUE;
03686       
03687     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
03688       <a class="code" href="cmd__nfstools_8h.html#a22">cmdnfs_fhandle3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a> , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
03689                             (caddr_t) &amp;(p_SETATTR3args-&gt;object) );
03690       <a class="code" href="cmd__nfstools_8h.html#a36">cmdnfs_sattr3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a> , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
03691                     (caddr_t) &amp;(p_SETATTR3args-&gt;new_attributes) );
03692       <span class="keywordflow">return</span> TRUE;
03693       <span class="keywordflow">break</span>;
03694       
03695     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
03696       <span class="comment">/* never decoded */</span>
03697     <span class="keywordflow">default</span>:
03698       <span class="keywordflow">return</span> FALSE;
03699   } 
03700 }
03701 
03702 
03703 
<a name="l03704"></a><a class="code" href="cmd__nfstools_8c.html#a37">03704</a> <span class="preprocessor">#define SETATTR3_OK_WCC( _p_SETATTR3res ) ( (_p_SETATTR3res)-&gt;SETATTR3res_u.resok.obj_wcc )</span>
<a name="l03705"></a><a class="code" href="cmd__nfstools_8c.html#a38">03705</a> <span class="preprocessor"></span><span class="preprocessor">#define SETATTR3_FAIL_WCC( _p_SETATTR3res ) ( (_p_SETATTR3res)-&gt;SETATTR3res_u.resfail.obj_wcc )</span>
03706 <span class="preprocessor"></span>
<a name="l03707"></a><a class="code" href="cmd__nfstools_8h.html#a57">03707</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a57">cmdnfs_SETATTR3res</a>(
03708       cmdnfs_encodetype_t     encodeflag,
03709       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
03710       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
03711       caddr_t     p_nfs_struct    
03712     )
03713 {
03714   
03715   SETATTR3res * p_SETATTR3res = ( SETATTR3res *) p_nfs_struct ;
03716       
03717   <span class="comment">/* sanity check */</span>
03718   <span class="keywordflow">if</span> ( p_SETATTR3res == NULL ) <span class="keywordflow">return</span> FALSE;
03719   
03720   <span class="keywordflow">switch</span> ( encodeflag )
03721   {
03722     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
03723             
03724       fprintf(out_stream, <span class="stringliteral">"%*sSETATTR3res =\n"</span>,indent, <span class="stringliteral">" "</span>);
03725       fprintf(out_stream, <span class="stringliteral">"%*s{\n"</span>,indent, <span class="stringliteral">" "</span>);
03726       
03727       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a34">cmdnfs_nfsstat3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+2, out_stream,
03728                             (caddr_t) &amp;p_SETATTR3res-&gt;status ) == FALSE )
03729       {
03730         <span class="keywordflow">return</span> FALSE;
03731       }
03732 
03733       <span class="keywordflow">if</span> ( p_SETATTR3res-&gt;status == NFS3_OK )
03734       {
03735         
03736         fprintf(out_stream, <span class="stringliteral">"%*sWcc_data (object):\n"</span>,indent+2, <span class="stringliteral">" "</span>);
03737         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8c.html#a102">cmdnfs_wccdata</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+4, out_stream,
03738                              (caddr_t) &amp; <a class="code" href="cmd__nfstools_8c.html#a37">SETATTR3_OK_WCC</a>(p_SETATTR3res) ) == FALSE )
03739         {
03740           <span class="keywordflow">return</span> FALSE;
03741         }
03742                 
03743       }
03744       <span class="keywordflow">else</span>
03745       {
03746         fprintf(out_stream, <span class="stringliteral">"%*sWcc_data (object):\n"</span>,indent+2, <span class="stringliteral">" "</span>);
03747         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8c.html#a102">cmdnfs_wccdata</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+4, out_stream,
03748                              (caddr_t) &amp; <a class="code" href="cmd__nfstools_8c.html#a38">SETATTR3_FAIL_WCC</a>(p_SETATTR3res) ) == FALSE )
03749         {
03750           <span class="keywordflow">return</span> FALSE;
03751         }    
03752       }
03753       
03754       fprintf(out_stream, <span class="stringliteral">"%*s}\n"</span>,indent, <span class="stringliteral">" "</span>);
03755       
03756       <span class="keywordflow">return</span> TRUE;
03757       
03758       <span class="keywordflow">break</span>;
03759       
03760     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
03761       <span class="comment">/* never encoded */</span>
03762     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
03763       <span class="comment">/* it is never an input (never encoded, never allocated) */</span>
03764     <span class="keywordflow">default</span>:
03765       <span class="keywordflow">return</span> FALSE;
03766   }
03767   
03768 }    
03769 
03770 <span class="preprocessor">#undef SETATTR3_OK_WCC</span>
03771 <span class="preprocessor"></span><span class="preprocessor">#undef SETATTR3_FAIL_WCC</span>
03772 <span class="preprocessor"></span>
03773 
03774 
<a name="l03775"></a><a class="code" href="cmd__nfstools_8h.html#a58">03775</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a58">cmdnfs_RENAME3args</a>(
03776       cmdnfs_encodetype_t     encodeflag,
03777       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
03778       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
03779       caddr_t         p_nfs_struct    
03780     )
03781 {
03782   RENAME3args * p_RENAME3args = (  RENAME3args *) p_nfs_struct ;
03783   <span class="keywordtype">char</span> * str_mode;
03784   
03785   <span class="comment">/* sanity check */</span>
03786   <span class="keywordflow">if</span> ( p_RENAME3args == NULL ) <span class="keywordflow">return</span> FALSE;
03787   
03788   <span class="keywordflow">switch</span> ( encodeflag )
03789   {
03790     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
03791       
03792       <span class="keywordflow">if</span> ( argc != 4 ) <span class="keywordflow">return</span> FALSE;
03793       
03794       <span class="comment">/* The first 2 args */</span>
03795       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a40">cmdnfs_diropargs3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>, 2, argv , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
03796                              (caddr_t) &amp;(p_RENAME3args-&gt;from) ) == FALSE )
03797       {
03798         <span class="keywordflow">return</span> FALSE;
03799       }
03800       
03801       <span class="comment">/* The last 2 args */</span>
03802       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a40">cmdnfs_diropargs3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>, argc-2, argv+2 , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
03803                              (caddr_t) &amp;(p_RENAME3args-&gt;to) ) == FALSE )
03804       {
03805         <span class="keywordflow">return</span> FALSE;
03806       }
03807       
03808       
03809       <span class="keywordflow">return</span> TRUE;
03810       
03811     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
03812       <a class="code" href="cmd__nfstools_8h.html#a40">cmdnfs_diropargs3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a> , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
03813                          (caddr_t) &amp;(p_RENAME3args-&gt;from) );
03814       <a class="code" href="cmd__nfstools_8h.html#a40">cmdnfs_diropargs3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a> , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
03815                          (caddr_t) &amp;(p_RENAME3args-&gt;to) );
03816       <span class="keywordflow">return</span> TRUE;
03817       <span class="keywordflow">break</span>;
03818       
03819     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
03820       <span class="comment">/* never decoded */</span>
03821     <span class="keywordflow">default</span>:
03822       <span class="keywordflow">return</span> FALSE;
03823   } 
03824 }
03825 
03826 
<a name="l03827"></a><a class="code" href="cmd__nfstools_8c.html#a39">03827</a> <span class="preprocessor">#define RENAME3_OK_FROMWCC( _p_RENAME3res ) ( (_p_RENAME3res)-&gt;RENAME3res_u.resok.fromdir_wcc )</span>
<a name="l03828"></a><a class="code" href="cmd__nfstools_8c.html#a40">03828</a> <span class="preprocessor"></span><span class="preprocessor">#define RENAME3_OK_TOWCC( _p_RENAME3res ) ( (_p_RENAME3res)-&gt;RENAME3res_u.resok.todir_wcc )</span>
<a name="l03829"></a><a class="code" href="cmd__nfstools_8c.html#a41">03829</a> <span class="preprocessor"></span><span class="preprocessor">#define RENAME3_FAIL_FROMWCC( _p_RENAME3res ) ( (_p_RENAME3res)-&gt;RENAME3res_u.resfail.fromdir_wcc )</span>
<a name="l03830"></a><a class="code" href="cmd__nfstools_8c.html#a42">03830</a> <span class="preprocessor"></span><span class="preprocessor">#define RENAME3_FAIL_TOWCC( _p_RENAME3res ) ( (_p_RENAME3res)-&gt;RENAME3res_u.resfail.todir_wcc )</span>
03831 <span class="preprocessor"></span>
<a name="l03832"></a><a class="code" href="cmd__nfstools_8h.html#a59">03832</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a59">cmdnfs_RENAME3res</a>(
03833       cmdnfs_encodetype_t     encodeflag,
03834       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
03835       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
03836       caddr_t     p_nfs_struct    
03837     )
03838 {
03839   
03840   RENAME3res * p_RENAME3res = ( RENAME3res *) p_nfs_struct ;
03841       
03842   <span class="comment">/* sanity check */</span>
03843   <span class="keywordflow">if</span> ( p_RENAME3res == NULL ) <span class="keywordflow">return</span> FALSE;
03844   
03845   <span class="keywordflow">switch</span> ( encodeflag )
03846   {
03847     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
03848             
03849       fprintf(out_stream, <span class="stringliteral">"%*sRENAME3res =\n"</span>,indent, <span class="stringliteral">" "</span>);
03850       fprintf(out_stream, <span class="stringliteral">"%*s{\n"</span>,indent, <span class="stringliteral">" "</span>);
03851       
03852       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a34">cmdnfs_nfsstat3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+2, out_stream,
03853                             (caddr_t) &amp;p_RENAME3res-&gt;status ) == FALSE )
03854       {
03855         <span class="keywordflow">return</span> FALSE;
03856       }
03857 
03858       <span class="keywordflow">if</span> ( p_RENAME3res-&gt;status == NFS3_OK )
03859       {
03860         
03861         fprintf(out_stream, <span class="stringliteral">"%*sWcc_data (source directory):\n"</span>,indent+2, <span class="stringliteral">" "</span>);
03862         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8c.html#a102">cmdnfs_wccdata</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+4, out_stream,
03863                              (caddr_t) &amp; <a class="code" href="cmd__nfstools_8c.html#a39">RENAME3_OK_FROMWCC</a>(p_RENAME3res) ) == FALSE )
03864         {
03865           <span class="keywordflow">return</span> FALSE;
03866         }
03867         fprintf(out_stream, <span class="stringliteral">"%*sWcc_data (target directory):\n"</span>,indent+2, <span class="stringliteral">" "</span>);
03868         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8c.html#a102">cmdnfs_wccdata</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+4, out_stream,
03869                              (caddr_t) &amp; <a class="code" href="cmd__nfstools_8c.html#a40">RENAME3_OK_TOWCC</a>(p_RENAME3res) ) == FALSE )
03870         {
03871           <span class="keywordflow">return</span> FALSE;
03872         }
03873                 
03874       }
03875       <span class="keywordflow">else</span>
03876       {
03877         fprintf(out_stream, <span class="stringliteral">"%*sWcc_data (source directory):\n"</span>,indent+2, <span class="stringliteral">" "</span>);
03878         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8c.html#a102">cmdnfs_wccdata</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+4, out_stream,
03879                              (caddr_t) &amp; <a class="code" href="cmd__nfstools_8c.html#a41">RENAME3_FAIL_FROMWCC</a>(p_RENAME3res) ) == FALSE )
03880         {
03881           <span class="keywordflow">return</span> FALSE;
03882         }
03883         fprintf(out_stream, <span class="stringliteral">"%*sWcc_data (target directory):\n"</span>,indent+2, <span class="stringliteral">" "</span>);
03884         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8c.html#a102">cmdnfs_wccdata</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+4, out_stream,
03885                              (caddr_t) &amp; <a class="code" href="cmd__nfstools_8c.html#a42">RENAME3_FAIL_TOWCC</a>(p_RENAME3res) ) == FALSE )
03886         {
03887           <span class="keywordflow">return</span> FALSE;
03888         }
03889       }
03890       
03891       fprintf(out_stream, <span class="stringliteral">"%*s}\n"</span>,indent, <span class="stringliteral">" "</span>);
03892       
03893       <span class="keywordflow">return</span> TRUE;
03894       
03895       <span class="keywordflow">break</span>;
03896       
03897     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
03898       <span class="comment">/* never encoded */</span>
03899     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
03900       <span class="comment">/* it is never an input (never encoded, never allocated) */</span>
03901     <span class="keywordflow">default</span>:
03902       <span class="keywordflow">return</span> FALSE;
03903   }
03904   
03905 }    
03906 
03907 <span class="preprocessor">#undef RENAME3_OK_FROMWCC</span>
03908 <span class="preprocessor"></span><span class="preprocessor">#undef RENAME3_OK_TOWCC</span>
03909 <span class="preprocessor"></span><span class="preprocessor">#undef RENAME3_FAIL_FROMWCC</span>
03910 <span class="preprocessor"></span><span class="preprocessor">#undef RENAME3_FAIL_TOWCC</span>
03911 <span class="preprocessor"></span>
03912 
03913 
<a name="l03914"></a><a class="code" href="cmd__nfstools_8h.html#a60">03914</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a60">cmdnfs_LINK3args</a>(
03915       cmdnfs_encodetype_t     encodeflag,
03916       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
03917       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
03918       caddr_t         p_nfs_struct    
03919     )
03920 {
03921   LINK3args * p_LINK3args = (  LINK3args *) p_nfs_struct ;
03922   <span class="keywordtype">char</span> * str_mode;
03923   
03924   <span class="comment">/* sanity check */</span>
03925   <span class="keywordflow">if</span> ( p_LINK3args == NULL ) <span class="keywordflow">return</span> FALSE;
03926   
03927   <span class="keywordflow">switch</span> ( encodeflag )
03928   {
03929     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
03930       
03931       <span class="keywordflow">if</span> ( argc != 3 ) <span class="keywordflow">return</span> FALSE;
03932       
03933       <span class="comment">/* The first arg */</span>
03934       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a22">cmdnfs_fhandle3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>, 1, argv , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
03935                             (caddr_t) &amp;(p_LINK3args-&gt;file) ) == FALSE )
03936       {
03937         <span class="keywordflow">return</span> FALSE;
03938       }
03939       
03940       <span class="comment">/* The last 2 args */</span>
03941       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a40">cmdnfs_diropargs3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>, argc-1, argv+1 , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
03942                              (caddr_t) &amp;(p_LINK3args-&gt;link) ) == FALSE )
03943       {
03944         <span class="keywordflow">return</span> FALSE;
03945       }
03946       
03947       
03948       <span class="keywordflow">return</span> TRUE;
03949       
03950     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
03951       <a class="code" href="cmd__nfstools_8h.html#a22">cmdnfs_fhandle3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a> , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
03952                        (caddr_t) &amp;(p_LINK3args-&gt;file) );
03953       <a class="code" href="cmd__nfstools_8h.html#a40">cmdnfs_diropargs3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a> , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
03954                          (caddr_t) &amp;(p_LINK3args-&gt;link) );
03955       <span class="keywordflow">return</span> TRUE;
03956       <span class="keywordflow">break</span>;
03957       
03958     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
03959       <span class="comment">/* never decoded */</span>
03960     <span class="keywordflow">default</span>:
03961       <span class="keywordflow">return</span> FALSE;
03962   } 
03963 }
03964 
03965 
<a name="l03966"></a><a class="code" href="cmd__nfstools_8c.html#a43">03966</a> <span class="preprocessor">#define LINK3_OK_ATTRS( _p_LINK3res ) ( (_p_LINK3res)-&gt;LINK3res_u.resok.file_attributes )</span>
<a name="l03967"></a><a class="code" href="cmd__nfstools_8c.html#a44">03967</a> <span class="preprocessor"></span><span class="preprocessor">#define LINK3_OK_WCC( _p_LINK3res ) ( (_p_LINK3res)-&gt;LINK3res_u.resok.linkdir_wcc )</span>
<a name="l03968"></a><a class="code" href="cmd__nfstools_8c.html#a45">03968</a> <span class="preprocessor"></span><span class="preprocessor">#define LINK3_FAIL_ATTRS( _p_LINK3res ) ( (_p_LINK3res)-&gt;LINK3res_u.resfail.file_attributes )</span>
<a name="l03969"></a><a class="code" href="cmd__nfstools_8c.html#a46">03969</a> <span class="preprocessor"></span><span class="preprocessor">#define LINK3_FAIL_WCC( _p_LINK3res ) ( (_p_LINK3res)-&gt;LINK3res_u.resfail.linkdir_wcc )</span>
03970 <span class="preprocessor"></span>
<a name="l03971"></a><a class="code" href="cmd__nfstools_8h.html#a61">03971</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a61">cmdnfs_LINK3res</a>(
03972       cmdnfs_encodetype_t     encodeflag,
03973       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
03974       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
03975       caddr_t     p_nfs_struct    
03976     )
03977 {
03978   
03979   LINK3res * p_LINK3res = ( LINK3res *) p_nfs_struct ;
03980       
03981   <span class="comment">/* sanity check */</span>
03982   <span class="keywordflow">if</span> ( p_LINK3res == NULL ) <span class="keywordflow">return</span> FALSE;
03983   
03984   <span class="keywordflow">switch</span> ( encodeflag )
03985   {
03986     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
03987             
03988       fprintf(out_stream, <span class="stringliteral">"%*sLINK3res =\n"</span>,indent, <span class="stringliteral">" "</span>);
03989       fprintf(out_stream, <span class="stringliteral">"%*s{\n"</span>,indent, <span class="stringliteral">" "</span>);
03990       
03991       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a34">cmdnfs_nfsstat3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+2, out_stream,
03992                             (caddr_t) &amp;p_LINK3res-&gt;status ) == FALSE )
03993       {
03994         <span class="keywordflow">return</span> FALSE;
03995       }
03996 
03997       <span class="keywordflow">if</span> ( p_LINK3res-&gt;status == NFS3_OK )
03998       {
03999         
04000         fprintf(out_stream, <span class="stringliteral">"%*sPost-op attributes (file):\n"</span>,indent+2, <span class="stringliteral">" "</span>);
04001         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a38">cmdnfs_postopattr</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+4, out_stream,
04002                                 (caddr_t) &amp; <a class="code" href="cmd__nfstools_8c.html#a43">LINK3_OK_ATTRS</a>(p_LINK3res) ) == FALSE )
04003         {
04004           <span class="keywordflow">return</span> FALSE;
04005         }
04006         
04007         fprintf(out_stream, <span class="stringliteral">"%*sWcc_data (link directory):\n"</span>,indent+2, <span class="stringliteral">" "</span>);
04008         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8c.html#a102">cmdnfs_wccdata</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+4, out_stream,
04009                              (caddr_t) &amp; <a class="code" href="cmd__nfstools_8c.html#a44">LINK3_OK_WCC</a>(p_LINK3res) ) == FALSE )
04010         {
04011           <span class="keywordflow">return</span> FALSE;
04012         }
04013                 
04014       }
04015       <span class="keywordflow">else</span>
04016       {
04017         fprintf(out_stream, <span class="stringliteral">"%*sPost-op attributes (file):\n"</span>,indent+2, <span class="stringliteral">" "</span>);
04018         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a38">cmdnfs_postopattr</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+4, out_stream,
04019                                 (caddr_t) &amp; <a class="code" href="cmd__nfstools_8c.html#a45">LINK3_FAIL_ATTRS</a>(p_LINK3res) ) == FALSE )
04020         {
04021           <span class="keywordflow">return</span> FALSE;
04022         }
04023         
04024         fprintf(out_stream, <span class="stringliteral">"%*sWcc_data (link directory):\n"</span>,indent+2, <span class="stringliteral">" "</span>);
04025         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8c.html#a102">cmdnfs_wccdata</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+4, out_stream,
04026                              (caddr_t) &amp; <a class="code" href="cmd__nfstools_8c.html#a46">LINK3_FAIL_WCC</a>(p_LINK3res) ) == FALSE )
04027         {
04028           <span class="keywordflow">return</span> FALSE;
04029         }
04030       }
04031       
04032       fprintf(out_stream, <span class="stringliteral">"%*s}\n"</span>,indent, <span class="stringliteral">" "</span>);
04033       
04034       <span class="keywordflow">return</span> TRUE;
04035       
04036       <span class="keywordflow">break</span>;
04037       
04038     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
04039       <span class="comment">/* never encoded */</span>
04040     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
04041       <span class="comment">/* it is never an input (never encoded, never allocated) */</span>
04042     <span class="keywordflow">default</span>:
04043       <span class="keywordflow">return</span> FALSE;
04044   }
04045   
04046 }    
04047 
04048 <span class="preprocessor">#undef LINK3_OK_ATTRS</span>
04049 <span class="preprocessor"></span><span class="preprocessor">#undef LINK3_OK_WCC</span>
04050 <span class="preprocessor"></span><span class="preprocessor">#undef LINK3_FAIL_ATTRS</span>
04051 <span class="preprocessor"></span><span class="preprocessor">#undef LINK3_FAIL_WCC</span>
04052 <span class="preprocessor"></span>
04053 
04054 
04055 
<a name="l04056"></a><a class="code" href="cmd__nfstools_8h.html#a62">04056</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a62">cmdnfs_SYMLINK3args</a>(
04057       cmdnfs_encodetype_t     encodeflag,
04058       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
04059       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
04060       caddr_t         p_nfs_struct    
04061     )
04062 {
04063   SYMLINK3args * p_SYMLINK3args = (  SYMLINK3args *) p_nfs_struct ;
04064   <span class="keywordtype">char</span> * str_mode;
04065   
04066   <span class="comment">/* sanity check */</span>
04067   <span class="keywordflow">if</span> ( p_SYMLINK3args == NULL ) <span class="keywordflow">return</span> FALSE;
04068   
04069   <span class="keywordflow">switch</span> ( encodeflag )
04070   {
04071     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
04072       
04073       <span class="keywordflow">if</span> ( (argc != 3)  &amp;&amp; (argc != 4) ) <span class="keywordflow">return</span> FALSE;
04074       
04075       <span class="comment">/* The first 2 args */</span>
04076       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a40">cmdnfs_diropargs3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>, 2, argv , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
04077                              (caddr_t) &amp;(p_SYMLINK3args-&gt;where) ) == FALSE )
04078       {
04079         <span class="keywordflow">return</span> FALSE;
04080       }
04081       
04082       <span class="comment">/* optional 3rd arg */</span>
04083       <span class="keywordflow">if</span> ( argc == 4 )
04084       {
04085         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a36">cmdnfs_sattr3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>, 1, argv + 2 , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
04086                                (caddr_t) &amp;(p_SYMLINK3args-&gt;symlink.symlink_attributes) ) == FALSE )
04087         {
04088           <span class="keywordflow">return</span> FALSE;
04089         }
04090         <span class="comment">/* 4th arg */</span>
04091         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a16">cmdnfs_dirpath</a>( <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>, argc - 3, argv + 3 , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
04092                                (caddr_t) &amp;(p_SYMLINK3args-&gt;symlink.symlink_data) ) == FALSE )
04093         {
04094           <span class="keywordflow">return</span> FALSE;
04095         }
04096         
04097       }
04098       <span class="keywordflow">else</span>
04099       {
04100         <span class="comment">/* empty attr set */</span>
04101         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a36">cmdnfs_sattr3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a> , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
04102                                (caddr_t) &amp;(p_SYMLINK3args-&gt;symlink.symlink_attributes) ) == FALSE )
04103         {
04104           <span class="keywordflow">return</span> FALSE;
04105         }        
04106         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a16">cmdnfs_dirpath</a>( <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>, argc - 2, argv + 2 , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
04107                                (caddr_t) &amp;(p_SYMLINK3args-&gt;symlink.symlink_data) ) == FALSE )
04108         {
04109           <span class="keywordflow">return</span> FALSE;
04110         }
04111       }
04112       
04113       <span class="keywordflow">return</span> TRUE;
04114       
04115     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
04116       <a class="code" href="cmd__nfstools_8h.html#a40">cmdnfs_diropargs3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a> , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
04117                          (caddr_t) &amp;(p_SYMLINK3args-&gt;where) );
04118       <a class="code" href="cmd__nfstools_8h.html#a36">cmdnfs_sattr3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a> , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
04119                      (caddr_t) &amp;(p_SYMLINK3args-&gt;symlink.symlink_attributes) );
04120       <a class="code" href="cmd__nfstools_8h.html#a16">cmdnfs_dirpath</a>( <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a> , 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>,
04121                      (caddr_t) &amp;(p_SYMLINK3args-&gt;symlink.symlink_data) );
04122       <span class="keywordflow">return</span> TRUE;
04123       <span class="keywordflow">break</span>;
04124       
04125     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
04126       <span class="comment">/* never decoded */</span>
04127     <span class="keywordflow">default</span>:
04128       <span class="keywordflow">return</span> FALSE;
04129   } 
04130 } <span class="comment">/* cmdnfs_SYMLINK3args */</span>
04131 
04132 
<a name="l04133"></a><a class="code" href="cmd__nfstools_8c.html#a47">04133</a> <span class="preprocessor">#define SYMLINK3_OK_FH( _p_SYMLINK3res ) ( (_p_SYMLINK3res)-&gt;SYMLINK3res_u.resok.obj )</span>
<a name="l04134"></a><a class="code" href="cmd__nfstools_8c.html#a48">04134</a> <span class="preprocessor"></span><span class="preprocessor">#define SYMLINK3_OK_ATTRS( _p_SYMLINK3res ) ( (_p_SYMLINK3res)-&gt;SYMLINK3res_u.resok.obj_attributes )</span>
<a name="l04135"></a><a class="code" href="cmd__nfstools_8c.html#a49">04135</a> <span class="preprocessor"></span><span class="preprocessor">#define SYMLINK3_OK_WCC( _p_SYMLINK3res ) ( (_p_SYMLINK3res)-&gt;SYMLINK3res_u.resok.dir_wcc )</span>
<a name="l04136"></a><a class="code" href="cmd__nfstools_8c.html#a50">04136</a> <span class="preprocessor"></span><span class="preprocessor">#define SYMLINK3_FAIL_WCC( _p_SYMLINK3res ) ( (_p_SYMLINK3res)-&gt;SYMLINK3res_u.resfail.dir_wcc )</span>
04137 <span class="preprocessor"></span>
<a name="l04138"></a><a class="code" href="cmd__nfstools_8h.html#a63">04138</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a63">cmdnfs_SYMLINK3res</a>(
04139       cmdnfs_encodetype_t     encodeflag,
04140       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
04141       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
04142       caddr_t     p_nfs_struct    
04143     )
04144 {
04145   
04146   SYMLINK3res * p_SYMLINK3res = ( SYMLINK3res *) p_nfs_struct ;
04147       
04148   <span class="comment">/* sanity check */</span>
04149   <span class="keywordflow">if</span> ( p_SYMLINK3res == NULL ) <span class="keywordflow">return</span> FALSE;
04150   
04151   <span class="keywordflow">switch</span> ( encodeflag )
04152   {
04153     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
04154             
04155       fprintf(out_stream, <span class="stringliteral">"%*sSYMLINK3res =\n"</span>,indent, <span class="stringliteral">" "</span>);
04156       fprintf(out_stream, <span class="stringliteral">"%*s{\n"</span>,indent, <span class="stringliteral">" "</span>);
04157       
04158       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a34">cmdnfs_nfsstat3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+2, out_stream,
04159                             (caddr_t) &amp;p_SYMLINK3res-&gt;status ) == FALSE )
04160       {
04161         <span class="keywordflow">return</span> FALSE;
04162       }
04163 
04164       <span class="keywordflow">if</span> ( p_SYMLINK3res-&gt;status == NFS3_OK )
04165       {
04166         
04167         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a39">cmdnfs_postopfh3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+2, out_stream,
04168                               (caddr_t) &amp; <a class="code" href="cmd__nfstools_8c.html#a47">SYMLINK3_OK_FH</a>(p_SYMLINK3res) ) == FALSE )
04169         {
04170           <span class="keywordflow">return</span> FALSE;
04171         }
04172         
04173         fprintf(out_stream, <span class="stringliteral">"%*sPost-op attributes (symlink):\n"</span>,indent+2, <span class="stringliteral">" "</span>);
04174         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a38">cmdnfs_postopattr</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+4, out_stream,
04175                                 (caddr_t) &amp; <a class="code" href="cmd__nfstools_8c.html#a48">SYMLINK3_OK_ATTRS</a>(p_SYMLINK3res) ) == FALSE )
04176         {
04177           <span class="keywordflow">return</span> FALSE;
04178         }
04179         
04180         fprintf(out_stream, <span class="stringliteral">"%*sWcc_data (directory):\n"</span>,indent+2, <span class="stringliteral">" "</span>);
04181         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8c.html#a102">cmdnfs_wccdata</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+4, out_stream,
04182                              (caddr_t) &amp; <a class="code" href="cmd__nfstools_8c.html#a49">SYMLINK3_OK_WCC</a>(p_SYMLINK3res) ) == FALSE )
04183         {
04184           <span class="keywordflow">return</span> FALSE;
04185         }
04186                 
04187       }
04188       <span class="keywordflow">else</span>
04189       {
04190         fprintf(out_stream, <span class="stringliteral">"%*sWcc_data (directory):\n"</span>,indent+2, <span class="stringliteral">" "</span>);
04191         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8c.html#a102">cmdnfs_wccdata</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+4, out_stream,
04192                              (caddr_t) &amp; <a class="code" href="cmd__nfstools_8c.html#a50">SYMLINK3_FAIL_WCC</a>(p_SYMLINK3res) ) == FALSE )
04193         {
04194           <span class="keywordflow">return</span> FALSE;
04195         }    
04196       }
04197       
04198       fprintf(out_stream, <span class="stringliteral">"%*s}\n"</span>,indent, <span class="stringliteral">" "</span>);
04199       
04200       <span class="keywordflow">return</span> TRUE;
04201       
04202       <span class="keywordflow">break</span>;
04203       
04204     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
04205       <span class="comment">/* never encoded */</span>
04206     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
04207       <span class="comment">/* it is never an input (never encoded, never allocated) */</span>
04208     <span class="keywordflow">default</span>:
04209       <span class="keywordflow">return</span> FALSE;
04210   }
04211   
04212 }    
04213 
04214 <span class="preprocessor">#undef SYMLINK3_OK_FH</span>
04215 <span class="preprocessor"></span><span class="preprocessor">#undef SYMLINK3_OK_ATTRS</span>
04216 <span class="preprocessor"></span><span class="preprocessor">#undef SYMLINK3_OK_WCC</span>
04217 <span class="preprocessor"></span><span class="preprocessor">#undef SYMLINK3_FAIL_WCC</span>
04218 <span class="preprocessor"></span>
04219 
<a name="l04220"></a><a class="code" href="cmd__nfstools_8c.html#a51">04220</a> <span class="preprocessor">#define FSINFO3_OK_ATTRS( _p_FSINFO3res ) ( (_p_FSINFO3res)-&gt;FSINFO3res_u.resok.obj_attributes )</span>
<a name="l04221"></a><a class="code" href="cmd__nfstools_8c.html#a52">04221</a> <span class="preprocessor"></span><span class="preprocessor">#define FSINFO3_OK_INFO( _p_FSINFO3res ) ( (_p_FSINFO3res)-&gt;FSINFO3res_u.resok )</span>
<a name="l04222"></a><a class="code" href="cmd__nfstools_8c.html#a53">04222</a> <span class="preprocessor"></span><span class="preprocessor">#define FSINFO3_FAIL_ATTRS( _p_FSINFO3res ) ( (_p_FSINFO3res)-&gt;FSINFO3res_u.resfail.obj_attributes )</span>
04223 <span class="preprocessor"></span>
<a name="l04224"></a><a class="code" href="cmd__nfstools_8h.html#a64">04224</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a64">cmdnfs_FSINFO3res</a>(
04225       cmdnfs_encodetype_t     encodeflag,
04226       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
04227       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
04228       caddr_t     p_nfs_struct    
04229     )
04230 {
04231   
04232   FSINFO3res * p_FSINFO3res = ( FSINFO3res *) p_nfs_struct ;
04233       
04234   <span class="comment">/* sanity check */</span>
04235   <span class="keywordflow">if</span> ( p_FSINFO3res == NULL ) <span class="keywordflow">return</span> FALSE;
04236   
04237   <span class="keywordflow">switch</span> ( encodeflag )
04238   {
04239     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
04240             
04241       fprintf(out_stream, <span class="stringliteral">"%*sFSINFO3res =\n"</span>,indent, <span class="stringliteral">" "</span>);
04242       fprintf(out_stream, <span class="stringliteral">"%*s{\n"</span>,indent, <span class="stringliteral">" "</span>);
04243       
04244       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a34">cmdnfs_nfsstat3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+2, out_stream,
04245                             (caddr_t) &amp;p_FSINFO3res-&gt;status ) == FALSE )
04246       {
04247         <span class="keywordflow">return</span> FALSE;
04248       }
04249 
04250       <span class="keywordflow">if</span> ( p_FSINFO3res-&gt;status == NFS3_OK )
04251       {
04252         
04253         fprintf(out_stream, <span class="stringliteral">"%*sPost-op attributes (root):\n"</span>,indent+2, <span class="stringliteral">" "</span>);
04254         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a38">cmdnfs_postopattr</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+4, out_stream,
04255                                 (caddr_t) &amp; <a class="code" href="cmd__nfstools_8c.html#a51">FSINFO3_OK_ATTRS</a>(p_FSINFO3res) ) == FALSE )
04256         {
04257           <span class="keywordflow">return</span> FALSE;
04258         }
04259         
04260         fprintf(out_stream, <span class="stringliteral">"%*srtmax = %u\n"</span>,indent+2, <span class="stringliteral">" "</span>,<a class="code" href="cmd__nfstools_8c.html#a52">FSINFO3_OK_INFO</a>(p_FSINFO3res).rtmax);
04261         fprintf(out_stream, <span class="stringliteral">"%*srtpref = %u\n"</span>,indent+2, <span class="stringliteral">" "</span>,<a class="code" href="cmd__nfstools_8c.html#a52">FSINFO3_OK_INFO</a>(p_FSINFO3res).rtpref);
04262         fprintf(out_stream, <span class="stringliteral">"%*srtmult = %u\n"</span>,indent+2, <span class="stringliteral">" "</span>,<a class="code" href="cmd__nfstools_8c.html#a52">FSINFO3_OK_INFO</a>(p_FSINFO3res).rtmult);
04263         fprintf(out_stream, <span class="stringliteral">"%*swtmax = %u\n"</span>,indent+2, <span class="stringliteral">" "</span>,<a class="code" href="cmd__nfstools_8c.html#a52">FSINFO3_OK_INFO</a>(p_FSINFO3res).wtmax);
04264         fprintf(out_stream, <span class="stringliteral">"%*swtpref = %u\n"</span>,indent+2, <span class="stringliteral">" "</span>,<a class="code" href="cmd__nfstools_8c.html#a52">FSINFO3_OK_INFO</a>(p_FSINFO3res).wtpref);
04265         fprintf(out_stream, <span class="stringliteral">"%*swtmult = %u\n"</span>,indent+2, <span class="stringliteral">" "</span>,<a class="code" href="cmd__nfstools_8c.html#a52">FSINFO3_OK_INFO</a>(p_FSINFO3res).wtmult);
04266         fprintf(out_stream, <span class="stringliteral">"%*sdtpref = %u\n"</span>,indent+2, <span class="stringliteral">" "</span>,<a class="code" href="cmd__nfstools_8c.html#a52">FSINFO3_OK_INFO</a>(p_FSINFO3res).dtpref);
04267         fprintf(out_stream, <span class="stringliteral">"%*smaxfilesize = %llu (%#llx)\n"</span>,indent+2, <span class="stringliteral">" "</span>,<a class="code" href="cmd__nfstools_8c.html#a52">FSINFO3_OK_INFO</a>(p_FSINFO3res).maxfilesize,
04268                                                                             <a class="code" href="cmd__nfstools_8c.html#a52">FSINFO3_OK_INFO</a>(p_FSINFO3res).maxfilesize );
04269         fprintf(out_stream, <span class="stringliteral">"%*stime_delta = %u.%.9u\n"</span>,indent+2, <span class="stringliteral">" "</span>,<a class="code" href="cmd__nfstools_8c.html#a52">FSINFO3_OK_INFO</a>(p_FSINFO3res).time_delta.seconds,
04270                                                                       <a class="code" href="cmd__nfstools_8c.html#a52">FSINFO3_OK_INFO</a>(p_FSINFO3res).time_delta.nseconds);
04271         fprintf(out_stream, <span class="stringliteral">"%*sproperties = %#x : "</span>,indent+2, <span class="stringliteral">" "</span>,<a class="code" href="cmd__nfstools_8c.html#a52">FSINFO3_OK_INFO</a>(p_FSINFO3res).properties );
04272         
04273         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8c.html#a52">FSINFO3_OK_INFO</a>(p_FSINFO3res).properties &amp; FSF3_LINK )
04274           fprintf(out_stream, <span class="stringliteral">"FSF3_LINK "</span> );         
04275         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8c.html#a52">FSINFO3_OK_INFO</a>(p_FSINFO3res).properties &amp; FSF3_SYMLINK )
04276           fprintf(out_stream, <span class="stringliteral">"FSF3_SYMLINK "</span> );
04277         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8c.html#a52">FSINFO3_OK_INFO</a>(p_FSINFO3res).properties &amp; FSF3_HOMOGENEOUS )
04278           fprintf(out_stream, <span class="stringliteral">"FSF3_HOMOGENEOUS "</span> );
04279         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8c.html#a52">FSINFO3_OK_INFO</a>(p_FSINFO3res).properties &amp; FSF3_CANSETTIME )
04280           fprintf(out_stream, <span class="stringliteral">"FSF3_CANSETTIME "</span> );
04281         
04282         fprintf(out_stream, <span class="stringliteral">"\n"</span> );
04283         
04284       }
04285       <span class="keywordflow">else</span>
04286       {
04287         fprintf(out_stream, <span class="stringliteral">"%*sPost-op attributes (root):\n"</span>,indent+2, <span class="stringliteral">" "</span>);
04288         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a38">cmdnfs_postopattr</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+4, out_stream,
04289                                 (caddr_t) &amp; <a class="code" href="cmd__nfstools_8c.html#a53">FSINFO3_FAIL_ATTRS</a>(p_FSINFO3res) ) == FALSE )
04290         {
04291           <span class="keywordflow">return</span> FALSE;
04292         }
04293       }
04294       
04295       fprintf(out_stream, <span class="stringliteral">"%*s}\n"</span>,indent, <span class="stringliteral">" "</span>);
04296       
04297       <span class="keywordflow">return</span> TRUE;
04298       
04299       <span class="keywordflow">break</span>;
04300       
04301     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
04302       <span class="comment">/* never encoded */</span>
04303     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
04304       <span class="comment">/* it is never an input (never encoded, never allocated) */</span>
04305     <span class="keywordflow">default</span>:
04306       <span class="keywordflow">return</span> FALSE;
04307   }
04308   
04309 }  <span class="comment">/* cmdnfs_FSINFO3res */</span>   
04310 
04311 <span class="preprocessor">#undef FSINFO3_OK_ATTRS</span>
04312 <span class="preprocessor"></span><span class="preprocessor">#undef FSINFO3_OK_INFO</span>
04313 <span class="preprocessor"></span><span class="preprocessor">#undef FSINFO3_FAIL_ATTRS</span>
04314 <span class="preprocessor"></span>
04315 
04316 
<a name="l04317"></a><a class="code" href="cmd__nfstools_8c.html#a54">04317</a> <span class="preprocessor">#define PATHCONF3_OK_ATTRS( _p_PATHCONF3res ) ( (_p_PATHCONF3res)-&gt;PATHCONF3res_u.resok.obj_attributes )</span>
<a name="l04318"></a><a class="code" href="cmd__nfstools_8c.html#a55">04318</a> <span class="preprocessor"></span><span class="preprocessor">#define PATHCONF3_OK_INFO( _p_PATHCONF3res ) ( (_p_PATHCONF3res)-&gt;PATHCONF3res_u.resok )</span>
<a name="l04319"></a><a class="code" href="cmd__nfstools_8c.html#a56">04319</a> <span class="preprocessor"></span><span class="preprocessor">#define PATHCONF3_FAIL_ATTRS( _p_PATHCONF3res ) ( (_p_PATHCONF3res)-&gt;PATHCONF3res_u.resfail.obj_attributes )</span>
04320 <span class="preprocessor"></span>
<a name="l04321"></a><a class="code" href="cmd__nfstools_8h.html#a65">04321</a> <span class="keywordtype">int</span> <a class="code" href="cmd__nfstools_8h.html#a65">cmdnfs_PATHCONF3res</a>(
04322       cmdnfs_encodetype_t     encodeflag,
04323       <span class="keywordtype">int</span>   argc,     <span class="keywordtype">char</span> ** argv,
04324       <span class="keywordtype">int</span>   indent,   FILE *  out_stream,
04325       caddr_t     p_nfs_struct    
04326     )
04327 {
04328   
04329   PATHCONF3res * p_PATHCONF3res = ( PATHCONF3res *) p_nfs_struct ;
04330       
04331   <span class="comment">/* sanity check */</span>
04332   <span class="keywordflow">if</span> ( p_PATHCONF3res == NULL ) <span class="keywordflow">return</span> FALSE;
04333   
04334   <span class="keywordflow">switch</span> ( encodeflag )
04335   {
04336     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>:
04337             
04338       fprintf(out_stream, <span class="stringliteral">"%*sPATHCONF3res =\n"</span>,indent, <span class="stringliteral">" "</span>);
04339       fprintf(out_stream, <span class="stringliteral">"%*s{\n"</span>,indent, <span class="stringliteral">" "</span>);
04340       
04341       <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a34">cmdnfs_nfsstat3</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+2, out_stream,
04342                             (caddr_t) &amp;p_PATHCONF3res-&gt;status ) == FALSE )
04343       {
04344         <span class="keywordflow">return</span> FALSE;
04345       }
04346 
04347       <span class="keywordflow">if</span> ( p_PATHCONF3res-&gt;status == NFS3_OK )
04348       {
04349         
04350         fprintf(out_stream, <span class="stringliteral">"%*sPost-op attributes (object):\n"</span>,indent+2, <span class="stringliteral">" "</span>);
04351         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a38">cmdnfs_postopattr</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+4, out_stream,
04352                                 (caddr_t) &amp; <a class="code" href="cmd__nfstools_8c.html#a54">PATHCONF3_OK_ATTRS</a>(p_PATHCONF3res) ) == FALSE )
04353         {
04354           <span class="keywordflow">return</span> FALSE;
04355         }
04356         
04357         fprintf(out_stream, <span class="stringliteral">"%*slinkmax = %u\n"</span>,indent+2, <span class="stringliteral">" "</span>,<a class="code" href="cmd__nfstools_8c.html#a55">PATHCONF3_OK_INFO</a>(p_PATHCONF3res).linkmax);
04358         fprintf(out_stream, <span class="stringliteral">"%*sname_max = %u\n"</span>,indent+2, <span class="stringliteral">" "</span>,<a class="code" href="cmd__nfstools_8c.html#a55">PATHCONF3_OK_INFO</a>(p_PATHCONF3res).name_max);
04359         fprintf(out_stream, <span class="stringliteral">"%*sno_trunc = %u\n"</span>,indent+2, <span class="stringliteral">" "</span>,<a class="code" href="cmd__nfstools_8c.html#a55">PATHCONF3_OK_INFO</a>(p_PATHCONF3res).no_trunc);
04360         fprintf(out_stream, <span class="stringliteral">"%*schown_restricted = %u\n"</span>,indent+2, <span class="stringliteral">" "</span>,<a class="code" href="cmd__nfstools_8c.html#a55">PATHCONF3_OK_INFO</a>(p_PATHCONF3res).chown_restricted);
04361         fprintf(out_stream, <span class="stringliteral">"%*scase_insensitive = %u\n"</span>,indent+2, <span class="stringliteral">" "</span>,<a class="code" href="cmd__nfstools_8c.html#a55">PATHCONF3_OK_INFO</a>(p_PATHCONF3res).case_insensitive);
04362         fprintf(out_stream, <span class="stringliteral">"%*scase_preserving = %u\n"</span>,indent+2, <span class="stringliteral">" "</span>,<a class="code" href="cmd__nfstools_8c.html#a55">PATHCONF3_OK_INFO</a>(p_PATHCONF3res).case_preserving);
04363         
04364       }
04365       <span class="keywordflow">else</span>
04366       {
04367         fprintf(out_stream, <span class="stringliteral">"%*sPost-op attributes (object):\n"</span>,indent+2, <span class="stringliteral">" "</span>);
04368         <span class="keywordflow">if</span> ( <a class="code" href="cmd__nfstools_8h.html#a38">cmdnfs_postopattr</a>( <a class="code" href="cmd__nfstools_8h.html#a70a13">CMDNFS_DECODE</a>, 0, <a class="code" href="Getopt_8c.html#a0">NULL</a>, indent+4, out_stream,
04369                                 (caddr_t) &amp; <a class="code" href="cmd__nfstools_8c.html#a56">PATHCONF3_FAIL_ATTRS</a>(p_PATHCONF3res) ) == FALSE )
04370         {
04371           <span class="keywordflow">return</span> FALSE;
04372         }
04373       }
04374       
04375       fprintf(out_stream, <span class="stringliteral">"%*s}\n"</span>,indent, <span class="stringliteral">" "</span>);
04376       
04377       <span class="keywordflow">return</span> TRUE;
04378       
04379       <span class="keywordflow">break</span>;
04380       
04381     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a12">CMDNFS_ENCODE</a>:
04382       <span class="comment">/* never encoded */</span>
04383     <span class="keywordflow">case</span> <a class="code" href="cmd__nfstools_8h.html#a70a14">CMDNFS_FREE</a>:
04384       <span class="comment">/* it is never an input (never encoded, never allocated) */</span>
04385     <span class="keywordflow">default</span>:
04386       <span class="keywordflow">return</span> FALSE;
04387   }
04388   
04389 }  <span class="comment">/* cmdnfs_PATHCONF3res */</span>   
04390 
04391 <span class="preprocessor">#undef PATHCONF3_OK_ATTRS</span>
04392 <span class="preprocessor"></span><span class="preprocessor">#undef PATHCONF3_OK_INFO</span>
04393 <span class="preprocessor"></span><span class="preprocessor">#undef PATHCONF3_FAIL_ATTRS</span>
04394 <span class="preprocessor"></span>
04395 
04396 
04397 <span class="comment">/*-----------------------------------------------------------------------*/</span>
04398 
04399 
<a name="l04411"></a><a class="code" href="cmd__nfstools_8c.html#a57">04411</a> <span class="preprocessor">#define print_mask(_out,_mode,_mask,_lettre) do {    \</span>
04412 <span class="preprocessor">        if (_mode &amp; _mask) fprintf(_out,_lettre);    \</span>
04413 <span class="preprocessor">        else fprintf(_out,"-");                      \</span>
04414 <span class="preprocessor">      } while(0)</span>
04415 <span class="preprocessor"></span>
<a name="l04416"></a><a class="code" href="cmd__nfstools_8h.html#a68">04416</a> <span class="keywordtype">void</span> <a class="code" href="cmd__nfstools_8h.html#a68">print_nfsitem_line</a>( FILE * out,fattr3 * attrib, <span class="keywordtype">char</span> * name , <span class="keywordtype">char</span> * target){
04417   
04418   <span class="keywordtype">char</span> buff[256];
04419   <span class="keywordtype">int</span> i;
04420   
04421   <span class="comment">/* print inode */</span>
04422   fprintf(out,<span class="stringliteral">"%10llx "</span>,attrib-&gt;fileid);
04423     
04424   <span class="comment">/* printing type */</span>
04425   <span class="keywordflow">switch</span>( attrib-&gt;type ){
04426     <span class="keywordflow">case</span> NF3FIFO:fprintf(out,<span class="stringliteral">"p"</span>);<span class="keywordflow">break</span>;
04427     <span class="keywordflow">case</span> NF3CHR:fprintf(out,<span class="stringliteral">"c"</span>);<span class="keywordflow">break</span>;
04428     <span class="keywordflow">case</span> NF3DIR:fprintf(out,<span class="stringliteral">"d"</span>);<span class="keywordflow">break</span>;
04429     <span class="keywordflow">case</span> NF3BLK:fprintf(out,<span class="stringliteral">"b"</span>);<span class="keywordflow">break</span>;
04430     <span class="keywordflow">case</span> NF3REG:fprintf(out,<span class="stringliteral">"-"</span>);<span class="keywordflow">break</span>;
04431     <span class="keywordflow">case</span> NF3LNK:fprintf(out,<span class="stringliteral">"l"</span>);<span class="keywordflow">break</span>;
04432     <span class="keywordflow">case</span> NF3SOCK:fprintf(out,<span class="stringliteral">"s"</span>);<span class="keywordflow">break</span>;
04433     <span class="keywordflow">default</span>:fprintf(out,<span class="stringliteral">"?"</span>);
04434   }
04435   
04436   <span class="comment">/* printing rights */</span>
04437   <a class="code" href="cmd__nfstools_8c.html#a57">print_mask</a>(out,attrib-&gt;mode,S_IRUSR,<span class="stringliteral">"r"</span>);
04438   <a class="code" href="cmd__nfstools_8c.html#a57">print_mask</a>(out,attrib-&gt;mode,S_IWUSR,<span class="stringliteral">"w"</span>);  
04439 
04440   <span class="keywordflow">if</span> ( attrib-&gt;mode &amp; S_ISUID ){
04441     <span class="keywordflow">if</span> ( attrib-&gt;mode &amp; S_IXUSR )
04442       fprintf(out,<span class="stringliteral">"s"</span>);
04443     <span class="keywordflow">else</span>
04444       fprintf(out,<span class="stringliteral">"S"</span>);
04445   } <span class="keywordflow">else</span> {
04446     <span class="keywordflow">if</span> ( attrib-&gt;mode &amp; S_IXUSR )
04447       fprintf(out,<span class="stringliteral">"x"</span>);
04448     <span class="keywordflow">else</span>
04449       fprintf(out,<span class="stringliteral">"-"</span>);    
04450   }
04451 
04452   <a class="code" href="cmd__nfstools_8c.html#a57">print_mask</a>(out,attrib-&gt;mode,S_IRGRP,<span class="stringliteral">"r"</span>);
04453   <a class="code" href="cmd__nfstools_8c.html#a57">print_mask</a>(out,attrib-&gt;mode,S_IWGRP,<span class="stringliteral">"w"</span>);
04454 
04455   <span class="keywordflow">if</span> ( attrib-&gt;mode &amp; S_ISGID ){
04456     <span class="keywordflow">if</span> ( attrib-&gt;mode &amp; S_IXGRP )
04457       fprintf(out,<span class="stringliteral">"s"</span>);
04458     <span class="keywordflow">else</span>
04459       fprintf(out,<span class="stringliteral">"l"</span>);
04460   } <span class="keywordflow">else</span> {
04461     <span class="keywordflow">if</span> ( attrib-&gt;mode &amp; S_IXGRP )
04462       fprintf(out,<span class="stringliteral">"x"</span>);
04463     <span class="keywordflow">else</span>
04464       fprintf(out,<span class="stringliteral">"-"</span>);    
04465   }
04466   <a class="code" href="cmd__nfstools_8c.html#a57">print_mask</a>(out,attrib-&gt;mode,S_IROTH,<span class="stringliteral">"r"</span>);
04467   <a class="code" href="cmd__nfstools_8c.html#a57">print_mask</a>(out,attrib-&gt;mode,S_IWOTH,<span class="stringliteral">"w"</span>);  
04468   <a class="code" href="cmd__nfstools_8c.html#a57">print_mask</a>(out,attrib-&gt;mode,S_IXOTH,<span class="stringliteral">"x"</span>);
04469 
04470   fprintf(out,<span class="stringliteral">" %3u"</span>,attrib-&gt;nlink);
04471   fprintf(out,<span class="stringliteral">" %8d"</span>,attrib-&gt;uid);
04472   fprintf(out,<span class="stringliteral">" %8d"</span>,attrib-&gt;gid);
04473   fprintf(out,<span class="stringliteral">" %15llu"</span>,attrib-&gt;size);
04474 
04475   <span class="comment">/* print mtime */</span>    
04476   fprintf(out,<span class="stringliteral">" %15s"</span>,<a class="code" href="cmd__tools_8h.html#a14">time2str</a>( attrib-&gt;mtime.seconds, buff));
04477   
04478   <span class="comment">/* print name */</span>
04479   fprintf(out,<span class="stringliteral">" %s"</span>, name);
04480   
04481   <span class="keywordflow">if</span> (attrib-&gt;type == NF3LNK)
04482     fprintf(out,<span class="stringliteral">" -&gt; %s"</span>, target);
04483   
04484   fprintf(out,<span class="stringliteral">"\n"</span>);
04485   <span class="keywordflow">return</span>;
04486   
04487 } <span class="comment">/* print_nfsitem_line */</span>
04488 
04489 
04490 
04491 
<a name="l04500"></a><a class="code" href="cmd__nfstools_8h.html#a69">04500</a> <span class="keywordtype">void</span> <a class="code" href="cmd__nfstools_8h.html#a69">print_nfs_attributes</a>( fattr3 * attrs,FILE * output){
04501   
04502     fprintf(output,<span class="stringliteral">"\tType : %s\n"</span>,nfstype3_to_str(attrs-&gt;type));
04503     fprintf(output,<span class="stringliteral">"\tSize : %llu\n"</span>,attrs-&gt;size);
04504     fprintf(output,<span class="stringliteral">"\tfsId : %u.%u\n"</span>,(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)(attrs-&gt;fsid&gt;&gt;32),(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)attrs-&gt;fsid);
04505     fprintf(output,<span class="stringliteral">"\tFileId : %#llx\n"</span>,attrs-&gt;fileid);
04506     fprintf(output,<span class="stringliteral">"\tMode : %#o\n"</span>,attrs-&gt;mode);
04507     fprintf(output,<span class="stringliteral">"\tNumlinks : %u\n"</span>,attrs-&gt;nlink);
04508     fprintf(output,<span class="stringliteral">"\tuid : %d\n"</span>,attrs-&gt;uid);
04509     fprintf(output,<span class="stringliteral">"\tgid : %d\n"</span>,attrs-&gt;gid);
04510     fprintf(output,<span class="stringliteral">"\tRawdev : %u.%u\n"</span>,attrs-&gt;rdev.specdata1,attrs-&gt;rdev.specdata2);
04511     fprintf(output,<span class="stringliteral">"\tatime : %s"</span>,ctime((time_t*)&amp;attrs-&gt;atime.seconds));
04512     fprintf(output,<span class="stringliteral">"\tctime : %s"</span>,ctime((time_t*)&amp;attrs-&gt;ctime.seconds));
04513     fprintf(output,<span class="stringliteral">"\tmtime : %s"</span>,ctime((time_t*)&amp;attrs-&gt;mtime.seconds));
04514     fprintf(output,<span class="stringliteral">"\tspaceused : %llu\n"</span>,attrs-&gt;used);
04515     
04516 }
04517 
04518 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Apr 9 08:24:34 2008 for ganeshell by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
