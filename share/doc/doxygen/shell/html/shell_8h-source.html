<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ganeshell: shell.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>shell.h</h1><a href="shell_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 
00035 <span class="preprocessor">#ifndef _SHELL_H</span>
00036 <span class="preprocessor"></span><span class="preprocessor">#define _SHELL_H</span>
00037 <span class="preprocessor"></span>
00038 <span class="preprocessor">#include "<a class="code" href="shell__types_8h.html">shell_types.h</a>"</span>
00039 
00040 
<a name="l00041"></a><a class="code" href="shell_8h.html#a0">00041</a> <span class="preprocessor">#define MAX_LINE_LEN      1024</span>
<a name="l00042"></a><a class="code" href="shell_8h.html#a1">00042</a> <span class="preprocessor"></span><span class="preprocessor">#define MAX_ARGS           256</span>
00043 <span class="preprocessor"></span>
00044 
00045 <span class="comment">/*------------------------------------------------------------------</span>
00046 <span class="comment"> *                    Internal error codes.</span>
00047 <span class="comment"> *-----------------------------------------------------------------*/</span>
00048 
<a name="l00049"></a><a class="code" href="shell_8h.html#a2">00049</a> <span class="preprocessor">#define SHELL_SUCCESS 0</span>
<a name="l00050"></a><a class="code" href="shell_8h.html#a3">00050</a> <span class="preprocessor"></span><span class="preprocessor">#define SHELL_ERROR  -1</span>
<a name="l00051"></a><a class="code" href="shell_8h.html#a4">00051</a> <span class="preprocessor"></span><span class="preprocessor">#define SHELL_NOT_FOUND -2</span>
<a name="l00052"></a><a class="code" href="shell_8h.html#a5">00052</a> <span class="preprocessor"></span><span class="preprocessor">#define SHELL_SYNTAX_ERROR -22</span>
00053 <span class="preprocessor"></span>
00054 <span class="comment">/*------------------------------------------------------------------</span>
00055 <span class="comment"> *                    Main shell routines.</span>
00056 <span class="comment"> *-----------------------------------------------------------------*/</span>
00057 
00063 <span class="keywordtype">int</span> <a class="code" href="shell_8h.html#a8">shell_Init</a>( <span class="keywordtype">int</span> verbose,
00064                 <span class="keywordtype">char</span> * input_file,                
00065                 <span class="keywordtype">char</span> * prompt,
00066                 <span class="keywordtype">int</span> shell_index );
00067 
00071 <span class="keywordtype">int</span> <a class="code" href="shell_8c.html#a18">shell_Launch</a>();
00072 
00073 
00078 <span class="keywordtype">int</span> <a class="code" href="shell_8h.html#a10">shell_BarrierInit</a>( <span class="keywordtype">int</span> nb_threads );
00079 
00080 
00081 
00082 <span class="comment">/*------------------------------------------------------------------</span>
00083 <span class="comment"> *                Parsing and execution routines.</span>
00084 <span class="comment"> *-----------------------------------------------------------------*/</span>
00085 
00097 <span class="keywordtype">int</span> <a class="code" href="shell_8h.html#a11">shell_ParseLine</a>( <span class="keywordtype">char</span> * in_out_line, <span class="keywordtype">char</span> ** out_arglist, <span class="keywordtype">int</span> * p_argcount );
00098 
00099 
00111 <span class="keywordtype">void</span> <a class="code" href="shell_8h.html#a12">shell_CleanArgs</a>( <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> ** in_out_argv, <span class="keywordtype">int</span> * in_allocated );
00112 
00113 
00125 <span class="keywordtype">int</span> <a class="code" href="shell_8h.html#a13">shell_SolveArgs</a>( <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> ** in_out_argv, <span class="keywordtype">int</span> * out_allocated );
00126 
00127 
00128 
00139 <span class="keywordtype">int</span> <a class="code" href="shell_8h.html#a14">shell_Execute</a>( <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> ** argv, FILE * output );
00140                     
00141 
00142 
00143 <span class="comment">/*------------------------------------------------------------------</span>
00144 <span class="comment"> *                 Shell ouput routines.</span>
00145 <span class="comment"> *-----------------------------------------------------------------*/</span>
00146 
00151 <span class="keywordtype">void</span> <a class="code" href="shell_8h.html#a15">shell_PrintError</a>(<a class="code" href="structshell__state____.html">shell_state_t</a>  * context, <span class="keywordtype">char</span> * error_msg );
00152 
00157 <span class="keywordtype">void</span> <a class="code" href="shell_8h.html#a16">shell_PrintTrace</a>(<a class="code" href="structshell__state____.html">shell_state_t</a>  * context, <span class="keywordtype">char</span> * msg );
00158 
00159 
00160 <span class="comment">/*------------------------------------------------------------------</span>
00161 <span class="comment"> *                 Shell state management routines.</span>
00162 <span class="comment"> *-----------------------------------------------------------------*/</span>
00163 
00164 
00167 <span class="keyword">static</span> <span class="keywordtype">char</span> * shell_special_vars[] =
00168 {
00169   <span class="stringliteral">"INPUT"</span>,       <span class="comment">/* a filename or &lt;stdin&gt; */</span>
00170   <span class="stringliteral">"INTERACTIVE"</span>, <span class="comment">/* Indicates if we are in interactive mode */</span>
00171   <span class="stringliteral">"LAYER"</span>,       <span class="comment">/* The current layer */</span>      
00172   <span class="stringliteral">"STATUS"</span>,      <span class="comment">/* Last command status */</span>
00173   <span class="stringliteral">"?"</span>,           <span class="comment">/* idem */</span>
00174   <span class="stringliteral">"VERBOSE"</span>,     <span class="comment">/* shel verbose mode */</span>      
00175   <span class="stringliteral">"DEBUG_LEVEL"</span>, <span class="comment">/* layer debug level */</span>
00176   <span class="stringliteral">"DBG_LVL"</span>,     <span class="comment">/* idem */</span>
00177   <span class="stringliteral">"PROMPT"</span>,      <span class="comment">/* shell prompt string */</span>
00178   <span class="stringliteral">"LINE"</span>,        <span class="comment">/* line number */</span>
00179   
00180   
00181    <span class="comment">/* end of special vars list */</span>
00182    <a class="code" href="Getopt_8c.html#a0">NULL</a>
00183 };
00184 
00185 
00192 <span class="keywordtype">int</span> <a class="code" href="shell_8h.html#a17">shell_SetLayer</a>( <a class="code" href="structshell__state____.html">shell_state_t</a> * context, <span class="keywordtype">char</span> * layer_name );
00193 
00194 
00199 <a class="code" href="structlayer__def____.html">layer_def_t</a> * <a class="code" href="shell_8h.html#a18">shell_GetLayer</a>(<a class="code" href="structshell__state____.html">shell_state_t</a> * context);
00200 
00201 
00206 <span class="keywordtype">int</span> <a class="code" href="shell_8h.html#a19">shell_SetStatus</a>( <a class="code" href="structshell__state____.html">shell_state_t</a> * context, <span class="keywordtype">int</span> returned_status );
00207 
00208 
00213 <span class="keywordtype">int</span> <a class="code" href="shell_8h.html#a20">shell_GetStatus</a>(<a class="code" href="structshell__state____.html">shell_state_t</a> * context );
00214 
00215 
00220 <span class="keywordtype">int</span> <a class="code" href="shell_8h.html#a21">shell_SetVerbose</a>( <a class="code" href="structshell__state____.html">shell_state_t</a> * context, <span class="keywordtype">char</span> * str_verbose );
00221 
00222 
00227 <span class="keywordtype">int</span> <a class="code" href="shell_8h.html#a22">shell_GetVerbose</a>(<a class="code" href="structshell__state____.html">shell_state_t</a> * context );
00228 
00229 
00234 <span class="keywordtype">int</span> <a class="code" href="shell_8h.html#a23">shell_SetDbgLvl</a>( <a class="code" href="structshell__state____.html">shell_state_t</a> * context, <span class="keywordtype">char</span> * str_debug_level );
00235 
00236 
00241 <span class="keywordtype">int</span> <a class="code" href="shell_8h.html#a24">shell_GetDbgLvl</a>();
00242 
00243 
00248 FILE * <a class="code" href="shell_8h.html#a25">shell_GetInputStream</a>(<a class="code" href="structshell__state____.html">shell_state_t</a> * context );
00249 
00250 
00251 
00260 <span class="keywordtype">int</span> <a class="code" href="shell_8h.html#a26">shell_SetInput</a>( <a class="code" href="structshell__state____.html">shell_state_t</a> * context, <span class="keywordtype">char</span> * file_name );
00261 
00262 
00263 
00268 <span class="keywordtype">int</span> <a class="code" href="shell_8h.html#a27">shell_SetPrompt</a>( <a class="code" href="structshell__state____.html">shell_state_t</a> * context, <span class="keywordtype">char</span> * str_prompt );
00269 
00270 
00275 <span class="keywordtype">char</span> * <a class="code" href="shell_8h.html#a28">shell_GetPrompt</a>( <a class="code" href="structshell__state____.html">shell_state_t</a> * context );
00276 
00277 
00282 <span class="keywordtype">int</span> <a class="code" href="shell_8h.html#a29">shell_SetShellId</a>( <a class="code" href="structshell__state____.html">shell_state_t</a> * context, <span class="keywordtype">int</span> shell_index );
00283 
00284 
00289 <span class="keywordtype">int</span> <a class="code" href="shell_8h.html#a30">shell_SetLine</a>( <a class="code" href="structshell__state____.html">shell_state_t</a> * context, <span class="keywordtype">int</span> lineno );
00290 
00291 
00296 <span class="keywordtype">int</span> <a class="code" href="shell_8h.html#a31">shell_GetLine</a>( <a class="code" href="structshell__state____.html">shell_state_t</a> * context );
00297 
00298  
00299 <span class="comment">/*------------------------------------------------------------------</span>
00300 <span class="comment"> *                      Shell commands.</span>
00301 <span class="comment"> *-----------------------------------------------------------------*/</span>
00302 
00303  
00304 <span class="keywordtype">int</span> <a class="code" href="shell_8h.html#a32">shellcmd_help</a>(
00305                    <span class="keywordtype">int</span> argc ,         <span class="comment">/* IN : number of args in argv */</span>
00306                    <span class="keywordtype">char</span> ** argv ,     <span class="comment">/* IN : arg list               */</span>
00307                    FILE * output      <span class="comment">/* IN : output stream          */</span>
00308                   );
00309 
00310 
00311 <span class="keywordtype">int</span> <a class="code" href="shell_8h.html#a33">shellcmd_if</a>(
00312                    <span class="keywordtype">int</span> argc ,         <span class="comment">/* IN : number of args in argv */</span>
00313                    <span class="keywordtype">char</span> ** argv ,     <span class="comment">/* IN : arg list               */</span>
00314                    FILE * output      <span class="comment">/* IN : output stream          */</span>
00315                   );
00316 
00317 
00318 <span class="keywordtype">int</span> <a class="code" href="shell_8h.html#a34">shellcmd_interactive</a>(
00319                    <span class="keywordtype">int</span> argc ,         <span class="comment">/* IN : number of args in argv */</span>
00320                    <span class="keywordtype">char</span> ** argv ,     <span class="comment">/* IN : arg list               */</span>
00321                    FILE * output      <span class="comment">/* IN : output stream          */</span>
00322                   );
00323 
00324 
00325 <span class="keywordtype">int</span> <a class="code" href="shell_8h.html#a35">shellcmd_set</a>(
00326                    <span class="keywordtype">int</span> argc ,         <span class="comment">/* IN : number of args in argv */</span>
00327                    <span class="keywordtype">char</span> ** argv ,     <span class="comment">/* IN : arg list               */</span>
00328                    FILE * output      <span class="comment">/* IN : output stream          */</span>
00329                   );
00330 
00331 
00332 <span class="keywordtype">int</span> <a class="code" href="shell_8h.html#a36">shellcmd_unset</a>(
00333                    <span class="keywordtype">int</span> argc ,         <span class="comment">/* IN : number of args in argv */</span>
00334                    <span class="keywordtype">char</span> ** argv ,     <span class="comment">/* IN : arg list               */</span>
00335                    FILE * output      <span class="comment">/* IN : output stream          */</span>
00336                   );
00337 
00338 
00339 <span class="keywordtype">int</span> <a class="code" href="shell_8h.html#a37">shellcmd_print</a>(
00340                    <span class="keywordtype">int</span> argc ,         <span class="comment">/* IN : number of args in argv */</span>
00341                    <span class="keywordtype">char</span> ** argv ,     <span class="comment">/* IN : arg list               */</span>
00342                    FILE * output      <span class="comment">/* IN : output stream          */</span>
00343                   );
00344 
00345 
00346 <span class="keywordtype">int</span> <a class="code" href="shell_8h.html#a38">shellcmd_varlist</a>(
00347                    <span class="keywordtype">int</span> argc ,         <span class="comment">/* IN : number of args in argv */</span>
00348                    <span class="keywordtype">char</span> ** argv ,     <span class="comment">/* IN : arg list               */</span>
00349                    FILE * output      <span class="comment">/* IN : output stream          */</span>
00350                   );
00351 
00352 
00353 <span class="keywordtype">int</span> <a class="code" href="shell_8h.html#a39">shellcmd_time</a>(
00354                    <span class="keywordtype">int</span> argc ,         <span class="comment">/* IN : number of args in argv */</span>
00355                    <span class="keywordtype">char</span> ** argv ,     <span class="comment">/* IN : arg list               */</span>
00356                    FILE * output      <span class="comment">/* IN : output stream          */</span>
00357                   );
00358 
00359 
00360 <span class="keywordtype">int</span> <a class="code" href="shell_8h.html#a40">shellcmd_quit</a>(
00361                    <span class="keywordtype">int</span> argc ,         <span class="comment">/* IN : number of args in argv */</span>
00362                    <span class="keywordtype">char</span> ** argv ,     <span class="comment">/* IN : arg list               */</span>
00363                    FILE * output      <span class="comment">/* IN : output stream          */</span>
00364                   );
00365 
00366 
00367 <span class="keywordtype">int</span> <a class="code" href="shell_8h.html#a41">shellcmd_barrier</a>(
00368                    <span class="keywordtype">int</span> argc ,         <span class="comment">/* IN : number of args in argv */</span>
00369                    <span class="keywordtype">char</span> ** argv ,     <span class="comment">/* IN : arg list               */</span>
00370                    FILE * output      <span class="comment">/* IN : output stream          */</span>
00371                   );
00372 
00373 
00376 <span class="keyword">static</span> <a class="code" href="structcommand__def____.html">command_def_t</a>  shell_commands[]={
00377   
00378   {<span class="stringliteral">"barrier"</span>,      shellcmd_barrier,     <span class="stringliteral">"synchronization in a multi-thread shell"</span>},
00379   {<span class="stringliteral">"echo"</span>,         shellcmd_print,       <span class="stringliteral">"print one or more arguments"</span>},
00380   {<span class="stringliteral">"exit"</span>,         shellcmd_quit,        <span class="stringliteral">"exit this shell"</span>},
00381   {<span class="stringliteral">"help"</span>,         shellcmd_help,        <span class="stringliteral">"print this help"</span>},
00382   {<span class="stringliteral">"if"</span>,           shellcmd_if,          <span class="stringliteral">"conditionnal execution"</span>},
00383   {<span class="stringliteral">"interactive"</span>,  shellcmd_interactive, <span class="stringliteral">"close script file and start interactive mode"</span>},
00384   {<span class="stringliteral">"print"</span>,        shellcmd_print,       <span class="stringliteral">"print one or more arguments"</span>},
00385   {<span class="stringliteral">"quit"</span>,         shellcmd_quit,        <span class="stringliteral">"exit this shell"</span>},
00386   {<span class="stringliteral">"set"</span>,          shellcmd_set,         <span class="stringliteral">"set the value of a shell variable"</span>},
00387   {<span class="stringliteral">"time"</span>,         shellcmd_time,        <span class="stringliteral">"measures the time for executing a command"</span>},
00388   {<span class="stringliteral">"unset"</span>,        shellcmd_unset,       <span class="stringliteral">"free a shell variable"</span>},
00389   {<span class="stringliteral">"varlist"</span>,      shellcmd_varlist,     <span class="stringliteral">"print the list of shell variables"</span>},
00390   
00391   {NULL,NULL,<a class="code" href="Getopt_8c.html#a0">NULL</a>} <span class="comment">/* End of command list */</span>
00392 };
00393  
00394 
00395 
00396 <span class="comment">/* @todo: if, source */</span>
00397 
00398  
00399 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Apr 9 08:24:35 2008 for ganeshell by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
