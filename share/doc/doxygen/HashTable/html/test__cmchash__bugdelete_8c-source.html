<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Hash Table Library: test_cmchash_bugdelete.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>test_cmchash_bugdelete.c</h1><a href="test__cmchash__bugdelete_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">/*</span>
00002 <span class="comment"> * vim:expandtab:shiftwidth=8:tabstop=8:</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> * Copyright CEA/DAM/DIF  (2008)</span>
00005 <span class="comment"> * contributeur : Philippe DENIEL   philippe.deniel@cea.fr</span>
00006 <span class="comment"> *                Thomas LEIBOVICI  thomas.leibovici@cea.fr</span>
00007 <span class="comment"> *</span>
00008 <span class="comment"> *</span>
00009 <span class="comment"> * Ce logiciel est un serveur implementant le protocole NFS.</span>
00010 <span class="comment"> *</span>
00011 <span class="comment"> * Ce logiciel est régi par la licence CeCILL soumise au droit français et</span>
00012 <span class="comment"> * respectant les principes de diffusion des logiciels libres. Vous pouvez</span>
00013 <span class="comment"> * utiliser, modifier et/ou redistribuer ce programme sous les conditions</span>
00014 <span class="comment"> * de la licence CeCILL telle que diffusée par le CEA, le CNRS et l'INRIA</span>
00015 <span class="comment"> * sur le site "http://www.cecill.info".</span>
00016 <span class="comment"> *</span>
00017 <span class="comment"> * En contrepartie de l'accessibilité au code source et des droits de copie,</span>
00018 <span class="comment"> * de modification et de redistribution accordés par cette licence, il n'est</span>
00019 <span class="comment"> * offert aux utilisateurs qu'une garantie limitée.  Pour les mêmes raisons,</span>
00020 <span class="comment"> * seule une responsabilité restreinte pèse sur l'auteur du programme,  le</span>
00021 <span class="comment"> * titulaire des droits patrimoniaux et les concédants successifs.</span>
00022 <span class="comment"> *</span>
00023 <span class="comment"> * A cet égard  l'attention de l'utilisateur est attirée sur les risques</span>
00024 <span class="comment"> * associés au chargement,  à l'utilisation,  à la modification et/ou au</span>
00025 <span class="comment"> * développement et à la reproduction du logiciel par l'utilisateur étant</span>
00026 <span class="comment"> * donné sa spécificité de logiciel libre, qui peut le rendre complexe à</span>
00027 <span class="comment"> * manipuler et qui le réserve donc à des développeurs et des professionnels</span>
00028 <span class="comment"> * avertis possédant  des  connaissances  informatiques approfondies.  Les</span>
00029 <span class="comment"> * utilisateurs sont donc invités à charger  et  tester  l'adéquation  du</span>
00030 <span class="comment"> * logiciel à leurs besoins dans des conditions permettant d'assurer la</span>
00031 <span class="comment"> * sécurité de leurs systèmes et ou de leurs données et, plus généralement,</span>
00032 <span class="comment"> * à l'utiliser et l'exploiter dans les mêmes conditions de sécurité.</span>
00033 <span class="comment"> *</span>
00034 <span class="comment"> * Le fait que vous puissiez accéder à cet en-tête signifie que vous avez</span>
00035 <span class="comment"> * pris connaissance de la licence CeCILL, et que vous en avez accepté les</span>
00036 <span class="comment"> * termes.</span>
00037 <span class="comment"> *</span>
00038 <span class="comment"> * ---------------------</span>
00039 <span class="comment"> *</span>
00040 <span class="comment"> * Copyright CEA/DAM/DIF (2005)</span>
00041 <span class="comment"> *  Contributor: Philippe DENIEL  philippe.deniel@cea.fr</span>
00042 <span class="comment"> *               Thomas LEIBOVICI thomas.leibovici@cea.fr</span>
00043 <span class="comment"> *</span>
00044 <span class="comment"> *</span>
00045 <span class="comment"> * This software is a server that implements the NFS protocol.</span>
00046 <span class="comment"> * </span>
00047 <span class="comment"> *</span>
00048 <span class="comment"> * This software is governed by the CeCILL  license under French law and</span>
00049 <span class="comment"> * abiding by the rules of distribution of free software.  You can  use,</span>
00050 <span class="comment"> * modify and/ or redistribute the software under the terms of the CeCILL</span>
00051 <span class="comment"> * license as circulated by CEA, CNRS and INRIA at the following URL</span>
00052 <span class="comment"> * "http://www.cecill.info".</span>
00053 <span class="comment"> *</span>
00054 <span class="comment"> * As a counterpart to the access to the source code and  rights to copy,</span>
00055 <span class="comment"> * modify and redistribute granted by the license, users are provided only</span>
00056 <span class="comment"> * with a limited warranty  and the software's author,  the holder of the</span>
00057 <span class="comment"> * economic rights,  and the successive licensors  have only  limited</span>
00058 <span class="comment"> * liability.</span>
00059 <span class="comment"> *</span>
00060 <span class="comment"> * In this respect, the user's attention is drawn to the risks associated</span>
00061 <span class="comment"> * with loading,  using,  modifying and/or developing or reproducing the</span>
00062 <span class="comment"> * software by the user in light of its specific status of free software,</span>
00063 <span class="comment"> * that may mean  that it is complicated to manipulate,  and  that  also</span>
00064 <span class="comment"> therefore means  that it is reserved for developers  and  experienced</span>
00065 <span class="comment"> * professionals having in-depth computer knowledge. Users are therefore</span>
00066 <span class="comment"> * encouraged to load and test the software's suitability as regards their</span>
00067 <span class="comment"> * requirements in conditions enabling the security of their systems and/or</span>
00068 <span class="comment"> * data to be ensured and,  more generally, to use and operate it in the</span>
00069 <span class="comment"> * same conditions as regards security.</span>
00070 <span class="comment"> *</span>
00071 <span class="comment"> * The fact that you are presently reading this means that you have had</span>
00072 <span class="comment"> * knowledge of the CeCILL license and that you accept its terms.</span>
00073 <span class="comment"> * ---------------------------------------</span>
00074 <span class="comment"> *</span>
00075 <span class="comment"> * Source du test de la lib de gestion des tables de hachage</span>
00076 <span class="comment"> *</span>
00077 <span class="comment"> * $Header: /cea/home/cvs/cvs/SHERPA/BaseCvs/GANESHA/src/HashTable/test_cmchash_bugdelete.c,v 1.3 2006/01/20 07:39:22 leibovic Exp $</span>
00078 <span class="comment"> *</span>
00079 <span class="comment"> * $Log: test_cmchash_bugdelete.c,v $</span>
00080 <span class="comment"> * Revision 1.3  2006/01/20 07:39:22  leibovic</span>
00081 <span class="comment"> * Back to the previous version.</span>
00082 <span class="comment"> *</span>
00083 <span class="comment"> * Revision 1.1  2005/11/29 13:38:15  deniel</span>
00084 <span class="comment"> * bottlenecked ip_stats</span>
00085 <span class="comment"> *</span>
00086 <span class="comment"> * Revision 1.19  2005/11/28 17:02:37  deniel</span>
00087 <span class="comment"> * Added CeCILL headers</span>
00088 <span class="comment"> *</span>
00089 <span class="comment"> * Revision 1.18  2005/10/05 14:03:28  deniel</span>
00090 <span class="comment"> * DEBUG ifdef are now much cleaner</span>
00091 <span class="comment"> *</span>
00092 <span class="comment"> * Revision 1.17  2005/05/10 11:43:57  deniel</span>
00093 <span class="comment"> * Datacache and metadatacache are noewqw bounded</span>
00094 <span class="comment"> *</span>
00095 <span class="comment"> * Revision 1.16  2005/04/28 14:04:17  deniel</span>
00096 <span class="comment"> * Modified HashTabel_Del prototype</span>
00097 <span class="comment"> *</span>
00098 <span class="comment"> * Revision 1.15  2005/03/02 10:57:00  deniel</span>
00099 <span class="comment"> * Corrected a bug in pdata management</span>
00100 <span class="comment"> *</span>
00101 <span class="comment"> * Revision 1.14  2004/12/08 15:47:17  deniel</span>
00102 <span class="comment"> * Inclusion of systenm headers has been reviewed</span>
00103 <span class="comment"> *</span>
00104 <span class="comment"> * Revision 1.13  2004/09/20 15:36:01  deniel</span>
00105 <span class="comment"> * Quelques mods mineures au niveau des #define</span>
00106 <span class="comment"> *</span>
00107 <span class="comment"> * Revision 1.12  2004/08/25 06:28:15  deniel</span>
00108 <span class="comment"> * Remise a plat du test</span>
00109 <span class="comment"> *</span>
00110 <span class="comment"> * Revision 1.11  2004/08/24 10:41:15  deniel</span>
00111 <span class="comment"> * Avant re-ecriture d'un autre test.</span>
00112 <span class="comment"> *</span>
00113 <span class="comment"> * Revision 1.10  2004/08/23 09:14:35  deniel</span>
00114 <span class="comment"> * Ajout de tests de non-regression (pour le delete)</span>
00115 <span class="comment"> *</span>
00116 <span class="comment"> * Revision 1.9  2004/08/20 08:55:13  deniel</span>
00117 <span class="comment"> * Rajout du support des statistique</span>
00118 <span class="comment"> * Doxygenisation des sources</span>
00119 <span class="comment"> *</span>
00120 <span class="comment"> * Revision 1.8  2004/08/19 09:44:07  deniel</span>
00121 <span class="comment"> * Ajout d'autres tests dans test_cmchash et maketest.conf</span>
00122 <span class="comment"> *</span>
00123 <span class="comment"> * Revision 1.7  2004/08/19 09:20:39  deniel</span>
00124 <span class="comment"> * Ajout du header CVS dans test_cnmhash.c</span>
00125 <span class="comment"> *</span>
00126 <span class="comment"> *</span>
00127 <span class="comment"> */</span>
00128 <span class="preprocessor">#ifdef HAVE_CONFIG_H</span>
00129 <span class="preprocessor"></span><span class="preprocessor">#include "config.h"</span>
00130 <span class="preprocessor">#endif</span>
00131 <span class="preprocessor"></span>
00132 
00133 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00134 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00135 <span class="preprocessor">#include &lt;strings.h&gt;</span>
00136 <span class="preprocessor">#include &lt;string.h&gt;</span>
00137 <span class="preprocessor">#include "BuddyMalloc.h"</span>
00138 <span class="preprocessor">#include "HashTable.h"</span>
00139 <span class="preprocessor">#include "MesureTemps.h"</span>
00140 
<a name="l00141"></a><a class="code" href="test__cmchash__bugdelete_8c.html#a0">00141</a> <span class="preprocessor">#define MAXTEST 10000    </span><span class="comment">/* Plus grand que MAXDESTROY !! */</span>
<a name="l00142"></a><a class="code" href="test__cmchash__bugdelete_8c.html#a1">00142</a> <span class="preprocessor">#define MAXDESTROY 50</span>
<a name="l00143"></a><a class="code" href="test__cmchash__bugdelete_8c.html#a2">00143</a> <span class="preprocessor"></span><span class="preprocessor">#define MAXGET 30</span>
<a name="l00144"></a><a class="code" href="test__cmchash__bugdelete_8c.html#a3">00144</a> <span class="preprocessor"></span><span class="preprocessor">#define NB_PREALLOC 10000</span>
<a name="l00145"></a><a class="code" href="test__cmchash__bugdelete_8c.html#a4">00145</a> <span class="preprocessor"></span><span class="preprocessor">#define PRIME 109 </span>
<a name="l00146"></a><a class="code" href="test__cmchash__bugdelete_8c.html#a5">00146</a> <span class="preprocessor"></span><span class="preprocessor">#define CRITERE 12 </span>
<a name="l00147"></a><a class="code" href="test__cmchash__bugdelete_8c.html#a6">00147</a> <span class="preprocessor"></span><span class="preprocessor">#define CRITERE_2 14 </span>
<a name="l00148"></a><a class="code" href="test__cmchash__bugdelete_8c.html#a7">00148</a> <span class="preprocessor"></span><span class="keywordtype">int</span> <a class="code" href="test__cmchash__bugdelete_8c.html#a7">bugdelete_key_array</a>[] = { 4738,
00149                               6483,
00150                               8393,
00151                               9661,
00152                               2990,
00153                               1054,
00154                               9823,
00155                               6386,
00156                               4029,
00157                               3533,
00158                               7074,
00159                               7339,
00160                               5170,
00161                               9363,
00162                               6,
00163                               9754,
00164                               5144,
00165                               2236,
00166                               8039,
00167                               9545,
00168                               5622,
00169                               2693,
00170                               1265,
00171                               9980,
00172                               2834,
00173                               1583,
00174                               1106,
00175                               8567,
00176                               8503,
00177                               8196,
00178                               2963,
00179                               9593,
00180                               4679,
00181                               7708,
00182                               9254,
00183                               4022,
00184                               8762,
00185                               5430,
00186                               408,
00187                               2791,
00188                               8963,
00189                               3835,
00190                               6484,
00191                               6485,
00192                               8394,
00193                               9666,
00194                               2999,
00195                               1055,
00196                               9824,
00197                               6387,
00198                               4030,
00199                               3534} ;
00200 
00201 
00202 
<a name="l00203"></a><a class="code" href="test__cmchash__bugdelete_8c.html#a8">00203</a> <span class="keywordtype">int</span> <a class="code" href="test__configurable__hash_8c.html#a11">compare_string_buffer</a>(  hash_buffer_t * buff1, hash_buffer_t * buff2 ) 
00204 {
00205   <span class="comment">/* Test if one of teh entries are NULL */</span>
00206   <span class="keywordflow">if</span>( buff1-&gt;pdata == NULL )
00207     <span class="keywordflow">return</span> ( buff2-&gt;pdata == NULL ) ? 0 : 1 ;
00208   <span class="keywordflow">else</span>
00209     {
00210       <span class="keywordflow">if</span>( buff2-&gt;pdata == NULL )
00211         <span class="keywordflow">return</span> -1 ; <span class="comment">/* left member is the greater one */</span>
00212       <span class="keywordflow">else</span>
00213         <span class="keywordflow">return</span> strcmp( buff1-&gt;pdata, buff2-&gt;pdata ) ;
00214     }
00215   <span class="comment">/* This line should never be reached */</span>
00216 }
00217 
<a name="l00218"></a><a class="code" href="test__cmchash__bugdelete_8c.html#a9">00218</a> <span class="keywordtype">int</span> <a class="code" href="test__configurable__hash_8c.html#a12">display_buff</a>( hash_buffer_t * pbuff, <span class="keywordtype">char</span> * str )
00219 {
00220   <span class="keywordflow">return</span> snprintf( str, HASHTABLE_DISPLAY_STRLEN, <span class="stringliteral">"%s"</span>, (<span class="keywordtype">char</span> *)pbuff-&gt;pdata ) ;
00221 }
00222 
00223 <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="group__HashTableInternalFunctions.html#ga0">simple_hash_func</a>( hash_parameter_t * p_hparam, hash_buffer_t * buffclef ) ;
00224 <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="group__HashTableInternalFunctions.html#ga1">double_hash_func</a>( hash_parameter_t * p_hparam, hash_buffer_t * buffclef ) ;
00225 <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="group__HashTableInternalFunctions.html#ga2">rbt_hash_func</a>( hash_parameter_t * p_hparam, hash_buffer_t * buffclef ) ;
00226 
<a name="l00227"></a><a class="code" href="test__cmchash__bugdelete_8c.html#a13">00227</a> <span class="keywordtype">int</span> <a class="code" href="test__configurable__hash_8c.html#a21">main</a>( <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> * argv[] )
00228 {
00229   hash_table_t * ht = NULL  ;
00230   hash_parameter_t hparam ;
00231   hash_buffer_t  buffval ;
00232   hash_buffer_t  buffkey ; 
00233   hash_buffer_t  buffval2 ;
00234   hash_buffer_t  buffkey2 ; 
00235   hash_stat_t    statistiques ;
00236   <span class="keywordtype">int</span> i ;
00237   <span class="keywordtype">int</span> val ;
00238   <span class="keywordtype">int</span> rc ;
00239   <span class="keywordtype">int</span> res ;
00240   <span class="keyword">struct </span>Temps debut, fin ;
00241   <span class="keywordtype">char</span> tmpstr[10] ;
00242   <span class="keywordtype">char</span> tmpstr2[10] ;
00243   <span class="keywordtype">char</span> tmpstr3[10] ;
00244   <span class="keywordtype">char</span> strtab[MAXTEST][10] ;
00245   <span class="keywordtype">int</span> critere_recherche = 0 ;
00246   <span class="keywordtype">int</span> random_val = 0 ;
00247   
00248   hparam.index_size = PRIME ;
00249   hparam.alphabet_length = 10 ;
00250   hparam.nb_node_prealloc = NB_PREALLOC ;
00251   hparam.hash_func_key = simple_hash_func ;
00252   hparam.hash_func_rbt = rbt_hash_func ;
00253   hparam.compare_key = compare_string_buffer ;
00254   hparam.key_to_str = display_buff ;
00255   hparam.val_to_str = display_buff ;
00256 
00257   BuddyInit( NULL ) ;
00258   
00259   <span class="comment">/* Init de la table */</span>
00260   <span class="keywordflow">if</span>( ( ht = <a class="code" href="group__HashTableExportedFunctions.html#ga0">HashTable_Init</a>( hparam ) ) == NULL )
00261     {
00262       printf( <span class="stringliteral">"Test ECHOUE : Mauvaise init\n"</span> ) ;
00263       exit( 1 ) ;
00264     }  
00265 
00266   MesureTemps(&amp;debut, NULL); 
00267   printf( <span class="stringliteral">"Creation de la table\n"</span> ) ;
00268   
00269   <span class="keywordflow">for</span>( i = 0 ; i &lt; MAXTEST ; i++ )
00270     {
00271       sprintf( strtab[i], <span class="stringliteral">"%d"</span>, i  ) ;
00272 
00273       buffkey.len = strlen( strtab[i] ) ;
00274       buffkey.pdata = strtab[i] ;
00275 
00276       buffval.len = strlen( strtab[i] ) ;
00277       buffval.pdata = strtab[i] ;
00278 
00279       rc = HashTable_Set( ht, &amp;buffkey, &amp;buffval ) ;
00280 <span class="preprocessor">#ifdef _DEBUG_HASHTABLE</span>
00281 <span class="preprocessor"></span>      printf( <span class="stringliteral">"Ajout de %s , %d , sortie = %d\n"</span>, strtab[i], i, rc ) ;
00282 <span class="preprocessor">#endif</span>
00283 <span class="preprocessor"></span>    }  
00284 
00285   MesureTemps(&amp;fin, &amp;debut);
00286   printf( <span class="stringliteral">"Duree de l'insertion de %d entrees: %s\n"</span>, <a class="code" href="test__cmchash_8c.html#a0">MAXTEST</a>, ConvertiTempsChaine(fin, NULL) ) ;
00287 <span class="preprocessor">#ifdef _DEBUG_HASHTABLE</span>
00288 <span class="preprocessor"></span>  printf( <span class="stringliteral">"-----------------------------------------\n"</span> ) ;
00289   <a class="code" href="group__HashTableExportedFunctions.html#ga6">HashTable_Print</a>( ht ) ;
00290 <span class="preprocessor">#endif</span>
00291 <span class="preprocessor"></span>  printf( <span class="stringliteral">"=========================================\n"</span> ) ;
00292   
00293   <span class="comment">/* Premier test simple: verif de la coherence des valeurs lues */</span>
00294   critere_recherche = CRITERE ;
00295   
00296   sprintf( tmpstr, <span class="stringliteral">"%d"</span>, critere_recherche ) ;
00297   buffkey.len = strlen( tmpstr ) ;
00298   buffkey.pdata = tmpstr ;
00299   
00300   MesureTemps(&amp;debut, NULL);
00301   rc = <a class="code" href="group__HashTableExportedFunctions.html#ga2">HashTable_Get</a>( ht, &amp;buffkey, &amp;buffval ) ;
00302   MesureTemps(&amp;fin, &amp;debut);
00303 
00304 
00305   printf( <span class="stringliteral">"Maintenant, j'essaye de recuperer %d entrees (prises au hasard, ou presque) \n"</span>, <a class="code" href="test__cmchash_8c.html#a2">MAXGET</a> ) ;
00306   MesureTemps(&amp;debut, NULL);
00307   <span class="keywordflow">for</span>( i = 0 ; i &lt; MAXGET ; i++ )
00308     {
00309       random_val = random() % MAXTEST ;
00310       sprintf( tmpstr, <span class="stringliteral">"%d"</span>, random_val ) ;
00311       buffkey2.len = strlen( tmpstr ) ;
00312       buffkey2.pdata = tmpstr ;
00313 
00314       rc = <a class="code" href="group__HashTableExportedFunctions.html#ga2">HashTable_Get</a>( ht, &amp;buffkey2, &amp;buffval2 ) ;
00315 <span class="preprocessor">#ifdef _DEBUG_HASHTABLE</span>
00316 <span class="preprocessor"></span>      printf( <span class="stringliteral">"\tLecture  de key = %s  --&gt; %s\n"</span>, buffkey2.pdata, buffval2.pdata ) ;
00317 <span class="preprocessor">#endif</span>
00318 <span class="preprocessor"></span>      <span class="keywordflow">if</span>( rc != HASHTABLE_SUCCESS )
00319         {
00320           printf( <span class="stringliteral">"Erreur lors de la lecture de %d = %d\n"</span>, i, rc ) ;
00321           printf( <span class="stringliteral">"Test ECHOUE : la valeur lue est incorrecte\n"</span> ) ;
00322           exit( 1 ) ;
00323         }
00324     }
00325   MesureTemps(&amp;fin, &amp;debut);
00326   printf( <span class="stringliteral">"Duree de lecture de %d elements = %s\n"</span>, <a class="code" href="test__cmchash_8c.html#a2">MAXGET</a>,  ConvertiTempsChaine(fin, NULL) ) ;
00327 
00328   printf( <span class="stringliteral">"-----------------------------------------\n"</span> ) ;
00329   
00330   sprintf( tmpstr, <span class="stringliteral">"%d"</span>, critere_recherche ) ;
00331   buffkey.len = strlen( tmpstr ) ;
00332   buffkey.pdata = tmpstr ;
00333 
00334   sprintf( tmpstr, <span class="stringliteral">"%d"</span>, critere_recherche ) ;
00335   buffkey.len = strlen( tmpstr ) ;
00336   buffkey.pdata = tmpstr ;
00337 
00338   sprintf( tmpstr, <span class="stringliteral">"%d"</span>, critere_recherche ) ;
00339   buffkey.len = strlen( tmpstr ) ;
00340   buffkey.pdata = tmpstr ;
00341   
00342   srandom(  getpid()  ) ;
00343 
00344   MesureTemps(&amp;debut, NULL);
00345   <span class="keywordflow">for</span>( i = 0 ; i &lt; MAXDESTROY ; i++ )
00346     {
00347       random_val = <a class="code" href="test__cmchash__bugdelete_8c.html#a7">bugdelete_key_array</a>[i] ;
00348       sprintf( tmpstr, <span class="stringliteral">"%d"</span>, random_val ) ;
00349 
00350       buffkey.len = strlen( tmpstr ) ;
00351       buffkey.pdata = tmpstr ;
00352       printf( <span class="stringliteral">"\t J'efface %d -&gt; %d | %d\n"</span>, 
00353               random_val, 
00354               <a class="code" href="group__HashTableInternalFunctions.html#ga0">simple_hash_func</a>( &amp;hparam, &amp;buffkey ),
00355               <a class="code" href="group__HashTableInternalFunctions.html#ga2">rbt_hash_func</a>( &amp;hparam, &amp;buffkey ) ) ;
00356       
00357       rc = <a class="code" href="group__HashTableExportedFunctions.html#ga3">HashTable_Del</a>( ht, &amp;buffkey, NULL, NULL ) ;
00358       <span class="keywordflow">if</span>( rc != HASHTABLE_SUCCESS )
00359         {
00360           printf( <span class="stringliteral">"Erreur lors de la destruction de %d = %d\n"</span>, random_val, rc ) ;
00361           printf( <span class="stringliteral">"Test ECHOUE : effacement incorrect\n"</span> ) ;
00362           exit( 1 ) ;
00363         }
00364     }
00365   MesureTemps(&amp;fin, &amp;debut);
00366   printf( <span class="stringliteral">"Duree de la destruction de %d elements = %s\n"</span>, <a class="code" href="test__cmchash_8c.html#a1">MAXDESTROY</a>,  ConvertiTempsChaine(fin, NULL) ) ;
00367 
00368   printf( <span class="stringliteral">"-----------------------------------------\n"</span> ) ;
00369 
00370   printf( <span class="stringliteral">"Maintenant, j'essaye de recuperer %d entrees (eventuellement detruites) \n"</span>, <a class="code" href="test__cmchash_8c.html#a2">MAXGET</a> ) ;
00371   MesureTemps(&amp;debut, NULL);
00372   <span class="keywordflow">for</span>( i = 0 ; i &lt; MAXGET ; i++ )
00373     {
00374       random_val = random() % MAXTEST ;
00375       sprintf( tmpstr, <span class="stringliteral">"%d"</span>, random_val ) ;
00376       buffkey.len = strlen( tmpstr ) ;
00377       buffkey.pdata = tmpstr ;
00378       
00379       rc = <a class="code" href="group__HashTableExportedFunctions.html#ga2">HashTable_Get</a>( ht, &amp;buffkey, &amp;buffval ) ;
00380     }
00381   MesureTemps(&amp;fin, &amp;debut);
00382   printf( <span class="stringliteral">"Duree de lecture de %d elements = %s\n"</span>, <a class="code" href="test__cmchash_8c.html#a2">MAXGET</a>,  ConvertiTempsChaine(fin, NULL) ) ;
00383 
00384   printf( <span class="stringliteral">"-----------------------------------------\n"</span> ) ;
00385   printf( <span class="stringliteral">"Ecriture d'une clef en double \n"</span> ) ;
00386   sprintf( tmpstr, <span class="stringliteral">"%d"</span>, <a class="code" href="test__cmchash_8c.html#a6">CRITERE_2</a> ) ;
00387   buffkey.len = strlen( tmpstr ) ;
00388   buffkey.pdata = tmpstr ;
00389   rc = <a class="code" href="group__HashTableExportedFunctions.html#ga1">HashTable_Test_And_Set</a>( ht, &amp;buffkey, &amp;buffval, HASHTABLE_SET_HOW_SET_NO_OVERWRITE ) ;
00390   printf( <span class="stringliteral">"La valeur doit etre HASHTABLE_ERROR_KEY_ALREADY_EXISTS  = %d --&gt; %d\n"</span>, HASHTABLE_ERROR_KEY_ALREADY_EXISTS, rc ) ;
00391   <span class="keywordflow">if</span>( rc != HASHTABLE_ERROR_KEY_ALREADY_EXISTS )
00392     {
00393       printf( <span class="stringliteral">"Test ECHOUE : Clef redondante\n"</span> ) ;
00394       exit( 1 ) ;
00395     }
00396   printf( <span class="stringliteral">"-----------------------------------------\n"</span> ) ;
00397    
00398 <span class="preprocessor">#ifdef _DEBUG_HASHTABLE</span>
00399 <span class="preprocessor"></span>  <a class="code" href="group__HashTableExportedFunctions.html#ga6">HashTable_Print</a>( ht ) ;
00400   printf( <span class="stringliteral">"-----------------------------------------\n"</span> ) ;
00401 <span class="preprocessor">#endif</span>
00402 <span class="preprocessor"></span>
00403   printf( <span class="stringliteral">"Affichage des statistiques de la table \n"</span> ) ;
00404   <a class="code" href="group__HashTableExportedFunctions.html#ga4">HashTable_GetStats</a>( ht, &amp;statistiques ) ;
00405   printf(<span class="stringliteral">" Nombre d'entrees = %d\n"</span>, statistiques.dynamic.nb_entries ) ;
00406   
00407   printf(<span class="stringliteral">"   Operations reussies  : Set = %d,  Get = %d,  Del = %d,  Test = %d\n"</span>, 
00408          statistiques.dynamic.ok.nb_set, statistiques.dynamic.ok.nb_get,
00409          statistiques.dynamic.ok.nb_del,  statistiques.dynamic.ok.nb_test ) ;
00410   
00411   
00412   printf(<span class="stringliteral">"   Operations en erreur : Set = %d,  Get = %d,  Del = %d,  Test = %d\n"</span>, 
00413          statistiques.dynamic.err.nb_set, statistiques.dynamic.err.nb_get,
00414          statistiques.dynamic.err.nb_del,  statistiques.dynamic.err.nb_test ) ;
00415 
00416   printf(<span class="stringliteral">"   Operations 'NotFound': Set = %d,  Get = %d,  Del = %d,  Test = %d\n"</span>, 
00417          statistiques.dynamic.notfound.nb_set, statistiques.dynamic.notfound.nb_get, 
00418          statistiques.dynamic.notfound.nb_del, statistiques.dynamic.notfound.nb_test ) ;
00419   
00420   printf( <span class="stringliteral">"  Statistiques calculees: min_rbt_node = %d,  max_rbt_node = %d,  average_rbt_node = %d\n"</span>, 
00421           statistiques.computed.min_rbt_num_node, statistiques.computed.max_rbt_num_node, 
00422           statistiques.computed.average_rbt_num_node ) ;
00423   
00424   <span class="comment">/* Test sur la pertinence des valeurs de statistiques */</span>
00425   <span class="keywordflow">if</span>( statistiques.dynamic.ok.nb_set != MAXTEST   ) 
00426     {
00427       printf( <span class="stringliteral">"Test ECHOUE : statistiques incorrectes: ok.nb_set \n"</span> ) ;
00428       exit( 1 ) ;
00429     }
00430 
00431   <span class="keywordflow">if</span>( statistiques.dynamic.ok.nb_get + statistiques.dynamic.notfound.nb_get != 2*<a class="code" href="test__cmchash_8c.html#a2">MAXGET</a> + 3 )
00432      {
00433       printf( <span class="stringliteral">"Test ECHOUE : statistiques incorrectes: *.nb_get \n"</span> ) ;
00434       exit( 1 ) ;
00435     }
00436 
00437   <span class="keywordflow">if</span>( statistiques.dynamic.ok.nb_del != <a class="code" href="test__cmchash_8c.html#a1">MAXDESTROY</a> +1  || statistiques.dynamic.notfound.nb_del != 1 )
00438      {
00439       printf( <span class="stringliteral">"Test ECHOUE : statistiques incorrectes: *.nb_del \n"</span> ) ;
00440       exit( 1 ) ;
00441     }
00442   
00443   <span class="keywordflow">if</span>( statistiques.dynamic.err.nb_test != 1 )
00444     {
00445       printf( <span class="stringliteral">"Test ECHOUE : statistiques incorrectes: err.nb_test \n"</span> ) ;
00446       exit( 1 ) ;
00447     }
00448   
00449   <span class="comment">/* Tous les tests sont ok */</span>
00450   BuddyDumpMem( stdout ) ;
00451   
00452   printf( <span class="stringliteral">"\n-----------------------------------------\n"</span> ) ;
00453   printf( <span class="stringliteral">"Test reussi : tous les tests sont passes avec succes\n"</span> ) ;
00454   
00455   exit( 0 ) ;
00456 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Apr 9 08:24:22 2008 for Hash Table Library by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
