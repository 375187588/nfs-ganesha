<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>RPCSEC_GSS Library: Xdr_reference.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>Xdr_reference.c</h1><a href="Xdr__reference_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">/*</span>
00002 <span class="comment"> * Sun RPC is a product of Sun Microsystems, Inc. and is provided for</span>
00003 <span class="comment"> * unrestricted use provided that this legend is included on all tape</span>
00004 <span class="comment"> * media and as a part of the software program in whole or part.  Users</span>
00005 <span class="comment"> * may copy or modify Sun RPC without charge, but are not authorized</span>
00006 <span class="comment"> * to license or distribute it to anyone else except as part of a product or</span>
00007 <span class="comment"> * program developed by the user.</span>
00008 <span class="comment"> * </span>
00009 <span class="comment"> * SUN RPC IS PROVIDED AS IS WITH NO WARRANTIES OF ANY KIND INCLUDING THE</span>
00010 <span class="comment"> * WARRANTIES OF DESIGN, MERCHANTIBILITY AND FITNESS FOR A PARTICULAR</span>
00011 <span class="comment"> * PURPOSE, OR ARISING FROM A COURSE OF DEALING, USAGE OR TRADE PRACTICE.</span>
00012 <span class="comment"> * </span>
00013 <span class="comment"> * Sun RPC is provided with no support and without any obligation on the</span>
00014 <span class="comment"> * part of Sun Microsystems, Inc. to assist in its use, correction,</span>
00015 <span class="comment"> * modification or enhancement.</span>
00016 <span class="comment"> * </span>
00017 <span class="comment"> * SUN MICROSYSTEMS, INC. SHALL HAVE NO LIABILITY WITH RESPECT TO THE</span>
00018 <span class="comment"> * INFRINGEMENT OF COPYRIGHTS, TRADE SECRETS OR ANY PATENTS BY SUN RPC</span>
00019 <span class="comment"> * OR ANY PART THEREOF.</span>
00020 <span class="comment"> * </span>
00021 <span class="comment"> * In no event will Sun Microsystems, Inc. be liable for any lost revenue</span>
00022 <span class="comment"> * or profits or other special, indirect and consequential damages, even if</span>
00023 <span class="comment"> * Sun has been advised of the possibility of such damages.</span>
00024 <span class="comment"> * </span>
00025 <span class="comment"> * Sun Microsystems, Inc.</span>
00026 <span class="comment"> * 2550 Garcia Avenue</span>
00027 <span class="comment"> * Mountain View, California  94043</span>
00028 <span class="comment"> */</span>
00029 
00030 <span class="preprocessor">#if defined(LIBC_SCCS) &amp;&amp; !defined(lint) </span>
00031 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="client-gss_8c.html#a12">rcsid</a> = <span class="stringliteral">"$OpenBSD: xdr_reference.c,v 1.3 1996/08/19 08:32:06 tholo Exp $"</span>;
00032 <span class="preprocessor">#endif </span><span class="comment">/* LIBC_SCCS and not lint */</span>
00033 
00034 <span class="comment">/*</span>
00035 <span class="comment"> * xdr_reference.c, Generic XDR routines impelmentation.</span>
00036 <span class="comment"> *</span>
00037 <span class="comment"> * Copyright (C) 1987, Sun Microsystems, Inc.</span>
00038 <span class="comment"> *</span>
00039 <span class="comment"> * These are the "non-trivial" xdr primitives used to serialize and de-serialize</span>
00040 <span class="comment"> * "pointers".  See xdr.h for more info on the interface to xdr.</span>
00041 <span class="comment"> */</span>
00042 
00043 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00044 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00045 <span class="preprocessor">#include &lt;string.h&gt;</span>
00046 <span class="preprocessor">#include "Types.h"</span>
00047 <span class="preprocessor">#include "Xdr.h"</span>
00048 
00049 <span class="comment">/*</span>
00050 <span class="comment"> * XDR an indirect pointer</span>
00051 <span class="comment"> * xdr_reference is for recursively translating a structure that is</span>
00052 <span class="comment"> * referenced by a pointer inside the structure that is currently being</span>
00053 <span class="comment"> * translated.  pp references a pointer to storage. If *pp is null</span>
00054 <span class="comment"> * the  necessary storage is allocated.</span>
00055 <span class="comment"> * size is the sizeof the referneced structure.</span>
00056 <span class="comment"> * proc is the routine to handle the referenced structure.</span>
00057 <span class="comment"> */</span>
00058 bool_t
<a name="l00059"></a><a class="code" href="Xdr__reference_8c.html#a0">00059</a> <a class="code" href="Xdr__reference_8c.html#a0">Xdr_reference</a>(xdrs, pp, size, proc)
00060         register XDR *xdrs;
00061         caddr_t *pp;            <span class="comment">/* the pointer to work on */</span>
00062         u_int size;             <span class="comment">/* size of the object pointed to */</span>
00063         Xdrproc_t proc;         <span class="comment">/* xdr routine to handle the object */</span>
00064 {
00065         <span class="keyword">register</span> caddr_t loc = *pp;
00066         <span class="keyword">register</span> bool_t stat;
00067 
00068         <span class="keywordflow">if</span> (loc == NULL)
00069                 <span class="keywordflow">switch</span> (xdrs-&gt;x_op) {
00070                 <span class="keywordflow">case</span> XDR_FREE:
00071                         <span class="keywordflow">return</span> (TRUE);
00072 
00073                 <span class="keywordflow">case</span> XDR_DECODE:
00074                         *pp = loc = (caddr_t) mem_alloc(size);
00075                         <span class="keywordflow">if</span> (loc == NULL) {
00076                                 FILE * tmplog ;
00077                 
00078                                 <span class="keywordflow">if</span>( ( tmplog = fopen( RPCSEC_GSS_LOG, <span class="stringliteral">"a"</span> ) ) != NULL )
00079                                 {
00080                                 (void) fprintf(tmplog,
00081                                     <span class="stringliteral">"xdr_reference: out of memory\n"</span>);
00082                                 fclose( tmplog ) ;
00083                                 }
00084                                 <span class="keywordflow">return</span> (FALSE);
00085                         }
00086                         memset(loc, 0, (<span class="keywordtype">int</span>)size);
00087                         <span class="keywordflow">break</span>;
00088 
00089                 <span class="keywordflow">default</span>:
00090                         <span class="keywordflow">break</span>;
00091         }
00092 
00093         stat = (*proc)(xdrs, loc);
00094 
00095         <span class="keywordflow">if</span> (xdrs-&gt;x_op == XDR_FREE) {
00096                 mem_free(loc, size);
00097                 *pp = NULL;
00098         }
00099         <span class="keywordflow">return</span> (stat);
00100 }
00101 
00102 
00103 <span class="comment">/*</span>
00104 <span class="comment"> * xdr_pointer():</span>
00105 <span class="comment"> *</span>
00106 <span class="comment"> * XDR a pointer to a possibly recursive data structure. This</span>
00107 <span class="comment"> * differs with xdr_reference in that it can serialize/deserialiaze</span>
00108 <span class="comment"> * trees correctly.</span>
00109 <span class="comment"> *</span>
00110 <span class="comment"> *  What's sent is actually a union:</span>
00111 <span class="comment"> *</span>
00112 <span class="comment"> *  union object_pointer switch (boolean b) {</span>
00113 <span class="comment"> *  case TRUE: object_data data;</span>
00114 <span class="comment"> *  case FALSE: void nothing;</span>
00115 <span class="comment"> *  }</span>
00116 <span class="comment"> *</span>
00117 <span class="comment"> * &gt; objpp: Pointer to the pointer to the object.</span>
00118 <span class="comment"> * &gt; obj_size: size of the object.</span>
00119 <span class="comment"> * &gt; xdr_obj: routine to XDR an object.</span>
00120 <span class="comment"> *</span>
00121 <span class="comment"> */</span>
00122 bool_t
<a name="l00123"></a><a class="code" href="Xdr__reference_8c.html#a1">00123</a> <a class="code" href="Xdr__reference_8c.html#a1">Xdr_pointer</a>(xdrs,objpp,obj_size,xdr_obj)
00124         register XDR *xdrs;
00125         <span class="keywordtype">char</span> **objpp;
00126         u_int obj_size;
00127         Xdrproc_t xdr_obj;
00128 {
00129 
00130         bool_t more_data;
00131 
00132         more_data = (*objpp != NULL);
00133         <span class="keywordflow">if</span> (! <a class="code" href="Xdr_8c.html#a18">Xdr_bool</a>(xdrs,&amp;more_data)) {
00134                 <span class="keywordflow">return</span> (FALSE);
00135         }
00136         <span class="keywordflow">if</span> (! more_data) {
00137                 *objpp = NULL;
00138                 <span class="keywordflow">return</span> (TRUE);
00139         }
00140         <span class="keywordflow">return</span> (<a class="code" href="Xdr__reference_8c.html#a0">Xdr_reference</a>(xdrs,objpp,obj_size,xdr_obj));
00141 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Fri Dec 22 14:15:35 2006 for RPCSEC_GSS Library by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
