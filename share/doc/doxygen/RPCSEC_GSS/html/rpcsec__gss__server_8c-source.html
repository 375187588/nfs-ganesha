<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>RPCSEC_GSS Library: rpcsec_gss_server.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>rpcsec_gss_server.c</h1><a href="rpcsec__gss__server_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">/*</span>
00002 <span class="comment"> * RPCSEC_GSS: basic server for tests</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> *  $Header: /cea/home/cvs/cvs/SHERPA/BaseCvs/GANESHA/src/RPCSEC_GSS/rpcsec_gss_server.c,v 1.1 2005/04/13 11:32:38 deniel Exp $</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> * $Log: rpcsec_gss_server.c,v $</span>
00007 <span class="comment"> * Revision 1.1  2005/04/13 11:32:38  deniel</span>
00008 <span class="comment"> * Added the two test client and server</span>
00009 <span class="comment"> *</span>
00010 <span class="comment"> *</span>
00011 <span class="comment"> */</span>
00012 
00013 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00014 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
00015 <span class="preprocessor">#include &lt;stdlib.h&gt;</span> 
00016 <span class="preprocessor">#include &lt;string.h&gt;</span> 
00017 
00018 <span class="preprocessor">#include &lt;sys/errno.h&gt;</span>
00019 <span class="preprocessor">#include &lt;sys/param.h&gt;</span>
00020 <span class="preprocessor">#include &lt;sys/types.h&gt;</span>
00021 
00022 <span class="preprocessor">#include &lt;sys/socket.h&gt;</span>
00023 <span class="preprocessor">#include &lt;netdb.h&gt;</span>
00024 <span class="preprocessor">#include &lt;netinet/in.h&gt;</span>
00025 <span class="preprocessor">#include &lt;netinet/tcp.h&gt;</span>
00026 
00027 <span class="preprocessor">#include "Rpc.h"</span>
00028 <span class="preprocessor">#include "Pmap_clnt.h"</span>
00029 <span class="preprocessor">#include "gssapi/gssapi.h"</span>
00030 
<a name="l00031"></a><a class="code" href="rpcsec__gss__server_8c.html#a0">00031</a> <span class="preprocessor">#define LOGFILE_DEFAUT    "./toto-server.log"</span>
<a name="l00032"></a><a class="code" href="rpcsec__gss__server_8c.html#a1">00032</a> <span class="preprocessor"></span><span class="preprocessor">#define TraduireAdresse( adresse, dest )                   \</span>
00033 <span class="preprocessor">           sprintf( dest, "%d.%d.%d.%d",                   \</span>
00034 <span class="preprocessor">                  ( ntohl( adresse ) &amp; 0xFF000000 ) &gt;&gt; 24, \</span>
00035 <span class="preprocessor">                  ( ntohl( adresse ) &amp; 0x00FF0000 ) &gt;&gt; 16, \</span>
00036 <span class="preprocessor">                  ( ntohl( adresse ) &amp; 0x0000FF00 ) &gt;&gt; 8,  \</span>
00037 <span class="preprocessor">                  ( ntohl( adresse ) &amp; 0x000000FF ) )</span>
<a name="l00038"></a><a class="code" href="rpcsec__gss__server_8c.html#a2">00038</a> <span class="preprocessor"></span><span class="preprocessor">#define TIMEOUT_SEC 25 </span>
<a name="l00039"></a><a class="code" href="rpcsec__gss__server_8c.html#a3">00039</a> <span class="preprocessor"></span><span class="preprocessor">#define DEFAULT_RPC_SERVICE 300400 </span>
<a name="l00040"></a><a class="code" href="rpcsec__gss__server_8c.html#a4">00040</a> <span class="preprocessor"></span><span class="preprocessor">#define RECV_SIZE 2048</span>
<a name="l00041"></a><a class="code" href="rpcsec__gss__server_8c.html#a5">00041</a> <span class="preprocessor"></span><span class="preprocessor">#define SEND_SIZE 2048</span>
<a name="l00042"></a><a class="code" href="rpcsec__gss__server_8c.html#a6">00042</a> <span class="preprocessor"></span><span class="preprocessor">#define V1 1 </span>
<a name="l00043"></a><a class="code" href="rpcsec__gss__server_8c.html#a7">00043</a> <span class="preprocessor"></span><span class="preprocessor">#define PROC_NULL  0 </span>
<a name="l00044"></a><a class="code" href="rpcsec__gss__server_8c.html#a8">00044</a> <span class="preprocessor"></span><span class="preprocessor">#define PROC_PLUS1 1</span>
00045 <span class="preprocessor"></span>
<a name="l00046"></a><a class="code" href="rpcsec__gss__server_8c.html#a9">00046</a> <span class="preprocessor">#define DEFAULT_MECHANISM "kerberos_v5"</span>
<a name="l00047"></a><a class="code" href="rpcsec__gss__server_8c.html#a10">00047</a> <span class="preprocessor"></span><span class="preprocessor">#define DEFAULT_PRINCIPAL "toto@trekking.bruyeres.s"</span>
00048 <span class="preprocessor"></span>
00049 <span class="comment">/* les options pour getopt */</span>
<a name="l00050"></a><a class="code" href="rpcsec__gss__server_8c.html#a12">00050</a> <span class="keywordtype">char</span> <a class="code" href="client-gss_8c.html#a14">options</a>[] = <span class="stringliteral">"hL:N:s:S:M:"</span> ;
00051 
00052 <span class="comment">/* L'aide en ligne */</span>
<a name="l00053"></a><a class="code" href="rpcsec__gss__server_8c.html#a13">00053</a> <span class="keywordtype">char</span> <a class="code" href="client-gss_8c.html#a15">utilisation</a>[] = 
00054 <span class="stringliteral">"Utilisation: %s [-hLs] \n"</span>
00055 <span class="stringliteral">"\t[-h]                   affiche cet aide en ligne\n"</span>
00056 <span class="stringliteral">"\t[-L &lt;logfile&gt;]         indique le fichier de log\n"</span>
00057 <span class="stringliteral">"\t[-N &lt;NivDebug&gt;]        indique le niveau de debug pour les journaux\n"</span> 
00058 <span class="stringliteral">"\t[-s &lt;service RPC&gt;]     indique le port ou le service a utiliser\n"</span> 
00059 <span class="stringliteral">"\t[-S &lt;service auth&gt;]    indique le principal a utiliser\n"</span>
00060 <span class="stringliteral">"\t[-M &lt;mechanism&gt;]       indique le mecanisme a utiliser\n"</span> ;
00061 
00062 <span class="comment">/* Des variables globales (en general ecrites une seule fois, relues plusieurs) */</span>
00063 <span class="keyword">static</span> <span class="keywordtype">char</span> logfile_name[MAXPATHLEN] ;    <span class="comment">/* Le chemin du fichier de log           */</span>
<a name="l00064"></a><a class="code" href="rpcsec__gss__server_8c.html#a15">00064</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="onc__rpc__server_8c.html#a12">rpc_service_num</a> = DEFAULT_RPC_SERVICE ;
00065 
<a name="l00066"></a><a class="code" href="structSvc__rpc__gss__data.html">00066</a> <span class="keyword">struct </span><a class="code" href="structSvc__rpc__gss__data.html">Svc_rpc_gss_data</a> {
00067         bool_t                          established;    <span class="comment">/* context established  */</span>
00068         gss_ctx_id_t                ctx;                      <span class="comment">/* context id           */</span>
<a name="l00069"></a><a class="code" href="structSvc__rpc__gss__data.html#o2">00069</a>         <span class="keyword">struct </span>Rpc_gss_sec      sec;                  <span class="comment">/* security triple      */</span>
00070         gss_buffer_desc           cname;                    <span class="comment">/* GSS client name      */</span>
00071         u_int                             seq;                <span class="comment">/* sequence number      */</span>
00072         u_int                             win;                <span class="comment">/* sequence window      */</span>
00073         u_int                             seqlast;      <span class="comment">/* last sequence number */</span>
00074         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>          seqmask;      <span class="comment">/* bitmask of seqnums   */</span>
00075         gss_name_t                    client_name;      <span class="comment">/* unparsed name string */</span>
00076 };
00077 
<a name="l00078"></a><a class="code" href="rpcsec__gss__server_8c.html#a11">00078</a> <span class="preprocessor">#define SVCAUTH_PRIVATE(auth) \</span>
00079 <span class="preprocessor">        ((struct Svc_rpc_gss_data *)(auth)-&gt;svc_ah_private)</span>
00080 <span class="preprocessor"></span>
<a name="l00081"></a><a class="code" href="rpcsec__gss__server_8c.html#a16">00081</a> <span class="keywordtype">void</span> <a class="code" href="rpcsec__gss__server_8natif_8c.html#a16">rpc_log_status</a>( <span class="keywordtype">char</span> *m, OM_uint32 maj_stat, OM_uint32 min_stat)
00082 {
00083         OM_uint32 min;
00084         gss_buffer_desc msg;
00085         <span class="keywordtype">int</span> msg_ctx = 0;
00086         FILE * tmplog ;
00087 
00088         fprintf(stderr, <span class="stringliteral">"Rpcsec_gss: %s: "</span>, m);
00089 
00090         gss_display_status(&amp;min, maj_stat, GSS_C_GSS_CODE, GSS_C_NULL_OID,
00091                            &amp;msg_ctx, &amp;msg);
00092         fprintf(stderr, <span class="stringliteral">"%s - "</span>, (<span class="keywordtype">char</span> *)msg.value);
00093         gss_release_buffer(&amp;min, &amp;msg);
00094 
00095         gss_display_status(&amp;min, min_stat, GSS_C_MECH_CODE, GSS_C_NULL_OID, &amp;msg_ctx, &amp;msg);
00096         fprintf(stderr, <span class="stringliteral">"%s\n"</span>, (<span class="keywordtype">char</span> *)msg.value);
00097         gss_release_buffer(&amp;min, &amp;msg);
00098 }
00099 
<a name="l00100"></a><a class="code" href="rpcsec__gss__server_8c.html#a17">00100</a> <span class="keywordtype">void</span> <a class="code" href="rpcsec__gss__server_8natif_8c.html#a17">dispatch</a>( <span class="keyword">struct</span> Svc_req * ptr_req, SVCXPRT * ptr_svc )
00101 {
00102   <span class="keywordtype">int</span> val ;
00103   <span class="keyword">struct </span>Rpc_gss_cred     * gc = NULL ;
00104   <span class="keyword">struct </span><a class="code" href="structSvc__rpc__gss__data.html">Svc_rpc_gss_data</a> * gd = NULL ;
00105   gss_buffer_desc           mechname;
00106   gss_buffer_desc           clientname ;
00107   OM_uint32                 maj_stat = 0 ;
00108   OM_uint32                 min_stat = 0 ;
00109 
00110   printf( <span class="stringliteral">"For this cal, authentication type %u is used\n"</span>, ptr_req-&gt;rq_cred.oa_flavor ) ;
00111 
00112   <span class="keywordflow">switch</span>( ptr_req-&gt;rq_proc )
00113     {
00114     <span class="keywordflow">case</span> <a class="code" href="onc__rpc__client_8c.html#a6">PROC_NULL</a>:
00115        printf( <span class="stringliteral">"Appel a PROC_NULL\n"</span> ) ;
00116 
00117       <span class="keywordflow">if</span>( Svc_getargs( ptr_svc, <a class="code" href="Xdr_8c.html#a5">Xdr_void</a>, NULL ) == FALSE )
00118         <a class="code" href="Svc_8c.html#a16">Svcerr_decode</a>( ptr_svc ) ;
00119       <span class="keywordflow">if</span>( <a class="code" href="Svc_8c.html#a14">Svc_sendreply</a>( ptr_svc, <a class="code" href="Xdr_8c.html#a5">Xdr_void</a>, NULL ) == FALSE )
00120         <a class="code" href="Svc_8c.html#a16">Svcerr_decode</a>( ptr_svc ) ;
00121       break ;
00122       
00123     <span class="keywordflow">case</span> <a class="code" href="onc__rpc__client_8c.html#a7">PROC_PLUS1</a>:
00124       printf(  <span class="stringliteral">"Appel a PROC_PLUS1\n"</span> ) ;
00125      
00126       <span class="keywordflow">if</span>( ptr_req-&gt;rq_cred.oa_flavor != RPCSEC_GSS )
00127         {
00128           <span class="comment">/* On n'a pas l'authentification qu'il faut, on degage de la */</span>
00129           <a class="code" href="Svc_8c.html#a19">Svcerr_weakauth</a>( ptr_svc ) ;
00130           break ;
00131         }
00132 
00133       gc = ptr_req-&gt;rq_clntcred;
00134       gd = <a class="code" href="rpcsec__gss__server_8c.html#a11">SVCAUTH_PRIVATE</a>(ptr_req-&gt;rq_xprt-&gt;xp_auth);
00135 
00136       maj_stat = gss_display_name(&amp;min_stat, 
00137                                   gd-&gt;<a class="code" href="structSvc__rpc__gss__data.html#o8">client_name</a>, 
00138                                   &amp;clientname, 
00139                                   &amp;gd-&gt;<a class="code" href="structSvc__rpc__gss__data.html#o2">sec</a>.mech);
00140       <a class="code" href="rpcsec__gss__server_8natif_8c.html#a16">rpc_log_status</a>( <span class="stringliteral">"gss_display_name (clientname) "</span>, maj_stat, min_stat ) ; 
00141       printf( <span class="stringliteral">"    le client est %s\n"</span>, clientname.value ) ;
00142 
00143       maj_stat = gss_oid_to_str(&amp;min_stat, 
00144                                 gd-&gt;<a class="code" href="structSvc__rpc__gss__data.html#o2">sec</a>.mech, 
00145                                 &amp;mechname);
00146       <a class="code" href="rpcsec__gss__server_8natif_8c.html#a16">rpc_log_status</a>( <span class="stringliteral">"gss_oid_to_str"</span>, maj_stat, min_stat ) ; 
00147       printf( <span class="stringliteral">"    OID = %s\n"</span>, mechname.value ) ;
00148 
00149       printf( <span class="stringliteral">"    KRB5OID =1.2.840.113554.1.2.2\n"</span> ) ;
00150 
00151       printf( <span class="stringliteral">"    RPCSEC_GSS Service is %u   RPCSEC_GSS_SVC_NONE=%u RPCSEC_GSS_SVC_INTEGRITY=%u RPCSEC_GSS_SVC_PRIVACY=%u\n"</span>, 
00152              gc-&gt;gc_svc, RPCSEC_GSS_SVC_NONE, RPCSEC_GSS_SVC_INTEGRITY, RPCSEC_GSS_SVC_PRIVACY ) ;
00153 
00154       
00155 
00156       <span class="comment">/* Le client est un gentil, on le laisse travailler */</span>
00157       <span class="keywordflow">if</span>( Svc_getargs( ptr_svc, <a class="code" href="Xdr_8c.html#a6">Xdr_int</a>, (<span class="keywordtype">char</span> *)&amp;val ) == FALSE )
00158         <a class="code" href="Svc_8c.html#a16">Svcerr_decode</a>( ptr_svc ) ;
00159       
00160       printf( <span class="stringliteral">"Valeur recue = %d\n"</span>, val ) ;
00161 
00162       val = val + 1 ;  <span class="comment">/* Ce que fait cette fonction est spectaculaire ... :-)))) */</span>
00163       
00164       <span class="keywordflow">if</span>( <a class="code" href="Svc_8c.html#a14">Svc_sendreply</a>( ptr_svc, <a class="code" href="Xdr_8c.html#a6">Xdr_int</a>, (<span class="keywordtype">char</span> *)&amp;val ) == FALSE )
00165         <a class="code" href="Svc_8c.html#a16">Svcerr_decode</a>( ptr_svc ) ;
00166       
00167       break ;
00168     }
00169   
00170 } <span class="comment">/* dispatch */</span>
00171 
<a name="l00172"></a><a class="code" href="rpcsec__gss__server_8c.html#a18">00172</a> <a class="code" href="server-gss_8c.html#a35">main</a>( <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> * argv[] )
00173 {
00174   <span class="keywordtype">char</span>               nom_exec[MAXPATHLEN] ;
00175   <span class="keywordtype">char</span> *             tempo_nom_exec  = NULL ;
00176   <span class="keyword">struct </span>rpcent *    etc_rpc ;               <span class="comment">/* pour consulter /etc/rpc ou rpc.bynumber */</span>
00177   <span class="keywordtype">int</span>                c ;                     <span class="comment">/* pour getopt                  */</span>
00178   <span class="keyword">static</span> <span class="keywordtype">char</span>        machine_locale[256] ;
00179   SVCXPRT *          ptr_svc ;
00180   <span class="keywordtype">int</span>                rc ;
00181 
00182   <span class="keywordtype">char</span> principal[1024] ;
00183   <span class="keywordtype">char</span> mechanism[1024] ;
00184 
00185   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> req_time = 10000 ;
00186   u_int lo, hi ;
00187   
00188   bool_t ret ;
00189  
00190   <span class="comment">/* Initialisation des valeurs par defaut */</span>
00191   strcpy( logfile_name, <a class="code" href="onc__rpc__server_8c.html#a0">LOGFILE_DEFAUT</a> ) ;
00192   strcpy( principal, <a class="code" href="rpcsec__gss__client_8c.html#a9">DEFAULT_PRINCIPAL</a> ) ;
00193   strcpy( mechanism, <a class="code" href="rpcsec__gss__client_8c.html#a8">DEFAULT_MECHANISM</a> ) ;
00194   
00195   <span class="comment">/* On recupere le nom de l'executable */</span>
00196   <span class="keywordflow">if</span>( ( tempo_nom_exec = strrchr( argv[0], <span class="charliteral">'/'</span> ) ) != NULL )
00197     strcpy( (<span class="keywordtype">char</span> *)nom_exec, tempo_nom_exec + 1 ) ;
00198  
00199  
00200   <span class="keywordflow">while</span>( ( c = getopt( argc, argv, <a class="code" href="client-gss_8c.html#a14">options</a> ) ) != EOF )
00201     {
00202       <span class="keywordflow">switch</span>( c ) 
00203         {
00204         <span class="keywordflow">case</span> <span class="charliteral">'s'</span>:
00205           <span class="comment">/* Un nom ou un numero de service a ete indique */</span>
00206           <span class="keywordflow">if</span>( isalpha( (<span class="keywordtype">int</span>)*optarg ) )
00207             {
00208               <span class="comment">/* Ca commence pas par un chiffre donc c'est un nom service */</span>
00209               <span class="keywordflow">if</span>( ( etc_rpc = getrpcbyname( optarg ) ) == NULL )
00210                 {
00211                   fprintf( stderr, <span class="stringliteral">"Impossible de resoudre le service %s\n"</span>, optarg ) ;
00212                 }
00213               <span class="keywordflow">else</span>
00214                 {
00215                   <a class="code" href="onc__rpc__server_8c.html#a12">rpc_service_num</a> = etc_rpc-&gt;r_number ;
00216                 }
00217             }
00218           <span class="keywordflow">else</span>
00219             {
00220               <span class="comment">/* C'est un numero de service qui est indique */</span>
00221               <a class="code" href="onc__rpc__server_8c.html#a12">rpc_service_num</a> = atoi( optarg ) ;
00222             }
00223           break ;
00224 
00225         <span class="keywordflow">case</span> <span class="charliteral">'S'</span>:
00226           <span class="comment">/* On positionne le service */</span>
00227           strcpy( principal, optarg ) ;
00228           break ;
00229 
00230         <span class="keywordflow">case</span> <span class="charliteral">'M'</span>:
00231           <span class="comment">/* On positionne le mecanisme */</span>
00232           strcpy( mechanism, optarg ) ;
00233           break ;
00234           
00235         <span class="keywordflow">case</span> <span class="charliteral">'L'</span>:
00236            printf( <span class="stringliteral">"Option -L unsupported for now\n"</span> ) ;
00237            break ;
00238 
00239         <span class="keywordflow">case</span> <span class="charliteral">'N'</span>:
00240            printf( <span class="stringliteral">"Option -N unsupported for now\n"</span> ) ;
00241            break ;
00242 
00243         <span class="keywordflow">case</span> <span class="charliteral">'?'</span>:
00244         <span class="keywordflow">case</span> <span class="charliteral">'h'</span>:
00245         <span class="keywordflow">default</span>:
00246           <span class="comment">/* Cette option affiche l'aide en ligne */</span>
00247           printf( <span class="stringliteral">"Unknown option %c\n"</span>, c ) ;
00248           printf( <a class="code" href="client-gss_8c.html#a15">utilisation</a>, argv[0] ) ;
00249           exit( 0 ) ;
00250           break ;
00251         }
00252     }
00253 <span class="preprocessor">#ifndef _NO_BUDDY_SYSTEM</span>
00254 <span class="preprocessor"></span>
00255   <span class="comment">/* Init Buddy allocator */</span>
00256 
00257   <span class="keywordflow">if</span> ( ( rc = BuddyInit( NULL )) != BUDDY_SUCCESS )
00258   {
00259     <span class="comment">/* can't use shell tracing functions there */</span>
00260     fprintf( stderr, <span class="stringliteral">"Error %d initializing Buddy allocator.\n"</span>,rc);
00261     exit( 1 ) ;
00262   }
00263 
00264 <span class="preprocessor">#endif</span>
00265 <span class="preprocessor"></span>
00266   <a class="code" href="Svc__tab__auth_8c.html#a3">Svcauth_gss_tab_creds_alloc</a>() ;
00267 
00268   <span class="keywordflow">if</span>( argc != optind )
00269     {
00270       fprintf( stderr, <a class="code" href="client-gss_8c.html#a15">utilisation</a>, nom_exec ) ;
00271       fprintf( stderr, <span class="stringliteral">"Pas d'argument additionnel\n"</span> ) ;
00272       exit( 1 ) ;
00273     }
00274   
00275   <span class="comment">/* Obtention du nom de la machine */</span>
00276   <span class="keywordflow">if</span>( gethostname( machine_locale, <span class="keyword">sizeof</span>( machine_locale ) ) != 0 )
00277     {
00278       printf( <span class="stringliteral">"gethostbyname impossible: errno=%d, h_errno=%d\n"</span>, errno, h_errno ) ;
00279       exit( 1 ) ;
00280     }
00281  
00282   <span class="comment">/* Petit coucou initial */</span>
00283   printf( <span class="stringliteral">"Demarrage du serveur toto-server-rpc\n"</span> ) ;
00284   printf( <span class="stringliteral">"Le nom de la machine est %s\n"</span>, machine_locale ) ;
00285   printf( <span class="stringliteral">"J'utilise le service RPC %d\n"</span>, <a class="code" href="onc__rpc__server_8c.html#a12">rpc_service_num</a> ) ;
00286   printf( <span class="stringliteral">"Utilisation du principal %s sur le mecanisme %s\n"</span>, principal, mechanism ) ; 
00287 
00288   <span class="comment">/* Creation du handler SVC */</span>
00289   <span class="keywordflow">if</span>( ( ptr_svc = <a class="code" href="Svc__tcp_8c.html#a14">Svctcp_create</a>( RPC_ANYSOCK, <a class="code" href="onc__rpc__client_8c.html#a4">SEND_SIZE</a> , <a class="code" href="onc__rpc__client_8c.html#a3">RECV_SIZE</a> ) ) == NULL )
00290     {
00291       printf( <span class="stringliteral">"svctcp_create impossible\n"</span> ) ;
00292       exit( 1 ) ;
00293     }
00294   
00295   <span class="comment">/* Si un enregistrement au portmapper avait eu lieu, je le latte */</span>
00296   <a class="code" href="Pmap__clnt_8c.html#a4">Pmap_unset</a>( <a class="code" href="onc__rpc__server_8c.html#a12">rpc_service_num</a>, <a class="code" href="onc__rpc__client_8c.html#a5">V1</a> ) ;
00297 
00298   <span class="comment">/* Creation des ressources pour la GSSAPI au travers de RPCSEC_GSS */</span>
00299   <span class="keywordflow">if</span>( ( ret = Svcauth_gss_import_name( principal ) ) != TRUE )
00300     {
00301       printf( <span class="stringliteral">"Erreur dans svcauth_gss_import_name\n"</span> ) ;
00302       exit( 1 ) ;
00303     }
00304   
00305   
00306    <span class="comment">/* Enregistrement du service */</span>
00307   printf( <span class="stringliteral">"Enregistrement sur le service %d\n"</span>, <a class="code" href="onc__rpc__server_8c.html#a12">rpc_service_num</a> ) ;
00308   <span class="keywordflow">if</span>( <a class="code" href="Svc_8c.html#a10">Svc_register</a>( ptr_svc, <a class="code" href="onc__rpc__server_8c.html#a12">rpc_service_num</a>, <a class="code" href="onc__rpc__client_8c.html#a5">V1</a>, <a class="code" href="onc__rpc__server_8c.html#a13">dispatch</a>, IPPROTO_TCP ) == FALSE )
00309     {
00310       printf( <span class="stringliteral">"svc_register impossible\n"</span> ) ;
00311       exit( 1 ) ;
00312     }
00313 
00314   printf( <span class="stringliteral">"------------------\n"</span> ) ;
00315 
00316   <span class="comment">/* Silence, on tourne .... */</span>
00317   <a class="code" href="Svc__run_8c.html#a1">Svc_run</a>() ;
00318 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Fri Dec 22 14:15:35 2006 for RPCSEC_GSS Library by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
