<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>RPCSEC_GSS Library: Clnt_generic.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>Clnt_generic.c</h1><a href="Clnt__generic_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">/*</span>
00002 <span class="comment"> * Sun RPC is a product of Sun Microsystems, Inc. and is provided for</span>
00003 <span class="comment"> * unrestricted use provided that this legend is included on all tape</span>
00004 <span class="comment"> * media and as a part of the software program in whole or part.  Users</span>
00005 <span class="comment"> * may copy or modify Sun RPC without charge, but are not authorized</span>
00006 <span class="comment"> * to license or distribute it to anyone else except as part of a product or</span>
00007 <span class="comment"> * program developed by the user.</span>
00008 <span class="comment"> * </span>
00009 <span class="comment"> * SUN RPC IS PROVIDED AS IS WITH NO WARRANTIES OF ANY KIND INCLUDING THE</span>
00010 <span class="comment"> * WARRANTIES OF DESIGN, MERCHANTIBILITY AND FITNESS FOR A PARTICULAR</span>
00011 <span class="comment"> * PURPOSE, OR ARISING FROM A COURSE OF DEALING, USAGE OR TRADE PRACTICE.</span>
00012 <span class="comment"> * </span>
00013 <span class="comment"> * Sun RPC is provided with no support and without any obligation on the</span>
00014 <span class="comment"> * part of Sun Microsystems, Inc. to assist in its use, correction,</span>
00015 <span class="comment"> * modification or enhancement.</span>
00016 <span class="comment"> *</span>
00017 <span class="comment"> * SUN MICROSYSTEMS, INC. SHALL HAVE NO LIABILITY WITH RESPECT TO THE</span>
00018 <span class="comment"> * INFRINGEMENT OF COPYRIGHTS, TRADE SECRETS OR ANY PATENTS BY SUN RPC</span>
00019 <span class="comment"> * OR ANY PART THEREOF.</span>
00020 <span class="comment"> * </span>
00021 <span class="comment"> * In no event will Sun Microsystems, Inc. be liable for any lost revenue</span>
00022 <span class="comment"> * or profits or other special, indirect and consequential damages, even if</span>
00023 <span class="comment"> * Sun has been advised of the possibility of such damages.</span>
00024 <span class="comment"> * </span>
00025 <span class="comment"> * Sun Microsystems, Inc.</span>
00026 <span class="comment"> * 2550 Garcia Avenue</span>
00027 <span class="comment"> * Mountain View, California  94043</span>
00028 <span class="comment"> */</span>
00029 
00030 <span class="comment">/*</span>
00031 <span class="comment"> * Copyright (C) 1987, Sun Microsystems, Inc.</span>
00032 <span class="comment"> */</span>
00033 <span class="preprocessor">#include &lt;string.h&gt;</span>
00034 <span class="preprocessor">#include "Rpc.h"</span>
00035 <span class="preprocessor">#include &lt;sys/socket.h&gt;</span>
00036 <span class="preprocessor">#include &lt;sys/errno.h&gt;</span>
00037 <span class="preprocessor">#include &lt;netdb.h&gt;</span>
00038 
00039 <span class="comment">/*</span>
00040 <span class="comment"> * Generic client creation: takes (hostname, program-number, protocol) and</span>
00041 <span class="comment"> * returns client handle. Default options are set, which the user can </span>
00042 <span class="comment"> * change using the rpc equivalent of ioctl()'s.</span>
00043 <span class="comment"> */</span>
<a name="l00044"></a><a class="code" href="Clnt__generic_8c.html#a0">00044</a> Client * <a class="code" href="Clnt__generic_8c.html#a0">Clnt_create</a>( <span class="keywordtype">char</span> * hostname, u_long prog, u_long vers, <span class="keywordtype">char</span> * proto)
00045 {
00046         <span class="keyword">struct </span>hostent *h;
00047         <span class="keyword">struct </span>protoent *p;
00048         <span class="keyword">struct </span>sockaddr_in sin;
00049         <span class="keywordtype">int</span> sock;
00050         <span class="keyword">struct </span>timeval tv;
00051         Client *client;
00052 
00053         h = gethostbyname(hostname);
00054         <span class="keywordflow">if</span> (h == NULL) {
00055                 rpc_createerr.cf_stat = RPC_UNKNOWNHOST;
00056                 <span class="keywordflow">return</span> (NULL);
00057         }
00058         <span class="keywordflow">if</span> (h-&gt;h_addrtype != AF_INET) {
00059                 <span class="comment">/*</span>
00060 <span class="comment">                 * Only support INET for now</span>
00061 <span class="comment">                 */</span>
00062                 rpc_createerr.cf_stat = RPC_SYSTEMERROR;
00063                 rpc_createerr.cf_error.re_errno = EAFNOSUPPORT; 
00064                 <span class="keywordflow">return</span> (NULL);
00065         }
00066         memset(&amp;sin, 0, <span class="keyword">sizeof</span>(sin));
00067 <span class="preprocessor">#ifndef __linux__</span>
00068 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00069 <span class="preprocessor"></span>        sin.sin_family = h-&gt;h_addrtype;
00070         sin.sin_port = 0;
00071         memcpy((<span class="keywordtype">char</span>*)&amp;sin.sin_addr, h-&gt;h_addr, h-&gt;h_length);
00072         p = getprotobyname(proto);
00073         <span class="keywordflow">if</span> (p == NULL) {
00074                 rpc_createerr.cf_stat = RPC_UNKNOWNPROTO;
00075                 rpc_createerr.cf_error.re_errno = EPFNOSUPPORT; 
00076                 <span class="keywordflow">return</span> (NULL);
00077         }
00078         sock = RPC_ANYSOCK;
00079         <span class="keywordflow">switch</span> (p-&gt;p_proto) {
00080         <span class="keywordflow">case</span> IPPROTO_UDP:
00081                 tv.tv_sec = 5;
00082                 tv.tv_usec = 0;
00083                 client = <a class="code" href="Clnt__udp_8c.html#a9">Clntudp_create</a>(&amp;sin, prog, vers, tv, &amp;sock);
00084                 <span class="keywordflow">if</span> (client == NULL) {
00085                         <span class="keywordflow">return</span> (NULL);
00086                 }
00087                 <span class="keywordflow">break</span>;
00088         <span class="keywordflow">case</span> IPPROTO_TCP:
00089                 client = <a class="code" href="Clnt__tcp_8c.html#a11">Clnttcp_create</a>(&amp;sin, prog, vers, &amp;sock, 0, 0);
00090                 <span class="keywordflow">if</span> (client == NULL) {
00091                         <span class="keywordflow">return</span> (NULL);
00092                 }
00093                 <span class="keywordflow">break</span>;
00094         <span class="keywordflow">default</span>:
00095                 rpc_createerr.cf_stat = RPC_SYSTEMERROR;
00096                 rpc_createerr.cf_error.re_errno = EPFNOSUPPORT; 
00097                 <span class="keywordflow">return</span> (NULL);
00098         }
00099         <span class="keywordflow">return</span> (client);
00100 }
00101 
<a name="l00102"></a><a class="code" href="Clnt__generic_8c.html#a1">00102</a> bool_t <a class="code" href="Clnt__generic_8c.html#a1">Clientwrap_args</a>( Client * clnt, XDR * xdrs, Xdrproc_t  xdr_args, caddr_t args_ptr)
00103 {
00104   <span class="keywordflow">return</span> ((*xdr_args)(xdrs, args_ptr));
00105 }
00106 
<a name="l00107"></a><a class="code" href="Clnt__generic_8c.html#a2">00107</a> bool_t <a class="code" href="Clnt__generic_8c.html#a2">Clientunwrap_args</a>( Client * clnt,  XDR * xdrs, Xdrproc_t  xdr_args, caddr_t args_ptr)
00108 {
00109   <span class="keywordflow">return</span> ((*xdr_args)(xdrs, args_ptr));
00110 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Fri Dec 22 14:15:35 2006 for RPCSEC_GSS Library by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
