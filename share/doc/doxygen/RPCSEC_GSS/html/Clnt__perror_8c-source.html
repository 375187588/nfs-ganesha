<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>RPCSEC_GSS Library: Clnt_perror.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>Clnt_perror.c</h1><a href="Clnt__perror_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">/*</span>
00002 <span class="comment"> * Sun RPC is a product of Sun Microsystems, Inc. and is provided for</span>
00003 <span class="comment"> * unrestricted use provided that this legend is included on all tape</span>
00004 <span class="comment"> * media and as a part of the software program in whole or part.  Users</span>
00005 <span class="comment"> * may copy or modify Sun RPC without charge, but are not authorized</span>
00006 <span class="comment"> * to license or distribute it to anyone else except as part of a product or</span>
00007 <span class="comment"> * program developed by the user.</span>
00008 <span class="comment"> *</span>
00009 <span class="comment"> * SUN RPC IS PROVIDED AS IS WITH NO WARRANTIES OF ANY KIND INCLUDING THE</span>
00010 <span class="comment"> * WARRANTIES OF DESIGN, MERCHANTIBILITY AND FITNESS FOR A PARTICULAR</span>
00011 <span class="comment"> * PURPOSE, OR ARISING FROM A COURSE OF DEALING, USAGE OR TRADE PRACTICE.</span>
00012 <span class="comment"> *</span>
00013 <span class="comment"> * Sun RPC is provided with no support and without any obligation on the</span>
00014 <span class="comment"> * part of Sun Microsystems, Inc. to assist in its use, correction,</span>
00015 <span class="comment"> * modification or enhancement.</span>
00016 <span class="comment"> *</span>
00017 <span class="comment"> * SUN MICROSYSTEMS, INC. SHALL HAVE NO LIABILITY WITH RESPECT TO THE</span>
00018 <span class="comment"> * INFRINGEMENT OF COPYRIGHTS, TRADE SECRETS OR ANY PATENTS BY SUN RPC</span>
00019 <span class="comment"> * OR ANY PART THEREOF.</span>
00020 <span class="comment"> *</span>
00021 <span class="comment"> * In no event will Sun Microsystems, Inc. be liable for any lost revenue</span>
00022 <span class="comment"> * or profits or other special, indirect and consequential damages, even if</span>
00023 <span class="comment"> * Sun has been advised of the possibility of such damages.</span>
00024 <span class="comment"> *</span>
00025 <span class="comment"> * Sun Microsystems, Inc.</span>
00026 <span class="comment"> * 2550 Garcia Avenue</span>
00027 <span class="comment"> * Mountain View, California  94043</span>
00028 <span class="comment"> */</span>
00029 
00030 <span class="comment">/*</span>
00031 <span class="comment"> * clnt_perror.c</span>
00032 <span class="comment"> *</span>
00033 <span class="comment"> * Copyright (C) 1984, Sun Microsystems, Inc.</span>
00034 <span class="comment"> *</span>
00035 <span class="comment"> */</span>
00036 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00037 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00038 <span class="preprocessor">#include &lt;string.h&gt;</span>
00039 <span class="preprocessor">#include "Rpc.h"</span>
00040 <span class="preprocessor">#include "Types.h"</span>
00041 <span class="preprocessor">#include "Auth.h"</span>
00042 <span class="preprocessor">#include "Clnt.h"</span>
00043 
00044 <span class="keyword">static</span> <span class="keywordtype">char</span> *auth_errmsg();
<a name="l00045"></a><a class="code" href="Clnt__perror_8c.html#a0">00045</a> <span class="preprocessor">#define CLNT_PERROR_BUFLEN 256</span>
00046 <span class="preprocessor"></span>
00047 <span class="keyword">static</span> <span class="keywordtype">char</span> *buf;
00048 
00049 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> rpc_errlist[] = {
00050         <span class="stringliteral">"RPC: Success"</span>,                         <span class="comment">/*  0 - RPC_SUCCESS */</span>
00051         <span class="stringliteral">"RPC: Can't encode arguments"</span>,          <span class="comment">/*  1 - RPC_CANTENCODEARGS */</span>
00052         <span class="stringliteral">"RPC: Can't decode result"</span>,             <span class="comment">/*  2 - RPC_CANTDECODERES */</span>
00053         <span class="stringliteral">"RPC: Unable to send"</span>,                  <span class="comment">/*  3 - RPC_CANTSEND */</span>
00054         <span class="stringliteral">"RPC: Unable to receive"</span>,               <span class="comment">/*  4 - RPC_CANTRECV */</span>
00055         <span class="stringliteral">"RPC: Timed out"</span>,                       <span class="comment">/*  5 - RPC_TIMEDOUT */</span>
00056         <span class="stringliteral">"RPC: Incompatible versions of RPC"</span>,    <span class="comment">/*  6 - RPC_VERSMISMATCH */</span>
00057         <span class="stringliteral">"RPC: Authentication error"</span>,            <span class="comment">/*  7 - RPC_AUTHERROR */</span>
00058         <span class="stringliteral">"RPC: Program unavailable"</span>,             <span class="comment">/*  8 - RPC_PROGUNAVAIL */</span>
00059         <span class="stringliteral">"RPC: Program/version mismatch"</span>,        <span class="comment">/*  9 - RPC_PROGVERSMISMATCH */</span>
00060         <span class="stringliteral">"RPC: Procedure unavailable"</span>,           <span class="comment">/* 10 - RPC_PROCUNAVAIL */</span>
00061         <span class="stringliteral">"RPC: Server can't decode arguments"</span>,   <span class="comment">/* 11 - RPC_CANTDECODEARGS */</span>
00062         <span class="stringliteral">"RPC: Remote system error"</span>,             <span class="comment">/* 12 - RPC_SYSTEMERROR */</span>
00063         <span class="stringliteral">"RPC: Unknown host"</span>,                    <span class="comment">/* 13 - RPC_UNKNOWNHOST */</span>
00064         <span class="stringliteral">"RPC: Port mapper failure"</span>,             <span class="comment">/* 14 - RPC_PMAPFAILURE */</span>
00065         <span class="stringliteral">"RPC: Program not registered"</span>,          <span class="comment">/* 15 - RPC_PROGNOTREGISTERED */</span>
00066         <span class="stringliteral">"RPC: Failed (unspecified error)"</span>,      <span class="comment">/* 16 - RPC_FAILED */</span>
00067         <span class="stringliteral">"RPC: Unknown protocol"</span>                 <span class="comment">/* 17 - RPC_UNKNOWNPROTO */</span>
00068 };
00069 
00070 
00071 
00072 <span class="keyword">static</span> <span class="keywordtype">char</span> *
00073 _buf()
00074 {
00075 
00076         <span class="keywordflow">if</span> (buf == 0)
00077                 buf = (<span class="keywordtype">char</span> *)malloc(CLNT_PERROR_BUFLEN);
00078         <span class="keywordflow">return</span> (buf);
00079 }
00080 
00081 <span class="comment">/*</span>
00082 <span class="comment"> * This interface for use by clntrpc</span>
00083 <span class="comment"> */</span>
<a name="l00084"></a><a class="code" href="Clnt__perror_8c.html#a6">00084</a> <span class="keywordtype">char</span> * <a class="code" href="Clnt__perror_8c.html#a6">Clnt_sperrno</a>( <span class="keyword">enum</span> Clnt_stat stat)
00085 {
00086         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> errnum = stat;
00087 
00088         <span class="keywordflow">if</span> (errnum &lt; (<span class="keyword">sizeof</span>(rpc_errlist)/<span class="keyword">sizeof</span>(rpc_errlist[0])))
00089                 <span class="keywordflow">return</span> (<span class="keywordtype">char</span> *)rpc_errlist[errnum];
00090 
00091         <span class="keywordflow">return</span> (<span class="stringliteral">"RPC: (unknown error code)"</span>);
00092 }
00093 
<a name="l00094"></a><a class="code" href="Clnt__perror_8c.html#a7">00094</a> <span class="keywordtype">void</span> <a class="code" href="Clnt__perror_8c.html#a7">Clnt_perrno</a>( <span class="keyword">enum</span> Clnt_stat num)
00095 {
00096         (void) fprintf(stderr, <span class="stringliteral">"%s\n"</span>, clnt_sperrno(num));
00097 }
00098 
00099 <span class="comment">/*</span>
00100 <span class="comment"> * Print reply error info</span>
00101 <span class="comment"> */</span>
<a name="l00102"></a><a class="code" href="Clnt__perror_8c.html#a8">00102</a> <span class="keywordtype">char</span> * <a class="code" href="Clnt__perror_8c.html#a8">Clnt_sperror</a>( Client * rpch, <span class="keywordtype">char</span> * s )
00103 {
00104         <span class="keyword">struct </span>Rpc_err e;
00105         <span class="keywordtype">char</span> *err;
00106         <span class="keywordtype">char</span> *str = _buf();
00107         <span class="keywordtype">char</span> *strstart = str;
00108         <span class="keywordtype">int</span> ret;
00109 
00110         <span class="keywordflow">if</span> (str == 0)
00111                 <span class="keywordflow">return</span> (0);
00112         CLNT_GETERR(rpch, &amp;e);
00113 
00114         ret = snprintf(str, <a class="code" href="Clnt__perror_8c.html#a0">CLNT_PERROR_BUFLEN</a>, <span class="stringliteral">"%s: %s"</span>, s,
00115             clnt_sperrno(e.re_status));
00116         str += ret;
00117         <span class="keywordflow">if</span> (str &gt; strstart + CLNT_PERROR_BUFLEN)
00118                 <span class="keywordflow">goto</span> truncated;
00119 
00120         <span class="keywordflow">switch</span> (e.re_status) {
00121         <span class="keywordflow">case</span> RPC_SUCCESS:
00122         <span class="keywordflow">case</span> RPC_CANTENCODEARGS:
00123         <span class="keywordflow">case</span> RPC_CANTDECODERES:
00124         <span class="keywordflow">case</span> RPC_TIMEDOUT:
00125         <span class="keywordflow">case</span> RPC_PROGUNAVAIL:
00126         <span class="keywordflow">case</span> RPC_PROCUNAVAIL:
00127         <span class="keywordflow">case</span> RPC_CANTDECODEARGS:
00128         <span class="keywordflow">case</span> RPC_SYSTEMERROR:
00129         <span class="keywordflow">case</span> RPC_UNKNOWNHOST:
00130         <span class="keywordflow">case</span> RPC_UNKNOWNPROTO:
00131         <span class="keywordflow">case</span> RPC_PMAPFAILURE:
00132         <span class="keywordflow">case</span> RPC_PROGNOTREGISTERED:
00133         <span class="keywordflow">case</span> RPC_FAILED:
00134                 <span class="keywordflow">break</span>;
00135 
00136         <span class="keywordflow">case</span> RPC_CANTSEND:
00137         <span class="keywordflow">case</span> RPC_CANTRECV:
00138                 ret = snprintf(str, <a class="code" href="Clnt__perror_8c.html#a0">CLNT_PERROR_BUFLEN</a> - (str - strstart),
00139                     <span class="stringliteral">"; errno = %s\n"</span>, strerror(e.re_errno));
00140                 <span class="keywordflow">break</span>;
00141 
00142         <span class="keywordflow">case</span> RPC_VERSMISMATCH:
00143                 ret = snprintf(str, <a class="code" href="Clnt__perror_8c.html#a0">CLNT_PERROR_BUFLEN</a> - (str - strstart),
00144                     <span class="stringliteral">"; low version = %u, high version = %u\n"</span>,
00145                     e.re_vers.low, e.re_vers.high);
00146                 <span class="keywordflow">break</span>;
00147 
00148         <span class="keywordflow">case</span> RPC_AUTHERROR:
00149                 err = auth_errmsg(e.re_why);
00150                 ret = snprintf(str, <a class="code" href="Clnt__perror_8c.html#a0">CLNT_PERROR_BUFLEN</a> - (str - strstart),
00151                     <span class="stringliteral">"; why = "</span>);
00152                 str += ret;
00153                 <span class="keywordflow">if</span> (str &gt; strstart + CLNT_PERROR_BUFLEN)
00154                         <span class="keywordflow">goto</span> truncated;
00155                 <span class="keywordflow">if</span> (err != NULL) {
00156                         ret = snprintf(str, <a class="code" href="Clnt__perror_8c.html#a0">CLNT_PERROR_BUFLEN</a> -
00157                             (str - strstart), <span class="stringliteral">"%s\n"</span>, err);
00158                 } <span class="keywordflow">else</span> {
00159                         ret = snprintf(str, <a class="code" href="Clnt__perror_8c.html#a0">CLNT_PERROR_BUFLEN</a> -
00160                             (str - strstart),
00161                             <span class="stringliteral">"(unknown authentication error - %d)\n"</span>,
00162                             (<span class="keywordtype">int</span>) e.re_why);
00163                 }
00164                 <span class="keywordflow">break</span>;
00165 
00166         <span class="keywordflow">case</span> RPC_PROGVERSMISMATCH:
00167                 ret = snprintf(str, <a class="code" href="Clnt__perror_8c.html#a0">CLNT_PERROR_BUFLEN</a> - (str - strstart),
00168                     <span class="stringliteral">"; low version = %u, high version = %u\n"</span>,
00169                     e.re_vers.low, e.re_vers.high);
00170                 <span class="keywordflow">break</span>;
00171 
00172         <span class="keywordflow">default</span>:        <span class="comment">/* unknown */</span>
00173                 ret = snprintf(str, <a class="code" href="Clnt__perror_8c.html#a0">CLNT_PERROR_BUFLEN</a> - (str - strstart),
00174                     <span class="stringliteral">"; s1 = %u, s2 = %u\n"</span>, e.re_lb.s1, e.re_lb.s2);
00175                 <span class="keywordflow">break</span>;
00176         }
00177         strstart[<a class="code" href="Clnt__perror_8c.html#a0">CLNT_PERROR_BUFLEN</a>-2] = <span class="charliteral">'\0'</span>;
00178         strcat(strstart, <span class="stringliteral">"\n"</span>);
00179         <span class="keywordflow">return</span> (strstart);
00180 
00181 truncated:
00182         snprintf(strstart + <a class="code" href="Clnt__perror_8c.html#a0">CLNT_PERROR_BUFLEN</a> - 5, 5, <span class="stringliteral">"...\n"</span>);
00183         <span class="keywordflow">return</span> (strstart);
00184 }
00185 
<a name="l00186"></a><a class="code" href="Clnt__perror_8c.html#a9">00186</a> <span class="keywordtype">void</span> <a class="code" href="Pmap__clnt_8c.html#a2">Clnt_perror</a>( Client * rpch, <span class="keywordtype">char</span> * s)
00187 {
00188         (void) fprintf(stderr, <span class="stringliteral">"%s\n"</span>, clnt_sperror(rpch, s));
00189 }
00190 
00191 
00192 
<a name="l00193"></a><a class="code" href="Clnt__perror_8c.html#a10">00193</a> <span class="keywordtype">char</span> * <a class="code" href="Clnt__perror_8c.html#a10">Clnt_spcreateerror</a>( <span class="keywordtype">char</span> * s)
00194 {
00195         <span class="keywordtype">char</span> *str = _buf();
00196 
00197         <span class="keywordflow">if</span> (str == 0)
00198                 <span class="keywordflow">return</span> (0);
00199 
00200         <span class="keywordflow">switch</span> (rpc_createerr.cf_stat) {
00201         <span class="keywordflow">case</span> RPC_PMAPFAILURE:
00202                 (void) snprintf(str, <a class="code" href="Clnt__perror_8c.html#a0">CLNT_PERROR_BUFLEN</a>, <span class="stringliteral">"%s: %s - %s\n"</span>, s,
00203                     clnt_sperrno(rpc_createerr.cf_stat),
00204                     clnt_sperrno(rpc_createerr.cf_error.re_status));
00205                 <span class="keywordflow">break</span>;
00206 
00207         <span class="keywordflow">case</span> RPC_SYSTEMERROR:
00208                 (void) snprintf(str, <a class="code" href="Clnt__perror_8c.html#a0">CLNT_PERROR_BUFLEN</a>, <span class="stringliteral">"%s: %s - %s\n"</span>, s,
00209                     clnt_sperrno(rpc_createerr.cf_stat),
00210                     strerror(rpc_createerr.cf_error.re_errno));
00211                 <span class="keywordflow">break</span>;
00212 
00213         <span class="keywordflow">default</span>:
00214                 (void) snprintf(str, <a class="code" href="Clnt__perror_8c.html#a0">CLNT_PERROR_BUFLEN</a>, <span class="stringliteral">"%s: %s\n"</span>, s,
00215                     clnt_sperrno(rpc_createerr.cf_stat));
00216                 <span class="keywordflow">break</span>;
00217         }
00218         str[<a class="code" href="Clnt__perror_8c.html#a0">CLNT_PERROR_BUFLEN</a>-2] = <span class="charliteral">'\n'</span>;
00219         str[<a class="code" href="Clnt__perror_8c.html#a0">CLNT_PERROR_BUFLEN</a>-1] = <span class="charliteral">'\0'</span>;
00220         <span class="keywordflow">return</span> (str);
00221 }
00222 
<a name="l00223"></a><a class="code" href="Clnt__perror_8c.html#a11">00223</a> <span class="keywordtype">void</span> <a class="code" href="Clnt__perror_8c.html#a11">Clnt_pcreateerror</a>( <span class="keywordtype">char</span> * s)
00224 {
00225         (void) fprintf(stderr, <span class="stringliteral">"%s"</span>, clnt_spcreateerror(s));
00226 }
00227 
00228 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> auth_errlist[] = {
00229         <span class="stringliteral">"Authentication OK"</span>,                    <span class="comment">/* 0 - AUTH_OK */</span>
00230         <span class="stringliteral">"Invalid client credential"</span>,            <span class="comment">/* 1 - AUTH_BADCRED */</span>
00231         <span class="stringliteral">"Server rejected credential"</span>,           <span class="comment">/* 2 - AUTH_REJECTEDCRED */</span>
00232         <span class="stringliteral">"Invalid client verifier"</span>,              <span class="comment">/* 3 - AUTH_BADVERF */</span>
00233         <span class="stringliteral">"Server rejected verifier"</span>,             <span class="comment">/* 4 - AUTH_REJECTEDVERF */</span>
00234         <span class="stringliteral">"Client credential too weak"</span>,           <span class="comment">/* 5 - AUTH_TOOWEAK */</span>
00235         <span class="stringliteral">"Invalid server verifier"</span>,              <span class="comment">/* 6 - AUTH_INVALIDRESP */</span>
00236         <span class="stringliteral">"Failed (unspecified error)"</span>            <span class="comment">/* 7 - AUTH_FAILED */</span>
00237 };
00238 
00239 
00240 
00241 
00242 <span class="keyword">static</span> <span class="keywordtype">char</span> * auth_errmsg( stat)
00243         enum Auth_stat stat;
00244 {
00245         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> errnum = stat;
00246 
00247         <span class="keywordflow">if</span> (errnum &lt; (<span class="keyword">sizeof</span>(auth_errlist)/<span class="keyword">sizeof</span>(auth_errlist[0])))
00248                 <span class="keywordflow">return</span> (<span class="keywordtype">char</span> *)auth_errlist[errnum];
00249 
00250         <span class="keywordflow">return</span> (NULL);
00251 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Fri Dec 22 14:15:35 2006 for RPCSEC_GSS Library by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
