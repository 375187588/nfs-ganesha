\section{cache\_\-content\_\-misc.c File Reference}
\label{cache__content__misc_8c}\index{cache\_\-content\_\-misc.c@{cache\_\-content\_\-misc.c}}


Management of the file content cache: miscellaneous functions.  
{\ttfamily \#include \char`\"{}fsal.h\char`\"{}}\par
{\ttfamily \#include \char`\"{}LRU\_\-List.h\char`\"{}}\par
{\ttfamily \#include \char`\"{}log\_\-macros.h\char`\"{}}\par
{\ttfamily \#include \char`\"{}HashData.h\char`\"{}}\par
{\ttfamily \#include \char`\"{}HashTable.h\char`\"{}}\par
{\ttfamily \#include \char`\"{}cache\_\-inode.h\char`\"{}}\par
{\ttfamily \#include \char`\"{}cache\_\-content.h\char`\"{}}\par
{\ttfamily \#include \char`\"{}stuff\_\-alloc.h\char`\"{}}\par
{\ttfamily \#include \char`\"{}nfs\_\-exports.h\char`\"{}}\par
{\ttfamily \#include $<$unistd.h$>$}\par
{\ttfamily \#include $<$sys/types.h$>$}\par
{\ttfamily \#include $<$sys/param.h$>$}\par
{\ttfamily \#include $<$time.h$>$}\par
{\ttfamily \#include $<$pthread.h$>$}\par
{\ttfamily \#include $<$string.h$>$}\par
{\ttfamily \#include $<$libgen.h$>$}\par
\subsection*{Defines}
\begin{DoxyCompactItemize}
\item 
\#define {\bf ALPHABET\_\-LEN}~16
\item 
\#define {\bf PRIME\_\-16BITS}~65521
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
short {\bf HashFileID4} (u\_\-int64\_\-t fileid4)
\item 
cache\_\-content\_\-status\_\-t {\bf cache\_\-content\_\-create\_\-name} (char $\ast$path, cache\_\-content\_\-nametype\_\-t type, fsal\_\-op\_\-context\_\-t $\ast$pcontext, cache\_\-entry\_\-t $\ast$pentry\_\-inode, cache\_\-content\_\-client\_\-t $\ast$pclient)
\item 
int {\bf cache\_\-content\_\-get\_\-export\_\-id} (char $\ast$dirname)
\item 
u\_\-int64\_\-t {\bf cache\_\-content\_\-get\_\-inum} (char $\ast$filename)
\item 
int {\bf cache\_\-content\_\-get\_\-datapath} (char $\ast$basepath, u\_\-int64\_\-t inum, char $\ast$datapath)
\item 
off\_\-t {\bf cache\_\-content\_\-recover\_\-size} (char $\ast$basepath, u\_\-int64\_\-t inum)
\item 
off\_\-t {\bf cache\_\-content\_\-get\_\-cached\_\-size} (cache\_\-content\_\-entry\_\-t $\ast$pentry)
\item 
cache\_\-inode\_\-status\_\-t {\bf cache\_\-content\_\-error\_\-convert} (cache\_\-content\_\-status\_\-t status)
\item 
off\_\-t {\bf cache\_\-content\_\-fsal\_\-seek\_\-convert} (fsal\_\-seek\_\-t seek, cache\_\-content\_\-status\_\-t $\ast$pstatus)
\item 
size\_\-t {\bf cache\_\-content\_\-fsal\_\-size\_\-convert} (fsal\_\-size\_\-t size, cache\_\-content\_\-status\_\-t $\ast$pstatus)
\item 
cache\_\-content\_\-status\_\-t {\bf cache\_\-content\_\-prepare\_\-directories} (exportlist\_\-t $\ast$pexportlist, char $\ast$cache\_\-dir, cache\_\-content\_\-status\_\-t $\ast$pstatus)
\item 
cache\_\-content\_\-status\_\-t {\bf cache\_\-content\_\-valid} (cache\_\-content\_\-entry\_\-t $\ast$pentry, cache\_\-inode\_\-op\_\-t op, cache\_\-content\_\-client\_\-t $\ast$pclient)
\item 
cache\_\-content\_\-status\_\-t {\bf cache\_\-content\_\-check\_\-threshold} (char $\ast$datacache\_\-path, unsigned int threshold\_\-min, unsigned int threshold\_\-max, int $\ast$p\_\-bool\_\-overflow, unsigned long $\ast$p\_\-blocks\_\-to\_\-lwm)
\item 
int {\bf cache\_\-content\_\-local\_\-cache\_\-opendir} (char $\ast$cache\_\-dir, cache\_\-content\_\-dirinfo\_\-t $\ast$pdirectory)
\item 
cache\_\-content\_\-status\_\-t {\bf cache\_\-content\_\-test\_\-cached} (cache\_\-entry\_\-t $\ast$pentry\_\-inode, cache\_\-content\_\-client\_\-t $\ast$pclient, fsal\_\-op\_\-context\_\-t $\ast$pcontext, cache\_\-content\_\-status\_\-t $\ast$pstatus)
\item 
int {\bf cache\_\-content\_\-local\_\-cache\_\-dir\_\-iter} (cache\_\-content\_\-dirinfo\_\-t $\ast$directory, struct dirent $\ast$pdir\_\-entry, unsigned int index, unsigned int mod)
\item 
void {\bf cache\_\-content\_\-local\_\-cache\_\-closedir} (cache\_\-content\_\-dirinfo\_\-t $\ast$directory)
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
unsigned int {\bf cache\_\-content\_\-dir\_\-errno}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Management of the file content cache: miscellaneous functions. \begin{DoxyAuthor}{Author}

\end{DoxyAuthor}
Author}
leibovic \begin{DoxyDate}{Date}

\end{DoxyDate}
Date}
2006/01/18 07:29:11 \begin{DoxyVersion}{Version}

\end{DoxyVersion}
Revision}
1.14 \doxyref{cache\_\-content\_\-misc.c}{p.}{cache__content__misc_8c} : Management of the file content cache, miscellaneous functions. 

Definition in file {\bf cache\_\-content\_\-misc.c}.

\subsection{Define Documentation}
\index{cache\_\-content\_\-misc.c@{cache\_\-content\_\-misc.c}!ALPHABET\_\-LEN@{ALPHABET\_\-LEN}}
\index{ALPHABET\_\-LEN@{ALPHABET\_\-LEN}!cache_content_misc.c@{cache\_\-content\_\-misc.c}}
\subsubsection[{ALPHABET\_\-LEN}]{\setlength{\rightskip}{0pt plus 5cm}\#define ALPHABET\_\-LEN~16}\label{cache__content__misc_8c_a1527a76432d0b61b445ab8a14a59f821}
\index{cache\_\-content\_\-misc.c@{cache\_\-content\_\-misc.c}!PRIME\_\-16BITS@{PRIME\_\-16BITS}}
\index{PRIME\_\-16BITS@{PRIME\_\-16BITS}!cache_content_misc.c@{cache\_\-content\_\-misc.c}}
\subsubsection[{PRIME\_\-16BITS}]{\setlength{\rightskip}{0pt plus 5cm}\#define PRIME\_\-16BITS~65521}\label{cache__content__misc_8c_af835625f13c0a3237a12d62b51932d49}


\subsection{Function Documentation}
\index{cache\_\-content\_\-misc.c@{cache\_\-content\_\-misc.c}!cache\_\-content\_\-check\_\-threshold@{cache\_\-content\_\-check\_\-threshold}}
\index{cache\_\-content\_\-check\_\-threshold@{cache\_\-content\_\-check\_\-threshold}!cache_content_misc.c@{cache\_\-content\_\-misc.c}}
\subsubsection[{cache\_\-content\_\-check\_\-threshold}]{\setlength{\rightskip}{0pt plus 5cm}cache\_\-content\_\-status\_\-t cache\_\-content\_\-check\_\-threshold (char $\ast$ {\em datacache\_\-path}, \/  unsigned int {\em threshold\_\-min}, \/  unsigned int {\em threshold\_\-max}, \/  int $\ast$ {\em p\_\-bool\_\-overflow}, \/  unsigned long $\ast$ {\em p\_\-blocks\_\-to\_\-lwm})}\label{cache__content__misc_8c_a9ed29d26f2626db68ba4e64feb82f399}
cache\_\-content\_\-check\_\-threshold: check datacache filesystem's threshold.


\begin{DoxyParams}{Parameters}
\item[{\em datacache\_\-path}][IN] the datacache filesystem's path. \item[{\em threshold\_\-min}][IN] the low watermark for the filesystem (in percent). \item[{\em threshold\_\-max}][IN] the high watermark for the filesystem (in percent). \item[{\em p\_\-bool\_\-overflow}][OUT] boolean that indicates whether the FS overcomes the high watermark. \item[{\em p\_\-blocks\_\-to\_\-lwm}][OUT] if bool\_\-overflow is set to true, this indicates the number of blocks to be purged in order to reach the low watermark.\end{DoxyParams}
\begin{DoxyReturn}{Returns}
CACHE\_\-CONTENT\_\-SUCCESS if successful \par
 

CACHE\_\-CONTENT\_\-INVALID\_\-ARGUMENT if some argument has an unexpected value\par
 

CACHE\_\-CONTENT\_\-LOCAL\_\-CACHE\_\-ERROR if an error occured while getting informations from datacache filesystem. 
\end{DoxyReturn}


Definition at line 564 of file cache\_\-content\_\-misc.c.\index{cache\_\-content\_\-misc.c@{cache\_\-content\_\-misc.c}!cache\_\-content\_\-create\_\-name@{cache\_\-content\_\-create\_\-name}}
\index{cache\_\-content\_\-create\_\-name@{cache\_\-content\_\-create\_\-name}!cache_content_misc.c@{cache\_\-content\_\-misc.c}}
\subsubsection[{cache\_\-content\_\-create\_\-name}]{\setlength{\rightskip}{0pt plus 5cm}cache\_\-content\_\-status\_\-t cache\_\-content\_\-create\_\-name (char $\ast$ {\em path}, \/  cache\_\-content\_\-nametype\_\-t {\em type}, \/  fsal\_\-op\_\-context\_\-t $\ast$ {\em pcontext}, \/  cache\_\-entry\_\-t $\ast$ {\em pentry\_\-inode}, \/  cache\_\-content\_\-client\_\-t $\ast$ {\em pclient})}\label{cache__content__misc_8c_a558daea3079689a6b6fb6d88aee83436}
cache\_\-content\_\-create\_\-name: Creates a name in the local fs for a cached entry.

Creates a name in the local fs for a cached entry and creates the directories that whil contain this file.


\begin{DoxyParams}{Parameters}
\item[{\em path}][OUT] buffer to be used for storing the name. \item[{\em type}][IN] type of pathname to be created. \item[{\em pentry\_\-inode}][OUT] Entry in Cache inode layer related to the file content entry. \item[{\em pclient}][IN] resources allocated for the file content client.\end{DoxyParams}
\begin{DoxyReturn}{Returns}
CACHE\_\-CONTENT\_\-SUCCESS if operation is a success, other values show an error. 
\end{DoxyReturn}


Definition at line 112 of file cache\_\-content\_\-misc.c.\index{cache\_\-content\_\-misc.c@{cache\_\-content\_\-misc.c}!cache\_\-content\_\-error\_\-convert@{cache\_\-content\_\-error\_\-convert}}
\index{cache\_\-content\_\-error\_\-convert@{cache\_\-content\_\-error\_\-convert}!cache_content_misc.c@{cache\_\-content\_\-misc.c}}
\subsubsection[{cache\_\-content\_\-error\_\-convert}]{\setlength{\rightskip}{0pt plus 5cm}cache\_\-inode\_\-status\_\-t cache\_\-content\_\-error\_\-convert (cache\_\-content\_\-status\_\-t {\em status})}\label{cache__content__misc_8c_aeb24a6ba9e91d72989466f52e7529a57}
cache\_\-content\_\-error\_\-convert: Converts a cache\_\-content\_\-status to a cache\_\-inode\_\-status.

Converts a cache\_\-content\_\-status to a cache\_\-inode\_\-status.


\begin{DoxyParams}{Parameters}
\item[{\em status}][IN] File content status to be converted.\end{DoxyParams}
\begin{DoxyReturn}{Returns}
a cache\_\-inode\_\-status\_\-t resulting from the conversion. 
\end{DoxyReturn}


Definition at line 349 of file cache\_\-content\_\-misc.c.\index{cache\_\-content\_\-misc.c@{cache\_\-content\_\-misc.c}!cache\_\-content\_\-fsal\_\-seek\_\-convert@{cache\_\-content\_\-fsal\_\-seek\_\-convert}}
\index{cache\_\-content\_\-fsal\_\-seek\_\-convert@{cache\_\-content\_\-fsal\_\-seek\_\-convert}!cache_content_misc.c@{cache\_\-content\_\-misc.c}}
\subsubsection[{cache\_\-content\_\-fsal\_\-seek\_\-convert}]{\setlength{\rightskip}{0pt plus 5cm}off\_\-t cache\_\-content\_\-fsal\_\-seek\_\-convert (fsal\_\-seek\_\-t {\em seek}, \/  cache\_\-content\_\-status\_\-t $\ast$ {\em pstatus})}\label{cache__content__misc_8c_a96da5495accf749026fbf64f3c1c87ed}
cache\_\-content\_\-fsal\_\-seek\_\-convert: converts a fsal\_\-seek\_\-t to unix offet.

Converts a fsal\_\-seek\_\-t to unix offet. Non absolulte fsal\_\-seek\_\-t will produce an error.


\begin{DoxyParams}{Parameters}
\item[{\em seek}][IN] FSAL Seek descriptor. \item[{\em pstatus}][OUT] pointer to the status.\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the converted value. 
\end{DoxyReturn}


Definition at line 407 of file cache\_\-content\_\-misc.c.\index{cache\_\-content\_\-misc.c@{cache\_\-content\_\-misc.c}!cache\_\-content\_\-fsal\_\-size\_\-convert@{cache\_\-content\_\-fsal\_\-size\_\-convert}}
\index{cache\_\-content\_\-fsal\_\-size\_\-convert@{cache\_\-content\_\-fsal\_\-size\_\-convert}!cache_content_misc.c@{cache\_\-content\_\-misc.c}}
\subsubsection[{cache\_\-content\_\-fsal\_\-size\_\-convert}]{\setlength{\rightskip}{0pt plus 5cm}size\_\-t cache\_\-content\_\-fsal\_\-size\_\-convert (fsal\_\-size\_\-t {\em size}, \/  cache\_\-content\_\-status\_\-t $\ast$ {\em pstatus})}\label{cache__content__misc_8c_ac8190cf8e2db21b75f6d74d1648de866}
cache\_\-content\_\-fsal\_\-size\_\-convert: converts a fsal\_\-size\_\-t to unix size.

Converts a fsal\_\-seek\_\-t to unix size.


\begin{DoxyParams}{Parameters}
\item[{\em seek}][IN] FSAL Seek descriptor. \item[{\em pstatus}][OUT] pointer to the status.\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the converted value. 
\end{DoxyReturn}


Definition at line 434 of file cache\_\-content\_\-misc.c.\index{cache\_\-content\_\-misc.c@{cache\_\-content\_\-misc.c}!cache\_\-content\_\-get\_\-cached\_\-size@{cache\_\-content\_\-get\_\-cached\_\-size}}
\index{cache\_\-content\_\-get\_\-cached\_\-size@{cache\_\-content\_\-get\_\-cached\_\-size}!cache_content_misc.c@{cache\_\-content\_\-misc.c}}
\subsubsection[{cache\_\-content\_\-get\_\-cached\_\-size}]{\setlength{\rightskip}{0pt plus 5cm}off\_\-t cache\_\-content\_\-get\_\-cached\_\-size (cache\_\-content\_\-entry\_\-t $\ast$ {\em pentry})}\label{cache__content__misc_8c_ab856d8b9a1b91fa69af22146bd4f1305}
cache\_\-content\_\-get\_\-cached\_\-size: recovers the size of a data cached file.

Recovers the size of a data cached file.


\begin{DoxyParams}{Parameters}
\item[{\em pentry}][IN] related pentry\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the recovered size (as a off\_\-t) or -\/1 is failed. 
\end{DoxyReturn}


Definition at line 319 of file cache\_\-content\_\-misc.c.\index{cache\_\-content\_\-misc.c@{cache\_\-content\_\-misc.c}!cache\_\-content\_\-get\_\-datapath@{cache\_\-content\_\-get\_\-datapath}}
\index{cache\_\-content\_\-get\_\-datapath@{cache\_\-content\_\-get\_\-datapath}!cache_content_misc.c@{cache\_\-content\_\-misc.c}}
\subsubsection[{cache\_\-content\_\-get\_\-datapath}]{\setlength{\rightskip}{0pt plus 5cm}int cache\_\-content\_\-get\_\-datapath (char $\ast$ {\em basepath}, \/  u\_\-int64\_\-t {\em inum}, \/  char $\ast$ {\em datapath})}\label{cache__content__misc_8c_aabf4ddbf1dd5475f61c90a6eb0b3fffe}
cache\_\-content\_\-get\_\-datapath : recovers the path for a file of a specified inum.


\begin{DoxyParams}{Parameters}
\item[{\em basepath}][IN] path to the root of the directory in the cache for the related export entry \item[{\em inum}][IN] inode number for the file whose size is to be recovered. \item[{\em path}][OUT] the absolute path of the file (must be at least a MAXPATHLEN length string).\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 if OK, or -\/1 is failed. 
\end{DoxyReturn}


Definition at line 256 of file cache\_\-content\_\-misc.c.\index{cache\_\-content\_\-misc.c@{cache\_\-content\_\-misc.c}!cache\_\-content\_\-get\_\-export\_\-id@{cache\_\-content\_\-get\_\-export\_\-id}}
\index{cache\_\-content\_\-get\_\-export\_\-id@{cache\_\-content\_\-get\_\-export\_\-id}!cache_content_misc.c@{cache\_\-content\_\-misc.c}}
\subsubsection[{cache\_\-content\_\-get\_\-export\_\-id}]{\setlength{\rightskip}{0pt plus 5cm}int cache\_\-content\_\-get\_\-export\_\-id (char $\ast$ {\em dirname})}\label{cache__content__misc_8c_ad90cf34ec0cf809d6c35ddd7bb46cfb9}
cache\_\-content\_\-get\_\-export\_\-id: gets an export id from an export dirname.

Gets an export id from an export dirname.


\begin{DoxyParams}{Parameters}
\item[{\em dirname}][IN] The dirname for the export\_\-id dirname.\end{DoxyParams}
\begin{DoxyReturn}{Returns}
-\/1 if failed, the export\_\-id if successfull. 
\end{DoxyReturn}


Definition at line 197 of file cache\_\-content\_\-misc.c.\index{cache\_\-content\_\-misc.c@{cache\_\-content\_\-misc.c}!cache\_\-content\_\-get\_\-inum@{cache\_\-content\_\-get\_\-inum}}
\index{cache\_\-content\_\-get\_\-inum@{cache\_\-content\_\-get\_\-inum}!cache_content_misc.c@{cache\_\-content\_\-misc.c}}
\subsubsection[{cache\_\-content\_\-get\_\-inum}]{\setlength{\rightskip}{0pt plus 5cm}u\_\-int64\_\-t cache\_\-content\_\-get\_\-inum (char $\ast$ {\em filename})}\label{cache__content__misc_8c_a6b96dfc7a98b14cb192f08b17c5b5b93}
cache\_\-content\_\-get\_\-inum: gets an inode number fronm a cache filename.

Gets an inode number fronm a cache filename.


\begin{DoxyParams}{Parameters}
\item[{\em filename}][IN] The filename to be parsed.\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 if failed, the inum if successfull. 
\end{DoxyReturn}


Definition at line 221 of file cache\_\-content\_\-misc.c.\index{cache\_\-content\_\-misc.c@{cache\_\-content\_\-misc.c}!cache\_\-content\_\-local\_\-cache\_\-closedir@{cache\_\-content\_\-local\_\-cache\_\-closedir}}
\index{cache\_\-content\_\-local\_\-cache\_\-closedir@{cache\_\-content\_\-local\_\-cache\_\-closedir}!cache_content_misc.c@{cache\_\-content\_\-misc.c}}
\subsubsection[{cache\_\-content\_\-local\_\-cache\_\-closedir}]{\setlength{\rightskip}{0pt plus 5cm}void cache\_\-content\_\-local\_\-cache\_\-closedir (cache\_\-content\_\-dirinfo\_\-t $\ast$ {\em directory})}\label{cache__content__misc_8c_af5c7ef164385697883f6b9f15e656320}
cache\_\-content\_\-local\_\-cache\_\-closedir: Close a local cache directory associated to an export entry.


\begin{DoxyParams}{Parameters}
\item[{\em directory\mbox{[}IN\mbox{]}}]the handle to the directory to be closed\end{DoxyParams}
\begin{DoxyReturn}{Returns}
nothing (void function) 
\end{DoxyReturn}


Definition at line 950 of file cache\_\-content\_\-misc.c.\index{cache\_\-content\_\-misc.c@{cache\_\-content\_\-misc.c}!cache\_\-content\_\-local\_\-cache\_\-dir\_\-iter@{cache\_\-content\_\-local\_\-cache\_\-dir\_\-iter}}
\index{cache\_\-content\_\-local\_\-cache\_\-dir\_\-iter@{cache\_\-content\_\-local\_\-cache\_\-dir\_\-iter}!cache_content_misc.c@{cache\_\-content\_\-misc.c}}
\subsubsection[{cache\_\-content\_\-local\_\-cache\_\-dir\_\-iter}]{\setlength{\rightskip}{0pt plus 5cm}int cache\_\-content\_\-local\_\-cache\_\-dir\_\-iter (cache\_\-content\_\-dirinfo\_\-t $\ast$ {\em directory}, \/  struct dirent $\ast$ {\em pdir\_\-entry}, \/  unsigned int {\em index}, \/  unsigned int {\em mod})}\label{cache__content__misc_8c_af3b048f895eb9a6432ef2fe8a08ce1a8}
cache\_\-content\_\-local\_\-cache\_\-dir\_\-iter: iterate on a local cache directory to get the entry one by one


\begin{DoxyParams}{Parameters}
\item[{\em directory}][IN] the directory to be read \item[{\em index}][IN] thread index for multithreaded flushes (first has index 0) \item[{\em mod}][IN] modulus for multithreaded flushes (number of threads) \item[{\em pdir\_\-entry}][OUT] found dir\_\-entry\end{DoxyParams}
\begin{DoxyReturn}{Returns}
TRUE if OK, FALSE if NOK. 
\end{DoxyReturn}


Definition at line 746 of file cache\_\-content\_\-misc.c.\index{cache\_\-content\_\-misc.c@{cache\_\-content\_\-misc.c}!cache\_\-content\_\-local\_\-cache\_\-opendir@{cache\_\-content\_\-local\_\-cache\_\-opendir}}
\index{cache\_\-content\_\-local\_\-cache\_\-opendir@{cache\_\-content\_\-local\_\-cache\_\-opendir}!cache_content_misc.c@{cache\_\-content\_\-misc.c}}
\subsubsection[{cache\_\-content\_\-local\_\-cache\_\-opendir}]{\setlength{\rightskip}{0pt plus 5cm}int cache\_\-content\_\-local\_\-cache\_\-opendir (char $\ast$ {\em cache\_\-dir}, \/  cache\_\-content\_\-dirinfo\_\-t $\ast$ {\em pdirectory})}\label{cache__content__misc_8c_a67e093fa4348ca6fd0a9151b7af9d4db}
cache\_\-content\_\-local\_\-cache\_\-opendir: Open a local cache directory associated to an export entry.


\begin{DoxyParams}{Parameters}
\item[{\em cache\_\-dir}][IN] the path to the directory associated with the export entry \item[{\em pdirectory}][OUT] pointer to trhe openend directory\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the handle to the directory or NULL is failed 
\end{DoxyReturn}


Definition at line 651 of file cache\_\-content\_\-misc.c.\index{cache\_\-content\_\-misc.c@{cache\_\-content\_\-misc.c}!cache\_\-content\_\-prepare\_\-directories@{cache\_\-content\_\-prepare\_\-directories}}
\index{cache\_\-content\_\-prepare\_\-directories@{cache\_\-content\_\-prepare\_\-directories}!cache_content_misc.c@{cache\_\-content\_\-misc.c}}
\subsubsection[{cache\_\-content\_\-prepare\_\-directories}]{\setlength{\rightskip}{0pt plus 5cm}cache\_\-content\_\-status\_\-t cache\_\-content\_\-prepare\_\-directories (exportlist\_\-t $\ast$ {\em pexportlist}, \/  char $\ast$ {\em cache\_\-dir}, \/  cache\_\-content\_\-status\_\-t $\ast$ {\em pstatus})}\label{cache__content__misc_8c_a5a36f1db8fd5661e4bb0107148a30aef}
cache\_\-content\_\-prepare\_\-directories: do the mkdir to set the data cache directories

do the mkdir to set the data cache directories.


\begin{DoxyParams}{Parameters}
\item[{\em pexportlist}][IN] export list \item[{\em pstatus}][OUT] pointer to the status.\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the status for the operation 
\end{DoxyReturn}


Definition at line 456 of file cache\_\-content\_\-misc.c.\index{cache\_\-content\_\-misc.c@{cache\_\-content\_\-misc.c}!cache\_\-content\_\-recover\_\-size@{cache\_\-content\_\-recover\_\-size}}
\index{cache\_\-content\_\-recover\_\-size@{cache\_\-content\_\-recover\_\-size}!cache_content_misc.c@{cache\_\-content\_\-misc.c}}
\subsubsection[{cache\_\-content\_\-recover\_\-size}]{\setlength{\rightskip}{0pt plus 5cm}off\_\-t cache\_\-content\_\-recover\_\-size (char $\ast$ {\em basepath}, \/  u\_\-int64\_\-t {\em inum})}\label{cache__content__misc_8c_a2b1831ed9c563dbae4271b982bde20e4}
cache\_\-content\_\-recover\_\-size: recovers the size of a data cached file.

Recovers the size of a data cached file.


\begin{DoxyParams}{Parameters}
\item[{\em basepath}][IN] path to the root of the directory in the cache for the related export entry \item[{\em inum}][IN] inode number for the file whose size is to be recovered.\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the recovered size (as a off\_\-t) or -\/1 is failed. 
\end{DoxyReturn}


Definition at line 286 of file cache\_\-content\_\-misc.c.\index{cache\_\-content\_\-misc.c@{cache\_\-content\_\-misc.c}!cache\_\-content\_\-test\_\-cached@{cache\_\-content\_\-test\_\-cached}}
\index{cache\_\-content\_\-test\_\-cached@{cache\_\-content\_\-test\_\-cached}!cache_content_misc.c@{cache\_\-content\_\-misc.c}}
\subsubsection[{cache\_\-content\_\-test\_\-cached}]{\setlength{\rightskip}{0pt plus 5cm}cache\_\-content\_\-status\_\-t cache\_\-content\_\-test\_\-cached (cache\_\-entry\_\-t $\ast$ {\em pentry\_\-inode}, \/  cache\_\-content\_\-client\_\-t $\ast$ {\em pclient}, \/  fsal\_\-op\_\-context\_\-t $\ast$ {\em pcontext}, \/  cache\_\-content\_\-status\_\-t $\ast$ {\em pstatus})}\label{cache__content__misc_8c_af44594b42282710727bc9f55d88d062b}
cache\_\-content\_\-test\_\-cached: Tests if a given pentry\_\-inode has already an associated data cache

Tests if a given pentry\_\-inode has already an associated data cache. This is useful to recover data from a data cache built by a former server instance.


\begin{DoxyParams}{Parameters}
\item[{\em pentry\_\-inode}][IN] entry in cache\_\-inode layer for this file. \item[{\em pclient}][IN] ressource allocated by the client for the nfs management. \item[{\em pcontext}][IN] the related FSAL Context  [OUT] returned status.\end{DoxyParams}
\begin{DoxyReturn}{Returns}
CACHE\_\-CONTENT\_\-SUCCESS if entry is found, CACHE\_\-CONTENT\_\-NOT\_\-FOUND if not found 
\end{DoxyReturn}


Definition at line 695 of file cache\_\-content\_\-misc.c.\index{cache\_\-content\_\-misc.c@{cache\_\-content\_\-misc.c}!cache\_\-content\_\-valid@{cache\_\-content\_\-valid}}
\index{cache\_\-content\_\-valid@{cache\_\-content\_\-valid}!cache_content_misc.c@{cache\_\-content\_\-misc.c}}
\subsubsection[{cache\_\-content\_\-valid}]{\setlength{\rightskip}{0pt plus 5cm}cache\_\-content\_\-status\_\-t cache\_\-content\_\-valid (cache\_\-content\_\-entry\_\-t $\ast$ {\em pentry}, \/  cache\_\-inode\_\-op\_\-t {\em op}, \/  cache\_\-content\_\-client\_\-t $\ast$ {\em pclient})}\label{cache__content__misc_8c_acf68a0b9bcb53d6e1e07e928d4cb0c19}
cache\_\-content\_\-valid: validates an entry to update its garbagge status.

Validates an error to update its garbagge status. Entry is supposed to be locked when this function is called !!


\begin{DoxyParams}{Parameters}
\item[{\em pentry}][INOUT] entry to be validated. \item[{\em op}][IN] can be set to CACHE\_\-INODE\_\-OP\_\-GET or CACHE\_\-INODE\_\-OP\_\-SET to show the type of operation done. \item[{\em pclient}][INOUT] ressource allocated by the client for the nfs management.\end{DoxyParams}
\begin{DoxyReturn}{Returns}
CACHE\_\-INODE\_\-SUCCESS if successful \par
 

CACHE\_\-INODE\_\-LRU\_\-ERROR if an errorr occured in LRU management. 
\end{DoxyReturn}


Definition at line 507 of file cache\_\-content\_\-misc.c.\index{cache\_\-content\_\-misc.c@{cache\_\-content\_\-misc.c}!HashFileID4@{HashFileID4}}
\index{HashFileID4@{HashFileID4}!cache_content_misc.c@{cache\_\-content\_\-misc.c}}
\subsubsection[{HashFileID4}]{\setlength{\rightskip}{0pt plus 5cm}short HashFileID4 (u\_\-int64\_\-t {\em fileid4})}\label{cache__content__misc_8c_a0dbffec9b48e227fd67f483c26524901}


Definition at line 81 of file cache\_\-content\_\-misc.c.

\subsection{Variable Documentation}
\index{cache\_\-content\_\-misc.c@{cache\_\-content\_\-misc.c}!cache\_\-content\_\-dir\_\-errno@{cache\_\-content\_\-dir\_\-errno}}
\index{cache\_\-content\_\-dir\_\-errno@{cache\_\-content\_\-dir\_\-errno}!cache_content_misc.c@{cache\_\-content\_\-misc.c}}
\subsubsection[{cache\_\-content\_\-dir\_\-errno}]{\setlength{\rightskip}{0pt plus 5cm}unsigned int {\bf cache\_\-content\_\-dir\_\-errno}}\label{cache__content__misc_8c_a3190a93bcc417fc913470e3a2481e44e}


Definition at line 75 of file cache\_\-content\_\-misc.c.