\section{cache\_\-content\_\-emergency\_\-flush.c File Reference}
\label{cache__content__emergency__flush_8c}\index{cache\_\-content\_\-emergency\_\-flush.c@{cache\_\-content\_\-emergency\_\-flush.c}}


Emergency flush for forcing flush of data cached files to FSAL.  
{\ttfamily \#include \char`\"{}LRU\_\-List.h\char`\"{}}\par
{\ttfamily \#include \char`\"{}log\_\-macros.h\char`\"{}}\par
{\ttfamily \#include \char`\"{}HashData.h\char`\"{}}\par
{\ttfamily \#include \char`\"{}HashTable.h\char`\"{}}\par
{\ttfamily \#include \char`\"{}fsal.h\char`\"{}}\par
{\ttfamily \#include \char`\"{}nfs\_\-core.h\char`\"{}}\par
{\ttfamily \#include \char`\"{}cache\_\-inode.h\char`\"{}}\par
{\ttfamily \#include \char`\"{}cache\_\-content.h\char`\"{}}\par
{\ttfamily \#include $<$unistd.h$>$}\par
{\ttfamily \#include $<$sys/types.h$>$}\par
{\ttfamily \#include $<$sys/param.h$>$}\par
{\ttfamily \#include $<$time.h$>$}\par
{\ttfamily \#include $<$pthread.h$>$}\par
{\ttfamily \#include $<$errno.h$>$}\par
{\ttfamily \#include $<$dirent.h$>$}\par
{\ttfamily \#include $<$sys/stat.h$>$}\par
{\ttfamily \#include $<$string.h$>$}\par
\subsection*{Defines}
\begin{DoxyCompactItemize}
\item 
\#define {\bf XSTR}(s)~STR(s)
\item 
\#define {\bf STR}(s)~\#s
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
cache\_\-content\_\-status\_\-t {\bf cache\_\-content\_\-emergency\_\-flush} (char $\ast$cachedir, cache\_\-content\_\-flush\_\-behaviour\_\-t flushhow, unsigned int lw\_\-mark\_\-trigger\_\-flag, time\_\-t grace\_\-period, unsigned int index, unsigned int mod, unsigned int $\ast$p\_\-nb\_\-flushed, unsigned int $\ast$p\_\-nb\_\-too\_\-young, unsigned int $\ast$p\_\-nb\_\-errors, unsigned int $\ast$p\_\-nb\_\-orphans, fsal\_\-op\_\-context\_\-t $\ast$pcontext, cache\_\-content\_\-status\_\-t $\ast$pstatus)
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
unsigned int {\bf cache\_\-content\_\-dir\_\-errno}
\item 
nfs\_\-parameter\_\-t {\bf nfs\_\-param}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Emergency flush for forcing flush of data cached files to FSAL. \begin{DoxyAuthor}{Author}
\$Author\$ 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
\$Date\$ 
\end{DoxyDate}
\begin{DoxyVersion}{Version}
\$Revision\$ \doxyref{cache\_\-content\_\-emergency\_\-flush.c}{p.}{cache__content__emergency__flush_8c} : Emergency flush for forcing flush of data cached files to FSAL. 
\end{DoxyVersion}


Definition in file {\bf cache\_\-content\_\-emergency\_\-flush.c}.

\subsection{Define Documentation}
\index{cache\_\-content\_\-emergency\_\-flush.c@{cache\_\-content\_\-emergency\_\-flush.c}!STR@{STR}}
\index{STR@{STR}!cache_content_emergency_flush.c@{cache\_\-content\_\-emergency\_\-flush.c}}
\subsubsection[{STR}]{\setlength{\rightskip}{0pt plus 5cm}\#define STR(s)~\#s}\label{cache__content__emergency__flush_8c_a6388870e639eee9c0a69446876f1f8cc}
\index{cache\_\-content\_\-emergency\_\-flush.c@{cache\_\-content\_\-emergency\_\-flush.c}!XSTR@{XSTR}}
\index{XSTR@{XSTR}!cache_content_emergency_flush.c@{cache\_\-content\_\-emergency\_\-flush.c}}
\subsubsection[{XSTR}]{\setlength{\rightskip}{0pt plus 5cm}\#define XSTR(s)~STR(s)}\label{cache__content__emergency__flush_8c_a03943706e48069237cd57f2d35ca987e}


\subsection{Function Documentation}
\index{cache\_\-content\_\-emergency\_\-flush.c@{cache\_\-content\_\-emergency\_\-flush.c}!cache\_\-content\_\-emergency\_\-flush@{cache\_\-content\_\-emergency\_\-flush}}
\index{cache\_\-content\_\-emergency\_\-flush@{cache\_\-content\_\-emergency\_\-flush}!cache_content_emergency_flush.c@{cache\_\-content\_\-emergency\_\-flush.c}}
\subsubsection[{cache\_\-content\_\-emergency\_\-flush}]{\setlength{\rightskip}{0pt plus 5cm}cache\_\-content\_\-status\_\-t cache\_\-content\_\-emergency\_\-flush (char $\ast$ {\em cachedir}, \/  cache\_\-content\_\-flush\_\-behaviour\_\-t {\em flushhow}, \/  unsigned int {\em lw\_\-mark\_\-trigger\_\-flag}, \/  time\_\-t {\em grace\_\-period}, \/  unsigned int {\em index}, \/  unsigned int {\em mod}, \/  unsigned int $\ast$ {\em p\_\-nb\_\-flushed}, \/  unsigned int $\ast$ {\em p\_\-nb\_\-too\_\-young}, \/  unsigned int $\ast$ {\em p\_\-nb\_\-errors}, \/  unsigned int $\ast$ {\em p\_\-nb\_\-orphans}, \/  fsal\_\-op\_\-context\_\-t $\ast$ {\em pcontext}, \/  cache\_\-content\_\-status\_\-t $\ast$ {\em pstatus})}\label{cache__content__emergency__flush_8c_abad9c0ed686123ae896aed8bcb770538}
cache\_\-content\_\-emergency\_\-flush: Flushes the content of a file in the local cache to the FSAL data.

Flushes the content of a file in the local cache to the FSAL data. This routine should be called only from the cache\_\-inode layer.

No lock management is done in this layer: the related pentry in the cache inode layer is locked and will prevent from concurent accesses.


\begin{DoxyParams}{Parameters}
\item[{\em cachedir}][IN] cachedir the filesystem where the cache resides \item[{\em flushhow}][IN] should we delete local files or not ? \item[{\em lw\_\-mark\_\-trig}][IN] shpuld we purge until low water mark is reached ? \item[{\em grace\_\-period}][IN] grace\_\-period The grace period for a file before being considered for deletion \item[{\em p\_\-nb\_\-flushed}][INOUT] current flushed count \item[{\em p\_\-nb\_\-errors}][INOUT] current flush errors \item[{\em p\_\-nb\_\-orphans}][INOUT] current orphan files detected \item[{\em pcontext}][INOUT] pcontext the FSAL context for this operation \item[{\em pstatys}][OUT] the status of the operation.\end{DoxyParams}
\begin{DoxyReturn}{Returns}
CACHE\_\-CONTENT\_\-SUCCESS if successful, an error otherwise. 
\end{DoxyReturn}


Definition at line 104 of file cache\_\-content\_\-emergency\_\-flush.c.

\subsection{Variable Documentation}
\index{cache\_\-content\_\-emergency\_\-flush.c@{cache\_\-content\_\-emergency\_\-flush.c}!cache\_\-content\_\-dir\_\-errno@{cache\_\-content\_\-dir\_\-errno}}
\index{cache\_\-content\_\-dir\_\-errno@{cache\_\-content\_\-dir\_\-errno}!cache_content_emergency_flush.c@{cache\_\-content\_\-emergency\_\-flush.c}}
\subsubsection[{cache\_\-content\_\-dir\_\-errno}]{\setlength{\rightskip}{0pt plus 5cm}unsigned int {\bf cache\_\-content\_\-dir\_\-errno}}\label{cache__content__emergency__flush_8c_a3190a93bcc417fc913470e3a2481e44e}


Definition at line 75 of file cache\_\-content\_\-misc.c.\index{cache\_\-content\_\-emergency\_\-flush.c@{cache\_\-content\_\-emergency\_\-flush.c}!nfs\_\-param@{nfs\_\-param}}
\index{nfs\_\-param@{nfs\_\-param}!cache_content_emergency_flush.c@{cache\_\-content\_\-emergency\_\-flush.c}}
\subsubsection[{nfs\_\-param}]{\setlength{\rightskip}{0pt plus 5cm}nfs\_\-parameter\_\-t {\bf nfs\_\-param}}\label{cache__content__emergency__flush_8c_aeb8fc46586993cf210777049fca03969}
