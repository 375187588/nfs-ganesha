\section{cache\_\-content\_\-rdwr.c File Reference}
\label{cache__content__rdwr_8c}\index{cache_content_rdwr.c@{cache\_\-content\_\-rdwr.c}}
Management of the file content cache: read/write operations. 

{\tt \#include \char`\"{}fsal.h\char`\"{}}\par
{\tt \#include \char`\"{}LRU\_\-List.h\char`\"{}}\par
{\tt \#include \char`\"{}log\_\-functions.h\char`\"{}}\par
{\tt \#include \char`\"{}Hash\-Data.h\char`\"{}}\par
{\tt \#include \char`\"{}Hash\-Table.h\char`\"{}}\par
{\tt \#include \char`\"{}cache\_\-inode.h\char`\"{}}\par
{\tt \#include \char`\"{}cache\_\-content.h\char`\"{}}\par
{\tt \#include $<$unistd.h$>$}\par
{\tt \#include $<$sys/types.h$>$}\par
{\tt \#include $<$sys/stat.h$>$}\par
{\tt \#include $<$fcntl.h$>$}\par
{\tt \#include $<$sys/param.h$>$}\par
{\tt \#include $<$time.h$>$}\par
{\tt \#include $<$pthread.h$>$}\par
\subsection*{Functions}
\begin{CompactItemize}
\item 
ssize\_\-t {\bf pread} (int fd, void $\ast$buf, size\_\-t count, off\_\-t offset)
\item 
ssize\_\-t {\bf pwrite} (int fd, const void $\ast$buf, size\_\-t count, off\_\-t offset)
\item 
cache\_\-content\_\-status\_\-t {\bf cache\_\-content\_\-open} (cache\_\-content\_\-entry\_\-t $\ast$pentry, cache\_\-content\_\-client\_\-t $\ast$pclient, cache\_\-content\_\-status\_\-t $\ast$pstatus)
\item 
cache\_\-content\_\-status\_\-t {\bf cache\_\-content\_\-close} (cache\_\-content\_\-entry\_\-t $\ast$pentry, cache\_\-content\_\-client\_\-t $\ast$pclient, cache\_\-content\_\-status\_\-t $\ast$pstatus)
\item 
cache\_\-content\_\-status\_\-t {\bf cache\_\-content\_\-rdwr} (cache\_\-content\_\-entry\_\-t $\ast$pentry, cache\_\-content\_\-io\_\-direction\_\-t read\_\-or\_\-write, fsal\_\-seek\_\-t $\ast$seek\_\-descriptor, fsal\_\-size\_\-t $\ast$pio\_\-size\_\-in, fsal\_\-size\_\-t $\ast$pio\_\-size\_\-out, caddr\_\-t buffer, fsal\_\-boolean\_\-t $\ast$p\_\-fsal\_\-eof, struct stat $\ast$pbuffstat, cache\_\-content\_\-client\_\-t $\ast$pclient, fsal\_\-op\_\-context\_\-t $\ast$pcontext, cache\_\-content\_\-status\_\-t $\ast$pstatus)
\end{CompactItemize}


\subsection{Detailed Description}
Management of the file content cache: read/write operations. 

\begin{Desc}
\item[Author:]\begin{Desc}
\item[Author]deniel \end{Desc}
\end{Desc}
\begin{Desc}
\item[Date:]\begin{Desc}
\item[Date]2005/11/28 17:02:33 \end{Desc}
\end{Desc}
\begin{Desc}
\item[Version:]\begin{Desc}
\item[Revision]1.12 \end{Desc}
\end{Desc}
cache\_\-content\_\-rdwr.c.c : Management of the file content cache, read and write operations.

Definition in file {\bf cache\_\-content\_\-rdwr.c}.

\subsection{Function Documentation}
\index{cache_content_rdwr.c@{cache\_\-content\_\-rdwr.c}!cache_content_close@{cache\_\-content\_\-close}}
\index{cache_content_close@{cache\_\-content\_\-close}!cache_content_rdwr.c@{cache\_\-content\_\-rdwr.c}}
\subsubsection{\setlength{\rightskip}{0pt plus 5cm}cache\_\-content\_\-status\_\-t cache\_\-content\_\-close (cache\_\-content\_\-entry\_\-t $\ast$ {\em pentry}, cache\_\-content\_\-client\_\-t $\ast$ {\em pclient}, cache\_\-content\_\-status\_\-t $\ast$ {\em pstatus})}\label{cache__content__rdwr_8c_a3}


cache\_\-content\_\-close: closes the local fd on the cache.

Closes the local fd on the cache.

No lock management is done in this layer: the related pentry in the cache inode layer is locked and will prevent from concurent accesses.

\begin{Desc}
\item[Parameters:]
\begin{description}
\item[{\em pentry}][IN] entry in file content layer whose content is to be accessed. \item[{\em pclient}][IN] ressource allocated by the client for the nfs management.  [OUT] returned status.\end{description}
\end{Desc}
\begin{Desc}
\item[Returns:]CACHE\_\-CONTENT\_\-SUCCESS is successful . \end{Desc}


Definition at line 202 of file cache\_\-content\_\-rdwr.c.

Referenced by cache\_\-content\_\-rdwr().\index{cache_content_rdwr.c@{cache\_\-content\_\-rdwr.c}!cache_content_open@{cache\_\-content\_\-open}}
\index{cache_content_open@{cache\_\-content\_\-open}!cache_content_rdwr.c@{cache\_\-content\_\-rdwr.c}}
\subsubsection{\setlength{\rightskip}{0pt plus 5cm}cache\_\-content\_\-status\_\-t cache\_\-content\_\-open (cache\_\-content\_\-entry\_\-t $\ast$ {\em pentry}, cache\_\-content\_\-client\_\-t $\ast$ {\em pclient}, cache\_\-content\_\-status\_\-t $\ast$ {\em pstatus})}\label{cache__content__rdwr_8c_a2}


cache\_\-content\_\-open: opens the local fd on the cache.

Opens the local fd on the cache.

No lock management is done in this layer: the related pentry in the cache inode layer is locked and will prevent from concurent accesses.

\begin{Desc}
\item[Parameters:]
\begin{description}
\item[{\em pentry}][IN] entry in file content layer whose content is to be accessed. \item[{\em pclient}][IN] ressource allocated by the client for the nfs management.  [OUT] returned status.\end{description}
\end{Desc}
\begin{Desc}
\item[Returns:]CACHE\_\-CONTENT\_\-SUCCESS is successful . \end{Desc}


Definition at line 130 of file cache\_\-content\_\-rdwr.c.

Referenced by cache\_\-content\_\-rdwr().\index{cache_content_rdwr.c@{cache\_\-content\_\-rdwr.c}!cache_content_rdwr@{cache\_\-content\_\-rdwr}}
\index{cache_content_rdwr@{cache\_\-content\_\-rdwr}!cache_content_rdwr.c@{cache\_\-content\_\-rdwr.c}}
\subsubsection{\setlength{\rightskip}{0pt plus 5cm}cache\_\-content\_\-status\_\-t cache\_\-content\_\-rdwr (cache\_\-content\_\-entry\_\-t $\ast$ {\em pentry}, cache\_\-content\_\-io\_\-direction\_\-t {\em read\_\-or\_\-write}, fsal\_\-seek\_\-t $\ast$ {\em seek\_\-descriptor}, fsal\_\-size\_\-t $\ast$ {\em pio\_\-size\_\-in}, fsal\_\-size\_\-t $\ast$ {\em pio\_\-size\_\-out}, caddr\_\-t {\em buffer}, fsal\_\-boolean\_\-t $\ast$ {\em p\_\-fsal\_\-eof}, struct stat $\ast$ {\em pbuffstat}, cache\_\-content\_\-client\_\-t $\ast$ {\em pclient}, fsal\_\-op\_\-context\_\-t $\ast$ {\em pcontext}, cache\_\-content\_\-status\_\-t $\ast$ {\em pstatus})}\label{cache__content__rdwr_8c_a4}


cache\_\-content\_\-rdwr: Reads/Writes through the cache layer.

Reads/Writes through the cache layer. This routine should be called only from the cache\_\-inode layer.

No lock management is done in this layer: the related pentry in the cache inode layer is locked and will prevent from concurent accesses.

\begin{Desc}
\item[Parameters:]
\begin{description}
\item[{\em pentry}][IN] entry in file content layer whose content is to be accessed. \item[{\em read\_\-or\_\-write}][IN] a flag of type cache\_\-content\_\-io\_\-direction\_\-t to tell if a read or write is to be done. \item[{\em seek\_\-descriptor}][IN] absolute position (in the FSAL file) where the IO will be done. \item[{\em pio\_\-size\_\-in}][IN] requested io size \item[{\em pio\_\-size\_\-out}][OUT] the size of the io that was successfully made. \item[{\em pbuffstat}][OUT] the 'stat' of entry in the data cache after the operation \item[{\em buffer}]write:[IN] read:[OUT] the buffer for the data. \item[{\em pclient}][IN] ressource allocated by the client for the nfs management. \item[{\em pcontext}][IN] fsal credentials for the operation.  [OUT] returned status.\end{description}
\end{Desc}
\begin{Desc}
\item[Returns:]CACHE\_\-CONTENT\_\-SUCCESS is successful . \end{Desc}


Definition at line 255 of file cache\_\-content\_\-rdwr.c.

References cache\_\-content\_\-close(), cache\_\-content\_\-fsal\_\-seek\_\-convert(), cache\_\-content\_\-fsal\_\-size\_\-convert(), cache\_\-content\_\-open(), cache\_\-content\_\-valid(), pread(), and pwrite().\index{cache_content_rdwr.c@{cache\_\-content\_\-rdwr.c}!pread@{pread}}
\index{pread@{pread}!cache_content_rdwr.c@{cache\_\-content\_\-rdwr.c}}
\subsubsection{\setlength{\rightskip}{0pt plus 5cm}ssize\_\-t pread (int {\em fd}, void $\ast$ {\em buf}, size\_\-t {\em count}, off\_\-t {\em offset})}\label{cache__content__rdwr_8c_a0}




Referenced by cache\_\-content\_\-rdwr().\index{cache_content_rdwr.c@{cache\_\-content\_\-rdwr.c}!pwrite@{pwrite}}
\index{pwrite@{pwrite}!cache_content_rdwr.c@{cache\_\-content\_\-rdwr.c}}
\subsubsection{\setlength{\rightskip}{0pt plus 5cm}ssize\_\-t pwrite (int {\em fd}, const void $\ast$ {\em buf}, size\_\-t {\em count}, off\_\-t {\em offset})}\label{cache__content__rdwr_8c_a1}




Referenced by cache\_\-content\_\-rdwr().